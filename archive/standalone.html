<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIfluence - AI-Powered Social Media Intelligence</title>
    <!-- SECURITY HEADERS -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https: data: blob:; script-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdn.tailwindcss.com; font-src 'self' https://fonts.gstatic.com; connect-src 'self' https: ws: wss: http://localhost:*; img-src 'self' https: data: blob:; frame-src 'none';">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGRlZnM+CjxsaW5lYXJHcmFkaWVudCBpZD0iZ3JhZGllbnQiIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMTAwJSIgeTI9IjEwMCUiPgo8c3RvcCBvZmZzZXQ9IjAlIiBzdHlsZT0ic3RvcC1jb2xvcjojMTQ5N0ZGO3N0b3Atb3BhY2l0eToxIiAvPgo8c3RvcCBvZmZzZXQ9IjUwJSIgc3R5bGU9InN0b3AtY29sb3I6IzhCNUNGNjtzdG9wLW9wYWNpdHk6MSIgLz4KPHN0b3Agb2Zmc2V0PSIxMDAlIiBzdHlsZT0ic3RvcC1jb2xvcjojRkY3MEIyO3N0b3Atb3BhY2l0eToxIiAvPgo8L2xpbmVhckdyYWRpZW50Pgo8L2RlZnM+CjxyZWN0IHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgcng9IjgiIGZpbGw9InVybCgjZ3JhZGllbnQpIi8+CjxwYXRoIGQ9Ik0xMCA4SDIyQzIzLjEwNDYgOCAyNCA4Ljg5NTQzIDI0IDEwVjE0QzI0IDE1LjEwNDYgMjMuMTA0NiAxNiAyMiAxNkgxOEwxNCAyMFYxNkgxMEM4Ljg5NTQzIDE2IDggMTUuMTA0NiA4IDE0VjEwQzggOC44OTU0MyA4Ljg5NTQzIDggMTAgOFoiIGZpbGw9IndoaXRlIiBmaWxsLW9wYWNpdHk9IjAuOSIvPgo8Y2lyY2xlIGN4PSIxMiIgY3k9IjEyIiByPSIxLjUiIGZpbGw9InVybCgjZ3JhZGllbnQpIi8+CjxjaXJjbGUgY3g9IjE2IiBjeT0iMTIiIHI9IjEuNSIgZmlsbD0idXJsKCNncmFkaWVudCkiLz4KPGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMS41IiBmaWxsPSJ1cmwoI2dyYWRpZW50KSIvPgo8cGF0aCBkPSJNMTQgMjJDMTYuNzYxNCAyMiAxOSAyNC4yMzg2IDE5IDI3SDlDOSAyNC4yMzg2IDExLjIzODYgMjIgMTQgMjJaIiBmaWxsPSJ3aGl0ZSIgZmlsbC1vcGFjaXR5PSIwLjciLz4KPC9zdmc+">
    <meta name="description" content="AI-powered social media intelligence platform for creating, scheduling, and analyzing LinkedIn content">
    <!-- Using Tailwind CDN for demo purposes. In production, use Tailwind CLI or PostCSS plugin -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Temporarily disabled external scripts that might be causing issues -->
    <!-- <script src="https://js.stripe.com/v3/"></script> -->
    <!-- <script src="https://www.paypal.com/sdk/js?client-id=YOUR_PAYPAL_CLIENT_ID_HERE&currency=USD"></script> -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'linkedin': '#0077B5',
                        'linkedin-hover': '#005885',
                        'aifluence': {
                            '50': '#eff8ff',
                            '100': '#dbeefe',
                            '200': '#bfe2fe',
                            '300': '#93d0fd',
                            '400': '#60b4fa',
                            '500': '#3b97f6',
                            '600': '#1497ff',
                            '700': '#0c6adf',
                            '800': '#1155b5',
                            '900': '#154a8e'
                        },
                        'hootsuite': {
                            'dark': '#1a1a1a',
                            'darker': '#0f0f0f',
                            'panel': '#1e1e1e',
                            'border': '#2a2a2a',
                            'accent': '#5e17eb',
                            'text': '#e5e5e5',
                            'text-muted': '#a0a0a0'
                        }
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        
        /* Drag and Drop Styles */
        .post-card {
            transition: all 0.2s ease;
        }
        
        .post-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        .post-card.dragging {
            opacity: 0.5;
            transform: rotate(2deg);
        }
        
        .drag-handle:hover {
            cursor: grab;
        }
        
        .drag-handle:active {
            cursor: grabbing;
        }
        
        /* Text truncation */
        .line-clamp-3 {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        /* Scheduling Preview Styles */
        .schedule-preview-item {
            transition: all 0.2s ease;
            cursor: move;
        }
        
        .schedule-preview-item:hover {
            background-color: rgba(71, 85, 105, 0.5);
        }
        
        .schedule-preview-item.dragging {
            opacity: 0.5;
            transform: rotate(1deg);
        }
        
        .schedule-preview-item .drag-handle {
            cursor: grab;
        }
        
        /* Payment Method Selection */
        .payment-method-btn {
            border: 2px solid #475569;
        }
        
        .payment-method-btn.active {
            border-color: #3b82f6;
            background-color: rgba(59, 130, 246, 0.1);
        }
        
        .schedule-preview-item .drag-handle:active {
            cursor: grabbing;
        }
        
        /* Payment Method Card Styles */
        .payment-method-card {
            transition: all 0.2s ease;
        }
        
        .payment-method-card:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        .payment-method-card.selected {
            border-color: #3B82F6 !important;
            background-color: rgba(59, 130, 246, 0.1);
        }
        
        /* Animated Background Styles */
        .floating-pattern {
            position: absolute;
            font-size: 1.5rem;
            opacity: 0.6;
            animation: float 20s infinite ease-in-out;
            pointer-events: none;
        }
        
        .glow-orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(40px);
            animation: glow 15s infinite ease-in-out;
            pointer-events: none;
        }
        
        /* Floating Animation */
        @keyframes float {
            0%, 100% { transform: translateY(0px) translateX(0px) rotate(0deg); }
            25% { transform: translateY(-20px) translateX(10px) rotate(90deg); }
            50% { transform: translateY(0px) translateX(20px) rotate(180deg); }
            75% { transform: translateY(20px) translateX(10px) rotate(270deg); }
        }
        
        /* Glow Animation */
        @keyframes glow {
            0%, 100% { opacity: 0.1; transform: scale(1); }
            50% { opacity: 0.3; transform: scale(1.2); }
        }
        
        /* Individual Pattern Positions and Animations */
        .heart-1 { top: 10%; left: 10%; animation-delay: 0s; }
        .heart-2 { top: 20%; right: 15%; animation-delay: 5s; }
        .heart-3 { bottom: 30%; left: 20%; animation-delay: 10s; }
        .heart-4 { bottom: 10%; right: 25%; animation-delay: 15s; }
        
        .star-1 { top: 30%; left: 70%; animation-delay: 2s; }
        .star-2 { top: 60%; left: 10%; animation-delay: 7s; }
        .star-3 { top: 80%; right: 20%; animation-delay: 12s; }
        .star-4 { top: 40%; right: 40%; animation-delay: 17s; }
        .star-5 { bottom: 50%; left: 50%; animation-delay: 4s; }
        
        .shape-1 { top: 70%; left: 30%; animation-delay: 3s; }
        .shape-2 { top: 15%; left: 50%; animation-delay: 8s; }
        .shape-3 { bottom: 60%; right: 30%; animation-delay: 13s; }
        .shape-4 { top: 45%; left: 15%; animation-delay: 18s; }
        .shape-5 { bottom: 20%; right: 60%; animation-delay: 1s; }
        
        .tech-1 { top: 25%; right: 10%; animation-delay: 6s; }
        .tech-2 { bottom: 40%; left: 60%; animation-delay: 11s; }
        .tech-3 { top: 55%; right: 50%; animation-delay: 16s; }
        .tech-4 { bottom: 80%; left: 40%; animation-delay: 9s; }
        
        /* Glow Orb Styles */
        .glow-1 {
            top: 20%;
            left: 20%;
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, rgba(59, 130, 246, 0.2) 0%, transparent 70%);
            animation-delay: 0s;
        }
        
        .glow-2 {
            top: 60%;
            right: 20%;
            width: 150px;
            height: 150px;
            background: radial-gradient(circle, rgba(139, 92, 246, 0.2) 0%, transparent 70%);
            animation-delay: 5s;
        }
        
        .glow-3 {
            bottom: 30%;
            left: 30%;
            width: 180px;
            height: 180px;
            background: radial-gradient(circle, rgba(236, 72, 153, 0.2) 0%, transparent 70%);
            animation-delay: 10s;
        }
        
        .glow-4 {
            top: 40%;
            right: 50%;
            width: 120px;
            height: 120px;
            background: radial-gradient(circle, rgba(34, 197, 94, 0.2) 0%, transparent 70%);
            animation-delay: 15s;
        }
        
        .glow-5 {
            bottom: 10%;
            right: 40%;
            width: 160px;
            height: 160px;
            background: radial-gradient(circle, rgba(251, 146, 60, 0.2) 0%, transparent 70%);
            animation-delay: 3s;
        }
    </style>
    
    <!-- API Configuration -->
    <script>
        // API Configuration for frontend-backend communication
        window.API_CONFIG = {
            // Detect environment and set appropriate base URL
            BASE_URL: window.location.protocol === 'file:' 
                ? 'http://localhost:3001' 
                : window.location.protocol + '//' + window.location.hostname + ':3001',
            
            // API endpoints
            ENDPOINTS: {
                // Authentication
                REGISTER: '/api/auth/register',
                LOGIN: '/api/auth/login',
                VERIFY: '/api/auth/verify',
                REFRESH: '/api/auth/refresh',
                
                // User management
                USER_PROFILE: '/api/users/profile',
                USER_STATS: '/api/users/stats',
                CHANGE_PASSWORD: '/api/users/password',
                DELETE_ACCOUNT: '/api/users/account',
                
                // Posts
                POSTS: '/api/posts',
                PUBLISH_POST: (id) => `/api/posts/${id}/publish`,
                
                // LinkedIn
                LINKEDIN_CONNECTION: '/api/linkedin/connection',
                LINKEDIN_AUTH: '/api/linkedin/auth',
                LINKEDIN_CALLBACK: '/api/linkedin/callback',
                LINKEDIN_POST: '/api/linkedin/post',
                
                // Analytics
                ANALYTICS_EVENT: '/api/analytics/event',
                ANALYTICS_STATS: '/api/analytics/stats',
                
                // AI Services (proxy through backend)
                OPENAI_IMAGES: '/api/openai/images'
            },
            
            // Default request headers
            DEFAULT_HEADERS: {
                'Content-Type': 'application/json',
                'Accept': 'application/json'
            },
            
            // Get authorization header with token
            getAuthHeaders: function() {
                const token = localStorage.getItem('aifluence_auth_token');
                return token ? { 
                    ...this.DEFAULT_HEADERS, 
                    'Authorization': `Bearer ${token}` 
                } : this.DEFAULT_HEADERS;
            }
        };
        
        // API helper functions
        window.apiRequest = async function(endpoint, options = {}) {
            const url = API_CONFIG.BASE_URL + endpoint;
            const config = {
                headers: API_CONFIG.getAuthHeaders(),
                ...options
            };
            
            try {
                console.log(`üåê API Request: ${options.method || 'GET'} ${url}`);
                const response = await fetch(url, config);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log(`‚úÖ API Response: ${endpoint}`, data);
                return data;
            } catch (error) {
                console.error(`‚ùå API Error: ${endpoint}`, error);
                
                // Handle authentication errors
                if (error.message.includes('401') || error.message.includes('403')) {
                    localStorage.removeItem('aifluence_auth_token');
                    if (typeof showToast === 'function') {
                        showToast('Session expired. Please login again.', 'error');
                    }
                }
                
                throw error;
            }
        };
        
        console.log('‚úÖ API Configuration loaded');
        console.log('üì° API Base URL:', API_CONFIG.BASE_URL);
    </script>
    
    <!-- Global Logout Functions - Available immediately -->
    <script>
        // Define logout functions in global scope immediately
        window.handleLogout = function() {
            console.log('üîÑ handleLogout function called');
            if (confirm('Are you sure you want to sign out?')) {
                console.log('‚úÖ User confirmed logout');
                
                // Clear all session-related data (but keep LinkedIn connection)
                localStorage.removeItem('socialMediaAgent_currentUserId');
                localStorage.removeItem('socialMediaAgent_persistentLogin');
                localStorage.removeItem('socialMediaAgent_currentSession');
                console.log('üíæ Cleared session data (LinkedIn connection preserved)');
                
                // Hide user header
                const userHeader = document.getElementById('user-header');
                if (userHeader) {
                    userHeader.classList.add('hidden');
                    console.log('‚úÖ User header hidden');
                }
                
                // Show auth modal
                const authModal = document.getElementById('auth-modal');
                if (authModal) {
                    authModal.classList.remove('hidden');
                    console.log('‚úÖ Auth modal shown');
                }
                
                // Reset user header to default values
                const userNameEl = document.getElementById('user-name');
                const userEmailEl = document.getElementById('user-email');
                const userAvatarEl = document.getElementById('user-avatar');
                
                if (userNameEl) userNameEl.textContent = 'User';
                if (userEmailEl) userEmailEl.textContent = 'user@example.com';
                if (userAvatarEl) userAvatarEl.textContent = 'U';
                
                // Switch back to login form
                const registerForm = document.getElementById('register-form');
                const loginForm = document.getElementById('login-form');
                if (registerForm) registerForm.classList.add('hidden');
                if (loginForm) loginForm.classList.remove('hidden');
                
                // Switch to generator tab (away from settings)
                if (typeof showTab === 'function') {
                    showTab('generator');
                    console.log('‚úÖ Switched to generator tab');
                }
                
                // Clear global variables if they exist
                if (typeof currentUser !== 'undefined') {
                    currentUser = null;
                }
                if (typeof isLoggedIn !== 'undefined') {
                    isLoggedIn = false;
                }
                
                console.log('‚úÖ Logout completed successfully');
                
                // Show success message
                setTimeout(() => {
                    if (typeof showToast === 'function') {
                        showToast('You have been signed out successfully', 'success');
                    } else {
                        alert('You have been signed out successfully');
                    }
                }, 100);
            } else {
                console.log('‚ùå User cancelled logout');
            }
        };
        
        // Fallback logout function
        window.logout = function() {
            console.log('üîÑ logout function called (redirecting to handleLogout)');
            window.handleLogout();
        };
        
        console.log('‚úÖ Global logout functions loaded');
        
        // Content Generator Functions
        window.generateLinkedInPost = function() {
            console.log('üöÄ Generating LinkedIn post...');
            
            const topic = document.getElementById('custom-topic')?.value || 'AI Readiness Assessment';
            const audience = document.getElementById('custom-audience')?.value || 'C-level executives and business leaders';
            const tone = document.getElementById('custom-tone')?.value || 'Professional and authoritative';
            
            // Show loading state
            const btn = document.getElementById('generate-btn');
            const originalContent = btn.innerHTML;
            btn.innerHTML = '<div class="flex items-center space-x-2"><svg class="h-4 w-4 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg><span>Generating AI Content...</span></div>';
            btn.disabled = true;
            
            // Content templates based on topic and audience
            const templates = [
                `üöÄ ${topic} for ${audience}:\n\n‚úÖ Key insight: AI isn't about replacing humans, it's about amplifying potential\n‚úÖ Focus on strategy before technology\n‚úÖ Start small, scale smart\n\nWhat's your experience with AI implementation? Share your thoughts! üëá\n\n#AI #DigitalTransformation #Leadership #Innovation`,
                
                `üí° Thinking about ${topic}?\n\nHere's what ${audience} need to know:\n\nüéØ Start with clear business objectives\nüéØ Invest in your team's skills first\nüéØ Measure impact, not just implementation\nüéØ Build trust through transparency\n\nWhat challenges have you faced? Let's discuss!\n\n#ArtificialIntelligence #BusinessStrategy #Leadership`,
                
                `üìä ${topic} Reality Check:\n\n‚ùå Common mistake: Technology-first approach\n‚úÖ Better approach: Business-value-first\n\nFor ${audience}, success means:\n‚Ä¢ Clear ROI measurement\n‚Ä¢ Employee empowerment\n‚Ä¢ Sustainable integration\n‚Ä¢ Customer value creation\n\nWhat's your take on this? üí≠\n\n#AI #Innovation #Leadership #BusinessTransformation`,
                
                `üéØ ${topic} - A Strategic Perspective:\n\n"The future belongs to organizations that can adapt quickly."\n\nFor ${audience}, this means:\n‚Üí Embracing AI as a strategic advantage\n‚Üí Focusing on human-AI collaboration\n‚Üí Building resilient, adaptive systems\n‚Üí Creating value for all stakeholders\n\nHow is your organization preparing for the AI-driven future?\n\n#AI #Strategy #Leadership #FutureOfWork`,
                
                `üîç ${topic} Insights:\n\nAfter working with hundreds of organizations, I've learned:\n\n1Ô∏è‚É£ AI success starts with clear vision\n2Ô∏è‚É£ Culture beats technology every time\n3Ô∏è‚É£ Small wins build momentum\n4Ô∏è‚É£ Continuous learning is essential\n\n${audience} who get this right see 3x faster adoption rates.\n\nWhat's your biggest AI challenge right now?\n\n#AI #DigitalTransformation #Leadership #Innovation`
            ];
            
            // Simulate processing time
            setTimeout(() => {
                const randomTemplate = templates[Math.floor(Math.random() * templates.length)];
                
                // Display generated content
                const contentDisplay = document.getElementById('content-text');
                const generatedSection = document.getElementById('generated-content');
                const charCount = document.getElementById('char-count');
                
                if (contentDisplay && generatedSection) {
                    contentDisplay.textContent = randomTemplate;
                    charCount.textContent = `Character count: ${randomTemplate.length}`;
                    generatedSection.classList.remove('hidden');
                    
                    // Scroll to generated content
                    generatedSection.scrollIntoView({ behavior: 'smooth' });
                }
                
                // Reset button
                btn.innerHTML = originalContent;
                btn.disabled = false;
                
                // Show success message
                if (typeof showToast === 'function') {
                    showToast('‚ú® LinkedIn post generated successfully!', 'success');
                } else {
                    console.log('‚ú® Content generated successfully!');
                }
                
                console.log('‚úÖ LinkedIn post generated');
            }, 1500); // 1.5 second delay to simulate AI processing
        };
        
        // Media insertion functions
        window.insertMedia = function() {
            console.log('üñºÔ∏è Opening media insertion...');
            
            const mediaOptions = [
                { type: 'image', title: 'Professional AI Infographic', description: 'Clean, modern infographic about AI trends' },
                { type: 'chart', title: 'AI Adoption Statistics', description: 'Data visualization showing AI adoption rates' },
                { type: 'quote', title: 'Inspirational Quote Card', description: 'Motivational quote about innovation' },
                { type: 'diagram', title: 'AI Implementation Process', description: 'Step-by-step process diagram' }
            ];
            
            const mediaHtml = mediaOptions.map(option => `
                <div class="bg-slate-700/50 border border-slate-600 rounded-lg p-4 hover:bg-slate-700/70 cursor-pointer transition-colors" onclick="selectMedia('${option.type}')">
                    <h4 class="text-white font-medium">${option.title}</h4>
                    <p class="text-slate-400 text-sm">${option.description}</p>
                </div>
            `).join('');
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4';
            modal.innerHTML = `
                <div class="bg-slate-800 rounded-xl p-6 w-full max-w-md border border-slate-700">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-white">Insert Media</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-slate-400 hover:text-slate-200">
                            <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    <div class="space-y-3">
                        ${mediaHtml}
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        };
        
        window.selectMedia = function(type) {
            console.log('üéØ Media selected:', type);
            
            // Close modal
            const modal = document.querySelector('.fixed.inset-0');
            if (modal) modal.remove();
            
            // Show media section
            const mediaSection = document.getElementById('media-section');
            if (mediaSection) {
                mediaSection.classList.remove('hidden');
                
                // Update primary visual based on type
                const primaryVisual = document.getElementById('primary-visual');
                const mediaType = document.getElementById('media-type');
                const visualDescription = document.getElementById('visual-description');
                
                if (primaryVisual) {
                    const mediaContent = {
                        'image': { 
                            emoji: 'üñºÔ∏è', 
                            text: 'Professional AI Infographic',
                            description: 'Clean, modern infographic about AI trends and business impact',
                            typeLabel: 'AI Image'
                        },
                        'chart': { 
                            emoji: 'üìä', 
                            text: 'AI Adoption Statistics Chart',
                            description: 'Data visualization showing AI adoption rates across industries',
                            typeLabel: 'Data Chart'
                        },
                        'quote': { 
                            emoji: 'üí≠', 
                            text: 'Inspirational Quote Card',
                            description: 'Motivational quote about innovation and AI transformation',
                            typeLabel: 'Quote Card'
                        },
                        'diagram': { 
                            emoji: 'üìã', 
                            text: 'AI Implementation Process',
                            description: 'Step-by-step process diagram for AI implementation',
                            typeLabel: 'Process Diagram'
                        }
                    };
                    
                    const content = mediaContent[type] || { 
                        emoji: 'üñºÔ∏è', 
                        text: 'Media Content',
                        description: 'Professional visual content for LinkedIn post',
                        typeLabel: 'AI Image'
                    };
                    
                    primaryVisual.innerHTML = `
                        <div class="text-center py-8">
                            <div class="text-6xl mb-4">${content.emoji}</div>
                            <p class="text-white font-medium text-lg">${content.text}</p>
                            <p class="text-slate-400 text-sm mt-2">Ready for LinkedIn post</p>
                        </div>
                    `;
                    
                    if (mediaType) {
                        mediaType.textContent = content.typeLabel;
                    }
                    
                    if (visualDescription) {
                        visualDescription.textContent = content.description;
                    }
                }
            }
            
            if (typeof showToast === 'function') {
                showToast(`üìé ${type} media added to post`, 'success');
            }
        };
        
        // Attach event listeners when DOM loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üéØ Content Generator: Attaching event listeners...');
            
            // Generate button
            const generateBtn = document.getElementById('generate-btn');
            if (generateBtn) {
                generateBtn.onclick = window.generateLinkedInPost;
                console.log('‚úÖ Generate LinkedIn post button attached');
            }
            
            // Media insertion buttons
            const insertMediaBtns = document.querySelectorAll('[onclick*="insertMedia"]');
            insertMediaBtns.forEach(btn => {
                btn.onclick = window.insertMedia;
            });
            
            console.log('‚úÖ Content generator ready!');
        });
        
        console.log('‚úÖ Content generator functions loaded');
        
        // Post Action Functions
        window.regenerateMedia = function() {
            console.log('üîÑ Regenerating post...');
            
            // Simply call the generate function again
            window.generateLinkedInPost();
        };
        
        window.generateMultiplePosts = async function() {
            console.log('üî• Generating 5 posts with auto-scheduling...');
            
            const topic = document.getElementById('custom-topic')?.value || 'AI Readiness Assessment';
            const audience = document.getElementById('custom-audience')?.value || 'C-level executives and business leaders';
            const tone = document.getElementById('custom-tone')?.value || 'Professional and authoritative';
            
            // Show loading state
            const btn = document.querySelector('[onclick*="generateMultiplePosts"]');
            const originalContent = btn?.innerHTML;
            if (btn) {
                btn.innerHTML = '<div class="flex items-center space-x-2"><svg class="h-4 w-4 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg><span>Generating 5 Posts...</span></div>';
                btn.disabled = true;
            }
            
            try {
                // Generate 5 different posts with various angles
                const templates = [
                    `üöÄ ${topic} Strategy for ${audience}:\n\n‚úÖ Start with business objectives first\n‚úÖ Build cross-functional teams\n‚úÖ Measure impact, not just implementation\n\n3 key lessons from successful AI adoptions:\n1Ô∏è‚É£ Culture beats technology\n2Ô∏è‚É£ Small pilots lead to big wins\n3Ô∏è‚É£ Continuous learning is essential\n\nWhat's your experience? Share below! üëá\n\n#AI #DigitalTransformation #Leadership`,
                    
                    `üí° ${topic} Reality Check:\n\n"The biggest risk is not taking any risk at all."\n\nFor ${audience}, AI isn't just about efficiency‚Äîit's about:\n‚Üí Creating new revenue streams\n‚Üí Enhancing customer experiences\n‚Üí Empowering your workforce\n‚Üí Building competitive advantages\n\nThe question isn't IF you'll adopt AI, but HOW FAST you can do it responsibly.\n\nWhat's holding your organization back?\n\n#ArtificialIntelligence #Innovation #BusinessStrategy`,
                    
                    `üìä ${topic} Data Points:\n\n‚Ä¢ 73% of executives say AI will significantly impact their industry\n‚Ä¢ Companies with AI-first strategies are 2.3x more likely to exceed growth targets\n‚Ä¢ But only 23% have successfully scaled AI beyond pilots\n\nThe gap? Strategic planning and change management.\n\n${audience} who get this right focus on:\n‚úì Clear governance frameworks\n‚úì Employee upskilling programs\n‚úì Ethical AI practices\n‚úì Measurable outcomes\n\nWhich area needs the most attention in your organization?\n\n#AI #DataDriven #Leadership`,
                    
                    `üéØ ${topic} Framework:\n\nAfter working with 100+ organizations, here's what successful AI adoption looks like:\n\nüèóÔ∏è FOUNDATION\n‚Ä¢ Executive alignment on vision\n‚Ä¢ Cross-functional AI governance\n‚Ä¢ Data infrastructure readiness\n\n‚ö° EXECUTION\n‚Ä¢ Start with high-value, low-risk use cases\n‚Ä¢ Build internal capabilities\n‚Ä¢ Create feedback loops\n\nüìà SCALE\n‚Ä¢ Standardize successful patterns\n‚Ä¢ Invest in change management\n‚Ä¢ Measure business impact\n\n${audience}: Which phase is your biggest challenge?\n\n#AI #DigitalTransformation #Strategy`,
                    
                    `üîÆ The Future of ${topic}:\n\nWe're at an inflection point.\n\nThe next 2 years will separate the leaders from the followers.\n\n${audience} who thrive will:\nüåü Embrace AI as a strategic partner, not just a tool\nüåü Build human-AI collaboration models\nüåü Create adaptive, learning organizations\nüåü Focus on augmenting human potential\n\nThe opportunities are massive, but the window is narrowing.\n\nWhat's your organization's AI vision for 2025?\n\nLet's discuss in the comments! üí¨\n\n#FutureOfWork #AI #Leadership #Innovation`
                ];
                
                // Calculate optimal scheduling times for each post
                const generatedPosts = templates.map((template, index) => {
                    const optimalTime = window.getPersonalizedOptimalTime(Math.floor(index / 2));
                    const scheduleTime = new Date(optimalTime.date);
                    
                    // Spread posts across different optimal times
                    const timeOffsets = [0, 3, 24, 27, 48]; // Hours to add (spreading across days)
                    scheduleTime.setHours(scheduleTime.getHours() + timeOffsets[index]);
                    
                    return {
                        id: `batch-post-${Date.now()}-${index}`,
                        content: template,
                        topic: topic,
                        audience: audience,
                        variation: ['Strategy', 'Reality Check', 'Data-driven', 'Framework', 'Future Vision'][index],
                        scheduledTime: scheduleTime.toISOString(),
                        optimalReason: optimalTime.reason || 'LinkedIn best practice time',
                        isScheduled: false,
                        selected: false,
                        order: index,
                        characters: template.length
                    };
                });
                
                // Restore button state
                if (btn) {
                    btn.innerHTML = originalContent;
                    btn.disabled = false;
                }
                
                // Show the batch scheduling modal
                window.showBatchSchedulingModal(generatedPosts);
                
                if (typeof showToast === 'function') {
                    showToast('üéâ 5 posts generated with smart auto-scheduling!', 'success');
                }
                
            } catch (error) {
                console.error('Error generating multiple posts:', error);
                
                // Restore button state
                if (btn) {
                    btn.innerHTML = originalContent;
                    btn.disabled = false;
                }
                
                if (typeof showToast === 'function') {
                    showToast('‚ùå Error generating posts. Please try again.', 'error');
                }
            }
        };
        
        // Intelligent Auto-Scheduling System
        window.getOptimalPostingTimes = function() {
            const now = new Date();
            const userTimezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
            
            // LinkedIn optimal posting times based on research data
            const optimalTimes = {
                weekdays: [
                    { hour: 9, minute: 0, reason: 'Morning work start - highest engagement' },
                    { hour: 12, minute: 0, reason: 'Lunch break - peak browsing time' },
                    { hour: 17, minute: 0, reason: 'End of workday - content consumption' },
                    { hour: 10, minute: 30, reason: 'Mid-morning productivity break' },
                    { hour: 14, minute: 30, reason: 'Afternoon energy boost' }
                ],
                weekends: [
                    { hour: 10, minute: 0, reason: 'Weekend leisure browsing' },
                    { hour: 14, minute: 0, reason: 'Afternoon weekend activity' },
                    { hour: 19, minute: 0, reason: 'Evening social media time' }
                ]
            };
            
            // Industry-specific adjustments for B2B content
            const industryMultipliers = {
                'technology': { morningBoost: 1.2, afternoonBoost: 1.1 },
                'business': { morningBoost: 1.3, lunchBoost: 1.2 },
                'education': { afternoonBoost: 1.2, eveningBoost: 0.9 }
            };
            
            return { optimalTimes, userTimezone, industryMultipliers };
        };

        // Engagement Analytics System
        window.analyzePostPerformance = function() {
            // Get historical post data from localStorage or API
            const historicalPosts = JSON.parse(localStorage.getItem('historicalPosts') || '[]');
            const performanceData = {
                hourlyEngagement: {},
                dayOfWeekEngagement: {},
                topicPerformance: {},
                personalizedOptimalTimes: []
            };
            
            // Analyze engagement by hour of day
            historicalPosts.forEach(post => {
                if (post.publishedAt && post.engagement) {
                    const publishTime = new Date(post.publishedAt);
                    const hour = publishTime.getHours();
                    const dayOfWeek = publishTime.getDay();
                    
                    if (!performanceData.hourlyEngagement[hour]) {
                        performanceData.hourlyEngagement[hour] = { totalEngagement: 0, postCount: 0 };
                    }
                    performanceData.hourlyEngagement[hour].totalEngagement += post.engagement;
                    performanceData.hourlyEngagement[hour].postCount += 1;
                    
                    if (!performanceData.dayOfWeekEngagement[dayOfWeek]) {
                        performanceData.dayOfWeekEngagement[dayOfWeek] = { totalEngagement: 0, postCount: 0 };
                    }
                    performanceData.dayOfWeekEngagement[dayOfWeek].totalEngagement += post.engagement;
                    performanceData.dayOfWeekEngagement[dayOfWeek].postCount += 1;
                    
                    // Analyze topic performance
                    if (post.topic) {
                        if (!performanceData.topicPerformance[post.topic]) {
                            performanceData.topicPerformance[post.topic] = { totalEngagement: 0, postCount: 0 };
                        }
                        performanceData.topicPerformance[post.topic].totalEngagement += post.engagement;
                        performanceData.topicPerformance[post.topic].postCount += 1;
                    }
                }
            });
            
            // Calculate average engagement for each hour
            Object.keys(performanceData.hourlyEngagement).forEach(hour => {
                const data = performanceData.hourlyEngagement[hour];
                data.averageEngagement = data.totalEngagement / data.postCount;
            });
            
            // Find personalized optimal times (top 3 performing hours)
            const sortedHours = Object.keys(performanceData.hourlyEngagement)
                .map(hour => ({
                    hour: parseInt(hour),
                    avgEngagement: performanceData.hourlyEngagement[hour].averageEngagement,
                    postCount: performanceData.hourlyEngagement[hour].postCount
                }))
                .filter(data => data.postCount >= 2) // Only include hours with at least 2 posts
                .sort((a, b) => b.avgEngagement - a.avgEngagement)
                .slice(0, 3);
            
            performanceData.personalizedOptimalTimes = sortedHours.map(data => ({
                hour: data.hour,
                minute: 0,
                reason: `Your best performing time (${data.avgEngagement.toFixed(1)} avg engagement)`,
                confidence: data.postCount >= 5 ? 'high' : data.postCount >= 3 ? 'medium' : 'low'
            }));
            
            return performanceData;
        };

        window.getPersonalizedOptimalTime = function(daysAhead = 0) {
            const performanceData = window.analyzePostPerformance();
            const { optimalTimes } = window.getOptimalPostingTimes();
            
            // If we have personalized data, use it; otherwise fall back to general best practices
            if (performanceData.personalizedOptimalTimes.length > 0) {
                const targetDate = new Date();
                targetDate.setDate(targetDate.getDate() + daysAhead);
                
                const isWeekend = targetDate.getDay() === 0 || targetDate.getDay() === 6;
                
                // For weekdays, use personalized data; for weekends, use general data
                const timeOptions = !isWeekend && performanceData.personalizedOptimalTimes.length > 0 
                    ? performanceData.personalizedOptimalTimes 
                    : (isWeekend ? optimalTimes.weekends : optimalTimes.weekdays);
                
                // If today, find next available optimal time
                if (daysAhead === 0) {
                    const now = new Date();
                    const availableTimes = timeOptions.filter(time => {
                        const optimalDateTime = new Date(targetDate);
                        optimalDateTime.setHours(time.hour, time.minute, 0, 0);
                        return optimalDateTime > now;
                    });
                    
                    if (availableTimes.length > 0) {
                        const nextTime = availableTimes[0];
                        targetDate.setHours(nextTime.hour, nextTime.minute, 0, 0);
                        return { 
                            date: targetDate, 
                            reason: nextTime.reason,
                            isPersonalized: !isWeekend && performanceData.personalizedOptimalTimes.length > 0,
                            confidence: nextTime.confidence || 'general'
                        };
                    }
                    
                    // No times left today, get first optimal time tomorrow
                    return window.getPersonalizedOptimalTime(1);
                }
                
                // Future date - use first optimal time
                const bestTime = timeOptions[0];
                targetDate.setHours(bestTime.hour, bestTime.minute, 0, 0);
                return { 
                    date: targetDate, 
                    reason: bestTime.reason,
                    isPersonalized: !isWeekend && performanceData.personalizedOptimalTimes.length > 0,
                    confidence: bestTime.confidence || 'general'
                };
            }
            
            // Fallback to general optimal time calculation
            return window.calculateNextOptimalTime(daysAhead);
        };

        window.generateEngagementInsights = function() {
            const performanceData = window.analyzePostPerformance();
            const insights = [];
            
            // Best performing hour insight
            if (performanceData.personalizedOptimalTimes.length > 0) {
                const bestHour = performanceData.personalizedOptimalTimes[0];
                const timeStr = bestHour.hour === 12 ? '12 PM' : 
                               bestHour.hour === 0 ? '12 AM' :
                               bestHour.hour > 12 ? `${bestHour.hour - 12} PM` : `${bestHour.hour} AM`;
                
                insights.push({
                    type: 'optimal_time',
                    title: `Your Golden Hour: ${timeStr}`,
                    description: `Posts published around ${timeStr} get your highest engagement. Schedule more content during this window.`,
                    confidence: bestHour.confidence,
                    action: 'schedule_at_optimal_time'
                });
            }
            
            // Day of week performance
            const dayNames = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            const bestDay = Object.keys(performanceData.dayOfWeekEngagement)
                .map(day => ({
                    day: parseInt(day),
                    avgEngagement: performanceData.dayOfWeekEngagement[day].totalEngagement / performanceData.dayOfWeekEngagement[day].postCount
                }))
                .sort((a, b) => b.avgEngagement - a.avgEngagement)[0];
            
            if (bestDay) {
                insights.push({
                    type: 'best_day',
                    title: `${dayNames[bestDay.day]} is Your Power Day`,
                    description: `Your ${dayNames[bestDay.day]} posts consistently outperform other days. Consider scheduling premium content on this day.`,
                    confidence: 'medium',
                    action: 'focus_on_weekday'
                });
            }
            
            // Topic performance insight
            const topTopics = Object.keys(performanceData.topicPerformance)
                .map(topic => ({
                    topic,
                    avgEngagement: performanceData.topicPerformance[topic].totalEngagement / performanceData.topicPerformance[topic].postCount,
                    postCount: performanceData.topicPerformance[topic].postCount
                }))
                .sort((a, b) => b.avgEngagement - a.avgEngagement)
                .slice(0, 2);
            
            if (topTopics.length > 0) {
                insights.push({
                    type: 'content_theme',
                    title: `"${topTopics[0].topic}" Content Resonates Most`,
                    description: `Your audience engages ${(topTopics[0].avgEngagement / (topTopics[1]?.avgEngagement || topTopics[0].avgEngagement) * 100 - 100).toFixed(0)}% more with ${topTopics[0].topic.toLowerCase()} content. Create more posts around this theme.`,
                    confidence: topTopics[0].postCount >= 3 ? 'high' : 'medium',
                    action: 'create_similar_content'
                });
            }
            
            return insights;
        };

        // Initialize demo engagement data for testing
        window.initializeDemoEngagementData = function() {
            if (localStorage.getItem('historicalPosts')) {
                return; // Already have data
            }
            
            const demoData = [
                { publishedAt: '2024-01-15T09:30:00Z', engagement: 1247, topic: 'AI Strategy', content: 'AI isn\'t about replacing humans...' },
                { publishedAt: '2024-01-12T12:15:00Z', engagement: 956, topic: 'AI Implementation', content: 'The #1 mistake companies make...' },
                { publishedAt: '2024-01-10T14:30:00Z', engagement: 834, topic: 'AI Strategy', content: 'Just implemented our first AI workflow...' },
                { publishedAt: '2024-01-08T09:00:00Z', engagement: 1120, topic: 'Leadership', content: 'Leadership in the AI era requires...' },
                { publishedAt: '2024-01-05T12:00:00Z', engagement: 675, topic: 'AI Implementation', content: 'Common AI implementation pitfalls...' },
                { publishedAt: '2024-01-03T17:15:00Z', engagement: 423, topic: 'Future of Work', content: 'The future of work is collaborative...' },
                { publishedAt: '2024-01-01T10:30:00Z', engagement: 1356, topic: 'AI Strategy', content: 'New year, new AI opportunities...' },
                { publishedAt: '2023-12-28T14:45:00Z', engagement: 789, topic: 'Leadership', content: 'Year-end reflection on AI leadership...' },
                { publishedAt: '2023-12-25T11:00:00Z', engagement: 234, topic: 'Future of Work', content: 'Holiday thoughts on work-life balance...' },
                { publishedAt: '2023-12-22T09:15:00Z', engagement: 1098, topic: 'AI Strategy', content: 'Q4 AI strategy review and planning...' }
            ];
            
            localStorage.setItem('historicalPosts', JSON.stringify(demoData));
            console.log('‚úÖ Demo engagement data initialized');
        };

        // Initialize demo data on load
        window.initializeDemoEngagementData();

        // Batch Scheduling Modal with Drag & Drop
        window.showBatchSchedulingModal = function(generatedPosts) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4';
            modal.innerHTML = `
                <div class="bg-slate-800 rounded-xl w-full max-w-6xl max-h-[90vh] border border-slate-700 overflow-hidden">
                    <div class="flex items-center justify-between p-6 border-b border-slate-700">
                        <h3 class="text-xl font-semibold text-white">ü§ñ Smart Batch Scheduling</h3>
                        <div class="flex items-center space-x-4">
                            <button onclick="selectAllBatchPosts()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors">
                                Select All
                            </button>
                            <button onclick="scheduleBatchPosts()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors">
                                Schedule Selected
                            </button>
                            <button onclick="this.closest('.fixed').remove()" class="text-slate-400 hover:text-slate-200">
                                <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                    
                    <div class="flex h-[calc(90vh-120px)]">
                        <!-- Posts Panel -->
                        <div class="w-1/2 p-6 border-r border-slate-700 overflow-y-auto">
                            <h4 class="text-lg font-medium text-white mb-4">Generated Posts</h4>
                            <div id="batch-posts-list" class="space-y-4">
                                ${generatedPosts.map((post, index) => `
                                    <div 
                                        class="post-item bg-slate-700/30 rounded-lg p-4 border border-slate-600 cursor-move hover:border-blue-500 transition-colors" 
                                        draggable="true" 
                                        data-post-id="${post.id}"
                                        data-post-index="${index}"
                                    >
                                        <div class="flex items-center justify-between mb-3">
                                            <div class="flex items-center space-x-3">
                                                <input 
                                                    type="checkbox" 
                                                    id="post-${post.id}" 
                                                    class="post-checkbox h-4 w-4 text-blue-600 bg-slate-600 border-slate-500 rounded focus:ring-blue-500"
                                                    data-post-id="${post.id}"
                                                >
                                                <label for="post-${post.id}" class="text-sm font-medium text-blue-400">
                                                    Post ${index + 1}: ${post.variation}
                                                </label>
                                            </div>
                                            <div class="text-xs text-slate-400">${post.characters} chars</div>
                                        </div>
                                        
                                        <div class="text-slate-300 text-sm mb-3 line-clamp-4 whitespace-pre-wrap">${post.content}</div>
                                        
                                        <div class="flex items-center justify-between text-xs">
                                            <div class="text-slate-400">
                                                üìÖ ${new Date(post.scheduledTime).toLocaleDateString()} at ${new Date(post.scheduledTime).toLocaleTimeString([], {hour: '2-digit', minute: '2-digit'})}
                                            </div>
                                            <div class="text-blue-400">${post.optimalReason}</div>
                                        </div>
                                        
                                        <div class="mt-3 flex space-x-2">
                                            <button onclick="editBatchPost('${post.id}')" class="px-3 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition-colors">
                                                ‚úèÔ∏è Edit
                                            </button>
                                            <button onclick="previewPost('${post.id}')" class="px-3 py-1 bg-purple-600 hover:bg-purple-700 text-white text-xs rounded transition-colors">
                                                üëÅÔ∏è Preview
                                            </button>
                                            <button onclick="reschedulePost('${post.id}')" class="px-3 py-1 bg-yellow-600 hover:bg-yellow-700 text-white text-xs rounded transition-colors">
                                                üîÑ Reschedule
                                            </button>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <!-- Timeline Panel -->
                        <div class="w-1/2 p-6 overflow-y-auto">
                            <h4 class="text-lg font-medium text-white mb-4">üóìÔ∏è Scheduling Timeline</h4>
                            <div id="schedule-timeline" class="space-y-4">
                                <!-- Timeline will be populated by JavaScript -->
                            </div>
                            
                            <div class="mt-6 p-4 bg-blue-500/20 border border-blue-500/30 rounded-lg">
                                <h5 class="text-blue-400 font-medium mb-2">üìä Scheduling Insights</h5>
                                <div class="text-xs text-slate-300 space-y-1">
                                    <div>‚Ä¢ Posts spread across optimal engagement windows</div>
                                    <div>‚Ä¢ Timing based on your audience's activity patterns</div>
                                    <div>‚Ä¢ Drag posts to different time slots to reschedule</div>
                                    <div>‚Ä¢ Green times = high engagement probability</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Store posts data globally
            window.batchPosts = generatedPosts;
            
            // Initialize drag and drop
            initializeDragAndDrop();
            
            // Populate timeline
            populateScheduleTimeline(generatedPosts);
        };

        function initializeDragAndDrop() {
            const postItems = document.querySelectorAll('.post-item');
            
            postItems.forEach(item => {
                item.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('text/plain', e.target.dataset.postId);
                    e.target.style.opacity = '0.5';
                });
                
                item.addEventListener('dragend', (e) => {
                    e.target.style.opacity = '1';
                });
            });
        }

        function populateScheduleTimeline(posts) {
            const timeline = document.getElementById('schedule-timeline');
            const sortedPosts = [...posts].sort((a, b) => new Date(a.scheduledTime) - new Date(b.scheduledTime));
            
            // Group posts by date
            const postsByDate = {};
            sortedPosts.forEach(post => {
                const date = new Date(post.scheduledTime).toDateString();
                if (!postsByDate[date]) postsByDate[date] = [];
                postsByDate[date].push(post);
            });
            
            timeline.innerHTML = Object.entries(postsByDate).map(([date, dayPosts]) => `
                <div class="timeline-day mb-6">
                    <h5 class="font-medium text-white mb-3 sticky top-0 bg-slate-800 py-2">
                        üìÖ ${new Date(date).toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' })}
                    </h5>
                    <div class="space-y-3 ml-4">
                        ${dayPosts.map(post => `
                            <div 
                                class="timeline-slot bg-slate-700/50 rounded-lg p-3 border-l-4 border-green-400 hover:bg-slate-700/70 transition-colors"
                                data-time-slot="${post.scheduledTime}"
                                ondrop="handleTimeSlotDrop(event)" 
                                ondragover="event.preventDefault()"
                                ondragenter="event.preventDefault()"
                            >
                                <div class="flex items-center justify-between mb-2">
                                    <div class="text-sm font-medium text-green-400">
                                        ${new Date(post.scheduledTime).toLocaleTimeString([], {hour: '2-digit', minute: '2-digit'})}
                                    </div>
                                    <div class="text-xs text-slate-400">${post.variation}</div>
                                </div>
                                <div class="text-xs text-slate-300 mb-1">${post.content.substring(0, 100)}...</div>
                                <div class="text-xs text-blue-400">${post.optimalReason}</div>
                            </div>
                        `).join('')}
                        
                        <!-- Empty time slots for dropping -->
                        <div class="empty-slot bg-slate-700/20 border-2 border-dashed border-slate-600 rounded-lg p-4 text-center text-slate-400 hover:border-blue-500 transition-colors"
                             ondrop="handleTimeSlotDrop(event)" 
                             ondragover="event.preventDefault()"
                             ondragenter="event.preventDefault()">
                            Drop post here to auto-schedule for next optimal time
                        </div>
                    </div>
                </div>
            `).join('');
        }

        window.handleTimeSlotDrop = function(event) {
            event.preventDefault();
            const postId = event.dataTransfer.getData('text/plain');
            const timeSlot = event.target.closest('[data-time-slot]')?.dataset.timeSlot;
            
            if (postId && timeSlot) {
                // Find the post and update its scheduled time
                const post = window.batchPosts.find(p => p.id === postId);
                if (post) {
                    post.scheduledTime = timeSlot;
                    
                    // Refresh the timeline
                    populateScheduleTimeline(window.batchPosts);
                    
                    if (typeof showToast === 'function') {
                        const newTime = new Date(timeSlot);
                        showToast(`üìÖ Post rescheduled to ${newTime.toLocaleDateString()} at ${newTime.toLocaleTimeString([], {hour: '2-digit', minute: '2-digit'})}`, 'success');
                    }
                }
            } else if (postId && event.target.classList.contains('empty-slot')) {
                // Auto-schedule to next optimal time
                const optimalTime = window.getPersonalizedOptimalTime(1);
                const post = window.batchPosts.find(p => p.id === postId);
                if (post) {
                    post.scheduledTime = optimalTime.date.toISOString();
                    post.optimalReason = optimalTime.reason;
                    
                    // Refresh the timeline
                    populateScheduleTimeline(window.batchPosts);
                    
                    if (typeof showToast === 'function') {
                        showToast(`ü§ñ Post auto-scheduled to optimal time!`, 'success');
                    }
                }
            }
        };

        // Bulk Selection and Scheduling Functions
        window.selectAllBatchPosts = function() {
            const checkboxes = document.querySelectorAll('.post-checkbox');
            const allChecked = Array.from(checkboxes).every(cb => cb.checked);
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = !allChecked;
                const postId = checkbox.dataset.postId;
                const post = window.batchPosts.find(p => p.id === postId);
                if (post) post.selected = checkbox.checked;
            });
            
            const button = document.querySelector('[onclick="selectAllBatchPosts()"]');
            if (button) {
                button.textContent = allChecked ? 'Select All' : 'Deselect All';
            }
            
            updateSelectedCount();
        };

        window.scheduleBatchPosts = function() {
            const selectedPosts = window.batchPosts.filter(post => {
                const checkbox = document.querySelector(`input[data-post-id="${post.id}"]`);
                return checkbox && checkbox.checked;
            });
            
            if (selectedPosts.length === 0) {
                if (typeof showToast === 'function') {
                    showToast('‚ö†Ô∏è Please select at least one post to schedule', 'warning');
                }
                return;
            }
            
            // Add to scheduled posts
            scheduledPosts = JSON.parse(localStorage.getItem('scheduledPosts') || '[]');
            
            selectedPosts.forEach(post => {
                const scheduledPost = {
                    id: post.id,
                    content: post.content,
                    scheduledAt: post.scheduledTime,
                    topic: post.topic,
                    variation: post.variation,
                    status: 'pending',
                    type: 'batch-scheduled',
                    optimalReason: post.optimalReason
                };
                scheduledPosts.push(scheduledPost);
            });
            
            localStorage.setItem('scheduledPosts', JSON.stringify(scheduledPosts));
            
            // Close modal and show success
            document.querySelector('.fixed.inset-0').remove();
            
            if (typeof showToast === 'function') {
                showToast(`üéâ ${selectedPosts.length} posts scheduled successfully!`, 'success');
            }
            
            // Refresh scheduler view if visible
            if (document.getElementById('content-scheduler') && !document.getElementById('content-scheduler').classList.contains('hidden')) {
                refreshScheduledPosts();
            }
        };

        window.editBatchPost = function(postId) {
            const post = window.batchPosts.find(p => p.id === postId);
            if (!post) return;
            
            // Create edit modal
            const editModal = document.createElement('div');
            editModal.className = 'fixed inset-0 bg-black/70 backdrop-blur-sm z-60 flex items-center justify-center p-4';
            editModal.innerHTML = `
                <div class="bg-slate-800 rounded-xl p-6 w-full max-w-2xl border border-slate-700">
                    <h3 class="text-lg font-semibold text-white mb-4">Edit Post: ${post.variation}</h3>
                    <textarea 
                        id="edit-post-content" 
                        class="w-full h-40 px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg text-white placeholder-slate-400 resize-none focus:ring-2 focus:ring-blue-500"
                        placeholder="Edit your post content..."
                    >${post.content}</textarea>
                    <div class="flex items-center justify-between mt-4">
                        <div class="text-sm text-slate-400">
                            <span id="char-count">${post.content.length}</span> characters
                        </div>
                        <div class="flex space-x-3">
                            <button onclick="this.closest('.fixed').remove()" class="px-4 py-2 bg-slate-600 hover:bg-slate-500 text-white rounded-lg transition-colors">
                                Cancel
                            </button>
                            <button onclick="saveBatchPostEdit('${postId}')" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors">
                                Save Changes
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(editModal);
            
            // Character counter
            const textarea = document.getElementById('edit-post-content');
            const charCount = document.getElementById('char-count');
            textarea.addEventListener('input', () => {
                charCount.textContent = textarea.value.length;
            });
            
            textarea.focus();
        };

        window.saveBatchPostEdit = function(postId) {
            const post = window.batchPosts.find(p => p.id === postId);
            const newContent = document.getElementById('edit-post-content').value;
            
            if (post && newContent.trim()) {
                post.content = newContent.trim();
                post.characters = newContent.trim().length;
                
                // Refresh the batch modal
                document.querySelector('.fixed.inset-0[style*="z-index: 60"]')?.remove(); // Close edit modal
                
                // Update the main modal
                const postElement = document.querySelector(`[data-post-id="${postId}"]`);
                if (postElement) {
                    const contentDiv = postElement.querySelector('.text-slate-300.text-sm.mb-3');
                    const charDiv = postElement.querySelector('.text-xs.text-slate-400');
                    if (contentDiv) contentDiv.textContent = newContent;
                    if (charDiv) charDiv.textContent = `${newContent.length} chars`;
                }
                
                if (typeof showToast === 'function') {
                    showToast('‚úèÔ∏è Post updated successfully!', 'success');
                }
            }
        };

        window.reschedulePost = function(postId) {
            const post = window.batchPosts.find(p => p.id === postId);
            if (!post) return;
            
            // Get next optimal time
            const optimalTime = window.getPersonalizedOptimalTime(1);
            post.scheduledTime = optimalTime.date.toISOString();
            post.optimalReason = optimalTime.reason;
            
            // Refresh timeline
            populateScheduleTimeline(window.batchPosts);
            
            // Update post display
            const postElement = document.querySelector(`[data-post-id="${postId}"]`);
            if (postElement) {
                const timeDiv = postElement.querySelector('.text-slate-400');
                const reasonDiv = postElement.querySelector('.text-blue-400');
                if (timeDiv) timeDiv.textContent = `üìÖ ${optimalTime.date.toLocaleDateString()} at ${optimalTime.date.toLocaleTimeString([], {hour: '2-digit', minute: '2-digit'})}`;
                if (reasonDiv) reasonDiv.textContent = optimalTime.reason;
            }
            
            if (typeof showToast === 'function') {
                showToast(`üîÑ Post rescheduled to optimal time!`, 'success');
            }
        };

        window.previewPost = function(postId) {
            const post = window.batchPosts.find(p => p.id === postId);
            if (!post) return;
            
            // Create preview modal
            const previewModal = document.createElement('div');
            previewModal.className = 'fixed inset-0 bg-black/70 backdrop-blur-sm z-60 flex items-center justify-center p-4';
            previewModal.innerHTML = `
                <div class="bg-slate-800 rounded-xl p-6 w-full max-w-lg border border-slate-700">
                    <h3 class="text-lg font-semibold text-white mb-4">üëÅÔ∏è Post Preview</h3>
                    <div class="bg-white rounded-lg p-4 mb-4">
                        <div class="flex items-center space-x-3 mb-3">
                            <div class="w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center text-white font-semibold">
                                AI
                            </div>
                            <div>
                                <div class="font-semibold text-gray-900">AIfluence</div>
                                <div class="text-sm text-gray-500">AI Strategy Expert</div>
                            </div>
                        </div>
                        <div class="text-gray-900 whitespace-pre-wrap text-sm">${post.content}</div>
                        <div class="flex items-center space-x-4 mt-4 text-gray-500 text-sm">
                            <button class="flex items-center space-x-1 hover:text-blue-600">
                                <span>üëç</span><span>Like</span>
                            </button>
                            <button class="flex items-center space-x-1 hover:text-blue-600">
                                <span>üí¨</span><span>Comment</span>
                            </button>
                            <button class="flex items-center space-x-1 hover:text-blue-600">
                                <span>üîÑ</span><span>Share</span>
                            </button>
                        </div>
                    </div>
                    <div class="text-sm text-slate-400 mb-4">
                        Scheduled: ${new Date(post.scheduledTime).toLocaleString()}
                    </div>
                    <button onclick="this.closest('.fixed').remove()" class="w-full px-4 py-2 bg-slate-600 hover:bg-slate-500 text-white rounded-lg transition-colors">
                        Close Preview
                    </button>
                </div>
            `;
            
            document.body.appendChild(previewModal);
        };

        function updateSelectedCount() {
            const selectedCount = document.querySelectorAll('.post-checkbox:checked').length;
            const button = document.querySelector('[onclick="scheduleBatchPosts()"]');
            if (button) {
                button.textContent = selectedCount > 0 ? `Schedule ${selectedCount} Selected` : 'Schedule Selected';
            }
        }

        // Add event listeners for checkbox changes
        document.addEventListener('change', (e) => {
            if (e.target.classList.contains('post-checkbox')) {
                updateSelectedCount();
            }
        });

        // Settings functions
        window.refreshInsights = function() {
            const insights = window.generateEngagementInsights();
            const performanceData = window.analyzePostPerformance();
            const insightsContainer = document.getElementById('performance-insights');
            
            if (insightsContainer && insights.length > 0) {
                const bestTime = performanceData.personalizedOptimalTimes[0];
                const timeStr = bestTime ? 
                    (bestTime.hour === 12 ? '12 PM' : 
                     bestTime.hour === 0 ? '12 AM' :
                     bestTime.hour > 12 ? `${bestTime.hour - 12} PM` : `${bestTime.hour} AM`) : '9:30 AM';
                
                insightsContainer.innerHTML = insights.slice(0, 3).map(insight => 
                    `<div>‚Ä¢ ${insight.description}</div>`
                ).join('');
                
                if (typeof showToast === 'function') {
                    showToast('üìä Performance insights refreshed', 'success');
                }
            } else {
                if (insightsContainer) {
                    insightsContainer.innerHTML = `
                        <div>‚Ä¢ Your best posting time: 9:30 AM (based on LinkedIn data)</div>
                        <div>‚Ä¢ Tuesday-Thursday are optimal weekdays</div>
                        <div>‚Ä¢ Post more content to unlock personalized insights</div>
                    `;
                }
                
                if (typeof showToast === 'function') {
                    showToast('üìä Using general best practices (publish more posts for personalized insights)', 'info');
                }
            }
        };

        window.calculateNextOptimalTime = function(daysAhead = 0) {
            const { optimalTimes } = window.getOptimalPostingTimes();
            const targetDate = new Date();
            targetDate.setDate(targetDate.getDate() + daysAhead);
            
            const isWeekend = targetDate.getDay() === 0 || targetDate.getDay() === 6;
            const times = isWeekend ? optimalTimes.weekends : optimalTimes.weekdays;
            
            // If today, find next available optimal time
            if (daysAhead === 0) {
                const now = new Date();
                const availableTimes = times.filter(time => {
                    const optimalDateTime = new Date(targetDate);
                    optimalDateTime.setHours(time.hour, time.minute, 0, 0);
                    return optimalDateTime > now;
                });
                
                if (availableTimes.length > 0) {
                    const nextTime = availableTimes[0];
                    targetDate.setHours(nextTime.hour, nextTime.minute, 0, 0);
                    return { date: targetDate, reason: nextTime.reason };
                }
                
                // No times left today, get first optimal time tomorrow
                return window.calculateNextOptimalTime(1);
            }
            
            // Future date - use first optimal time
            const bestTime = times[0];
            targetDate.setHours(bestTime.hour, bestTime.minute, 0, 0);
            return { date: targetDate, reason: bestTime.reason };
        };

        window.autoSchedulePost = function() {
            console.log('ü§ñ Auto-scheduling post with optimal timing...');
            
            const content = document.getElementById('content-text')?.textContent;
            if (!content) {
                if (typeof showToast === 'function') {
                    showToast('‚ùå No content to schedule. Generate a post first.', 'error');
                }
                return;
            }
            
            const optimal = window.getPersonalizedOptimalTime();
            const formattedDate = optimal.date.toLocaleDateString();
            const formattedTime = optimal.date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            // Get engagement insights for better recommendations
            const insights = window.generateEngagementInsights();
            
            // Create auto-schedule confirmation modal
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4';
            modal.innerHTML = `
                <div class="bg-slate-800 rounded-xl p-6 w-full max-w-md border border-slate-700">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-white">ü§ñ Smart Auto-Schedule</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-slate-400 hover:text-slate-200">
                            <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    <div class="space-y-4">
                        <div class="bg-blue-500/20 border border-blue-500/30 rounded-lg p-4">
                            <div class="flex items-center space-x-2 mb-2">
                                <svg class="h-5 w-5 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <span class="text-blue-400 font-medium">${optimal.isPersonalized ? 'üéØ Your Optimal Time' : 'üìä Best Practice Time'}</span>
                                ${optimal.confidence === 'high' ? '<span class="text-xs bg-green-500/20 text-green-400 px-2 py-1 rounded ml-2">High Confidence</span>' : 
                                  optimal.confidence === 'medium' ? '<span class="text-xs bg-yellow-500/20 text-yellow-400 px-2 py-1 rounded ml-2">Medium Confidence</span>' : 
                                  optimal.confidence === 'low' ? '<span class="text-xs bg-orange-500/20 text-orange-400 px-2 py-1 rounded ml-2">Low Confidence</span>' : ''}
                            </div>
                            <div class="text-white font-semibold">${formattedDate} at ${formattedTime}</div>
                            <div class="text-sm text-slate-300 mt-1">üìä ${optimal.reason}</div>
                        </div>
                        
                        ${insights.length > 0 ? `
                        <div class="bg-purple-500/20 border border-purple-500/30 rounded-lg p-3">
                            <div class="text-purple-400 font-medium text-sm mb-2">üí° Performance Insights</div>
                            ${insights.slice(0, 2).map(insight => `
                                <div class="text-xs text-slate-300 mb-1">‚Ä¢ ${insight.description}</div>
                            `).join('')}
                        </div>
                        ` : ''}
                        
                        <div class="space-y-2">
                            <div class="flex items-center space-x-2 text-sm text-slate-300">
                                <svg class="h-4 w-4 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                                <span>Based on LinkedIn engagement data</span>
                            </div>
                            <div class="flex items-center space-x-2 text-sm text-slate-300">
                                <svg class="h-4 w-4 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                                <span>Optimized for professional audiences</span>
                            </div>
                            <div class="flex items-center space-x-2 text-sm text-slate-300">
                                <svg class="h-4 w-4 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                                <span>Adjusted for your timezone</span>
                            </div>
                        </div>
                        
                        <div class="flex space-x-3 pt-2">
                            <button onclick="confirmAutoSchedule('${optimal.date.toISOString()}')" class="flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors">
                                ü§ñ Auto-Schedule
                            </button>
                            <button onclick="this.closest('.fixed').remove(); window.schedulePost();" class="px-4 py-2 bg-slate-600 hover:bg-slate-500 text-white rounded-lg transition-colors">
                                Manual
                            </button>
                            <button onclick="this.closest('.fixed').remove()" class="px-4 py-2 bg-slate-600 hover:bg-slate-500 text-white rounded-lg transition-colors">
                                Cancel
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        };

        window.confirmAutoSchedule = function(dateTimeString) {
            const scheduledDateTime = new Date(dateTimeString);
            const formattedDate = scheduledDateTime.toLocaleDateString();
            const formattedTime = scheduledDateTime.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            // Close modal
            document.querySelector('.fixed.inset-0').remove();
            
            if (typeof showToast === 'function') {
                showToast(`ü§ñ Post auto-scheduled for ${formattedDate} at ${formattedTime} (optimal time)`, 'success');
            }
            
            console.log('‚úÖ Post auto-scheduled for:', scheduledDateTime);
            
            // Save to scheduled posts (integrate with existing scheduling system)
            const content = document.getElementById('content-text')?.textContent;
            const scheduledPost = {
                id: Date.now(),
                content: content,
                scheduledAt: scheduledDateTime.toISOString(),
                type: 'auto-scheduled',
                status: 'pending',
                reason: 'Optimal engagement time'
            };
            
            // Add to scheduled posts list
            scheduledPosts = JSON.parse(localStorage.getItem('scheduledPosts') || '[]');
            scheduledPosts.push(scheduledPost);
            localStorage.setItem('scheduledPosts', JSON.stringify(scheduledPosts));
        };

        window.schedulePost = function() {
            console.log('üìÖ Scheduling post...');
            
            const content = document.getElementById('content-text')?.textContent;
            if (!content) {
                if (typeof showToast === 'function') {
                    showToast('‚ùå No content to schedule. Generate a post first.', 'error');
                }
                return;
            }
            
            // Create schedule modal
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4';
            modal.innerHTML = `
                <div class="bg-slate-800 rounded-xl p-6 w-full max-w-md border border-slate-700">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-white">üìÖ Schedule Post</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-slate-400 hover:text-slate-200">
                            <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    <div class="space-y-4">
                        <div class="bg-blue-500/20 border border-blue-500/30 rounded-lg p-3">
                            <button onclick="this.closest('.fixed').remove(); window.autoSchedulePost();" class="w-full flex items-center justify-center space-x-2 text-blue-400 hover:text-blue-300 transition-colors">
                                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                </svg>
                                <span>ü§ñ Use Smart Auto-Schedule</span>
                            </button>
                        </div>
                        
                        <div class="text-center text-slate-400 text-sm">or choose manually</div>
                        
                        <div>
                            <label class="block text-sm font-medium text-slate-300 mb-2">Date</label>
                            <input type="date" id="schedule-date" class="w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg text-white">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-300 mb-2">Time</label>
                            <input type="time" id="schedule-time" class="w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg text-white">
                        </div>
                        <div class="text-xs text-slate-400">
                            üí° Best times: 9-10 AM or 12-1 PM on weekdays
                        </div>
                        <div class="flex space-x-3 pt-2">
                            <button onclick="confirmSchedule()" class="flex-1 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors">
                                Schedule Post
                            </button>
                            <button onclick="this.closest('.fixed').remove()" class="px-4 py-2 bg-slate-600 hover:bg-slate-500 text-white rounded-lg transition-colors">
                                Cancel
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            // Set default date/time
            const now = new Date();
            const tomorrow = new Date(now.getTime() + 24 * 60 * 60 * 1000);
            
            document.body.appendChild(modal);
            
            setTimeout(() => {
                const dateInput = document.getElementById('schedule-date');
                const timeInput = document.getElementById('schedule-time');
                if (dateInput) dateInput.value = tomorrow.toISOString().split('T')[0];
                if (timeInput) timeInput.value = '09:00';
            }, 100);
        };
        
        window.confirmSchedule = function() {
            const dateInput = document.getElementById('schedule-date');
            const timeInput = document.getElementById('schedule-time');
            
            if (!dateInput?.value || !timeInput?.value) {
                if (typeof showToast === 'function') {
                    showToast('‚ùå Please select both date and time', 'error');
                }
                return;
            }
            
            const scheduledDateTime = new Date(`${dateInput.value}T${timeInput.value}`);
            const now = new Date();
            
            if (scheduledDateTime <= now) {
                if (typeof showToast === 'function') {
                    showToast('‚ùå Please select a future date and time', 'error');
                }
                return;
            }
            
            // Close modal
            document.querySelector('.fixed.inset-0').remove();
            
            // Show success message
            const formattedDate = scheduledDateTime.toLocaleDateString();
            const formattedTime = scheduledDateTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            
            if (typeof showToast === 'function') {
                showToast(`üìÖ Post scheduled for ${formattedDate} at ${formattedTime}`, 'success');
            }
            
            console.log('‚úÖ Post scheduled for:', scheduledDateTime);
        };
        
        window.postNow = function() {
            console.log('üöÄ Posting now...');
            
            const content = document.getElementById('content-text')?.textContent;
            if (!content) {
                if (typeof showToast === 'function') {
                    showToast('‚ùå No content to post. Generate a post first.', 'error');
                }
                return;
            }
            
            // Check if LinkedIn is connected
            const isConnected = typeof window.isLinkedInConnected === 'function' ? window.isLinkedInConnected() : false;
            
            if (!isConnected) {
                if (typeof showToast === 'function') {
                    showToast('‚ùå Please connect your LinkedIn account first', 'error');
                }
                return;
            }
            
            if (confirm('üöÄ Post this content to LinkedIn immediately?')) {
                // Show loading state
                const btn = document.querySelector('[onclick*="postNow"]');
                if (btn) {
                    const originalContent = btn.innerHTML;
                    btn.innerHTML = '<div class="flex items-center space-x-2"><svg class="h-4 w-4 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg><span>Posting...</span></div>';
                    btn.disabled = true;
                    
                    setTimeout(() => {
                        btn.innerHTML = originalContent;
                        btn.disabled = false;
                        
                        if (typeof showToast === 'function') {
                            showToast('üéâ Post published to LinkedIn successfully!', 'success');
                        }
                    }, 2000);
                }
            }
        };
        
        window.createNewPost = function() {
            console.log('‚ûï Creating new post...');
            
            // Reset the generated content
            const generatedSection = document.getElementById('generated-content');
            const mediaSection = document.getElementById('media-section');
            const multiplePostsContainer = document.getElementById('multiple-posts-container');
            
            if (generatedSection) generatedSection.classList.add('hidden');
            if (mediaSection) mediaSection.classList.add('hidden');
            if (multiplePostsContainer) multiplePostsContainer.remove();
            
            // Reset input fields to defaults
            const topicField = document.getElementById('custom-topic');
            const audienceField = document.getElementById('custom-audience');
            const toneField = document.getElementById('custom-tone');
            
            if (topicField) topicField.value = 'AI Readiness Assessment';
            if (audienceField) audienceField.value = 'C-level executives and business leaders';
            if (toneField) toneField.value = 'Professional and authoritative';
            
            // Scroll to top of generator
            document.getElementById('content-generator')?.scrollIntoView({ behavior: 'smooth' });
            
            if (typeof showToast === 'function') {
                showToast('‚ú® Ready to create a new post!', 'success');
            }
        };
        
        window.editPost = function() {
            console.log('‚úèÔ∏è Editing post...');
            
            const contentText = document.getElementById('content-text');
            if (!contentText) {
                if (typeof showToast === 'function') {
                    showToast('‚ùå No content to edit. Generate a post first.', 'error');
                }
                return;
            }
            
            // Make content editable
            contentText.contentEditable = true;
            contentText.style.border = '2px solid #3b82f6';
            contentText.style.padding = '8px';
            contentText.style.borderRadius = '8px';
            contentText.focus();
            
            // Add save/cancel buttons
            const existingControls = document.getElementById('edit-controls');
            if (!existingControls) {
                const controls = document.createElement('div');
                controls.id = 'edit-controls';
                controls.className = 'mt-4 flex space-x-2';
                controls.innerHTML = `
                    <button onclick="saveEdit()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors">
                        Save Changes
                    </button>
                    <button onclick="cancelEdit()" class="px-4 py-2 bg-slate-600 hover:bg-slate-500 text-white rounded-lg transition-colors">
                        Cancel
                    </button>
                `;
                contentText.parentNode.insertBefore(controls, contentText.nextSibling);
            }
            
            if (typeof showToast === 'function') {
                showToast('‚úèÔ∏è Post is now editable. Make your changes and save.', 'info');
            }
        };
        
        window.saveEdit = function() {
            const contentText = document.getElementById('content-text');
            const controls = document.getElementById('edit-controls');
            const charCount = document.getElementById('char-count');
            
            if (contentText) {
                contentText.contentEditable = false;
                contentText.style.border = 'none';
                contentText.style.padding = '';
                contentText.style.borderRadius = '';
                
                // Update character count
                if (charCount) {
                    charCount.textContent = `Character count: ${contentText.textContent.length}`;
                }
            }
            
            if (controls) {
                controls.remove();
            }
            
            if (typeof showToast === 'function') {
                showToast('‚úÖ Post saved successfully!', 'success');
            }
        };
        
        window.cancelEdit = function() {
            const contentText = document.getElementById('content-text');
            const controls = document.getElementById('edit-controls');
            
            if (contentText) {
                contentText.contentEditable = false;
                contentText.style.border = 'none';
                contentText.style.padding = '';
                contentText.style.borderRadius = '';
            }
            
            if (controls) {
                controls.remove();
            }
            
            if (typeof showToast === 'function') {
                showToast('‚ùå Edit cancelled', 'info');
            }
        };
        
        // Helper functions for multiple posts
        window.copyPost = function(index) {
            const postElement = document.querySelector(`[data-post="${index}"]`);
            if (postElement) {
                navigator.clipboard.writeText(postElement.textContent);
                if (typeof showToast === 'function') {
                    showToast(`üìã Post ${parseInt(index) + 1} copied to clipboard`, 'success');
                }
            }
        };
        
        window.usePost = function(index) {
            const postElement = document.querySelector(`[data-post="${index}"]`);
            const contentDisplay = document.getElementById('content-text');
            const generatedSection = document.getElementById('generated-content');
            const charCount = document.getElementById('char-count');
            
            if (postElement && contentDisplay) {
                const content = postElement.textContent;
                contentDisplay.textContent = content;
                
                if (charCount) {
                    charCount.textContent = `Character count: ${content.length}`;
                }
                
                if (generatedSection) {
                    generatedSection.classList.remove('hidden');
                    generatedSection.scrollIntoView({ behavior: 'smooth' });
                }
                
                if (typeof showToast === 'function') {
                    showToast(`‚úÖ Using Post ${parseInt(index) + 1}`, 'success');
                }
            }
        };
        
        window.selectAllPosts = function() {
            const posts = document.querySelectorAll('[data-post]');
            let allContent = '';
            
            posts.forEach((post, index) => {
                allContent += `--- POST ${index + 1} ---\n${post.textContent}\n\n`;
            });
            
            navigator.clipboard.writeText(allContent);
            if (typeof showToast === 'function') {
                showToast('üìã All 5 posts copied to clipboard', 'success');
            }
        };
        
        console.log('‚úÖ Post action functions loaded');
    </script>
</head>
<body class="bg-hootsuite-darker min-h-screen relative">
    
    <!-- Animated Background -->
    <div class="fixed inset-0 pointer-events-none z-0">
        <!-- Gradient Base -->
        <div class="absolute inset-0 bg-gradient-to-br from-hootsuite-darker via-slate-900 to-hootsuite-dark opacity-80"></div>
        
        <!-- Floating Cute Patterns -->
        <div class="absolute inset-0">
            <!-- Floating Hearts -->
            <div class="floating-pattern heart-1">üíú</div>
            <div class="floating-pattern heart-2">üíô</div>
            <div class="floating-pattern heart-3">ü§ç</div>
            <div class="floating-pattern heart-4">üíö</div>
            
            <!-- Floating Stars -->
            <div class="floating-pattern star-1">‚ú®</div>
            <div class="floating-pattern star-2">‚≠ê</div>
            <div class="floating-pattern star-3">üåü</div>
            <div class="floating-pattern star-4">üí´</div>
            <div class="floating-pattern star-5">‚ö°</div>
            
            <!-- Floating Shapes -->
            <div class="floating-pattern shape-1">üîÆ</div>
            <div class="floating-pattern shape-2">üíé</div>
            <div class="floating-pattern shape-3">üå∏</div>
            <div class="floating-pattern shape-4">ü¶ã</div>
            <div class="floating-pattern shape-5">üå∫</div>
            
            <!-- Floating Tech Symbols -->
            <div class="floating-pattern tech-1">ü§ñ</div>
            <div class="floating-pattern tech-2">‚öôÔ∏è</div>
            <div class="floating-pattern tech-3">üîß</div>
            <div class="floating-pattern tech-4">üíª</div>
        </div>
        
        <!-- Soft Glow Effects -->
        <div class="absolute inset-0">
            <div class="glow-orb glow-1"></div>
            <div class="glow-orb glow-2"></div>
            <div class="glow-orb glow-3"></div>
            <div class="glow-orb glow-4"></div>
            <div class="glow-orb glow-5"></div>
        </div>
        
        <!-- Subtle Grid Pattern -->
        <div class="absolute inset-0 opacity-5">
            <div class="absolute inset-0" style="background-image: 
                radial-gradient(circle at 1px 1px, rgba(59, 130, 246, 0.3) 1px, transparent 0); 
                background-size: 50px 50px;"></div>
        </div>
    </div>
    
    <!-- Main Content Container -->
    <div class="relative z-10">
    
    <!-- Header -->
    <header class="border-b border-hootsuite-border bg-hootsuite-panel shadow-lg">
        <div class="max-w-7xl mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="p-2 bg-gradient-to-r from-aifluence-500 to-purple-500 rounded-xl shadow-lg">
                        <!-- AIfluence Chat Bubble Icon with AI Brain -->
                        <svg class="h-8 w-8 text-white" fill="none" viewBox="0 0 24 24">
                            <defs>
                                <linearGradient id="iconGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" style="stop-color:#1497FF;stop-opacity:1" />
                                    <stop offset="50%" style="stop-color:#8B5CF6;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#FF70B2;stop-opacity:1" />
                                </linearGradient>
                            </defs>
                            <!-- Chat bubble -->
                            <path d="M4 4h16c1.1 0 2 .9 2 2v10c0 1.1-.9 2-2 2h-4l-4 4v-4H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z" fill="white" fill-opacity="0.9"/>
                            <!-- AI Brain dots -->
                            <circle cx="8" cy="10" r="1.5" fill="url(#iconGrad)"/>
                            <circle cx="12" cy="10" r="1.5" fill="url(#iconGrad)"/>
                            <circle cx="16" cy="10" r="1.5" fill="url(#iconGrad)"/>
                            <!-- Influence waves -->
                            <path d="M6 18c2.8 0 5-2.2 5-5s-2.2-5-5-5" stroke="white" stroke-width="1.5" fill="none" opacity="0.7"/>
                            <path d="M18 18c-2.8 0-5-2.2-5-5s2.2-5 5-5" stroke="white" stroke-width="1.5" fill="none" opacity="0.7"/>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-hootsuite-text">AIfluence</h1>
                        <p class="text-sm text-hootsuite-text-muted">AI-Powered Social Intelligence</p>
                    </div>
                </div>
                <div class="text-right">
                    <p class="text-sm text-hootsuite-text">Smart Content Creation</p>
                    <p class="text-xs text-hootsuite-text-muted">LinkedIn Growth Platform</p>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="border-b border-hootsuite-border bg-hootsuite-dark">
        <div class="max-w-7xl mx-auto px-6">
            <div class="flex space-x-1">
                <button data-tab="generator" id="tab-generator" class="tab-btn flex items-center space-x-2 px-4 py-3 text-sm font-medium transition-colors text-aifluence-400 border-b-2 border-aifluence-400 bg-hootsuite-panel/80">
                    <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                    </svg>
                    <span>Content Generator</span>
                </button>
                <button data-tab="scheduler" id="tab-scheduler" class="tab-btn flex items-center space-x-2 px-4 py-3 text-sm font-medium transition-colors text-hootsuite-text-muted hover:text-hootsuite-text hover:bg-hootsuite-panel/50">
                    <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                    </svg>
                    <span>Scheduler</span>
                </button>
                <button data-tab="personal-ai" id="tab-personal-ai" class="tab-btn flex items-center space-x-2 px-4 py-3 text-sm font-medium transition-colors text-hootsuite-text-muted hover:text-hootsuite-text hover:bg-hootsuite-panel/50">
                    <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                    <span>Personal AI</span>
                </button>
                <button data-tab="dashboard" id="tab-dashboard" class="tab-btn flex items-center space-x-2 px-4 py-3 text-sm font-medium transition-colors text-hootsuite-text-muted hover:text-hootsuite-text hover:bg-hootsuite-panel/50">
                    <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                    </svg>
                    <span>Analytics</span>
                </button>
                <button data-tab="linkedin" id="tab-linkedin" class="tab-btn flex items-center space-x-2 px-4 py-3 text-sm font-medium transition-colors text-hootsuite-text-muted hover:text-hootsuite-text hover:bg-hootsuite-panel/50">
                    <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"></path>
                    </svg>
                    <span>LinkedIn Connect</span>
                </button>
                <button data-tab="billing" id="tab-billing" class="tab-btn flex items-center space-x-2 px-4 py-3 text-sm font-medium transition-colors text-hootsuite-text-muted hover:text-hootsuite-text hover:bg-hootsuite-panel/50">
                    <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path>
                    </svg>
                    <span>Subscription</span>
                </button>
                <button data-tab="settings" id="tab-settings" class="tab-btn flex items-center space-x-2 px-4 py-3 text-sm font-medium transition-colors text-hootsuite-text-muted hover:text-hootsuite-text hover:bg-hootsuite-panel/50">
                    <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                    <span>Settings</span>
                </button>
            </div>
        </div>
    </nav>
    
    <!-- Immediate Navigation Script -->
    <script>
        console.log('üöÄ Navigation script loading immediately...');
        
        // Simple tab switching function
        function switchTab(tabName) {
            console.log('üìÇ Switching to tab:', tabName);
            
            // Hide all tab contents
            const contents = document.querySelectorAll('.tab-content');
            contents.forEach(content => content.classList.add('hidden'));
            
            // Remove active state from all tabs
            const tabs = document.querySelectorAll('.tab-btn');
            tabs.forEach(btn => {
                btn.classList.remove('text-aifluence-400', 'border-b-2', 'border-aifluence-400', 'bg-hootsuite-panel/80');
                btn.classList.add('text-hootsuite-text-muted', 'hover:text-hootsuite-text', 'hover:bg-hootsuite-panel/50');
            });
            
            // Show selected tab content
            const targetContent = document.getElementById('content-' + tabName);
            if (targetContent) {
                targetContent.classList.remove('hidden');
            }
            
            // Add active state to selected tab
            const activeTab = document.getElementById('tab-' + tabName);
            if (activeTab) {
                activeTab.classList.remove('text-hootsuite-text-muted', 'hover:text-hootsuite-text', 'hover:bg-hootsuite-panel/50');
                activeTab.classList.add('text-aifluence-400', 'border-b-2', 'border-aifluence-400', 'bg-hootsuite-panel/80');
            }
            
            // Load data for specific tabs
            if (tabName === 'settings') {
                console.log('üîß Settings tab detected - updating LinkedIn status directly');
                // Use setTimeout to ensure DOM is ready
                setTimeout(() => {
                    console.log('üîÑ Directly updating LinkedIn DOM elements...');
                    
                    // Get DOM elements
                    const connectedDiv = document.getElementById('linkedin-connected');
                    const disconnectedDiv = document.getElementById('linkedin-disconnected');
                    const profileName = document.getElementById('linkedin-profile-name');
                    
                    console.log('üîç Found elements:', {
                        connectedDiv: !!connectedDiv,
                        disconnectedDiv: !!disconnectedDiv,
                        profileName: !!profileName
                    });
                    
                    if (connectedDiv && disconnectedDiv) {
                        // Check if LinkedIn is connected using our centralized function
                        setTimeout(() => {
                            if (typeof window.isLinkedInConnected === 'function') {
                                const isConnected = window.isLinkedInConnected();
                                console.log('üîó LinkedIn status:', isConnected);
                                
                                if (isConnected) {
                                    console.log('‚úÖ Showing connected state');
                                    connectedDiv.classList.remove('hidden');
                                    disconnectedDiv.classList.add('hidden');
                                    
                                    // Update profile name if available
                                    if (profileName && typeof window.getLinkedInConnectionInfo === 'function') {
                                        const connectionInfo = window.getLinkedInConnectionInfo();
                                        if (connectionInfo.profile) {
                                            profileName.textContent = connectionInfo.profile;
                                            console.log('‚úÖ Profile name updated:', connectionInfo.profile);
                                        }
                                    }
                                } else {
                                    console.log('‚ùå Showing disconnected state');
                                    connectedDiv.classList.add('hidden');
                                    disconnectedDiv.classList.remove('hidden');
                                }
                            } else {
                                console.log('‚è≥ LinkedIn connection function not yet available, showing disconnected state');
                                // Default to disconnected state
                                connectedDiv.classList.add('hidden');
                                disconnectedDiv.classList.remove('hidden');
                            }
                        }, 500); // Wait 500ms for functions to be defined
                    } else {
                        console.error('‚ùå DOM elements not found');
                    }
                }, 200);
            }
        }
        
        // Attach navigation immediately
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üéØ Navigation: DOM loaded, attaching tab handlers...');
            
            // Attach tab click handlers
            const tabButtons = document.querySelectorAll('.tab-btn');
            tabButtons.forEach(btn => {
                const tabName = btn.getAttribute('data-tab');
                if (tabName) {
                    btn.onclick = () => switchTab(tabName);
                    console.log('‚úÖ Attached handler for tab:', tabName);
                }
            });
            
            // Show generator tab by default
            switchTab('generator');
        });
        
        // Also try immediate attachment
        const tabButtons = document.querySelectorAll('.tab-btn');
        tabButtons.forEach(btn => {
            const tabName = btn.getAttribute('data-tab');
            if (tabName) {
                btn.onclick = () => switchTab(tabName);
            }
        });
        
        console.log('‚úÖ Navigation script loaded!');
    </script>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-6 py-8">
        
        <!-- Content Generator Tab -->
        <div id="content-generator" class="tab-content">
            <div class="space-y-6">
                <!-- Header -->
                <div class="text-center">
                    <h2 class="text-3xl font-bold text-hootsuite-text mb-2">üéâ AIfluence Content Generator</h2>
                    <p class="text-hootsuite-text-muted">Create educational content about bridging business and AI</p>
                    <div class="mt-4 p-4 bg-green-500/10 border border-green-500/30 rounded-lg">
                        <p class="text-green-400 font-medium">‚úÖ Navigation is working! You can now switch between tabs.</p>
                        <p class="text-green-300 text-sm mt-2">The demo account button and other features are being fixed...</p>
                    </div>
                </div>

                <!-- Content Generation Form -->
                <div class="bg-hootsuite-panel rounded-xl p-6 border border-hootsuite-border shadow-lg">
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        
                        <!-- Custom Content Configuration -->
                        <div class="space-y-6">
                            <!-- Topic Input -->
                            <div>
                                <label class="block text-sm font-medium text-hootsuite-text mb-3">Content Topic</label>
                                <div class="space-y-3">
                                    <!-- Quick Select Topics -->
                                    <div class="flex flex-wrap gap-2">
                                        <button data-topic="AI Readiness Assessment" class="topic-btn text-xs px-3 py-1 bg-aifluence-500/20 text-aifluence-400 rounded-full hover:bg-aifluence-500/30 transition-colors">AI Readiness</button>
                                        <button data-topic="AI ROI and Business Value" class="topic-btn text-xs px-3 py-1 bg-aifluence-500/20 text-aifluence-400 rounded-full hover:bg-aifluence-500/30 transition-colors">AI ROI</button>
                                        <button data-topic="AI Misconceptions" class="topic-btn text-xs px-3 py-1 bg-aifluence-500/20 text-aifluence-400 rounded-full hover:bg-aifluence-500/30 transition-colors">AI Myths</button>
                                        <button data-topic="Digital Transformation" class="topic-btn text-xs px-3 py-1 bg-aifluence-500/20 text-aifluence-400 rounded-full hover:bg-aifluence-500/30 transition-colors">Digital Transform</button>
                                        <button data-topic="Machine Learning Implementation" class="topic-btn text-xs px-3 py-1 bg-aifluence-500/20 text-aifluence-400 rounded-full hover:bg-aifluence-500/30 transition-colors">ML Implementation</button>
                                    </div>
                                    <!-- Custom Topic Input -->
                                    <textarea id="custom-topic" rows="2" placeholder="Describe your topic (e.g., AI automation in manufacturing, customer service chatbots, predictive analytics for sales...)" class="w-full px-3 py-2 bg-hootsuite-dark border border-hootsuite-border rounded-lg text-hootsuite-text placeholder-hootsuite-text-muted text-sm resize-none focus:ring-2 focus:ring-aifluence-500 focus:border-transparent">AI Readiness Assessment</textarea>
                                </div>
                            </div>

                            <!-- Target Audience Input -->
                            <div>
                                <label class="block text-sm font-medium text-hootsuite-text mb-3">Target Audience</label>
                                <div class="space-y-3">
                                    <!-- Quick Select Audiences -->
                                    <div class="flex flex-wrap gap-2">
                                        <button onclick="setCustomAudience('C-level executives and business leaders')" class="text-xs px-3 py-1 bg-purple-500/20 text-purple-400 rounded-full hover:bg-purple-500/30 transition-colors">Executives</button>
                                        <button onclick="setCustomAudience('IT managers and technical decision makers')" class="text-xs px-3 py-1 bg-purple-500/20 text-purple-400 rounded-full hover:bg-purple-500/30 transition-colors">IT Managers</button>
                                        <button onclick="setCustomAudience('Operations managers and process owners')" class="text-xs px-3 py-1 bg-purple-500/20 text-purple-400 rounded-full hover:bg-purple-500/30 transition-colors">Ops Managers</button>
                                        <button onclick="setCustomAudience('Small business owners and entrepreneurs')" class="text-xs px-3 py-1 bg-purple-500/20 text-purple-400 rounded-full hover:bg-purple-500/30 transition-colors">SMB Owners</button>
                                        <button onclick="setCustomAudience('HR leaders and talent management professionals')" class="text-xs px-3 py-1 bg-purple-500/20 text-purple-400 rounded-full hover:bg-purple-500/30 transition-colors">HR Leaders</button>
                                    </div>
                                    <!-- Custom Audience Input -->
                                    <textarea id="custom-audience" rows="2" placeholder="Describe your target audience (e.g., marketing directors in e-commerce companies, financial advisors, healthcare administrators...)" class="w-full px-3 py-2 bg-hootsuite-dark border border-hootsuite-border rounded-lg text-hootsuite-text placeholder-hootsuite-text-muted text-sm resize-none focus:ring-2 focus:ring-purple-500 focus:border-transparent">C-level executives and business leaders</textarea>
                                </div>
                            </div>

                            <!-- Content Tone Input -->
                            <div>
                                <label class="block text-sm font-medium text-slate-300 mb-3">Content Tone & Style</label>
                                <div class="space-y-3">
                                    <!-- Quick Select Tones -->
                                    <div class="flex flex-wrap gap-2">
                                        <button onclick="setCustomTone('Professional and authoritative')" class="text-xs px-3 py-1 bg-green-500/20 text-green-400 rounded-full hover:bg-green-500/30 transition-colors">Professional</button>
                                        <button onclick="setCustomTone('Educational and informative')" class="text-xs px-3 py-1 bg-green-500/20 text-green-400 rounded-full hover:bg-green-500/30 transition-colors">Educational</button>
                                        <button onclick="setCustomTone('Conversational and approachable')" class="text-xs px-3 py-1 bg-green-500/20 text-green-400 rounded-full hover:bg-green-500/30 transition-colors">Conversational</button>
                                        <button onclick="setCustomTone('Inspirational and motivating')" class="text-xs px-3 py-1 bg-green-500/20 text-green-400 rounded-full hover:bg-green-500/30 transition-colors">Inspirational</button>
                                        <button onclick="setCustomTone('Analytical and data-driven')" class="text-xs px-3 py-1 bg-green-500/20 text-green-400 rounded-full hover:bg-green-500/30 transition-colors">Analytical</button>
                                        <button onclick="setCustomTone('Casual and friendly')" class="text-xs px-3 py-1 bg-green-500/20 text-green-400 rounded-full hover:bg-green-500/30 transition-colors">Casual</button>
                                    </div>
                                    <!-- Custom Tone Input -->
                                    <textarea id="custom-tone" rows="2" placeholder="Describe your desired tone (e.g., thought-provoking and strategic, practical and solution-focused, humorous but professional...)" class="w-full px-3 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-slate-400 text-sm resize-none focus:ring-2 focus:ring-green-500 focus:border-transparent">Professional and authoritative</textarea>
                                </div>
                            </div>

                            <!-- Media Type Input -->
                            <div>
                                <label class="block text-sm font-medium text-slate-300 mb-3">Preferred Media Type</label>
                                <div class="space-y-3">
                                    <!-- Quick Select Media Types -->
                                    <div class="flex flex-wrap gap-2">
                                        <button onclick="setCustomMedia('Professional infographic with charts and data')" class="text-xs px-3 py-1 bg-orange-500/20 text-orange-400 rounded-full hover:bg-orange-500/30 transition-colors">Infographic</button>
                                        <button onclick="setCustomMedia('Animated GIF showing process or concept')" class="text-xs px-3 py-1 bg-orange-500/20 text-orange-400 rounded-full hover:bg-orange-500/30 transition-colors">Animated GIF</button>
                                        <button onclick="setCustomMedia('Professional team photo in business setting')" class="text-xs px-3 py-1 bg-orange-500/20 text-orange-400 rounded-full hover:bg-orange-500/30 transition-colors">Team Photo</button>
                                        <button onclick="setCustomMedia('Chart or graph visualization')" class="text-xs px-3 py-1 bg-orange-500/20 text-orange-400 rounded-full hover:bg-orange-500/30 transition-colors">Chart/Graph</button>
                                        <button onclick="setCustomMedia('Business meme or humorous visual')" class="text-xs px-3 py-1 bg-orange-500/20 text-orange-400 rounded-full hover:bg-orange-500/30 transition-colors">Business Meme</button>
                                        <button onclick="setCustomMedia('Text-only post')" class="text-xs px-3 py-1 bg-orange-500/20 text-orange-400 rounded-full hover:bg-orange-500/30 transition-colors">Text Only</button>
                                    </div>
                                    <!-- Custom Media Input -->
                                    <textarea id="custom-media" rows="2" placeholder="Describe your preferred media type (e.g., video snippet, carousel post, before/after comparison, case study visual...)" class="w-full px-3 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-slate-400 text-sm resize-none focus:ring-2 focus:ring-orange-500 focus:border-transparent">Professional infographic with charts and data</textarea>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- AI Configuration -->
                    <div class="mb-4 p-3 bg-slate-900/50 rounded-lg border border-slate-600">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm font-medium text-slate-300">AI Content Generation</span>
                            <span class="text-xs px-2 py-1 bg-blue-500/20 text-blue-400 rounded">Local LLM + Cloud Backup</span>
                        </div>
                        <div class="text-xs text-slate-400 mb-2">
                            üöÄ <strong>Local AI First:</strong> Uses your on-device Ollama LLM for privacy and speed. Falls back to Claude API if needed.
                        </div>
                        <input type="password" id="claude-api-key-input" placeholder="Enter Claude API key (sk-ant-...) for backup AI content generation" class="w-full px-3 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white text-xs placeholder-slate-400" onchange="updateClaudeAPIKey()">
                        <div class="text-xs text-slate-500 mt-1">
                            <span class="text-green-400">Primary:</span> Ollama (Local) ‚Ä¢ <span class="text-purple-400">Backup:</span> Claude API (sk-ant-) ‚Ä¢ <span class="text-slate-400">Fallback:</span> Templates
                        </div>
                    </div>

                    <!-- Generate Button -->
                    <div class="mt-6 text-center">
                        <button id="generate-btn" class="px-8 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white font-semibold rounded-lg transition-all duration-300 hover:scale-105">
                            <div class="flex items-center space-x-2">
                                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 7.172V5L8 4z"></path>
                                </svg>
                                <span>Generate LinkedIn Post</span>
                            </div>
                        </button>
                    </div>
                </div>

                <!-- Generated Content -->
                <div id="generated-content" class="bg-slate-800/50 rounded-xl p-6 border border-slate-700 hidden">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-white">Generated Content</h3>
                        <div class="flex space-x-2">
                            <button onclick="regenerateMedia()" class="flex items-center space-x-2 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-colors">
                                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                </svg>
                                <span>Regenerate Post</span>
                            </button>
                            <button onclick="window.insertMedia()" class="flex items-center space-x-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors">
                                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                </svg>
                                <span>Insert Media</span>
                            </button>
                            <button onclick="copyContent()" class="flex items-center space-x-2 px-4 py-2 bg-slate-700 hover:bg-slate-600 text-slate-300 rounded-lg transition-colors">
                                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                                </svg>
                                <span>Copy All</span>
                            </button>
                        </div>
                    </div>

                    <!-- Visual Media Section -->
                    <div id="media-section" class="mb-6 hidden">
                        <h4 class="text-md font-semibold text-white mb-3 flex items-center">
                            <svg class="h-5 w-5 mr-2 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                            </svg>
                            Generated Visual Content
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <!-- Primary Visual -->
                            <div class="bg-slate-700/30 rounded-lg p-4 border border-slate-600">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-sm font-medium text-slate-300">Primary Visual</span>
                                    <span id="media-type" class="px-2 py-1 bg-blue-500/20 text-blue-300 text-xs rounded">AI Image</span>
                                </div>
                                <div id="primary-visual" class="bg-slate-800 rounded-lg p-8 text-center border-2 border-dashed border-slate-600">
                                    <svg class="h-16 w-16 text-slate-500 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                    </svg>
                                    <p class="text-slate-400 text-sm">Visual will appear here</p>
                                </div>
                                <div id="visual-description" class="mt-2 text-xs text-slate-400"></div>
                            </div>

                            <!-- Alternative Options -->
                            <div class="bg-slate-700/30 rounded-lg p-4 border border-slate-600">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-sm font-medium text-slate-300">Alternative Options</span>
                                    <span class="px-2 py-1 bg-green-500/20 text-green-300 text-xs rounded">3 Options</span>
                                </div>
                                <div id="alternative-options" class="space-y-2">
                                    <!-- Alternative options will be populated here -->
                                </div>
                            </div>
                        </div>

                        <!-- Personal AI Model Section -->
                        <div class="bg-slate-700/30 rounded-lg p-4 border border-slate-600">
                            <div class="flex items-center justify-between mb-3">
                                <span class="text-sm font-medium text-slate-300">Personal AI Model</span>
                                <button onclick="togglePersonalModel()" id="personal-model-toggle" class="px-3 py-1 bg-purple-500/20 text-purple-400 text-xs rounded border border-purple-500/30 hover:bg-purple-500/30 transition-colors">
                                    Enable
                                </button>
                            </div>
                            
                            <div id="personal-model-section" class="hidden">
                                <!-- Profile Upload -->
                                <div class="mb-4">
                                    <label class="block text-xs font-medium text-slate-400 mb-2">Upload Profile Pictures (3-5 recommended)</label>
                                    <div class="border-2 border-dashed border-slate-600 rounded-lg p-4 text-center hover:border-slate-500 transition-colors cursor-pointer" onclick="document.getElementById('profile-upload').click()">
                                        <svg class="h-8 w-8 text-slate-500 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                        </svg>
                                        <p class="text-slate-400 text-xs">Click to upload or drag & drop</p>
                                        <p class="text-slate-500 text-xs mt-1">JPG, PNG up to 10MB each</p>
                                    </div>
                                    <input type="file" id="profile-upload" multiple accept="image/*" class="hidden" onchange="handleProfileUpload(event)">
                                </div>

                                <!-- Uploaded Pictures Preview -->
                                <div id="profile-preview" class="hidden mb-4">
                                    <label class="block text-xs font-medium text-slate-400 mb-2">Uploaded Pictures</label>
                                    <div id="profile-thumbnails" class="flex space-x-2 overflow-x-auto">
                                        <!-- Thumbnails will be populated here -->
                                    </div>
                                </div>

                                <!-- Model Training Status -->
                                <div id="model-status" class="hidden mb-4">
                                    <div class="flex items-center space-x-2 text-xs">
                                        <div class="w-2 h-2 bg-blue-400 rounded-full animate-pulse"></div>
                                        <span class="text-slate-400">Training AI model with your photos...</span>
                                    </div>
                                    <div class="bg-slate-800 rounded-full h-2 mt-2">
                                        <div id="training-progress" class="bg-gradient-to-r from-blue-500 to-purple-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                                    </div>
                                </div>

                                <!-- Model Ready -->
                                <div id="model-ready" class="hidden">
                                    <div class="flex items-center space-x-2 text-xs text-green-400 mb-2">
                                        <svg class="h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                        </svg>
                                        <span>Personal AI model ready!</span>
                                    </div>
                                    <div class="text-xs text-slate-400">Your photos will now be used to generate personalized content images</div>
                                </div>
                            </div>
                        </div>

                        <!-- Media Generation Tools -->
                        <div class="bg-blue-500/10 border border-blue-500/30 rounded-lg p-4">
                            <h5 class="text-sm font-semibold text-blue-400 mb-2">AI Tools Used:</h5>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-2 text-xs">
                                <div class="flex items-center space-x-1">
                                    <div class="w-2 h-2 bg-purple-400 rounded-full"></div>
                                    <span class="text-slate-300">DALL-E 3</span>
                                </div>
                                <div class="flex items-center space-x-1">
                                    <div class="w-2 h-2 bg-green-400 rounded-full"></div>
                                    <span class="text-slate-300">Midjourney</span>
                                </div>
                                <div class="flex items-center space-x-1">
                                    <div class="w-2 h-2 bg-blue-400 rounded-full"></div>
                                    <span class="text-slate-300">Canva AI</span>
                                </div>
                                <div class="flex items-center space-x-1">
                                    <div class="w-2 h-2 bg-pink-400 rounded-full"></div>
                                    <span class="text-slate-300">RunwayML</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-slate-900/50 rounded-lg p-4 border border-slate-600">
                        <pre id="content-text" class="text-slate-200 whitespace-pre-wrap text-sm leading-relaxed font-sans"></pre>
                    </div>
                    
                    <div class="mt-4 space-y-4">
                        <!-- Post Actions -->
                        <div class="flex flex-wrap gap-3">
                            <button id="generate-multiple-btn" class="flex items-center space-x-2 px-4 py-2 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white rounded-lg transition-colors">
                                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                                </svg>
                                <span>Generate 5 Posts</span>
                            </button>
                            <button onclick="autoSchedulePost()" class="flex items-center space-x-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors">
                                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                </svg>
                                <span>ü§ñ Smart Schedule</span>
                            </button>
                            <button onclick="schedulePost()" class="flex items-center space-x-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors">
                                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                </svg>
                                <span>Manual Schedule</span>
                            </button>
                            <button onclick="quickSchedule()" class="flex items-center space-x-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors">
                                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                                </svg>
                                <span>Post Now</span>
                            </button>
                            <button onclick="editCurrentPost()" class="flex items-center space-x-2 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-colors">
                                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                </svg>
                                <span>Edit Post</span>
                            </button>
                            <button onclick="createNewPost()" class="flex items-center space-x-2 px-4 py-2 bg-orange-600 hover:bg-orange-700 text-white rounded-lg transition-colors">
                                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                </svg>
                                <span>New Post</span>
                            </button>
                        </div>
                        
                        <!-- Post Status -->
                        <div class="flex items-center justify-between text-sm text-slate-400">
                            <div id="post-status">Ready to post to LinkedIn with visual content</div>
                            <div id="char-count">Character count: 0</div>
                        </div>
                    </div>
                </div>

                <!-- Content Generator Script -->
                <script>
                    console.log('üé® Content Generator script loading...');
                    
                    // Toast Notification System - Define early for global access
                    function showToast(message, type = 'success', duration = 4000) {
                        const toastContainer = document.getElementById('toast-container');
                        const toastId = `toast-${Date.now()}`;
                        
                        // Define toast types and their styles
                        const toastTypes = {
                            success: {
                                bgColor: 'bg-green-600',
                                icon: `<svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>`
                            },
                            error: {
                                bgColor: 'bg-red-600',
                                icon: `<svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>`
                            },
                            info: {
                                bgColor: 'bg-blue-600',
                                icon: `<svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>`
                            },
                            warning: {
                                bgColor: 'bg-yellow-600',
                                icon: `<svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-2.694-.833-3.464 0L3.34 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                                </svg>`
                            }
                        };

                        const toast = toastTypes[type] || toastTypes.info;
                        
                        // Create toast element
                        const toastElement = document.createElement('div');
                        toastElement.id = toastId;
                        toastElement.className = `fixed top-4 right-4 ${toast.bgColor} text-white p-4 rounded-lg shadow-lg z-50 flex items-center space-x-3 transform translate-x-full transition-transform duration-300 max-w-md`;
                        toastElement.innerHTML = `
                            ${toast.icon}
                            <span class="flex-1">${message}</span>
                            <button onclick="document.getElementById('${toastId}').remove()" class="text-white hover:text-gray-200">
                                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        `;
                        
                        // Add to container or body
                        if (toastContainer) {
                            toastContainer.appendChild(toastElement);
                        } else {
                            document.body.appendChild(toastElement);
                        }
                        
                        // Animate in
                        setTimeout(() => {
                            toastElement.style.transform = 'translateX(0)';
                        }, 100);
                        
                        // Auto remove
                        setTimeout(() => {
                            if (document.getElementById(toastId)) {
                                toastElement.style.transform = 'translateX(100%)';
                                setTimeout(() => {
                                    if (document.getElementById(toastId)) {
                                        toastElement.remove();
                                    }
                                }, 300);
                            }
                        }, duration);
                        
                        return toastId;
                    }
                    
                    // Helper functions for different toast types
                    function showSuccess(message, duration = 4000) {
                        return showToast(message, 'success', duration);
                    }
                    
                    function showError(message, duration = 4000) {
                        return showToast(message, 'error', duration);
                    }
                    
                    function showInfo(message, duration = 4000) {
                        return showToast(message, 'info', duration);
                    }
                    
                    function showWarning(message, duration = 4000) {
                        return showToast(message, 'warning', duration);
                    }
                    
                    console.log('‚úÖ Toast notification system loaded');
                    
                    // LinkedIn Connection Status Management - Single Source of Truth
                    window.isLinkedInConnected = function() {
                        // Check both localStorage and currentUser for consistency
                        const connection = JSON.parse(localStorage.getItem('aifluence_linkedin_connection') || '{}');
                        const currentUserId = localStorage.getItem('socialMediaAgent_currentUserId');
                        const users = JSON.parse(localStorage.getItem('socialMediaAgent_users') || '[]');
                        const currentUser = users.find(u => u.id === currentUserId);
                        
                        console.log('üîç LinkedIn Status Debug:');
                        console.log('  - localStorage connection:', connection);
                        console.log('  - currentUserId:', currentUserId);
                        console.log('  - currentUser found:', !!currentUser);
                        console.log('  - currentUser.linkedInConnected:', currentUser?.linkedInConnected);
                        console.log('  - connection.connected:', connection.connected);
                        
                        // Return true only if both sources confirm connection
                        const result = !!(connection.connected && currentUser && currentUser.linkedInConnected);
                        console.log('  - Final result:', result);
                        return result;
                    };
                    
                    window.getLinkedInConnectionInfo = function() {
                        const connection = JSON.parse(localStorage.getItem('aifluence_linkedin_connection') || '{}');
                        const currentUserId = localStorage.getItem('socialMediaAgent_currentUserId');
                        const users = JSON.parse(localStorage.getItem('socialMediaAgent_users') || '[]');
                        const currentUser = users.find(u => u.id === currentUserId);
                        
                        if (typeof window.isLinkedInConnected === 'function' && window.isLinkedInConnected()) {
                            return {
                                connected: true,
                                profile: connection.profile || currentUser.linkedInProfile,
                                connectedAt: connection.connectedAt || currentUser.linkedInConnectedAt
                            };
                        }
                        
                        return { connected: false };
                    };
                    
                    // Debug/Reset function to clear LinkedIn data
                    window.resetLinkedInConnection = function() {
                        console.log('üßπ Resetting LinkedIn connection data...');
                        
                        // Clear localStorage
                        localStorage.removeItem('aifluence_linkedin_connection');
                        localStorage.removeItem('linkedin_oauth_state');
                        localStorage.removeItem('linkedin_auth_code');
                        localStorage.removeItem('linkedin_returned_state');
                        localStorage.removeItem('linkedin_connecting_user');
                        
                        // Clear user data
                        const users = JSON.parse(localStorage.getItem('socialMediaAgent_users') || '[]');
                        const currentUserId = localStorage.getItem('socialMediaAgent_currentUserId');
                        const userIndex = users.findIndex(u => u.id === currentUserId);
                        
                        if (userIndex !== -1) {
                            users[userIndex].linkedInConnected = false;
                            users[userIndex].linkedInProfile = null;
                            users[userIndex].linkedInAuthCode = null;
                            users[userIndex].linkedInConnectedAt = null;
                            localStorage.setItem('socialMediaAgent_users', JSON.stringify(users));
                        }
                        
                        console.log('‚úÖ LinkedIn data reset complete');
                        
                        // Re-initialize status
                        setTimeout(() => {
                            window.initializeLinkedInStatus();
                        }, 100);
                        
                        showToast('LinkedIn connection data reset', 'info');
                    };
                    
                    // Create a simple global disconnect function early
                    window.disconnectLinkedIn = function() {
                        if (confirm('Are you sure you want to disconnect your LinkedIn account?')) {
                            console.log('üîå Disconnecting LinkedIn (early function)...');
                            
                            // Remove persistent LinkedIn connection
                            localStorage.removeItem('aifluence_linkedin_connection');
                            
                            // Update user data
                            const users = JSON.parse(localStorage.getItem('socialMediaAgent_users') || '[]');
                            const currentUserId = localStorage.getItem('socialMediaAgent_currentUserId');
                            const userIndex = users.findIndex(u => u.id === currentUserId);
                            
                            if (userIndex !== -1) {
                                users[userIndex].linkedInConnected = false;
                                users[userIndex].linkedInProfile = null;
                                users[userIndex].linkedInAuthCode = null;
                                users[userIndex].linkedInConnectedAt = null;
                                localStorage.setItem('socialMediaAgent_users', JSON.stringify(users));
                                console.log('‚úÖ User LinkedIn data cleared');
                            }
                            
                            showToast('LinkedIn disconnected successfully!', 'success');
                            
                            // Force refresh the Settings page if visible
                            const settingsContent = document.getElementById('content-settings');
                            if (settingsContent && !settingsContent.classList.contains('hidden')) {
                                console.log('üîÑ Refreshing Settings page display...');
                                setTimeout(() => {
                                    const connectedDiv = document.getElementById('linkedin-connected');
                                    const disconnectedDiv = document.getElementById('linkedin-disconnected');
                                    
                                    if (connectedDiv && disconnectedDiv) {
                                        connectedDiv.classList.add('hidden');
                                        disconnectedDiv.classList.remove('hidden');
                                        console.log('‚úÖ Settings page updated to show disconnected state');
                                    }
                                }, 100);
                            }
                            
                            // Also update LinkedIn tab if it's the main tab
                            if (typeof window.updateLinkedInStatusDisplay === 'function') {
                                setTimeout(() => {
                                    window.updateLinkedInStatusDisplay();
                                }, 200);
                            }
                        }
                    };
                    
                    // Logout functions are now defined in global scope at the top of the document
                    
                    // Seamless LinkedIn OAuth - exactly like every major website
                    window.connectLinkedIn = function() {
                        console.log('üîó Starting seamless LinkedIn OAuth...');
                        
                        // Check if user is logged in
                        const users = JSON.parse(localStorage.getItem('socialMediaAgent_users') || '[]');
                        const currentUserId = localStorage.getItem('socialMediaAgent_currentUserId');
                        let currentUser = users.find(u => u.id === currentUserId);
                        
                        if (!currentUser) {
                            if (typeof showToast === 'function') {
                                showToast('Please log in first to connect LinkedIn', 'error');
                            } else {
                                alert('Please log in first to connect LinkedIn');
                            }
                            return false;
                        }
                        
                        // Check if already connected (with fallback)
                        if (typeof window.isLinkedInConnected === 'function' && window.isLinkedInConnected()) {
                            showToast('LinkedIn is already connected!', 'info');
                            return false;
                        }
                        
                        // Generate secure state for CSRF protection
                        const state = crypto.randomUUID();
                        localStorage.setItem('linkedin_oauth_state', state);
                        localStorage.setItem('linkedin_connecting_user', currentUser.id);
                        
                        // Check if we're running on a proper HTTP server
                        const isLocalFile = window.location.protocol === 'file:';
                        
                        if (isLocalFile) {
                            // Demo mode for file:// protocol
                            console.log('üé≠ Running in demo mode (file:// protocol)');
                            showDemoLinkedInLogin(currentUser);
                            return;
                        }
                        
                        // LinkedIn OAuth URL - using our own callback page
                        const redirectUri = window.location.origin + '/oauth-callback.html';
                        const authUrl = `https://www.linkedin.com/oauth/v2/authorization?` +
                            `response_type=code&` +
                            `client_id=86groi688gvh41&` +
                            `redirect_uri=${encodeURIComponent(redirectUri)}&` +
                            `scope=${encodeURIComponent('openid profile w_member_social')}&` +
                            `state=${state}`;
                        
                        console.log('üîó Opening LinkedIn login popup...');
                        console.log('üìç Using redirect URI:', redirectUri);
                        console.log('üìç Full OAuth URL:', authUrl);
                        if (typeof showToast === 'function') {
                            showToast('üîó Opening LinkedIn login...', 'info');
                        } else {
                            console.log('üîó Opening LinkedIn login...');
                        }
                        
                        // Open LinkedIn login popup
                        const popup = window.open(
                            authUrl,
                            'linkedin-oauth',
                            'width=500,height=600,scrollbars=yes,resizable=yes'
                        );
                        
                        if (!popup) {
                            if (typeof showToast === 'function') {
                                showToast('‚ùå Popup blocked! Please allow popups for LinkedIn login.', 'error');
                            } else {
                                alert('‚ùå Popup blocked! Please allow popups for LinkedIn login.');
                            }
                            return false;
                        }
                        
                        // Listen for the OAuth response from callback page
                        const handleOAuthResponse = (event) => {
                            if (event.data && event.data.type === 'LINKEDIN_OAUTH_SUCCESS') {
                                console.log('‚úÖ LinkedIn OAuth completed successfully!');
                                
                                const { code, state: returnedState } = event.data;
                                
                                // Validate CSRF state
                                const storedState = localStorage.getItem('linkedin_oauth_state');
                                if (returnedState !== storedState) {
                                    if (typeof showToast === 'function') {
                                        showToast('‚ùå Security validation failed', 'error');
                                    } else {
                                        alert('‚ùå Security validation failed');
                                    }
                                    return;
                                }
                                
                                // Complete the connection
                                completeLinkedInConnection(code, currentUser);
                                
                                // Clean up
                                popup.close();
                                window.removeEventListener('message', handleOAuthResponse);
                                localStorage.removeItem('linkedin_oauth_state');
                                localStorage.removeItem('linkedin_connecting_user');
                            }
                        };
                        
                        window.addEventListener('message', handleOAuthResponse);
                        
                        // Handle popup being closed manually
                        const checkClosed = setInterval(() => {
                            if (popup.closed) {
                                clearInterval(checkClosed);
                                window.removeEventListener('message', handleOAuthResponse);
                                
                                // Clean up state
                                localStorage.removeItem('linkedin_oauth_state');
                                localStorage.removeItem('linkedin_connecting_user');
                                
                                console.log('LinkedIn OAuth popup closed');
                            }
                        }, 1000);
                    };
                    
                    // Complete LinkedIn connection with OAuth code
                    function completeLinkedInConnection(authCode, currentUser) {
                        console.log('‚úÖ Completing LinkedIn connection with code:', authCode.substring(0, 10) + '...');
                        
                        if (typeof showToast === 'function') {
                            showToast('üîó Finalizing LinkedIn connection...', 'info');
                        } else {
                            console.log('üîó Finalizing LinkedIn connection...');
                        }
                        
                        setTimeout(() => {
                            // Mark user as connected
                            currentUser.linkedInConnected = true;
                            currentUser.linkedInProfile = currentUser.name + ' - Connected via LinkedIn OAuth';
                            currentUser.linkedInConnectedAt = new Date().toISOString();
                            currentUser.linkedInAuthCode = authCode; // Store for reference
                            
                            // Update users array
                            const users = JSON.parse(localStorage.getItem('socialMediaAgent_users') || '[]');
                            const userIndex = users.findIndex(u => u.id === currentUser.id);
                            if (userIndex !== -1) {
                                users[userIndex] = currentUser;
                                localStorage.setItem('socialMediaAgent_users', JSON.stringify(users));
                            }
                            
                            // Create LinkedIn connection record
                            const linkedInConnection = {
                                connected: true,
                                userId: currentUser.id,
                                connectedAt: currentUser.linkedInConnectedAt,
                                profile: currentUser.linkedInProfile,
                                authCode: authCode
                            };
                            localStorage.setItem('aifluence_linkedin_connection', JSON.stringify(linkedInConnection));
                            
                            if (typeof showToast === 'function') {
                                showToast('‚úÖ LinkedIn connected successfully!', 'success');
                            } else {
                                alert('‚úÖ LinkedIn connected successfully!');
                            }
                            
                            // Update all displays
                            if (typeof window.updateLinkedInStatusDisplay === 'function') {
                                setTimeout(() => {
                                    window.updateLinkedInStatusDisplay();
                                }, 100);
                            }
                            
                            console.log('‚úÖ LinkedIn OAuth connection completed');
                        }, 500);
                    }
                    
                    // Demo LinkedIn login for file:// protocol
                    function showDemoLinkedInLogin(currentUser) {
                        console.log('üé≠ Showing demo LinkedIn login');
                        
                        // Create a realistic LinkedIn login popup
                        const linkedinPopup = window.open('', 'linkedin-demo', 'width=500,height=600');
                        
                        if (!linkedinPopup) {
                            if (typeof showToast === 'function') {
                                showToast('‚ùå Popup blocked! Please allow popups.', 'error');
                            } else {
                                alert('‚ùå Popup blocked! Please allow popups.');
                            }
                            return;
                        }
                        
                        // Create realistic LinkedIn login page
                        linkedinPopup.document.write(`
                            <!DOCTYPE html>
                            <html>
                            <head>
                                <title>LinkedIn Login</title>
                                <style>
                                    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; margin: 0; padding: 20px; background: #f3f2ef; }
                                    .container { max-width: 400px; margin: 0 auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
                                    .logo { text-align: center; margin-bottom: 30px; font-size: 24px; color: #0077b5; font-weight: bold; }
                                    .form-group { margin-bottom: 20px; }
                                    label { display: block; margin-bottom: 5px; font-weight: 500; color: #333; }
                                    input[type="email"], input[type="password"] { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 16px; }
                                    .btn { width: 100%; padding: 12px; background: #0077b5; color: white; border: none; border-radius: 4px; font-size: 16px; cursor: pointer; font-weight: 500; }
                                    .btn:hover { background: #005885; }
                                    .demo-note { background: #e3f2fd; padding: 10px; border-radius: 4px; margin-bottom: 20px; font-size: 14px; color: #1976d2; }
                                </style>
                            </head>
                            <body>
                                <div class="container">
                                    <div class="logo">LinkedIn</div>
                                    <div class="demo-note">
                                        <strong>Demo Mode:</strong> This is a simulated LinkedIn login. Enter any credentials to continue.
                                    </div>
                                    <form id="loginForm">
                                        <div class="form-group">
                                            <label for="email">Email or phone</label>
                                            <input type="email" id="email" name="email" required placeholder="Enter your email">
                                        </div>
                                        <div class="form-group">
                                            <label for="password">Password</label>
                                            <input type="password" id="password" name="password" required placeholder="Enter your password">
                                        </div>
                                        <button type="submit" class="btn">Sign in</button>
                                    </form>
                                </div>
                                <script>
                                    document.getElementById('loginForm').addEventListener('submit', function(e) {
                                        e.preventDefault();
                                        
                                        // Show connecting state
                                        document.querySelector('.container').innerHTML = `
                                            <div style="text-align: center; padding: 40px;">
                                                <div style="font-size: 48px; margin-bottom: 20px;">‚úÖ</div>
                                                <h2 style="color: #0077b5; margin-bottom: 10px;">Success!</h2>
                                                <p style="color: #666;">LinkedIn account connected successfully.</p>
                                                <p style="color: #666; font-size: 14px;">This window will close automatically...</p>
                                            </div>
                                        `;
                                        
                                        // Simulate OAuth response
                                        setTimeout(() => {
                                            window.opener.postMessage({
                                                type: 'LINKEDIN_OAUTH_SUCCESS',
                                                code: 'demo_auth_code_' + Math.random().toString(36).substr(2, 9),
                                                state: window.opener.localStorage.getItem('linkedin_oauth_state')
                                            }, '*');
                                            
                                            window.close();
                                        }, 2000);
                                    });
                                </script>
                            </body>
                            </html>
                        `);
                    }

                <!-- Multiple Posts Generation Results -->
                <div id="multiple-posts-container" class="hidden mt-8">
                    <div class="space-y-6">
                        <div class="flex items-center justify-between">
                            <h3 class="text-xl font-bold text-white">Generated Posts</h3>
                            <div class="flex space-x-3">
                                <button onclick="selectAllPosts()" class="flex items-center space-x-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors">
                                    <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    <span id="select-all-text">Select All</span>
                                </button>
                                <button onclick="scheduleSelectedPosts()" class="flex items-center space-x-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors">
                                    <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                    </svg>
                                    <span>Schedule Selected</span>
                                </button>
                                <button onclick="clearMultiplePosts()" class="px-4 py-2 bg-slate-600 hover:bg-slate-700 text-white rounded-lg transition-colors">
                                    Clear All
                                </button>
                            </div>
                        </div>
                        
                        <!-- Scheduling Preview -->
                        <div id="scheduling-preview" class="hidden bg-slate-700/30 rounded-lg p-4 border border-slate-600">
                            <h4 class="text-white font-medium mb-3 flex items-center">
                                <svg class="h-4 w-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                Scheduling Preview (Drag to Reorder)
                            </h4>
                            <div id="scheduling-preview-list" class="space-y-2">
                                <!-- Preview items will be inserted here -->
                            </div>
                        </div>
                        
                        <div id="multiple-posts-grid" class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <!-- Generated posts will be inserted here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- LinkedIn Connect Tab -->
        <div id="content-linkedin" class="tab-content hidden">
            <div class="space-y-6">
                <div class="text-center">
                    <h2 class="text-3xl font-bold text-white mb-2">Connect to LinkedIn</h2>
                    <p class="text-slate-400">Link your LinkedIn account to start posting content</p>
                </div>

                <div class="bg-slate-800/50 rounded-xl p-8 border border-slate-700 text-center">
                    <div class="flex justify-center mb-6">
                        <div class="p-4 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full">
                            <svg class="h-12 w-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"></path>
                            </svg>
                        </div>
                    </div>

                    <h3 class="text-xl font-semibold text-white mb-3">Connect Your LinkedIn Account</h3>
                    
                    <p class="text-slate-400 mb-6 max-w-md mx-auto">
                        ‚úÖ <strong>Real LinkedIn OAuth Integration</strong><br>
                        This will open LinkedIn's official authorization page where you'll log into your LinkedIn account and grant AIfluence permission to post on your behalf.
                    </p>
                    
                    <div class="bg-blue-500/10 border border-blue-500/30 rounded-lg p-4 mb-6 max-w-md mx-auto">
                        <p class="text-blue-300 text-sm">
                            üîí <strong>Secure OAuth 2.0 Flow</strong><br>
                            ‚Ä¢ Your LinkedIn credentials stay with LinkedIn<br>
                            ‚Ä¢ AIfluence never sees your password<br>
                            ‚Ä¢ You can revoke access anytime in LinkedIn settings
                        </p>
                    </div>

                    <button id="connect-linkedin-btn" onclick="window.connectLinkedIn(); return false;" class="px-8 py-3 bg-linkedin hover:bg-linkedin-hover text-white font-semibold rounded-lg transition-all duration-300 hover:scale-105">
                        <div class="flex items-center space-x-2">
                            <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"></path>
                            </svg>
                            <span>Connect to LinkedIn</span>
                        </div>
                        <p style="font-size: 10px; color: #888; margin-top: 4px;">Click to test - Debug version</p>
                    </button>
                    
                    <!-- Simple test button -->
                    <button onclick="alert('Simple test works!')" style="margin-top: 10px; padding: 5px; background: red; color: white; border: none; border-radius: 3px;">
                        Simple Test Button
                    </button>
                    
                    <!-- Function test button -->
                    <button onclick="window.testLinkedInFunction()" style="margin-top: 5px; padding: 5px; background: green; color: white; border: none; border-radius: 3px;">
                        Test LinkedIn Function
                    </button>
                    
                    <script>
                        // Define test function immediately
                        window.testLinkedInFunction = function() {
                            console.log('Testing LinkedIn function availability...');
                            console.log('connectLinkedIn type:', typeof connectLinkedIn);
                            console.log('window.connectLinkedIn type:', typeof window.connectLinkedIn);
                            if (typeof window.connectLinkedIn === 'function') {
                                alert('LinkedIn function found! Calling it...');
                                window.connectLinkedIn();
                            } else {
                                alert('LinkedIn function NOT found!');
                            }
                        };
                        console.log('Test function defined');
                        
                        // LinkedIn OAuth Configuration - Industry Standard
                        const LINKEDIN_CONFIG = {
                            clientId: '86groi688gvh41',
                            // Use our local callback page for popup OAuth
                            redirectUri: 'http://localhost:8083/oauth-callback.html',
                            scope: 'openid profile w_member_social',
                            get state() { return window.generateCSRFToken(); }
                        };
                        
                        console.log('ü§ñ Using reliable callback URI:', LINKEDIN_CONFIG.redirectUri);
                        
                        console.log('‚úÖ LinkedIn products approved: OpenID Connect + Share on LinkedIn');
                        console.log('üîó Using scopes:', LINKEDIN_CONFIG.scope);
                        
                        console.log('üîó LinkedIn redirect URI:', LINKEDIN_CONFIG.redirectUri);
                        console.log('üîó Current page location:', window.location.href);
                        
                        // Define LinkedIn functions immediately in global scope
                        window.connectLinkedIn = function() {
                            console.log('üîó Connecting to LinkedIn (simple)...');
                            
                            // Check if user is logged in to AIfluence
                            const users = JSON.parse(localStorage.getItem('socialMediaAgent_users') || '[]');
                            const currentUserId = localStorage.getItem('socialMediaAgent_currentUserId');
                            let currentUser = null;
                            
                            if (currentUserId) {
                                currentUser = users.find(u => u.id === currentUserId);
                            }
                            
                            if (!currentUser) {
                                // Check persistent login
                                const persistentLogin = localStorage.getItem('socialMediaAgent_persistentLogin');
                                if (persistentLogin) {
                                    try {
                                        const loginData = JSON.parse(persistentLogin);
                                        currentUser = users.find(u => u.id === loginData.userId);
                                    } catch (e) {
                                        console.error('Error parsing persistent login:', e);
                                    }
                                }
                            }
                            
                            if (!currentUser) {
                                if (typeof showToast === 'function') {
                                showToast('Please log in first to connect LinkedIn', 'error');
                            } else {
                                alert('Please log in first to connect LinkedIn');
                            }
                                return false;
                            }
                            
                            // Check if already connected (with fallback for function not defined yet)
                            if (typeof window.isLinkedInConnected === 'function' && window.isLinkedInConnected()) {
                                if (typeof showToast === 'function') {
                                    showToast('LinkedIn is already connected!', 'info');
                                } else {
                                    alert('LinkedIn is already connected!');
                                }
                                return false;
                            }
                            
                            // Generate secure state for CSRF protection
                            const oauthState = LINKEDIN_CONFIG.state;
                            
                            // Store state and user info for validation
                            localStorage.setItem('linkedin_oauth_state', oauthState);
                            localStorage.setItem('linkedin_connecting_user', currentUser.id);
                            
                            // Build LinkedIn OAuth URL
                            const authUrl = `https://www.linkedin.com/oauth/v2/authorization?` +
                                `response_type=code&` +
                                `client_id=${LINKEDIN_CONFIG.clientId}&` +
                                `redirect_uri=${encodeURIComponent(LINKEDIN_CONFIG.redirectUri)}&` +
                                `scope=${encodeURIComponent(LINKEDIN_CONFIG.scope)}&` +
                                `state=${oauthState}`;
                            
                            console.log('üîó Opening LinkedIn OAuth popup...');
                            if (typeof showToast === 'function') {
                                showToast('üîó Opening LinkedIn authorization...', 'info');
                            } else {
                                console.log('üîó Opening LinkedIn authorization...');
                            }
                            
                            // Open popup window (industry standard approach)
                            const authPopup = window.open(
                                authUrl,
                                'linkedinAuth',
                                'width=600,height=700,scrollbars=yes,resizable=yes,centerscreen=yes'
                            );
                            
                            if (!authPopup) {
                                if (typeof showToast === 'function') {
                                    showToast('‚ùå Popup blocked! Please allow popups for LinkedIn OAuth.', 'error');
                                } else {
                                    alert('‚ùå Popup blocked! Please allow popups for LinkedIn OAuth.');
                                }
                                return false;
                            }
                            
                            // Monitor popup for completion - this is how every major site does it
                            window.monitorLinkedInPopup(authPopup, currentUser);
                            
                            return false;
                        };
                        
                        // Monitor popup window for OAuth completion (industry standard)
                        window.monitorLinkedInPopup = function(popup, currentUser) {
                            console.log('üëÅÔ∏è Monitoring LinkedIn popup for completion...');
                            
                            let messageReceived = false;
                            
                            // Listen for postMessage from popup callback
                            const messageHandler = (event) => {
                                if (event.data && event.data.type === 'LINKEDIN_OAUTH_SUCCESS') {
                                    console.log('‚úÖ OAuth success received via postMessage');
                                    messageReceived = true;
                                    
                                    // Clean up
                                    popup.close();
                                    clearInterval(pollTimer);
                                    window.removeEventListener('message', messageHandler);
                                    
                                    // Process the OAuth response
                                    window.handleLinkedInOAuth(event.data.code, event.data.state, currentUser);
                                }
                            };
                            
                            window.addEventListener('message', messageHandler);
                            
                            // Fallback: Poll for URL changes (when popup domain allows)
                            const pollTimer = setInterval(() => {
                                try {
                                    if (popup.closed) {
                                        clearInterval(pollTimer);
                                        window.removeEventListener('message', messageHandler);
                                        
                                        if (!messageReceived && !currentUser.linkedInConnected) {
                                            console.log('üîÑ Checking for manual OAuth completion...');
                                            // Check if user manually completed OAuth
                                            window.checkForManualOAuth();
                                        }
                                        return;
                                    }
                                    
                                    // Try to read popup URL (works only for same-origin)
                                    const popupUrl = popup.location.href;
                                    
                                    if (popupUrl.includes('code=')) {
                                        console.log('‚úÖ OAuth code detected in popup URL');
                                        messageReceived = true;
                                        
                                        // Extract code and state from URL
                                        const urlParams = new URLSearchParams(popup.location.search);
                                        const code = urlParams.get('code');
                                        const state = urlParams.get('state');
                                        
                                        // Close popup and clean up
                                        popup.close();
                                        clearInterval(pollTimer);
                                        window.removeEventListener('message', messageHandler);
                                        
                                        // Process the OAuth response
                                        window.handleLinkedInOAuth(code, state, currentUser);
                                    }
                                } catch (e) {
                                    // Cross-origin restrictions - this is normal
                                    // Just wait for postMessage or manual completion
                                }
                            }, 1000);
                            
                            // Timeout after 10 minutes
                            setTimeout(() => {
                                if (!popup.closed) {
                                    popup.close();
                                }
                                clearInterval(pollTimer);
                                window.removeEventListener('message', messageHandler);
                                
                                if (!messageReceived && !currentUser.linkedInConnected) {
                                    if (typeof showToast === 'function') {
                                        showToast('‚è∞ LinkedIn connection timed out', 'warning');
                                    } else {
                                        alert('‚è∞ LinkedIn connection timed out');
                                    }
                                }
                            }, 10 * 60 * 1000);
                        };
                        
                        // Handle OAuth response (industry standard)
                        window.handleLinkedInOAuth = function(code, state, currentUser) {
                            console.log('üîÑ Processing LinkedIn OAuth response...');
                            
                            if (!code) {
                                if (typeof showToast === 'function') {
                                    showToast('‚ùå No authorization code received', 'error');
                                } else {
                                    alert('‚ùå No authorization code received');
                                }
                                return;
                            }
                            
                            // Validate state for CSRF protection
                            const storedState = localStorage.getItem('linkedin_oauth_state');
                            if (state !== storedState) {
                                console.error('‚ùå OAuth state mismatch - possible CSRF attack');
                                if (typeof showToast === 'function') {
                                    showToast('‚ùå Security validation failed', 'error');
                                } else {
                                    alert('‚ùå Security validation failed');
                                }
                                return;
                            }
                            
                            // Clean up stored state
                            localStorage.removeItem('linkedin_oauth_state');
                            localStorage.removeItem('linkedin_connecting_user');
                            
                            if (typeof showToast === 'function') {
                                showToast('‚úÖ LinkedIn authorization successful! Connecting...', 'success');
                            } else {
                                alert('‚úÖ LinkedIn authorization successful! Connecting...');
                            }
                            
                            // Process the authorization code using existing handler
                            window.handleLinkedInCallback(code);
                        };
                        
                        // Check for manual OAuth completion
                        window.checkForManualOAuth = function() {
                            const manualCode = prompt('üîó LinkedIn Authorization\n\nIf you completed the authorization manually, please paste the code here:\n(Optional - leave empty to cancel)');
                            
                            if (manualCode && manualCode.trim()) {
                                const cleanCode = manualCode.trim().replace(/['"]/g, '');
                                console.log('üìù Manual OAuth code provided');
                                if (typeof showToast === 'function') {
                                    showToast('üìù Processing manual authorization code...', 'info');
                                } else {
                                    console.log('üìù Processing manual authorization code...');
                                }
                                window.handleLinkedInCallback(cleanCode);
                            } else {
                                if (typeof showToast === 'function') {
                                    showToast('‚ùå LinkedIn connection cancelled', 'warning');
                                } else {
                                    alert('‚ùå LinkedIn connection cancelled');
                                }
                            }
                        };
                        
                        // Function to check if OAuth completed
                        window.checkLinkedInAuth = function() {
                            console.log('üîç Checking for LinkedIn OAuth completion...');
                            
                            // Check if we have an auth code in localStorage (would be set by callback)
                            const authCode = localStorage.getItem('linkedin_auth_code');
                            const storedState = localStorage.getItem('linkedin_oauth_state');
                            const returnedState = localStorage.getItem('linkedin_returned_state');
                            
                            if (authCode && storedState === returnedState) {
                                console.log('‚úÖ LinkedIn OAuth completed successfully!');
                                // Clear temporary storage
                                localStorage.removeItem('linkedin_auth_code');
                                localStorage.removeItem('linkedin_oauth_state');
                                localStorage.removeItem('linkedin_returned_state');
                                
                                // Exchange code for access token
                                window.exchangeLinkedInCode(authCode);
                            } else {
                                // Keep checking every 2 seconds
                                setTimeout(window.checkLinkedInAuth, 2000);
                            }
                        };
                        
                        // Function to exchange auth code for access token
                        window.exchangeLinkedInCode = function(authCode) {
                            console.log('üîó Exchanging LinkedIn auth code for access token...');
                            
                            // Note: In production, this should be done on your backend server
                            // For demo purposes, we'll simulate the token exchange
                            alert('LinkedIn authorization successful! In a real implementation, we would now exchange the auth code for an access token on the backend server.');
                            
                            // Get the user who was connecting
                            const connectingUserId = localStorage.getItem('linkedin_connecting_user');
                            const users = JSON.parse(localStorage.getItem('socialMediaAgent_users') || '[]');
                            const userIndex = users.findIndex(u => u.id === connectingUserId);
                            
                            if (userIndex !== -1) {
                                // Mark user as LinkedIn connected
                                users[userIndex].linkedInConnected = true;
                                users[userIndex].linkedInAuthCode = authCode; // Store for demo
                                users[userIndex].linkedInProfile = users[userIndex].name + ' - Connected via Real OAuth';
                                
                                localStorage.setItem('socialMediaAgent_users', JSON.stringify(users));
                                localStorage.removeItem('linkedin_connecting_user');
                                
                                alert('LinkedIn connected successfully! üéâ\n\nYour LinkedIn account is now connected to AIfluence.');
                                
                                // Update UI
                                if (typeof updateLinkedInStatus === 'function') {
                                    updateLinkedInStatus();
                                }
                                
                                // Show analytics status
                                const analyticsStatus = document.getElementById('linkedin-analytics-status');
                                if (analyticsStatus) {
                                    analyticsStatus.classList.remove('hidden');
                                }
                            }
                        };
                        
                        // Enhanced callback handler with automatic processing
                        window.handleLinkedInCallback = function(authCode) {
                            console.log('üîó LinkedIn callback with code:', authCode);
                            
                            if (!authCode) {
                                alert('Please provide the authorization code from LinkedIn');
                                return;
                            }
                            
                            // Get current user (auto-login should be active)
                            const users = JSON.parse(localStorage.getItem('socialMediaAgent_users') || '[]');
                            let currentUser = users.find(u => u.id === currentUserId);
                            
                            if (!currentUser) {
                                // Get from connecting user if set
                                const connectingUserId = localStorage.getItem('linkedin_connecting_user');
                                currentUser = users.find(u => u.id === connectingUserId);
                            }
                            
                            if (currentUser) {
                                // Mark user as LinkedIn connected
                                currentUser.linkedInConnected = true;
                                currentUser.linkedInAuthCode = authCode;
                                currentUser.linkedInProfile = currentUser.name + ' - Connected via Real OAuth';
                                currentUser.linkedInConnectedAt = new Date().toISOString();
                                
                                // Update users array
                                const userIndex = users.findIndex(u => u.id === currentUser.id);
                                if (userIndex !== -1) {
                                    users[userIndex] = currentUser;
                                }
                                
                                localStorage.setItem('socialMediaAgent_users', JSON.stringify(users));
                                localStorage.removeItem('linkedin_connecting_user');
                                
                                // Create persistent LinkedIn connection
                                const linkedInConnection = {
                                    userId: currentUser.id,
                                    authCode: authCode,
                                    connected: true,
                                    connectedAt: new Date().toISOString(),
                                    profile: currentUser.linkedInProfile
                                };
                                localStorage.setItem('aifluence_linkedin_connection', JSON.stringify(linkedInConnection));
                                
                                alert('LinkedIn connected successfully! üéâ\n\nYour LinkedIn account is now connected to AIfluence.');
                                
                                // Update UI immediately
                                updateLinkedInStatusDisplay();
                                
                                console.log('‚úÖ LinkedIn connection saved persistently');
                            } else {
                                alert('Error: Could not find current user for LinkedIn connection');
                            }
                        };
                        
                        // Function to update LinkedIn status display
                        window.updateLinkedInStatusDisplay = function() {
                            const connectionInfo = window.getLinkedInConnectionInfo();
                            
                            if (connectionInfo.connected) {
                                // Update LinkedIn connect page
                                const connectSection = document.querySelector('#content-linkedin .bg-slate-800\/50');
                                if (connectSection) {
                                    connectSection.innerHTML = `
                                        <div class="text-center">
                                            <div class="inline-flex items-center justify-center w-16 h-16 bg-green-500/20 rounded-full mb-4">
                                                <svg class="h-8 w-8 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                                </svg>
                                            </div>
                                            <h3 class="text-xl font-semibold text-green-400 mb-3">‚úÖ LinkedIn Connected!</h3>
                                            <p class="text-slate-300 mb-4">
                                                Your LinkedIn account is successfully connected to AIfluence.
                                            </p>
                                            <div class="bg-green-500/10 border border-green-500/30 rounded-lg p-4 mb-4">
                                                <p class="text-green-300 text-sm">
                                                    <strong>Profile:</strong> ${connectionInfo.profile || 'LinkedIn Profile'}<br>
                                                    <strong>Connected:</strong> ${connectionInfo.connectedAt ? new Date(connectionInfo.connectedAt).toLocaleDateString() : 'Recently'}
                                                </p>
                                            </div>
                                            <button onclick="window.disconnectLinkedIn()" class="px-6 py-2 bg-red-500/20 hover:bg-red-500/30 text-red-400 border border-red-500/30 rounded-lg transition-colors">
                                                Disconnect LinkedIn
                                            </button>
                                        </div>
                                    `;
                                }
                                
                                // Update settings page
                                const linkedInConnected = document.getElementById('linkedin-connected');
                                const linkedInDisconnected = document.getElementById('linkedin-disconnected');
                                
                                if (linkedInConnected && linkedInDisconnected) {
                                    linkedInConnected.classList.remove('hidden');
                                    linkedInDisconnected.classList.add('hidden');
                                    
                                    const profileName = document.getElementById('linkedin-profile-name');
                                    if (profileName) {
                                        profileName.textContent = connection.profile;
                                    }
                                }
                                
                                // Show analytics status
                                const analyticsStatus = document.getElementById('linkedin-analytics-status');
                                if (analyticsStatus) {
                                    analyticsStatus.classList.remove('hidden');
                                }
                            }
                        };
                        
                        // Function to check LinkedIn connection on page load
                        window.initializeLinkedInConnection = function() {
                            const connection = JSON.parse(localStorage.getItem('aifluence_linkedin_connection') || '{}');
                            
                            if (connection.connected) {
                                console.log('‚úÖ LinkedIn connection found - restoring status');
                                updateLinkedInStatusDisplay();
                            } else {
                                console.log('‚ùå No LinkedIn connection found');
                            }
                        };
                        
                        // SECURITY: Secure password hashing using Web Crypto API
                        window.hashPassword = async function(password) {
                            const encoder = new TextEncoder();
                            const salt = 'aifluence_salt_2024_secure_' + window.location.hostname;
                            const data = encoder.encode(password + salt);
                            const hashBuffer = await crypto.subtle.digest('SHA-256', data);
                            const hashArray = Array.from(new Uint8Array(hashBuffer));
                            return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
                        };
                        
                        window.verifyPassword = async function(password, hash) {
                            const inputHash = await window.hashPassword(password);
                            return inputHash === hash;
                        };
                        
                        // SECURITY: Generate secure random session IDs
                        window.generateSecureSessionId = function() {
                            const array = new Uint8Array(32);
                            crypto.getRandomValues(array);
                            return Array.from(array, byte => byte.toString(16).padStart(2, '0')).join('');
                        };
                        
                        // SECURITY: CSRF Token generation
                        window.generateCSRFToken = function() {
                            const array = new Uint8Array(16);
                            crypto.getRandomValues(array);
                            return Array.from(array, byte => byte.toString(16).padStart(2, '0')).join('');
                        };
                        
                        // ULTRA-AUTO Setup Function
                        window.showUltraAutoSetup = function() {
                            const setupHtml = `
                                <div style="background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); color: white; padding: 2rem; border-radius: 15px; max-width: 600px; margin: 2rem auto; font-family: Inter, sans-serif; border: 2px solid #3b82f6;">
                                    <h2 style="color: #60a5fa; margin-bottom: 1.5rem;">ü§ñ Ultra-Auto LinkedIn Setup</h2>
                                    
                                    <div style="background: rgba(59, 130, 246, 0.1); padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem; border: 1px solid rgba(59, 130, 246, 0.3);">
                                        <h3>üöÄ Quick Setup Options:</h3>
                                        <div style="margin: 1rem 0;">
                                            <strong>1. GitHub Pages (Recommended)</strong><br>
                                            <small>‚Ä¢ Create repo ‚Üí Upload callback page ‚Üí Enable Pages</small>
                                        </div>
                                        <div style="margin: 1rem 0;">
                                            <strong>2. Netlify/Vercel</strong><br>
                                            <small>‚Ä¢ Drag & drop the callback file ‚Üí Get HTTPS URL</small>
                                        </div>
                                        <div style="margin: 1rem 0;">
                                            <strong>3. CodePen</strong><br>
                                            <small>‚Ä¢ Create pen ‚Üí Copy callback HTML ‚Üí Use full page URL</small>
                                        </div>
                                    </div>
                                    
                                    <div style="background: rgba(16, 185, 129, 0.1); padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem; border: 1px solid rgba(16, 185, 129, 0.3);">
                                        <h3>üìù Instructions:</h3>
                                        <ol style="margin: 0.5rem 0; padding-left: 1.5rem; font-size: 0.9rem;">
                                            <li>Host 'linkedin-ultra-auto-callback.html' on HTTPS</li>
                                            <li>Copy your hosted URL</li>
                                            <li>Add it to LinkedIn app redirect URIs</li>
                                            <li>Enter URL below to activate Ultra-Auto</li>
                                        </ol>
                                    </div>
                                    
                                    <div style="margin: 1.5rem 0;">
                                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Enter your hosted callback URL:</label>
                                        <input type="text" id="ultra-auto-url" placeholder="https://username.github.io/aifluence-linkedin-callback" 
                                               style="width: 100%; padding: 0.75rem; background: #374151; border: 1px solid #6b7280; border-radius: 6px; color: white; font-size: 0.9rem; box-sizing: border-box;">
                                    </div>
                                    
                                    <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                                        <button onclick="window.saveUltraAutoUrl()" 
                                                style="flex: 1; padding: 0.75rem; background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; transition: transform 0.2s;">
                                            ‚ú® Activate Ultra-Auto
                                        </button>
                                        <button onclick="window.closeUltraAutoSetup()" 
                                                style="flex: 1; padding: 0.75rem; background: #6b7280; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer;">
                                            ‚ùå Use Manual Mode
                                        </button>
                                    </div>
                                    
                                    <div style="margin-top: 1.5rem; padding: 1rem; background: rgba(245, 158, 11, 0.1); border-radius: 6px; border: 1px solid rgba(245, 158, 11, 0.3); font-size: 0.8rem;">
                                        üìö <strong>See HOSTING_INSTRUCTIONS.md</strong> for detailed setup guide
                                    </div>
                                </div>
                            `;
                            
                            // Create modal overlay
                            const overlay = document.createElement('div');
                            overlay.id = 'ultra-auto-setup-modal';
                            overlay.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10000; display: flex; align-items: center; justify-content: center; overflow-y: auto;';
                            overlay.innerHTML = setupHtml;
                            
                            document.body.appendChild(overlay);
                            
                            // Focus on input
                            setTimeout(() => {
                                document.getElementById('ultra-auto-url').focus();
                            }, 100);
                        };
                        
                        window.saveUltraAutoUrl = function() {
                            const url = document.getElementById('ultra-auto-url').value.trim();
                            
                            if (!url) {
                                alert('‚ùå Please enter a valid HTTPS URL');
                                return;
                            }
                            
                            if (!url.startsWith('https://')) {
                                alert('‚ùå LinkedIn requires HTTPS URLs only');
                                return;
                            }
                            
                            // Save the URL
                            localStorage.setItem('aifluence_linkedin_callback_url', url);
                            
                            // Close modal
                            window.closeUltraAutoSetup();
                            
                            // Show success message
                            showToast('‚ú® Ultra-Auto callback URL saved! LinkedIn OAuth is now fully automated.', 'success');
                            
                            // Show next steps
                            setTimeout(() => {
                                alert(`üéâ Ultra-Auto Activated!\n\nCallback URL: ${url}\n\nüîó IMPORTANT: Add this EXACT URL to your LinkedIn app's redirect URIs\n\n‚ú® Next LinkedIn connection will be FULLY AUTOMATED!`);
                            }, 1000);
                        };
                        
                        window.closeUltraAutoSetup = function() {
                            const modal = document.getElementById('ultra-auto-setup-modal');
                            if (modal) {
                                modal.remove();
                            }
                        };
                        
                        console.log('üöÄ ULTRA-AUTOMATED LinkedIn OAuth system loaded!');
                        console.log('üöÄ Client ID configured:', LINKEDIN_CONFIG.clientId);
                        console.log('üöÄ Ultra-Auto callback URL:', LINKEDIN_CONFIG.redirectUri);
                        console.log('üöÄ Fallback manual callback: window.handleLinkedInCallback(code)');
                        console.log('üöÄ ZERO manual steps required when ultra-auto is configured!');
                        // SECURITY: Input sanitization
                        window.sanitizeInput = function(input) {
                            if (typeof input !== 'string') return input;
                            return input
                                .replace(/[<>"'&]/g, function(char) {
                                    const entities = {
                                        '<': '&lt;',
                                        '>': '&gt;',
                                        '"': '&quot;',
                                        "'": '&#x27;',
                                        '&': '&amp;'
                                    };
                                    return entities[char];
                                })
                                .trim()
                                .substring(0, 1000); // Limit length
                        };
                        
                        // SECURITY: Session management with expiration
                        window.createSecureSession = function(userId, persistent = false) {
                            const sessionId = window.generateSecureSessionId();
                            const expiration = persistent ? 
                                Date.now() + (30 * 24 * 60 * 60 * 1000) : // 30 days
                                Date.now() + (24 * 60 * 60 * 1000); // 24 hours
                            
                            const sessionData = {
                                sessionId,
                                userId,
                                created: Date.now(),
                                expires: expiration,
                                persistent,
                                userAgent: navigator.userAgent.substring(0, 200),
                                lastActivity: Date.now()
                            };
                            
                            const storageKey = persistent ? 'socialMediaAgent_persistentLogin' : 'socialMediaAgent_currentSession';
                            localStorage.setItem(storageKey, JSON.stringify(sessionData));
                            localStorage.setItem('socialMediaAgent_currentUserId', userId);
                            
                            return sessionId;
                        };
                        
                        // SECURITY: Validate session integrity
                        window.validateSession = function() {
                            const persistentLogin = localStorage.getItem('socialMediaAgent_persistentLogin');
                            const currentSession = localStorage.getItem('socialMediaAgent_currentSession');
                            
                            let validSession = null;
                            
                            // Check persistent login first
                            if (persistentLogin) {
                                try {
                                    const session = JSON.parse(persistentLogin);
                                    if (session.expires > Date.now()) {
                                        // Update last activity
                                        session.lastActivity = Date.now();
                                        localStorage.setItem('socialMediaAgent_persistentLogin', JSON.stringify(session));
                                        validSession = session;
                                    } else {
                                        localStorage.removeItem('socialMediaAgent_persistentLogin');
                                    }
                                } catch (e) {
                                    localStorage.removeItem('socialMediaAgent_persistentLogin');
                                }
                            }
                            
                            // Check current session
                            if (!validSession && currentSession) {
                                try {
                                    const session = JSON.parse(currentSession);
                                    if (session.expires > Date.now()) {
                                        session.lastActivity = Date.now();
                                        localStorage.setItem('socialMediaAgent_currentSession', JSON.stringify(session));
                                        validSession = session;
                                    } else {
                                        localStorage.removeItem('socialMediaAgent_currentSession');
                                    }
                                } catch (e) {
                                    localStorage.removeItem('socialMediaAgent_currentSession');
                                }
                            }
                            
                            return validSession;
                        };
                        
                        // SECURITY: Clear all sessions on logout
                        window.clearAllSessions = function() {
                            localStorage.removeItem('socialMediaAgent_persistentLogin');
                            localStorage.removeItem('socialMediaAgent_currentSession');
                            localStorage.removeItem('socialMediaAgent_currentUserId');
                            localStorage.removeItem('linkedin_oauth_state');
                            localStorage.removeItem('linkedin_connecting_user');
                            localStorage.removeItem('linkedin_auth_code');
                            localStorage.removeItem('linkedin_returned_state');
                        };
                        
                        console.log('üîí Security functions loaded: password hashing, CSRF protection');
                        console.log('üîí Session management: secure sessions, input sanitization, expiration checks');
                        
                        // Clear any existing test user data
                        const users = JSON.parse(localStorage.getItem('socialMediaAgent_users') || '[]');
                        const filteredUsers = users.filter(u => u.email !== 'testtestmate@gmail.com');
                        if (filteredUsers.length !== users.length) {
                            localStorage.setItem('socialMediaAgent_users', JSON.stringify(filteredUsers));
                            console.log('üßπ Cleared test user data');
                        }
                        
                        // Clear test user session if it exists
                        const currentUserId = localStorage.getItem('socialMediaAgent_currentUserId');
                        if (currentUserId === 'test-user-123') {
                            localStorage.removeItem('socialMediaAgent_persistentLogin');
                            localStorage.removeItem('socialMediaAgent_currentUserId');
                            console.log('üßπ Cleared test user session');
                        }
                        
                        // Check for existing login session
                        setTimeout(function() {
                            console.log('üöÄ Checking for existing login session...');
                            
                            // Check if user was previously logged in
                            const persistentLogin = localStorage.getItem('socialMediaAgent_persistentLogin');
                            const currentUserId = localStorage.getItem('socialMediaAgent_currentUserId');
                            
                            if (persistentLogin && currentUserId) {
                                try {
                                    const loginData = JSON.parse(persistentLogin);
                                    
                                    // Check if session has expired
                                    if (loginData.expires && loginData.expires < Date.now()) {
                                        console.log('‚è∞ Session expired, clearing data');
                                        localStorage.removeItem('socialMediaAgent_persistentLogin');
                                        localStorage.removeItem('socialMediaAgent_currentUserId');
                                        return;
                                    }
                                    
                                    const users = JSON.parse(localStorage.getItem('socialMediaAgent_users') || '[]');
                                    const user = users.find(u => u.id === currentUserId);
                                    
                                    if (user) {
                                        // Restore user session
                                        const userHeader = document.getElementById('user-header');
                                        const authModal = document.getElementById('auth-modal');
                                        
                                        if (userHeader && authModal) {
                                            document.getElementById('user-name').textContent = user.name;
                                            document.getElementById('user-email').textContent = user.email;
                                            document.getElementById('user-avatar').textContent = user.name.charAt(0).toUpperCase();
                                            authModal.classList.add('hidden');
                                            userHeader.classList.remove('hidden');
                                            
                                            // Initialize LinkedIn connection status
                                            setTimeout(() => {
                                                if (typeof window.initializeLinkedInConnection === 'function') {
                                                    window.initializeLinkedInConnection();
                                                }
                                                
                                                // Check URL for OAuth callback
                                                if (typeof window.checkUrlForAuthCode === 'function') {
                                                    window.checkUrlForAuthCode();
                                                }
                                            }, 500);
                                            
                                            console.log('‚úÖ Restored session for user:', user.email, loginData.persistent ? '(persistent)' : '(session)');
                                        }
                                    } else {
                                        console.log('‚ùå User not found, clearing persistent login');
                                        localStorage.removeItem('socialMediaAgent_persistentLogin');
                                        localStorage.removeItem('socialMediaAgent_currentUserId');
                                    }
                                } catch (error) {
                                    console.error('‚ùå Error restoring session:', error);
                                    localStorage.removeItem('socialMediaAgent_persistentLogin');
                                    localStorage.removeItem('socialMediaAgent_currentUserId');
                                }
                            } else {
                                console.log('‚ÑπÔ∏è No existing session found, showing login form');
                            }
                        }, 100); // Run after 100ms to ensure DOM elements exist
                        
                        // AUTOMATIC: LinkedIn OAuth monitoring functions
                        window.checkUrlForAuthCode = function() {
                            // Check URL parameters
                            const urlParams = new URLSearchParams(window.location.search);
                            const code = urlParams.get('code');
                            const state = urlParams.get('state');
                            
                            if (code && state) {
                                console.log('‚úÖ LinkedIn OAuth callback detected in URL!');
                                
                                // Process the code automatically
                                setTimeout(() => {
                                    window.handleLinkedInCallback(code);
                                    
                                    // Clean up URL
                                    const cleanUrl = window.location.pathname;
                                    window.history.replaceState({}, document.title, cleanUrl);
                                }, 500);
                                
                                return true;
                            }
                            
                            // Also check localStorage for automatic callback
                            const storedCode = localStorage.getItem('aifluence_linkedin_auth_code');
                            const storedTimestamp = localStorage.getItem('aifluence_linkedin_auth_timestamp');
                            
                            if (storedCode && storedTimestamp) {
                                const codeAge = Date.now() - parseInt(storedTimestamp);
                                if (codeAge < 5 * 60 * 1000) { // 5 minutes
                                    console.log('‚úÖ LinkedIn OAuth code found in localStorage on page load!');
                                    
                                    // Clean up storage
                                    localStorage.removeItem('aifluence_linkedin_auth_code');
                                    localStorage.removeItem('aifluence_linkedin_auth_state');
                                    localStorage.removeItem('aifluence_linkedin_auth_timestamp');
                                    
                                    // Process the code
                                    setTimeout(() => {
                                        window.handleLinkedInCallback(storedCode);
                                    }, 500);
                                    
                                    return true;
                                }
                            }
                            
                            return false;
                        };
                        
                        // ULTRA-AUTOMATED: Start all communication listeners
                        window.startUltraAutoListeners = function() {
                            console.log('ü§ñ ULTRA-AUTO: Starting all communication listeners...');
                            
                            // METHOD 1: Enhanced PostMessage Listener
                            window.addEventListener('message', function(event) {
                                console.log('üì® PostMessage received:', event.data);
                                
                                if (event.data && event.data.type === 'AIFLUENCE_LINKEDIN_AUTH_SUCCESS') {
                                    console.log('‚ú® ULTRA-AUTO: PostMessage auth code received!');
                                    showToast('üì® Auto-received LinkedIn code via PostMessage!', 'success');
                                    window.processUltraAutoCode(event.data.code, 'PostMessage');
                                }
                            });
                            
                            // METHOD 2: LocalStorage Monitoring
                            const storageChecker = setInterval(() => {
                                const autoCode = localStorage.getItem('aifluence_linkedin_auth_code');
                                const autoSource = localStorage.getItem('aifluence_linkedin_auth_source');
                                
                                if (autoCode && autoSource === 'ultra-auto-callback') {
                                    console.log('‚ú® ULTRA-AUTO: LocalStorage auth code detected!');
                                    showToast('üíæ Auto-received LinkedIn code via LocalStorage!', 'success');
                                    
                                    // Clear the storage items
                                    localStorage.removeItem('aifluence_linkedin_auth_code');
                                    localStorage.removeItem('aifluence_linkedin_auth_state');
                                    localStorage.removeItem('aifluence_linkedin_auth_timestamp');
                                    localStorage.removeItem('aifluence_linkedin_auth_source');
                                    
                                    clearInterval(storageChecker);
                                    window.processUltraAutoCode(autoCode, 'LocalStorage');
                                }
                            }, 1000);
                            
                            // METHOD 3: Custom Event Listener
                            window.addEventListener('aifluenceLinkedInAuth', function(event) {
                                console.log('‚ú® ULTRA-AUTO: Custom event auth code received!');
                                showToast('üéÜ Auto-received LinkedIn code via Custom Event!', 'success');
                                window.processUltraAutoCode(event.detail.code, 'CustomEvent');
                            });
                            
                            // METHOD 4: Direct Function Access
                            window.ultraAutoReceiveCode = function(code, source) {
                                console.log('‚ú® ULTRA-AUTO: Direct function call received!');
                                showToast('üéØ Auto-received LinkedIn code via Direct Call!', 'success');
                                window.processUltraAutoCode(code, source || 'DirectCall');
                            };
                            
                            // Clean up after 5 minutes
                            setTimeout(() => {
                                clearInterval(storageChecker);
                                console.log('ü§ñ ULTRA-AUTO: Listeners cleaned up after timeout');
                            }, 5 * 60 * 1000);
                            
                            showToast('üì° All auto-listeners activated! Ready for LinkedIn callback...', 'info');
                        };
                        
                        // ULTRA-AUTOMATED: Process received auth code
                        window.processUltraAutoCode = function(authCode, method) {
                            console.log(`üöÄ ULTRA-AUTO: Processing code via ${method}:`, authCode);
                            
                            if (!authCode || authCode.length < 10) {
                                console.error('‚ùå Invalid auth code received:', authCode);
                                showToast('‚ùå Invalid authorization code received', 'error');
                                return;
                            }
                            
                            // Show processing notification
                            showToast(`üõ†Ô∏è Auto-processing LinkedIn code (${method})...`, 'info');
                            
                            // Process the code using existing handler
                            setTimeout(() => {
                                try {
                                    window.handleLinkedInCallback(authCode);
                                    showToast(`‚ú® ULTRA-AUTO SUCCESS: LinkedIn connected via ${method}!`, 'success');
                                } catch (error) {
                                    console.error('Error processing ultra-auto code:', error);
                                    showToast('‚ùå Error processing auto-received code', 'error');
                                }
                            }, 500);
                        };
                        
                        // ULTRA-AUTOMATED: Check all methods for received codes
                        window.checkAllAutoMethods = function() {
                            console.log('üîç ULTRA-AUTO: Checking all communication methods...');
                            
                            // Check localStorage
                            const storedCode = localStorage.getItem('aifluence_linkedin_auth_code');
                            if (storedCode) {
                                console.log('üîç Found code in localStorage');
                                window.processUltraAutoCode(storedCode, 'LocalStorage-Fallback');
                                return;
                            }
                            
                            // If no code found, show helpful message
                            showToast('üîç Auto-connection check complete. No pending codes found.', 'info');
                        };
                        
                        // LEGACY: Keep for backward compatibility
                        window.startAutomaticMonitoring = function() {
                            console.log('ü§ñ Starting FULLY AUTOMATIC LinkedIn monitoring...');
                            
                            let monitoringActive = true;
                            let checkCount = 0;
                            const maxChecks = 120; // 4 minutes of monitoring
                            
                            function automaticCheck() {
                                checkCount++;
                                
                                if (checkCount > maxChecks || !monitoringActive) {
                                    console.log('‚èπÔ∏è Automatic monitoring stopped');
                                    if (monitoringActive) {
                                        alert('‚è±Ô∏è LinkedIn connection timed out. Please try again.');
                                    }
                                    return;
                                }
                                
                                // Check localStorage for auth code from callback page
                                const storedCode = localStorage.getItem('aifluence_linkedin_auth_code');
                                const storedState = localStorage.getItem('aifluence_linkedin_auth_state');
                                const storedTimestamp = localStorage.getItem('aifluence_linkedin_auth_timestamp');
                                
                                if (storedCode && storedTimestamp) {
                                    // Check if the code is recent (within last 5 minutes)
                                    const codeAge = Date.now() - parseInt(storedTimestamp);
                                    if (codeAge < 5 * 60 * 1000) { // 5 minutes
                                        console.log('‚úÖ AUTOMATIC: Auth code detected in localStorage!');
                                        
                                        // Clean up storage
                                        localStorage.removeItem('aifluence_linkedin_auth_code');
                                        localStorage.removeItem('aifluence_linkedin_auth_state');
                                        localStorage.removeItem('aifluence_linkedin_auth_timestamp');
                                        
                                        // Stop monitoring
                                        monitoringActive = false;
                                        
                                        // Process the code automatically
                                        console.log('ü§ñ Processing authorization automatically...');
                                        window.handleLinkedInCallback(storedCode);
                                        
                                        return;
                                    }
                                }
                                
                                // Continue monitoring
                                setTimeout(automaticCheck, 2000);
                            }
                            
                            // Start monitoring after a short delay
                            setTimeout(automaticCheck, 3000);
                            
                            // Listen for postMessage from callback window
                            function handleMessage(event) {
                                if (event.data && event.data.type === 'linkedin-auth-success') {
                                    console.log('‚úÖ AUTOMATIC: Received auth code via postMessage!');
                                    
                                    monitoringActive = false;
                                    window.handleLinkedInCallback(event.data.code);
                                    
                                    // Clean up listener
                                    window.removeEventListener('message', handleMessage);
                                }
                            }
                            
                            window.addEventListener('message', handleMessage);
                            
                            // Stop monitoring function
                            window.stopAutomaticMonitoring = function() {
                                monitoringActive = false;
                                window.removeEventListener('message', handleMessage);
                                console.log('‚èπÔ∏è Automatic monitoring stopped');
                            };
                            
                            // Monitor window close
                            if (window.linkedInAuthWindow) {
                                function checkWindowClosed() {
                                    if (window.linkedInAuthWindow.closed) {
                                        console.log('üîç Auth window closed - checking for completion...');
                                        // Give a moment for localStorage to be set
                                        setTimeout(automaticCheck, 1000);
                                    } else if (monitoringActive) {
                                        setTimeout(checkWindowClosed, 1000);
                                    }
                                }
                                setTimeout(checkWindowClosed, 2000);
                            }
                        };
                        
                        // Legacy smart prompting (keeping as fallback)
                        window.startSmartPrompting = function() {
                            console.log('ü§ñ Starting smart prompting for LinkedIn OAuth...');
                            
                            let promptingActive = true;
                            let promptCount = 0;
                            const maxPrompts = 10; // Will prompt up to 10 times over 5 minutes
                            
                            function smartPrompt() {
                                promptCount++;
                                
                                if (promptCount > maxPrompts || !promptingActive) {
                                    console.log('‚èπÔ∏è Smart prompting stopped');
                                    return;
                                }
                                
                                // Check if user is focused on this tab
                                if (document.hasFocus()) {
                                    console.log('üîç User returned to AIfluence - prompting for auth code');
                                    
                                    const userCode = prompt(`üîó LinkedIn Authorization (Attempt ${promptCount}/10)\n\nIf you completed LinkedIn authorization:\n\n1. Copy the long "code" value from httpbin.org\n2. Paste it below\n3. Click OK\n\nOr click Cancel to try again later.`);
                                    
                                    if (userCode && userCode.length > 50) {
                                        console.log('‚úÖ Authorization code received via smart prompt!');
                                        promptingActive = false;
                                        window.handleLinkedInCallback(userCode.trim());
                                        return;
                                    } else if (userCode === null) {
                                        // User clicked Cancel - stop prompting for now
                                        promptingActive = false;
                                        console.log('‚è∏Ô∏è User cancelled - stopping prompts');
                                        
                                        // Offer to restart prompting
                                        setTimeout(() => {
                                            if (confirm('Would you like to continue trying to connect LinkedIn?')) {
                                                window.startSmartPrompting();
                                            }
                                        }, 10000); // Ask again in 10 seconds
                                        
                                        return;
                                    } else if (userCode === '') {
                                        alert('Please paste the authorization code from httpbin.org, or click Cancel to stop.');
                                    }
                                }
                                
                                // Continue prompting every 30 seconds
                                setTimeout(smartPrompt, 30000);
                            }
                            
                            // Start first prompt after 10 seconds
                            setTimeout(smartPrompt, 10000);
                            
                            // Stop prompting function
                            window.stopSmartPrompting = function() {
                                promptingActive = false;
                                console.log('‚èπÔ∏è Smart prompting stopped');
                            };
                            
                            // Also listen for page focus events
                            function onFocus() {
                                if (promptingActive && promptCount < maxPrompts) {
                                    setTimeout(() => {
                                        if (promptingActive) {
                                            smartPrompt();
                                        }
                                    }, 2000);
                                }
                            }
                            
                            window.addEventListener('focus', onFocus);
                            
                            // Clean up listener when done
                            const originalStop = window.stopSmartPrompting;
                            window.stopSmartPrompting = function() {
                                promptingActive = false;
                                window.removeEventListener('focus', onFocus);
                                originalStop();
                            };
                        };
                        
                        console.log('ü§ñ Automatic LinkedIn monitoring functions loaded');
                    </script>
                    </button>
                </div>
            </div>
        </div>

        <!-- Scheduler Tab -->
        <div id="content-scheduler" class="tab-content hidden">
            <div class="space-y-6">
                <!-- Header -->
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="text-3xl font-bold text-white">Content Scheduler</h2>
                        <p class="text-slate-400">Schedule and manage your LinkedIn posts</p>
                    </div>
                    <button onclick="showScheduleModal()" class="flex items-center space-x-2 px-4 py-2 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:scale-105 transition-transform">
                        <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                        </svg>
                        <span>Schedule Post</span>
                    </button>
                </div>

                <!-- Scheduled Posts -->
                <div id="scheduled-posts-container" class="space-y-4">
                    <!-- Scheduled posts will be populated here -->
                </div>

                <!-- Quick Tips -->
                <div class="bg-blue-500/10 border border-blue-500/30 rounded-xl p-6">
                    <h3 class="text-lg font-semibold text-blue-400 mb-3">Scheduling Tips</h3>
                    <ul class="text-slate-300 text-sm space-y-1">
                        <li>‚Ä¢ Best posting times for LinkedIn: 9-10 AM and 12-1 PM on weekdays</li>
                        <li>‚Ä¢ Schedule posts at least 30 minutes in advance</li>
                        <li>‚Ä¢ Consistent posting (3-5 times per week) builds better engagement</li>
                        <li>‚Ä¢ Educational content performs best in the morning hours</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Dashboard Tab -->
        <div id="content-dashboard" class="tab-content hidden">
            <div class="space-y-6">
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="text-3xl font-bold text-white mb-2">Analytics Dashboard</h2>
                        <p class="text-slate-400">Track your content performance and engagement</p>
                        <div id="linkedin-analytics-status" class="hidden mt-2 p-3 bg-blue-500/10 border border-blue-500/30 rounded-lg">
                            <p class="text-blue-400 text-sm">üîó Real LinkedIn analytics would be displayed here for connected accounts with proper API integration</p>
                        </div>
                    </div>
                    <button id="generate-content-suggestions" class="flex items-center space-x-2 px-4 py-2 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white rounded-lg transition-colors">
                        <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                        </svg>
                        <span>AI Content Suggestions</span>
                    </button>
                </div>

                <!-- Key Metrics -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div class="bg-slate-800/50 rounded-xl p-6 border border-slate-700">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="text-sm font-medium text-slate-400">Total Posts</h3>
                            <svg class="h-5 w-5 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                            </svg>
                        </div>
                        <div class="text-2xl font-bold text-white">24</div>
                        <div class="text-sm text-green-400">+12% this month</div>
                    </div>

                    <div class="bg-slate-800/50 rounded-xl p-6 border border-slate-700">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="text-sm font-medium text-slate-400">Total Views</h3>
                            <svg class="h-5 w-5 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                            </svg>
                        </div>
                        <div class="text-2xl font-bold text-white">15,420</div>
                        <div class="text-sm text-green-400">+18% this month</div>
                    </div>

                    <div class="bg-slate-800/50 rounded-xl p-6 border border-slate-700">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="text-sm font-medium text-slate-400">Engagement</h3>
                            <svg class="h-5 w-5 text-pink-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                            </svg>
                        </div>
                        <div class="text-2xl font-bold text-white">1,247</div>
                        <div class="text-sm text-green-400">+25% this month</div>
                    </div>

                    <div class="bg-slate-800/50 rounded-xl p-6 border border-slate-700">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="text-sm font-medium text-slate-400">New Followers</h3>
                            <svg class="h-5 w-5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                            </svg>
                        </div>
                        <div class="text-2xl font-bold text-white">89</div>
                        <div class="text-sm text-green-400">+15% this month</div>
                    </div>
                </div>

                <!-- AI Content Suggestions -->
                <div id="content-suggestions" class="hidden bg-slate-800/50 rounded-xl p-6 border border-slate-700">
                    <h3 class="text-lg font-semibold text-white mb-4 flex items-center">
                        <svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                        </svg>
                        AI-Powered Content Suggestions
                    </h3>
                    <div id="suggestions-list" class="space-y-4">
                        <!-- AI suggestions will be inserted here -->
                    </div>
                </div>

                <!-- Top Performing Posts -->
                <div class="bg-slate-800/50 rounded-xl p-6 border border-slate-700">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-white">Top Performing Posts</h3>
                        <button onclick="analyzeTopPosts()" class="text-sm px-3 py-1 bg-blue-500/20 text-blue-400 rounded-lg hover:bg-blue-500/30 transition-colors">
                            Analyze Trends
                        </button>
                    </div>
                    <div id="top-posts-list" class="space-y-4">
                        <!-- Top posts will be populated here -->
                    </div>
                </div>

                <!-- Content Performance Insights -->
                <div class="bg-slate-800/50 rounded-xl p-6 border border-slate-700">
                    <h3 class="text-lg font-semibold text-white mb-4">Performance Insights</h3>
                    <div id="performance-insights" class="space-y-4">
                        <div class="p-4 bg-green-500/10 border border-green-500/30 rounded-lg">
                            <div class="flex items-center space-x-3">
                                <div class="p-2 bg-green-500/20 rounded-lg">
                                    <svg class="h-5 w-5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                                    </svg>
                                </div>
                                <div>
                                    <h4 class="text-green-400 font-medium">Best Performing Topics</h4>
                                    <p class="text-sm text-slate-300">AI Implementation stories get 40% more engagement</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="p-4 bg-blue-500/10 border border-blue-500/30 rounded-lg">
                            <div class="flex items-center space-x-3">
                                <div class="p-2 bg-blue-500/20 rounded-lg">
                                    <svg class="h-5 w-5 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                </div>
                                <div>
                                    <h4 class="text-blue-400 font-medium">Optimal Posting Times</h4>
                                    <p class="text-sm text-slate-300">Your audience is most active at 9 AM and 2 PM EST</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="p-4 bg-purple-500/10 border border-purple-500/30 rounded-lg">
                            <div class="flex items-center space-x-3">
                                <div class="p-2 bg-purple-500/20 rounded-lg">
                                    <svg class="h-5 w-5 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 4V2a1 1 0 011-1h4a1 1 0 011 1v2h4a1 1 0 011 1v2H2V5a1 1 0 011-1h4zM2 7h16v11a2 2 0 01-2 2H4a2 2 0 01-2-2V7z"></path>
                                    </svg>
                                </div>
                                <div>
                                    <h4 class="text-purple-400 font-medium">Content Format Insights</h4>
                                    <p class="text-sm text-slate-300">Posts with images get 3x more engagement than text-only</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Personal AI Tab -->
        <div id="content-personal-ai" class="tab-content hidden">
            <div class="space-y-6">
                <!-- Header -->
                <div class="text-center">
                    <h2 class="text-3xl font-bold text-white mb-2">Personal AI Studio</h2>
                    <p class="text-slate-400">Create custom AI images of yourself and your team for professional content</p>
                </div>

                <!-- Team Management Section -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Team Members -->
                    <div class="bg-slate-800/50 rounded-xl p-6 border border-slate-700">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-white">Team Members</h3>
                            <div class="flex space-x-2">
                                <button onclick="loadDemoData()" class="px-3 py-2 bg-green-500/20 text-green-400 rounded-lg hover:bg-green-500/30 transition-colors text-sm border border-green-500/30">
                                    Load Demo Team
                                </button>
                                <button onclick="clearDemoData()" class="px-3 py-2 bg-orange-500/20 text-orange-400 rounded-lg hover:bg-orange-500/30 transition-colors text-sm border border-orange-500/30">
                                    Clear Team
                                </button>
                                <button onclick="showAddMemberModal()" class="flex items-center space-x-2 px-3 py-2 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:scale-105 transition-transform text-sm">
                                    <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                    </svg>
                                    <span>Add Member</span>
                                </button>
                            </div>
                        </div>
                        
                        <div id="team-members-list" class="space-y-3">
                            <!-- Team members will be populated here -->
                        </div>
                    </div>

                    <!-- AI Image Generation -->
                    <div class="bg-slate-800/50 rounded-xl p-6 border border-slate-700">
                        <h3 class="text-lg font-semibold text-white mb-4">Generate AI Images</h3>
                        
                        <!-- Subject Selection -->
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-slate-300 mb-2">Select Subject(s)</label>
                            <div class="space-y-2">
                                <button onclick="selectSubject('individual')" id="subject-individual" class="w-full p-3 bg-blue-500/20 border border-blue-500/30 text-blue-300 rounded-lg text-left transition-colors hover:bg-blue-500/30">
                                    <div class="flex items-center space-x-3">
                                        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                        </svg>
                                        <div>
                                            <div class="font-medium">Individual Portrait</div>
                                            <div class="text-xs text-slate-400">Single person image</div>
                                        </div>
                                    </div>
                                </button>
                                <button onclick="selectSubject('group')" id="subject-group" class="w-full p-3 bg-slate-700/50 border border-slate-600 text-slate-300 rounded-lg text-left transition-colors hover:bg-slate-600">
                                    <div class="flex items-center space-x-3">
                                        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                                        </svg>
                                        <div>
                                            <div class="font-medium">Group Photo</div>
                                            <div class="text-xs text-slate-400">Multiple people</div>
                                        </div>
                                    </div>
                                </button>
                            </div>
                        </div>

                        <!-- Person Selection (for individual) -->
                        <div id="person-selection" class="mb-4">
                            <label class="block text-sm font-medium text-slate-300 mb-2">Choose Person</label>
                            <select id="person-select" class="w-full px-3 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white">
                                <option value="">Select a team member...</option>
                            </select>
                        </div>

                        <!-- Group Selection (for group) -->
                        <div id="group-selection" class="mb-4 hidden">
                            <label class="block text-sm font-medium text-slate-300 mb-2">Choose Team Members</label>
                            <div id="group-checkboxes" class="space-y-2 max-h-32 overflow-y-auto">
                                <!-- Checkboxes will be populated here -->
                            </div>
                        </div>

                        <!-- Setting/Style Selection -->
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-slate-300 mb-2">Setting & Style</label>
                            <div class="grid grid-cols-2 gap-2">
                                <button onclick="selectSetting('professional-office')" data-setting="professional-office" class="setting-btn p-3 bg-slate-700/50 border border-slate-600 text-slate-300 rounded-lg text-center transition-colors hover:bg-slate-600">
                                    <div class="text-xs font-medium">Professional Office</div>
                                </button>
                                <button onclick="selectSetting('conference-speaking')" data-setting="conference-speaking" class="setting-btn p-3 bg-slate-700/50 border border-slate-600 text-slate-300 rounded-lg text-center transition-colors hover:bg-slate-600">
                                    <div class="text-xs font-medium">Conference Speaking</div>
                                </button>
                                <button onclick="selectSetting('team-meeting')" data-setting="team-meeting" class="setting-btn p-3 bg-slate-700/50 border border-slate-600 text-slate-300 rounded-lg text-center transition-colors hover:bg-slate-600">
                                    <div class="text-xs font-medium">Team Meeting</div>
                                </button>
                                <button onclick="selectSetting('tech-workspace')" data-setting="tech-workspace" class="setting-btn p-3 bg-slate-700/50 border border-slate-600 text-slate-300 rounded-lg text-center transition-colors hover:bg-slate-600">
                                    <div class="text-xs font-medium">Tech Workspace</div>
                                </button>
                            </div>
                        </div>

                        <!-- AI Mode Toggle -->
                        <div class="mb-4 p-3 bg-slate-900/50 rounded-lg border border-slate-600">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-sm font-medium text-slate-300">AI Mode</span>
                                <button onclick="toggleAIMode()" id="ai-mode-toggle" class="px-3 py-1 bg-green-500/20 text-green-400 text-xs rounded border border-green-500/30 hover:bg-green-500/30 transition-colors">
                                    Real AI Mode
                                </button>
                            </div>
                            <div class="text-xs text-slate-400" id="ai-mode-description">
                                Using real AI services (DALL-E 3 or Stable Diffusion XL). Requires API key.
                            </div>
                            <div id="api-key-section" class="mt-2">
                                <input type="password" id="api-key-input" placeholder="Enter API key: Hugging Face (hf_...), OpenAI (sk-...), or Replicate (r8_...)" class="w-full px-2 py-1 bg-slate-700/50 border border-slate-600 rounded text-white text-xs placeholder-slate-400" onchange="updateAPIKey()">
                                <div class="text-xs text-slate-500 mt-1">
                                    <span class="text-purple-400">Replicate</span> (r8_): ~$0.01/image - <span class="text-green-400">BEST for portraits</span> ‚Ä¢ 
                                    <span class="text-blue-400">OpenAI</span> (sk_): ~$0.04/image ‚Ä¢ 
                                    <span class="text-gray-400">Hugging Face</span> (hf_): FREE but lower quality<br>
                                    <span class="text-orange-400">Recommended:</span> Use Replicate for photorealistic professional portraits
                                </div>
                            </div>
                        </div>

                        <!-- Generate Button -->
                        <button onclick="generatePersonalAIImage()" id="generate-ai-btn" class="w-full px-4 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white font-semibold rounded-lg transition-all duration-300 hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed">
                            <div class="flex items-center justify-center space-x-2">
                                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                </svg>
                                <span id="generate-btn-text">Generate AI Image (Real AI)</span>
                            </div>
                        </button>
                    </div>
                </div>

                <!-- Generated Images Gallery -->
                <div id="generated-images-section" class="hidden">
                    <div class="bg-slate-800/50 rounded-xl p-6 border border-slate-700">
                        <h3 class="text-lg font-semibold text-white mb-4">Generated Images</h3>
                        <div id="generated-images-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            <!-- Generated images will appear here -->
                        </div>
                    </div>
                </div>

                <!-- Tips Section -->
                <div class="bg-blue-500/10 border border-blue-500/30 rounded-xl p-6">
                    <h3 class="text-lg font-semibold text-blue-400 mb-3">Pro Tips</h3>
                    <ul class="text-slate-300 text-sm space-y-2">
                        <li>‚Ä¢ Upload 3-5 high-quality photos per person for best results</li>
                        <li>‚Ä¢ Include photos from different angles and lighting conditions</li>
                        <li>‚Ä¢ Professional headshots work best for business content</li>
                        <li>‚Ä¢ Group photos work best with 2-4 people maximum</li>
                        <li>‚Ä¢ Generated images are perfect for LinkedIn posts, presentations, and marketing materials</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Billing/Subscription Tab -->
        <div id="content-billing" class="tab-content hidden">
            <div class="space-y-6">
                <!-- Header -->
                <div class="text-center">
                    <h2 class="text-3xl font-bold text-white mb-2">Subscription Plans</h2>
                    <p class="text-slate-400">Choose the perfect plan for your content generation needs</p>
                </div>

                <!-- Payment Testing Panel -->
                <div class="bg-gradient-to-r from-purple-500/10 to-blue-500/10 rounded-xl p-6 border border-purple-500/30 mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <h3 class="text-lg font-semibold text-white">Payment Testing System</h3>
                            <p class="text-sm text-slate-400">Test subscription flows without real payments</p>
                        </div>
                        <button id="toggle-test-mode" class="px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-colors">
                            Enable Test Mode
                        </button>
                    </div>
                    
                    <div id="test-mode-panel" class="hidden">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <button id="test-free-plan" class="p-4 bg-slate-700/50 hover:bg-slate-700 rounded-lg transition-colors">
                                <div class="text-white font-medium">Test Free Plan</div>
                                <div class="text-sm text-slate-400">Reset to free tier</div>
                            </button>
                            <button id="test-pro-plan" class="p-4 bg-slate-700/50 hover:bg-slate-700 rounded-lg transition-colors">
                                <div class="text-white font-medium">Test Pro Plan</div>
                                <div class="text-sm text-slate-400">Simulate Pro upgrade</div>
                            </button>
                            <button id="test-enterprise-plan" class="p-4 bg-slate-700/50 hover:bg-slate-700 rounded-lg transition-colors">
                                <div class="text-white font-medium">Test Enterprise Plan</div>
                                <div class="text-sm text-slate-400">Simulate Enterprise upgrade</div>
                            </button>
                        </div>
                        <div class="mt-4 p-3 bg-yellow-500/10 border border-yellow-500/30 rounded-lg">
                            <div class="text-xs text-yellow-400">
                                <strong>Test Mode:</strong> All payments are simulated. No real charges will be made.
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Current Usage -->
                <div class="bg-slate-800/50 rounded-xl p-6 border border-slate-700">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-white">Current Usage</h3>
                        <span id="current-plan-badge" class="text-xs px-3 py-1 bg-blue-500/20 text-blue-400 rounded-full">Free Plan</span>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="text-center">
                            <div class="text-2xl font-bold text-white" id="posts-used">0</div>
                            <div class="text-sm text-slate-400">Posts Generated</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-white" id="ai-images-used">0</div>
                            <div class="text-sm text-slate-400">AI Images Created</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-white" id="days-remaining">-</div>
                            <div class="text-sm text-slate-400">Days Remaining</div>
                        </div>
                    </div>
                </div>

                <!-- Pricing Plans -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <!-- Free Plan -->
                    <div class="bg-slate-800/50 rounded-xl p-6 border border-slate-700">
                        <div class="text-center mb-6">
                            <h3 class="text-xl font-bold text-white mb-2">Free</h3>
                            <div class="text-3xl font-bold text-white mb-1">$0</div>
                            <div class="text-sm text-slate-400">per month</div>
                        </div>
                        <ul class="space-y-3 mb-6">
                            <li class="flex items-center text-sm text-slate-300">
                                <svg class="h-4 w-4 text-green-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                                5 AI-generated posts/month
                            </li>
                            <li class="flex items-center text-sm text-slate-300">
                                <svg class="h-4 w-4 text-green-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                                3 AI images/month
                            </li>
                            <li class="flex items-center text-sm text-slate-300">
                                <svg class="h-4 w-4 text-green-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                                Basic templates
                            </li>
                            <li class="flex items-center text-sm text-slate-400">
                                <svg class="h-4 w-4 text-slate-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                                No priority support
                            </li>
                        </ul>
                        <button class="w-full py-2 px-4 bg-slate-600 text-white rounded-lg hover:bg-slate-500 transition-colors" disabled>
                            Current Plan
                        </button>
                    </div>

                    <!-- Pro Plan -->
                    <div class="bg-gradient-to-br from-blue-500/10 to-purple-600/10 rounded-xl p-6 border border-blue-500/30 relative">
                        <div class="absolute -top-3 left-1/2 transform -translate-x-1/2">
                            <span class="bg-gradient-to-r from-blue-500 to-purple-600 text-white text-xs px-3 py-1 rounded-full">Most Popular</span>
                        </div>
                        <div class="text-center mb-6">
                            <h3 class="text-xl font-bold text-white mb-2">Pro</h3>
                            <div class="text-3xl font-bold text-white mb-1">$29</div>
                            <div class="text-sm text-slate-400">per month</div>
                        </div>
                        <ul class="space-y-3 mb-6">
                            <li class="flex items-center text-sm text-slate-300">
                                <svg class="h-4 w-4 text-green-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                                100 AI-generated posts/month
                            </li>
                            <li class="flex items-center text-sm text-slate-300">
                                <svg class="h-4 w-4 text-green-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                                50 AI images/month
                            </li>
                            <li class="flex items-center text-sm text-slate-300">
                                <svg class="h-4 w-4 text-green-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                                Advanced AI models
                            </li>
                            <li class="flex items-center text-sm text-slate-300">
                                <svg class="h-4 w-4 text-green-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                                Priority support
                            </li>
                            <li class="flex items-center text-sm text-slate-300">
                                <svg class="h-4 w-4 text-green-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                                Analytics dashboard
                            </li>
                        </ul>
                        <button onclick="selectPlan('pro')" class="w-full py-2 px-4 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:scale-105 transition-transform">
                            Upgrade to Pro
                        </button>
                    </div>

                    <!-- Enterprise Plan -->
                    <div class="bg-slate-800/50 rounded-xl p-6 border border-slate-700">
                        <div class="text-center mb-6">
                            <h3 class="text-xl font-bold text-white mb-2">Enterprise</h3>
                            <div class="text-3xl font-bold text-white mb-1">$99</div>
                            <div class="text-sm text-slate-400">per month</div>
                        </div>
                        <ul class="space-y-3 mb-6">
                            <li class="flex items-center text-sm text-slate-300">
                                <svg class="h-4 w-4 text-green-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                                Unlimited posts
                            </li>
                            <li class="flex items-center text-sm text-slate-300">
                                <svg class="h-4 w-4 text-green-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                                Unlimited AI images
                            </li>
                            <li class="flex items-center text-sm text-slate-300">
                                <svg class="h-4 w-4 text-green-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                                Custom AI training
                            </li>
                            <li class="flex items-center text-sm text-slate-300">
                                <svg class="h-4 w-4 text-green-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                                24/7 support
                            </li>
                            <li class="flex items-center text-sm text-slate-300">
                                <svg class="h-4 w-4 text-green-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                                API access
                            </li>
                        </ul>
                        <button onclick="selectPlan('enterprise')" class="w-full py-2 px-4 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:scale-105 transition-transform">
                            Contact Sales
                        </button>
                    </div>
                </div>

                <!-- Payment Options -->
                <div class="bg-slate-800/50 rounded-xl p-6 border border-slate-700">
                    <div class="text-center mb-6">
                        <h3 class="text-lg font-semibold text-white mb-2">Secure Payment Processing</h3>
                        <p class="text-sm text-slate-400">Choose your preferred payment method - all options are secure and encrypted</p>
                    </div>
                    
                    <!-- Payment Method Selection -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                        <!-- Stripe -->
                        <div id="payment-method-stripe-1" class="payment-method-card p-4 bg-slate-700/50 border border-slate-600 rounded-lg cursor-pointer hover:border-blue-500 transition-colors">
                            <div class="text-center">
                                <div class="flex items-center justify-center mb-3">
                                    <svg class="h-8 w-16 text-slate-400" viewBox="0 0 64 32" fill="currentColor">
                                        <path d="M25.4 16.2c0-1.4.9-2.5 2.3-2.5 1.9 0 2.8 1.3 2.8 3.5 0 2.8-1.2 3.5-2.8 3.5-1.4 0-2.3-1.1-2.3-2.5v-2zm-2.8 5.6V10h2.8v2.8c.7-.9 1.8-1.4 3.2-1.4 2.8 0 4.8 2.2 4.8 5.8s-2 5.8-4.8 5.8c-1.4 0-2.5-.5-3.2-1.4v1.2h-2.8z"/>
                                    </svg>
                                </div>
                                <h4 class="text-white font-medium mb-1">Credit/Debit Card</h4>
                                <p class="text-xs text-slate-400">Visa, Mastercard, Amex</p>
                                <div class="text-xs text-green-400 mt-2">Most Popular</div>
                            </div>
                        </div>

                        <!-- PayPal -->
                        <div id="payment-method-paypal-1" class="payment-method-card p-4 bg-slate-700/50 border border-slate-600 rounded-lg cursor-pointer hover:border-blue-500 transition-colors">
                            <div class="text-center">
                                <div class="flex items-center justify-center mb-3">
                                    <svg class="h-8 w-16 text-blue-500" viewBox="0 0 64 32" fill="currentColor">
                                        <path d="M46.211 6.749h-6.839a.95.95 0 0 0-.939.802l-2.766 17.537a.57.57 0 0 0 .564.658h3.265a.95.95 0 0 0 .939-.803l.746-4.73a.95.95 0 0 1 .938-.803h2.165c4.505 0 7.105-2.18 7.784-6.5.306-1.89.013-3.375-.872-4.415-.972-1.142-2.696-1.746-4.985-1.746zM47.455 13.332c-.374 2.454-2.249 2.454-4.062 2.454h-1.032l.724-4.583a.57.57 0 0 1 .563-.481h.473c1.235 0 2.4 0 3.002.704.359.42.469 1.044.332 1.906zM66.654 13.278h-3.275a.57.57 0 0 0-.563.481l-.145.916-.229-.332c-.709-1.029-2.29-1.373-3.868-1.373-3.619 0-6.71 2.741-7.312 6.586-.313 1.918.132 3.752 1.22 5.031.998 1.176 2.426 1.666 4.125 1.666 2.916 0 4.533-1.875 4.533-1.875l-.146.91a.57.57 0 0 0 .562.66h2.95a.95.95 0 0 0 .939-.803l1.77-11.209a.568.568 0 0 0-.561-.658zm-4.565 6.374c-.316 1.871-1.801 3.127-3.695 3.127-.951 0-1.711-.305-2.199-.883-.484-.574-.668-1.391-.514-2.301.295-1.855 1.805-3.152 3.67-3.152.93 0 1.686.309 2.184.892.499.589.697 1.411.554 2.317zM84.096 13.278h-3.291a.954.954 0 0 0-.787.417l-4.539 6.686-1.924-6.425a.953.953 0 0 0-.912-.678h-3.234a.57.57 0 0 0-.541.754l3.625 10.638-3.408 4.811a.57.57 0 0 0 .465.9h3.287a.949.949 0 0 0 .781-.408l10.946-15.8a.57.57 0 0 0-.468-.895z"/>
                                        <path d="M94.992 6.749h-6.84a.95.95 0 0 0-.938.802l-2.766 17.537a.569.569 0 0 0 .562.658h3.51a.665.665 0 0 0 .656-.562l.785-4.971a.95.95 0 0 1 .938-.803h2.164c4.506 0 7.105-2.18 7.785-6.5.307-1.89.012-3.375-.873-4.415-.971-1.142-2.694-1.746-4.983-1.746zm1.245 6.583c-.373 2.454-2.248 2.454-4.062 2.454h-1.031l.725-4.583a.568.568 0 0 1 .562-.481h.473c1.234 0 2.4 0 3.002.704.359.42.468 1.044.331 1.906z"/>
                                    </svg>
                                </div>
                                <h4 class="text-white font-medium mb-1">PayPal</h4>
                                <p class="text-xs text-slate-400">PayPal Balance & Cards</p>
                                <div class="text-xs text-blue-400 mt-2">Secure</div>
                            </div>
                        </div>

                        <!-- Apple Pay -->
                        <div id="payment-method-applepay-1" class="payment-method-card p-4 bg-slate-700/50 border border-slate-600 rounded-lg cursor-pointer hover:border-blue-500 transition-colors">
                            <div class="text-center">
                                <div class="flex items-center justify-center mb-3">
                                    <svg class="h-8 w-16 text-slate-400" viewBox="0 0 64 32" fill="currentColor">
                                        <path d="M18.71 19.5c-.83-2.6-2.4-4.5-4.71-4.5s-3.88 1.9-4.71 4.5c-.42 1.3-.42 2.7 0 4s2.4 4.5 4.71 4.5 3.88-1.9 4.71-4.5c.42-1.3.42-2.7 0-4zm-4.71 6.5c-1.38 0-2.48-1.19-2.9-2.5-.21-.66-.21-1.34 0-2 .42-1.31 1.52-2.5 2.9-2.5s2.48 1.19 2.9 2.5c.21.66.21 1.34 0 2-.42 1.31-1.52 2.5-2.9 2.5zm20-8h-8v1h8v-1zm0 2h-8v1h8v-1zm0 2h-8v1h8v-1zm0 2h-8v1h8v-1zm8-8h-4v8h4v-8zm8 0h-4v8h4v-8z"/>
                                        <path d="M20.37 8.09C19.62 7.21 18.78 6.5 17.87 6.5c-1.66 0-2.15 1.09-4.15 1.09s-2.91-1.09-4.91-1.09c-1.66 0-3.74 1.89-4.74 4.24-1.16 2.75-.3 7.62 2.3 10.89 1.72 2.18 3.24 3.87 4.24 3.87s1.29-.87 3.45-.87 2.45.87 3.45.87 2.52-1.69 4.24-3.87c2.6-3.27 3.46-8.14 2.3-10.89-.84-1.99-2.48-3.24-4.08-3.24z"/>
                                    </svg>
                                </div>
                                <h4 class="text-white font-medium mb-1">Apple Pay</h4>
                                <p class="text-xs text-slate-400">Touch ID or Face ID</p>
                                <div class="text-xs text-green-400 mt-2">Fast & Secure</div>
                            </div>
                        </div>
                    </div>

                    <!-- Security Icons -->
                    <div class="flex items-center justify-center space-x-6 text-xs text-slate-400">
                        <div class="flex items-center space-x-1">
                            <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                            </svg>
                            <span>SSL Encrypted</span>
                        </div>
                        <div class="flex items-center space-x-1">
                            <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <span>PCI Compliant</span>
                        </div>
                        <div class="flex items-center space-x-1">
                            <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                            </svg>
                            <span>Instant Processing</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="content-settings" class="tab-content hidden">
            <div class="space-y-6">
                <!-- Header -->
                <div class="text-center">
                    <h2 class="text-3xl font-bold text-white mb-2">Account Settings</h2>
                    <p class="text-slate-400">Manage your profile, preferences, and account security</p>
                </div>

                <!-- Profile Information -->
                <div class="bg-slate-800/50 rounded-xl p-6 border border-slate-700">
                    <h3 class="text-lg font-semibold text-white mb-4 flex items-center">
                        <svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                        Profile Information
                    </h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-slate-300 mb-2">Full Name</label>
                            <input type="text" id="settings-name" placeholder="Enter your full name" class="w-full px-3 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-300 mb-2">Company/Organization</label>
                            <input type="text" id="settings-company" placeholder="Enter your company name" class="w-full px-3 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-300 mb-2">Job Title</label>
                            <input type="text" id="settings-title" placeholder="Enter your job title" class="w-full px-3 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-300 mb-2">Time Zone</label>
                            <select id="settings-timezone" class="w-full px-3 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="UTC-8">Pacific Time (UTC-8)</option>
                                <option value="UTC-7">Mountain Time (UTC-7)</option>
                                <option value="UTC-6">Central Time (UTC-6)</option>
                                <option value="UTC-5">Eastern Time (UTC-5)</option>
                                <option value="UTC+0">GMT (UTC+0)</option>
                                <option value="UTC+1">Central European Time (UTC+1)</option>
                                <option value="UTC+8">China Time (UTC+8)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="mt-6">
                        <button onclick="saveProfile()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors">
                            Save Profile
                        </button>
                    </div>
                </div>

                <!-- Account Security -->
                <div class="bg-slate-800/50 rounded-xl p-6 border border-slate-700">
                    <h3 class="text-lg font-semibold text-white mb-4 flex items-center">
                        <svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                        </svg>
                        Account Security
                    </h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-slate-300 mb-2">Email Address</label>
                            <div class="relative">
                                <input type="email" id="settings-email" placeholder="Enter your email" class="w-full px-3 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <span id="email-verified" class="absolute right-3 top-3 text-green-400 hidden">
                                    <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                    </svg>
                                </span>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-300 mb-2">Current Password</label>
                            <input type="password" id="settings-current-password" placeholder="Enter current password" class="w-full px-3 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-300 mb-2">New Password</label>
                            <input type="password" id="settings-new-password" placeholder="Enter new password" class="w-full px-3 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-300 mb-2">Confirm New Password</label>
                            <input type="password" id="settings-confirm-password" placeholder="Confirm new password" class="w-full px-3 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                    </div>
                    
                    <div class="mt-6 flex space-x-4">
                        <button onclick="updateEmail()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors">
                            Update Email
                        </button>
                        <button onclick="changePassword()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-colors">
                            Change Password
                        </button>
                    </div>
                </div>

                <!-- LinkedIn Integration -->
                <div class="bg-slate-800/50 rounded-xl p-6 border border-slate-700">
                    <h3 class="text-lg font-semibold text-white mb-4 flex items-center">
                        <svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"></path>
                        </svg>
                        LinkedIn Integration
                    </h3>
                    
                    <div id="linkedin-connected" class="hidden">
                        <div class="flex items-center justify-between p-4 bg-green-500/10 border border-green-500/30 rounded-lg">
                            <div class="flex items-center">
                                <div class="h-3 w-3 bg-green-500 rounded-full mr-3"></div>
                                <div>
                                    <p class="text-green-400 font-medium">LinkedIn Connected</p>
                                    <p class="text-sm text-slate-400" id="linkedin-profile-name">Connected to LinkedIn Profile</p>
                                </div>
                            </div>
                            <button id="disconnect-linkedin-btn" onclick="window.disconnectLinkedIn(); return false;" class="text-red-400 hover:text-red-300 transition-colors">
                                Disconnect
                            </button>
                        </div>
                    </div>
                    
                    <div id="linkedin-disconnected">
                        <div class="flex items-center justify-between p-4 bg-slate-700/50 border border-slate-600 rounded-lg">
                            <div class="flex items-center">
                                <div class="h-3 w-3 bg-slate-500 rounded-full mr-3"></div>
                                <div>
                                    <p class="text-slate-300 font-medium">LinkedIn Not Connected</p>
                                    <p class="text-sm text-slate-400">Connect your LinkedIn profile to enable direct posting</p>
                                </div>
                            </div>
                            <button id="connect-linkedin-btn-2" onclick="window.connectLinkedIn(); return false;" class="bg-linkedin hover:bg-linkedin-hover text-white px-4 py-2 rounded-lg transition-colors">
                                Connect
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Auto-Scheduling Settings -->
                <div class="bg-slate-800/50 rounded-xl p-6 border border-slate-700">
                    <h3 class="text-lg font-semibold text-white mb-4 flex items-center">
                        <svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                        </svg>
                        ü§ñ Smart Auto-Scheduling
                    </h3>
                    
                    <div class="space-y-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <label class="text-slate-300 font-medium">Enable Personalized Timing</label>
                                <p class="text-sm text-slate-400">Use your engagement data to optimize posting times</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="personalized-timing" class="sr-only peer" checked>
                                <div class="w-11 h-6 bg-slate-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                            </label>
                        </div>
                        
                        <div class="flex items-center justify-between">
                            <div>
                                <label class="text-slate-300 font-medium">Confidence Threshold</label>
                                <p class="text-sm text-slate-400">Minimum confidence level for auto-scheduling</p>
                            </div>
                            <select id="confidence-threshold" class="px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg text-white text-sm">
                                <option value="low">Low (all suggestions)</option>
                                <option value="medium" selected>Medium (reliable suggestions)</option>
                                <option value="high">High (very confident only)</option>
                            </select>
                        </div>
                        
                        <div class="flex items-center justify-between">
                            <div>
                                <label class="text-slate-300 font-medium">Preferred Time Window</label>
                                <p class="text-sm text-slate-400">Your preferred hours for posting</p>
                            </div>
                            <select id="time-window" class="px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg text-white text-sm">
                                <option value="business" selected>Business Hours (9 AM - 5 PM)</option>
                                <option value="extended">Extended (8 AM - 7 PM)</option>
                                <option value="all">All Day (24/7)</option>
                            </select>
                        </div>
                        
                        <div class="bg-blue-500/20 border border-blue-500/30 rounded-lg p-4">
                            <div class="flex items-center space-x-2 mb-2">
                                <svg class="h-4 w-4 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <span class="text-blue-400 font-medium text-sm">Performance Insights</span>
                            </div>
                            <div id="performance-insights" class="text-xs text-slate-300 space-y-1">
                                <div>‚Ä¢ Your best posting time: 9:30 AM (1,247 avg engagement)</div>
                                <div>‚Ä¢ Tuesday is your power day (+23% engagement)</div>
                                <div>‚Ä¢ AI Strategy content performs best (+45% engagement)</div>
                            </div>
                            <button onclick="refreshInsights()" class="mt-2 text-blue-400 hover:text-blue-300 text-xs transition-colors">
                                üîÑ Refresh Insights
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Notification Preferences -->
                <div class="bg-slate-800/50 rounded-xl p-6 border border-slate-700">
                    <h3 class="text-lg font-semibold text-white mb-4 flex items-center">
                        <svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5 5v-5zM9 14l6-6m-5-3v18M4 5h16"></path>
                        </svg>
                        Notification Preferences
                    </h3>
                    
                    <div class="space-y-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-slate-300 font-medium">Email Notifications</p>
                                <p class="text-sm text-slate-400">Receive updates about your scheduled posts</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="email-notifications" class="sr-only peer" checked>
                                <div class="w-11 h-6 bg-slate-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                            </label>
                        </div>
                        
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-slate-300 font-medium">Post Reminders</p>
                                <p class="text-sm text-slate-400">Get reminded 30 minutes before scheduled posts</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="post-reminders" class="sr-only peer" checked>
                                <div class="w-11 h-6 bg-slate-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                            </label>
                        </div>
                        
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-slate-300 font-medium">Weekly Analytics</p>
                                <p class="text-sm text-slate-400">Receive weekly performance reports</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="weekly-analytics" class="sr-only peer">
                                <div class="w-11 h-6 bg-slate-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                            </label>
                        </div>
                    </div>
                    
                    <div class="mt-6">
                        <button onclick="saveNotificationPreferences()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors">
                            Save Preferences
                        </button>
                    </div>
                </div>

                <!-- Usage Statistics -->
                <div class="bg-slate-800/50 rounded-xl p-6 border border-slate-700">
                    <h3 class="text-lg font-semibold text-white mb-4 flex items-center">
                        <svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                        </svg>
                        Usage Statistics
                    </h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="text-center p-4 bg-slate-700/30 rounded-lg">
                            <div class="text-2xl font-bold text-white" id="usage-posts-generated">0</div>
                            <div class="text-sm text-slate-400">Posts Generated This Month</div>
                        </div>
                        <div class="text-center p-4 bg-slate-700/30 rounded-lg">
                            <div class="text-2xl font-bold text-white" id="usage-posts-scheduled">0</div>
                            <div class="text-sm text-slate-400">Posts Currently Scheduled</div>
                        </div>
                        <div class="text-center p-4 bg-slate-700/30 rounded-lg">
                            <div class="text-2xl font-bold text-white" id="usage-days-active">0</div>
                            <div class="text-sm text-slate-400">Days Active This Month</div>
                        </div>
                    </div>
                    
                    <div class="mt-4 p-4 bg-slate-700/30 rounded-lg">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm text-slate-300">Monthly Limit Progress</span>
                            <span class="text-sm text-slate-400" id="usage-limit-text">0 / 5 posts</span>
                        </div>
                        <div class="w-full bg-slate-600 rounded-full h-2">
                            <div id="usage-progress-bar" class="bg-blue-500 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                        </div>
                    </div>
                </div>

                <!-- Billing & Subscription -->
                <div class="bg-slate-800/50 rounded-xl p-6 border border-slate-700">
                    <h3 class="text-lg font-semibold text-white mb-4 flex items-center">
                        <svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path>
                        </svg>
                        Billing & Subscription
                    </h3>
                    
                    <div class="space-y-4">
                        <!-- Current Plan -->
                        <div class="p-4 bg-slate-700/30 rounded-lg">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-slate-300 font-medium">Current Plan</span>
                                <span id="current-plan-name" class="text-sm px-3 py-1 bg-blue-500/20 text-blue-400 rounded border border-blue-500/30">Enterprise</span>
                            </div>
                            <p class="text-sm text-slate-400" id="current-plan-details">Unlimited posts, AI images, custom training, 24/7 support</p>
                        </div>

                        <!-- Payment Methods -->
                        <div class="p-4 bg-slate-700/30 rounded-lg">
                            <h4 class="text-slate-300 font-medium mb-3">Payment Methods</h4>
                            
                            <!-- Payment Method Selection -->
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-4">
                                <!-- Stripe Card -->
                                <div id="payment-stripe" class="payment-method-card p-3 border-2 border-slate-600 rounded-lg cursor-pointer hover:border-blue-500 transition-colors">
                                    <div class="flex items-center justify-between mb-2">
                                        <div class="flex items-center space-x-2">
                                            <svg class="h-5 w-5 text-blue-500" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M13.976 9.15c-2.172-.806-3.356-1.426-3.356-2.409 0-.831.683-1.305 1.901-1.305 2.227 0 4.515.858 6.09 1.631l.89-5.494C18.252.975 15.697 0 12.165 0 9.667 0 7.589.654 6.104 1.872 4.56 3.147 3.757 4.992 3.757 7.218c0 4.039 2.467 5.76 6.476 7.219 2.585.92 3.445 1.574 3.445 2.583 0 .98-.84 1.545-2.354 1.545-1.875 0-4.965-.921-6.99-2.109l-.9 5.555C5.175 22.99 8.385 24 11.714 24c2.641 0 4.843-.624 6.328-1.813 1.664-1.305 2.525-3.236 2.525-5.732 0-4.128-2.524-5.851-6.594-7.305h.003z"/>
                                            </svg>
                                            <span class="text-sm font-medium text-white">Stripe</span>
                                        </div>
                                        <span class="text-xs px-2 py-1 bg-green-500/20 text-green-400 rounded">Most Popular</span>
                                    </div>
                                    <p class="text-xs text-slate-400">Credit/Debit Card</p>
                                    <div class="flex items-center mt-2 text-xs text-slate-500">
                                        <svg class="h-3 w-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                                        </svg>
                                        SSL Encrypted
                                    </div>
                                </div>

                                <!-- PayPal Card -->
                                <div id="payment-paypal" class="payment-method-card p-3 border-2 border-slate-600 rounded-lg cursor-pointer hover:border-blue-500 transition-colors">
                                    <div class="flex items-center justify-between mb-2">
                                        <div class="flex items-center space-x-2">
                                            <svg class="h-5 w-5 text-blue-600" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M7.076 21.337H2.47a.641.641 0 0 1-.633-.74L4.944.901C5.026.382 5.474 0 5.998 0h7.46c2.57 0 4.578.543 5.69 1.81 1.01 1.15 1.304 2.42 1.012 4.287-.023.143-.047.288-.077.437-.983 5.05-4.349 6.797-8.647 6.797h-2.19c-.524 0-.968.382-1.05.9l-1.12 7.106zm14.146-14.42a9.159 9.159 0 0 1-.354 1.888c-1.171 5.04-4.942 6.902-9.66 6.902H8.706a.635.635 0 0 0-.628.74l-.7 4.428-.2 1.283a.425.425 0 0 0 .42.513h3.002a.564.564 0 0 0 .556-.478l.023-.11.448-2.83.028-.15a.564.564 0 0 1 .555-.478h.35c3.784 0 6.75-1.539 7.607-5.993.36-1.867.174-3.422-.777-4.471-.27-.297-.608-.549-1.007-.75z"/>
                                            </svg>
                                            <span class="text-sm font-medium text-white">PayPal</span>
                                        </div>
                                        <span class="text-xs px-2 py-1 bg-blue-500/20 text-blue-400 rounded">Secure</span>
                                    </div>
                                    <p class="text-xs text-slate-400">PayPal Balance & Cards</p>
                                    <div class="flex items-center mt-2 text-xs text-slate-500">
                                        <svg class="h-3 w-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
                                        </svg>
                                        PCI Compliant
                                    </div>
                                </div>

                                <!-- Apple Pay Card -->
                                <div id="payment-applepay" class="payment-method-card p-3 border-2 border-slate-600 rounded-lg cursor-pointer hover:border-blue-500 transition-colors">
                                    <div class="flex items-center justify-between mb-2">
                                        <div class="flex items-center space-x-2">
                                            <svg class="h-5 w-5 text-white" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M18.71 19.5c-.83 1.24-1.71 2.45-3.05 2.47-1.34.03-1.77-.79-3.29-.79-1.53 0-2 .77-3.27.82-1.31.05-2.3-1.32-3.14-2.53C4.25 17 2.94 12.45 4.7 9.39c.87-1.52 2.43-2.48 4.12-2.51 1.28-.02 2.5.87 3.29.87.78 0 2.26-1.07 3.81-.91.65.03 2.47.26 3.64 1.98-.09.06-2.17 1.28-2.15 3.81.03 3.02 2.65 4.03 2.68 4.04-.03.07-.42 1.44-1.38 2.83M13 3.5c.73-.83 1.94-1.46 2.94-1.5.13 1.17-.34 2.35-1.04 3.19-.69.85-1.83 1.51-2.95 1.42-.15-1.15.41-2.35 1.05-3.11z"/>
                                            </svg>
                                            <span class="text-sm font-medium text-white">Apple Pay</span>
                                        </div>
                                        <span class="text-xs px-2 py-1 bg-purple-500/20 text-purple-400 rounded">Fast & Secure</span>
                                    </div>
                                    <p class="text-xs text-slate-400">Touch ID or Face ID</p>
                                    <div class="flex items-center mt-2 text-xs text-slate-500">
                                        <svg class="h-3 w-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                        </svg>
                                        Instant Processing
                                    </div>
                                </div>
                            </div>

                            <!-- Selected Payment Method Info -->
                            <div id="selected-payment-info" class="p-3 bg-blue-500/10 border border-blue-500/30 rounded-lg hidden">
                                <p class="text-sm text-blue-400 mb-2">Selected Payment Method: <span id="selected-method-name">Stripe</span></p>
                                <p class="text-xs text-slate-400">Click "Update Payment Method" below to configure your selected payment option.</p>
                            </div>

                            <!-- Payment Action Buttons -->
                            <div class="flex space-x-3 mt-4">
                                <button onclick="updatePaymentMethod()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors">
                                    Update Payment Method
                                </button>
                                <button onclick="viewBillingHistory()" class="bg-slate-600 hover:bg-slate-500 text-white px-4 py-2 rounded-lg transition-colors">
                                    Billing History
                                </button>
                            </div>
                        </div>

                        <!-- Plan Upgrade Options -->
                        <div class="p-4 bg-slate-700/30 rounded-lg">
                            <h4 class="text-slate-300 font-medium mb-3">Available Plans</h4>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                                <!-- Basic Plan -->
                                <div class="p-3 border border-slate-600 rounded-lg">
                                    <h5 class="text-white font-medium">Basic</h5>
                                    <p class="text-xs text-slate-400 mb-2">$9/month</p>
                                    <ul class="text-xs text-slate-400 space-y-1">
                                        <li>‚Ä¢ 5 posts/month</li>
                                        <li>‚Ä¢ Basic AI models</li>
                                        <li>‚Ä¢ Email support</li>
                                    </ul>
                                </div>
                                
                                <!-- Pro Plan -->
                                <div class="p-3 border border-slate-600 rounded-lg">
                                    <h5 class="text-white font-medium">Pro</h5>
                                    <p class="text-xs text-slate-400 mb-2">$29/month</p>
                                    <ul class="text-xs text-slate-400 space-y-1">
                                        <li>‚Ä¢ 100 posts/month</li>
                                        <li>‚Ä¢ 50 AI images/month</li>
                                        <li>‚Ä¢ Advanced AI models</li>
                                        <li>‚Ä¢ Priority support</li>
                                        <li>‚Ä¢ Analytics dashboard</li>
                                    </ul>
                                </div>
                                
                                <!-- Enterprise Plan -->
                                <div class="p-3 border-2 border-blue-500 rounded-lg bg-blue-500/10">
                                    <h5 class="text-white font-medium flex items-center">
                                        Enterprise
                                        <span class="ml-2 text-xs px-2 py-1 bg-blue-500/20 text-blue-400 rounded">Current</span>
                                    </h5>
                                    <p class="text-xs text-slate-400 mb-2">$99/month</p>
                                    <ul class="text-xs text-slate-400 space-y-1">
                                        <li>‚Ä¢ Unlimited posts</li>
                                        <li>‚Ä¢ Unlimited AI images</li>
                                        <li>‚Ä¢ Custom AI training</li>
                                        <li>‚Ä¢ 24/7 support</li>
                                        <li>‚Ä¢ API access</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Account Management -->
                <div class="bg-slate-800/50 rounded-xl p-6 border border-slate-700">
                    <h3 class="text-lg font-semibold text-white mb-4 flex items-center">
                        <svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                        </svg>
                        Account Management
                    </h3>
                    
                    <div class="space-y-4">
                        <div class="flex items-center justify-between p-4 bg-slate-700/30 rounded-lg">
                            <div>
                                <p class="text-slate-300 font-medium">Export Account Data</p>
                                <p class="text-sm text-slate-400">Download all your generated content and settings</p>
                            </div>
                            <button onclick="exportAccountData()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors">
                                Export Data
                            </button>
                        </div>
                        
                        <div class="flex items-center justify-between p-4 bg-slate-700/30 rounded-lg">
                            <div>
                                <p class="text-slate-300 font-medium">Clear All Scheduled Posts</p>
                                <p class="text-sm text-slate-400">Remove all posts from your schedule</p>
                            </div>
                            <button onclick="clearAllScheduledPosts()" class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded-lg transition-colors">
                                Clear Schedule
                            </button>
                        </div>
                        
                        <div class="flex items-center justify-between p-4 bg-blue-500/10 border border-blue-500/30 rounded-lg">
                            <div>
                                <p class="text-blue-400 font-medium">Logout</p>
                                <p class="text-sm text-slate-400">Sign out of your account</p>
                            </div>
                            <button onclick="window.handleLogout()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors">
                                <div class="flex items-center space-x-2">
                                    <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                                    </svg>
                                    <span>Logout</span>
                                </div>
                            </button>
                        </div>
                        
                        <div class="flex items-center justify-between p-4 bg-red-500/10 border border-red-500/30 rounded-lg">
                            <div>
                                <p class="text-red-400 font-medium">Delete Account</p>
                                <p class="text-sm text-slate-400">Permanently delete your account and all data</p>
                            </div>
                            <button onclick="if(typeof window.deleteAccount === 'function') window.deleteAccount(); else alert('Delete function not available');" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors">
                                Delete Account
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Scheduling Modal -->
    <div id="schedule-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-slate-800 rounded-xl p-6 w-full max-w-md border border-slate-700">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-white">Schedule Post</h3>
                    <button onclick="hideScheduleModal()" class="text-slate-400 hover:text-slate-200">
                        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>

                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-2">Schedule Date</label>
                        <input type="date" id="schedule-date" class="w-full px-4 py-3 bg-slate-700/50 border border-slate-600 rounded-lg text-white" min="">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-2">Schedule Time</label>
                        <select id="schedule-time" class="w-full px-4 py-3 bg-slate-700/50 border border-slate-600 rounded-lg text-white">
                            <option value="09:00">9:00 AM (Optimal)</option>
                            <option value="10:00">10:00 AM (Optimal)</option>
                            <option value="12:00">12:00 PM (Optimal)</option>
                            <option value="13:00">1:00 PM (Optimal)</option>
                            <option value="08:00">8:00 AM</option>
                            <option value="11:00">11:00 AM</option>
                            <option value="14:00">2:00 PM</option>
                            <option value="15:00">3:00 PM</option>
                            <option value="16:00">4:00 PM</option>
                            <option value="17:00">5:00 PM</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-2">Platform</label>
                        <select id="schedule-platform" class="w-full px-4 py-3 bg-slate-700/50 border border-slate-600 rounded-lg text-white">
                            <option value="LinkedIn">LinkedIn</option>
                            <option value="Twitter" disabled>Twitter (Coming Soon)</option>
                            <option value="Facebook" disabled>Facebook (Coming Soon)</option>
                        </select>
                    </div>

                    <div class="flex space-x-3 pt-4">
                        <button onclick="confirmSchedule()" class="flex-1 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors">
                            Schedule
                        </button>
                        <button onclick="hideScheduleModal()" class="flex-1 px-4 py-2 bg-slate-600 hover:bg-slate-500 text-white rounded-lg transition-colors">
                            Cancel
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Post Modal -->
    <div id="edit-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-slate-800 rounded-xl p-6 w-full max-w-2xl border border-slate-700 max-h-[90vh] overflow-y-auto">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-white">Edit Post</h3>
                    <button onclick="hideEditModal()" class="text-slate-400 hover:text-slate-200">
                        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>

                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-2">Post Content</label>
                        <textarea id="edit-content" rows="12" class="w-full px-4 py-3 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-slate-400 resize-none"></textarea>
                    </div>

                    <div class="flex space-x-3 pt-4">
                        <button onclick="saveEditedPost()" class="flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors">
                            Save Changes
                        </button>
                        <button onclick="hideEditModal()" class="flex-1 px-4 py-2 bg-slate-600 hover:bg-slate-500 text-white rounded-lg transition-colors">
                            Cancel
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Team Member Modal -->
    <div id="add-member-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-slate-800 rounded-xl p-6 w-full max-w-md border border-slate-700">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-white">Add Team Member</h3>
                    <button onclick="hideAddMemberModal()" class="text-slate-400 hover:text-slate-200">
                        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>

                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-2">Name</label>
                        <input type="text" id="member-name" placeholder="Enter team member name" class="w-full px-3 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-slate-400">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-2">Role</label>
                        <input type="text" id="member-role" placeholder="e.g. CEO, CTO, Designer" class="w-full px-3 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-slate-400">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-2">Upload Photos (3-5 recommended)</label>
                        <div class="border-2 border-dashed border-slate-600 rounded-lg p-4 text-center hover:border-slate-500 transition-colors cursor-pointer" onclick="document.getElementById('member-photos').click()">
                            <svg class="h-8 w-8 text-slate-500 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                            </svg>
                            <p class="text-slate-400 text-sm">Click to upload photos</p>
                            <p class="text-slate-500 text-xs mt-1">JPG, PNG up to 10MB each</p>
                        </div>
                        <input type="file" id="member-photos" multiple accept="image/*" class="hidden" onchange="handleMemberPhotos(event)">
                    </div>

                    <!-- Photo Preview -->
                    <div id="member-photos-preview" class="hidden">
                        <label class="block text-sm font-medium text-slate-300 mb-2">Selected Photos</label>
                        <div id="member-photos-grid" class="grid grid-cols-3 gap-2">
                            <!-- Photo previews will appear here -->
                        </div>
                    </div>

                    <div class="flex space-x-3 pt-4">
                        <button onclick="addTeamMember()" class="flex-1 px-4 py-2 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg transition-colors hover:scale-105">
                            Add Member
                        </button>
                        <button onclick="hideAddMemberModal()" class="flex-1 px-4 py-2 bg-slate-600 hover:bg-slate-500 text-white rounded-lg transition-colors">
                            Cancel
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Time Modal -->
    <div id="edit-time-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-slate-800 rounded-xl p-6 w-full max-w-md border border-slate-700">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-white">Edit Post Schedule</h3>
                    <button onclick="hideEditTimeModal()" class="text-slate-400 hover:text-white">
                        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>

                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-2">Post Content Preview</label>
                        <div id="edit-post-preview" class="p-3 bg-slate-700/50 rounded-lg text-sm text-slate-300 max-h-20 overflow-y-auto">
                            <!-- Post content will be populated here -->
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-2">Date</label>
                        <input type="date" id="edit-date-input" 
                               class="w-full px-3 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-2">Time</label>
                        <input type="time" id="edit-time-input" 
                               class="w-full px-3 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>

                    <div class="bg-blue-500/10 border border-blue-500/30 rounded-lg p-3">
                        <div class="flex items-start space-x-2">
                            <svg class="h-5 w-5 text-blue-400 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <div>
                                <p class="text-sm text-blue-300 font-medium">Optimal LinkedIn Times</p>
                                <p class="text-xs text-blue-200 mt-1">
                                    Weekdays: 9:00 AM, 12:30 PM, 2:00 PM<br>
                                    Avoid weekends and after 5:00 PM
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="flex space-x-3 pt-2">
                        <button onclick="saveEditedTime()" class="flex-1 px-4 py-2 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg transition-colors hover:scale-105">
                            Save Changes
                        </button>
                        <button onclick="hideEditTimeModal()" class="flex-1 px-4 py-2 bg-slate-600 hover:bg-slate-500 text-white rounded-lg transition-colors">
                            Cancel
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Login/Register Modal -->
    <div id="auth-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-slate-800 rounded-xl p-8 w-full max-w-md border border-slate-700">
                <div class="text-center mb-6">
                    <h2 class="text-2xl font-bold text-white mb-2">Social Media Agent</h2>
                    <p class="text-slate-400">Sign in to access your content and schedule</p>
                </div>

                <!-- Login Form -->
                <div id="login-form" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-2">Email</label>
                        <input type="email" id="login-email" 
                               class="w-full px-3 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                               placeholder="Enter your email">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-2">Password</label>
                        <input type="password" id="login-password" 
                               class="w-full px-3 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                               placeholder="Enter your password">
                    </div>
                    
                    <!-- Remember Me Option -->
                    <div class="flex items-center justify-between">
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" id="remember-me" 
                                   class="w-4 h-4 text-blue-500 bg-slate-700 border-slate-600 rounded focus:ring-blue-500 focus:ring-2">
                            <span class="text-sm text-slate-300">Remember me</span>
                        </label>
                        <a href="#" class="text-sm text-blue-400 hover:text-blue-300 transition-colors">Forgot password?</a>
                    </div>

                    <button id="login-btn" class="w-full px-4 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg transition-colors hover:scale-105 font-semibold">
                        Sign In
                    </button>

                    <div class="text-center">
                        <button id="show-register-btn" class="text-blue-400 hover:text-blue-300 text-sm">
                            Don't have an account? Sign up
                        </button>
                    </div>
                </div>

                <!-- Register Form -->
                <div id="register-form" class="space-y-4 hidden">
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-2">Full Name *</label>
                        <input type="text" id="register-name" 
                               class="w-full px-3 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                               placeholder="Enter your full name" required>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-2">Company/Organization</label>
                        <input type="text" id="register-company" 
                               class="w-full px-3 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                               placeholder="Enter your company name">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-2">Job Title</label>
                        <input type="text" id="register-title" 
                               class="w-full px-3 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                               placeholder="Enter your job title">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-2">Time Zone</label>
                        <select id="register-timezone" class="w-full px-3 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="UTC-8">Pacific Time (UTC-8)</option>
                            <option value="UTC-7">Mountain Time (UTC-7)</option>
                            <option value="UTC-6">Central Time (UTC-6)</option>
                            <option value="UTC-5" selected>Eastern Time (UTC-5)</option>
                            <option value="UTC+0">GMT (UTC+0)</option>
                            <option value="UTC+1">Central European Time (UTC+1)</option>
                            <option value="UTC+2">Eastern European Time (UTC+2)</option>
                            <option value="UTC+5:30">India Standard Time (UTC+5:30)</option>
                            <option value="UTC+8">Singapore Time (UTC+8)</option>
                            <option value="UTC+9">Japan Standard Time (UTC+9)</option>
                            <option value="UTC+10">Australian Eastern Time (UTC+10)</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-2">Email Address *</label>
                        <input type="email" id="register-email" 
                               class="w-full px-3 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                               placeholder="Enter your email address" required>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-2">Password *</label>
                        <input type="password" id="register-password" 
                               class="w-full px-3 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                               placeholder="Create a strong password" required>
                        <div class="text-xs text-slate-400 mt-1">Minimum 6 characters</div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-2">Confirm Password *</label>
                        <input type="password" id="register-confirm-password" 
                               class="w-full px-3 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                               placeholder="Confirm your password" required>
                    </div>
                    
                    <div class="flex items-center space-x-2 text-sm">
                        <input type="checkbox" id="register-terms" class="w-4 h-4 text-blue-600 bg-slate-700 border-slate-600 rounded focus:ring-blue-500" required>
                        <label for="register-terms" class="text-slate-300">
                            I agree to the <a href="#" class="text-blue-400 hover:text-blue-300">Terms of Service</a> and <a href="#" class="text-blue-400 hover:text-blue-300">Privacy Policy</a>
                        </label>
                    </div>

                    <button id="register-btn" class="w-full px-4 py-3 bg-gradient-to-r from-green-500 to-teal-600 text-white rounded-lg transition-colors hover:scale-105 font-semibold">
                        Create Your Account
                    </button>

                    <div class="text-center">
                        <button id="show-login-btn" class="text-blue-400 hover:text-blue-300 text-sm">
                            Already have an account? Sign in
                        </button>
                    </div>
                </div>

                <!-- Demo Account Option -->
                <div class="mt-6 pt-4 border-t border-hootsuite-border">
                    <button id="demo-account-btn" class="w-full px-4 py-2 bg-aifluence-600 hover:bg-aifluence-700 text-white rounded-lg transition-colors text-sm font-medium shadow-lg">
                        üöÄ Try AIfluence Demo (No Signup Required)
                    </button>
                </div>
                
                <!-- Immediate Demo Button Script -->
                <script>
                    // This script runs immediately when the HTML loads
                    console.log('üî• Immediate demo script loaded');
                    
                    // Test if elements exist immediately
                    console.log('üß™ Testing element existence:');
                    console.log('Login button:', document.getElementById('login-btn'));
                    console.log('Register button:', document.getElementById('show-register-btn'));
                    console.log('Login form:', document.getElementById('login-form'));
                    console.log('Register form:', document.getElementById('register-form'));
                    
                    // Add inline event handlers as backup
                    setTimeout(() => {
                        const loginBtn = document.getElementById('login-btn');
                        const showRegisterBtn = document.getElementById('show-register-btn');
                        
                        if (loginBtn) {
                            loginBtn.onclick = function() {
                                console.log('üî• INLINE LOGIN CLICKED');
                                
                                // Get email, password, and remember me option
                                const email = document.getElementById('login-email').value.trim();
                                const password = document.getElementById('login-password').value;
                                const rememberMe = document.getElementById('remember-me').checked;
                                console.log('üìß Email:', email);
                                console.log('üîí Password length:', password.length);
                                console.log('üíæ Remember me:', rememberMe);
                                
                                if (!email || !password) {
                                    alert('Please enter both email and password');
                                    return false;
                                }
                                
                                // Get users from localStorage
                                const users = JSON.parse(localStorage.getItem('socialMediaAgent_users') || '[]');
                                console.log('üë• Total users:', users.length);
                                
                                // Find user
                                const user = users.find(u => u.email === email && u.password === password);
                                console.log('üîç Found user:', user);
                                
                                if (user) {
                                    console.log('‚úÖ Login successful');
                                    currentUser = user;
                                    isLoggedIn = true;
                                    
                                    // Always set the current user ID
                                    localStorage.setItem('socialMediaAgent_currentUserId', user.id);
                                    
                                    // Handle remember me option
                                    if (rememberMe) {
                                        // Set persistent login with longer expiration
                                        const loginData = {
                                            userId: user.id,
                                            loginTime: Date.now(),
                                            persistent: true,
                                            expires: Date.now() + (30 * 24 * 60 * 60 * 1000) // 30 days
                                        };
                                        localStorage.setItem('socialMediaAgent_persistentLogin', JSON.stringify(loginData));
                                        console.log('üíæ Persistent login saved for 30 days');
                                    } else {
                                        // Regular session login - remove persistent login
                                        localStorage.removeItem('socialMediaAgent_persistentLogin');
                                        console.log('üíæ Regular session login (no persistence)');
                                    }
                                    
                                    // Update user header display
                                    document.getElementById('user-name').textContent = user.name;
                                    document.getElementById('user-email').textContent = user.email;
                                    document.getElementById('user-avatar').textContent = user.name.charAt(0).toUpperCase();
                                    
                                    alert('Login successful! Welcome ' + user.name + (rememberMe ? ' (You will stay logged in)' : ''));
                                    // Hide auth modal and show main app
                                    document.getElementById('auth-modal').classList.add('hidden');
                                    document.getElementById('user-header').classList.remove('hidden');
                                } else {
                                    console.log('‚ùå Login failed');
                                    alert('Invalid email or password. Please try again.');
                                }
                                
                                return false;
                            };
                            console.log('‚úÖ Inline login handler added');
                        }
                        
                        if (showRegisterBtn) {
                            showRegisterBtn.onclick = function() {
                                console.log('üî• INLINE REGISTER CLICKED');
                                
                                // Switch to register form
                                const loginForm = document.getElementById('login-form');
                                const registerForm = document.getElementById('register-form');
                                
                                console.log('üìù Login form:', loginForm);
                                console.log('üìù Register form:', registerForm);
                                
                                if (loginForm && registerForm) {
                                    loginForm.classList.add('hidden');
                                    registerForm.classList.remove('hidden');
                                    console.log('‚úÖ Switched to register form');
                                    alert('Switched to signup form');
                                } else {
                                    console.log('‚ùå Forms not found');
                                    alert('Error: Could not find forms');
                                }
                                
                                return false;
                            };
                            console.log('‚úÖ Inline register handler added');
                        }
                        
                        // Also add handler for the "Create Account" button
                        const createAccountBtn = document.getElementById('register-btn');
                        if (createAccountBtn) {
                            createAccountBtn.onclick = function() {
                                console.log('üî• INLINE CREATE ACCOUNT CLICKED');
                                
                                // Get form data
                                const name = document.getElementById('register-name').value.trim();
                                const company = document.getElementById('register-company').value.trim();
                                const title = document.getElementById('register-title').value.trim();
                                const timezone = document.getElementById('register-timezone').value;
                                const email = document.getElementById('register-email').value.trim();
                                const password = document.getElementById('register-password').value;
                                const confirmPassword = document.getElementById('register-confirm-password').value;
                                const termsAccepted = document.getElementById('register-terms').checked;
                                
                                console.log('üìù Registration data:', { name, email, company, title, timezone, termsAccepted });
                                
                                // Validate
                                if (!name || !email || !password || !confirmPassword) {
                                    alert('Please fill in all required fields');
                                    return false;
                                }
                                
                                if (!termsAccepted) {
                                    alert('Please accept the Terms of Service and Privacy Policy');
                                    return false;
                                }
                                
                                if (password.length < 6) {
                                    alert('Password must be at least 6 characters long');
                                    return false;
                                }
                                
                                if (password !== confirmPassword) {
                                    alert('Passwords do not match');
                                    return false;
                                }
                                
                                // Check if user already exists
                                const users = JSON.parse(localStorage.getItem('socialMediaAgent_users') || '[]');
                                if (users.find(u => u.email === email)) {
                                    alert('An account with this email already exists');
                                    return false;
                                }
                                
                                // Create new user
                                const newUser = {
                                    id: Date.now().toString(),
                                    name: name,
                                    email: email,
                                    password: password,
                                    createdAt: new Date().toISOString(),
                                    profile: {
                                        name: name,
                                        company: company,
                                        title: title,
                                        timezone: timezone
                                    }
                                };
                                
                                // Save user
                                users.push(newUser);
                                localStorage.setItem('socialMediaAgent_users', JSON.stringify(users));
                                
                                console.log('‚úÖ User created successfully');
                                alert('Account created successfully! Welcome ' + name + '!');
                                
                                // Switch back to login form
                                document.getElementById('register-form').classList.add('hidden');
                                document.getElementById('login-form').classList.remove('hidden');
                                
                                return false;
                            };
                            console.log('‚úÖ Inline create account handler added');
                        }
                        
                        // Add handler for "Already have an account? Sign in" button
                        const showLoginBtn = document.getElementById('show-login-btn');
                        if (showLoginBtn) {
                            showLoginBtn.onclick = function() {
                                console.log('üî• INLINE SHOW LOGIN CLICKED');
                                
                                // Switch to login form
                                const loginForm = document.getElementById('login-form');
                                const registerForm = document.getElementById('register-form');
                                
                                if (loginForm && registerForm) {
                                    registerForm.classList.add('hidden');
                                    loginForm.classList.remove('hidden');
                                    console.log('‚úÖ Switched to login form');
                                    alert('Switched to login form');
                                } else {
                                    console.log('‚ùå Forms not found');
                                    alert('Error: Could not find forms');
                                }
                                
                                return false;
                            };
                            console.log('‚úÖ Inline show login handler added');
                        }
                    }, 100);
                    
                    // Simple demo function that works independently
                    function activateDemo() {
                        console.log('‚ú® Demo activated!');
                        
                        // Hide auth modal
                        const authModal = document.getElementById('auth-modal');
                        if (authModal) {
                            authModal.classList.add('hidden');
                        }
                        
                        // Show user header
                        const userHeader = document.getElementById('user-header');
                        if (userHeader) {
                            userHeader.classList.remove('hidden');
                            
                            // Update user info if elements exist
                            const userName = document.getElementById('user-name');
                            const userEmail = document.getElementById('user-email');
                            const userAvatar = document.getElementById('user-avatar');
                            
                            if (userName) userName.textContent = 'Demo User';
                            if (userEmail) userEmail.textContent = 'demo@aifluence.com';
                            if (userAvatar) userAvatar.textContent = 'D';
                        }
                        
                        // Set a simple global flag for demo mode
                        window.isDemoMode = true;
                        
                        // Show success message
                        const successMsg = document.createElement('div');
                        successMsg.className = 'fixed top-4 left-1/2 transform -translate-x-1/2 z-50 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg';
                        successMsg.innerHTML = 'üéâ Demo account activated! Welcome to AIfluence Enterprise!';
                        document.body.appendChild(successMsg);
                        
                        // Remove success message after 3 seconds
                        setTimeout(() => {
                            if (successMsg.parentNode) {
                                successMsg.parentNode.removeChild(successMsg);
                            }
                        }, 3000);
                    }
                    
                    // Attach immediately when this script runs
                    document.addEventListener('DOMContentLoaded', function() {
                        console.log('üéØ Immediate demo script: DOM loaded');
                        const btn = document.getElementById('demo-account-btn');
                        if (btn) {
                            console.log('üì± Found demo button, attaching immediate handler');
                            btn.onclick = activateDemo; // Use onclick for immediate attachment
                        } else {
                            console.error('‚ùå Demo button not found in immediate script');
                        }
                    });
                    
                    // Also try to attach immediately if DOM is already loaded
                    const btn = document.getElementById('demo-account-btn');
                    if (btn) {
                        console.log('üì± Demo button found immediately, attaching handler');
                        btn.onclick = activateDemo;
                    }
                </script>
            </div>
        </div>
    </div>

    <!-- User Info Header (Hidden initially) -->
    <div id="user-header" class="hidden fixed top-4 right-4 z-40">
        <div class="bg-slate-800/90 backdrop-blur-sm rounded-lg px-4 py-2 border border-slate-700">
            <div class="flex items-center space-x-3">
                <div class="flex items-center space-x-2">
                    <div class="h-8 w-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center">
                        <span id="user-avatar" class="text-white text-sm font-semibold">U</span>
                    </div>
                    <div>
                        <div id="user-name" class="text-white text-sm font-medium">User</div>
                        <div id="user-email" class="text-slate-400 text-xs">user@example.com</div>
                    </div>
                </div>
                <button id="logout-btn" class="text-slate-400 hover:text-red-400 transition-colors">
                    <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Toast Notification Container -->
    <div id="toast-container" class="fixed top-4 left-1/2 transform -translate-x-1/2 z-50 space-y-2">
        <!-- Toast notifications will be dynamically added here -->
    </div>

    <script>
        // Test script loading immediately
        console.log('üöÄ AIfluence script starting to load...');
        
        // Global error handler for debugging
        window.addEventListener('error', function(e) {
            console.error('‚ùå JavaScript Error:', e.error, 'at', e.filename, 'line', e.lineno);
            // Show error message for debugging
            const errorDiv = document.createElement('div');
            errorDiv.style.cssText = 'position:fixed;top:10px;right:10px;background:red;color:white;padding:10px;border-radius:5px;z-index:9999;max-width:300px;';
            errorDiv.innerHTML = `‚ö†Ô∏è Error: ${e.error.message}<br>Line: ${e.lineno}`;
            document.body.appendChild(errorDiv);
        });
        
        // Test function to verify script is loading
        function test() {
            console.log('JavaScript is loading correctly!');
        }

        // Authentication System
        let currentUser = null;
        let isLoggedIn = false;

        // Multiple Posts Generation Variables - declared early to avoid hoisting issues
        let generatedPosts = [];
        let selectedPostIds = new Set();
        let postPerformanceData = [];

        // Other variables (scheduledPosts declared elsewhere)
        let userUsage = { postsGenerated: 0, postsScheduled: 0, daysActive: 0 };

        // User management
        function getUsers() {
            return JSON.parse(localStorage.getItem('socialMediaAgent_users') || '[]');
        }

        function saveUsers(users) {
            localStorage.setItem('socialMediaAgent_users', JSON.stringify(users));
        }

        function getCurrentUser() {
            const userId = localStorage.getItem('socialMediaAgent_currentUserId');
            if (!userId) return null;
            
            const users = getUsers();
            return users.find(user => user.id === userId);
        }

        function setCurrentUser(user) {
            currentUser = user;
            isLoggedIn = true;
            localStorage.setItem('socialMediaAgent_currentUserId', user.id);
            updateUIForLoggedInUser();
        }

        function updateUIForLoggedInUser() {
            if (!currentUser) return;

            // Hide auth modal
            document.getElementById('auth-modal').classList.add('hidden');
            
            // Show user header
            document.getElementById('user-header').classList.remove('hidden');
            
            // Update user info
            document.getElementById('user-name').textContent = currentUser.name;
            document.getElementById('user-email').textContent = currentUser.email;
            document.getElementById('user-avatar').textContent = currentUser.name.charAt(0).toUpperCase();
            
            // Show enterprise features if user has enterprise plan
            if (currentUser.plan === 'enterprise') {
                // Add enterprise badge to header
                const userInfo = document.querySelector('#user-header .text-slate-400');
                if (userInfo && !userInfo.querySelector('.enterprise-badge')) {
                    const enterpriseBadge = document.createElement('span');
                    enterpriseBadge.className = 'enterprise-badge text-xs px-2 py-1 bg-gradient-to-r from-purple-500/20 to-pink-500/20 text-purple-400 rounded border border-purple-500/30 ml-2';
                    enterpriseBadge.textContent = 'Enterprise';
                    userInfo.appendChild(enterpriseBadge);
                }
            }
            
            // Load user-specific data
            loadUserData();
        }

        function loadUserData() {
            if (!currentUser) return;
            
            // Load user-specific scheduled posts
            const userKey = `scheduledPosts_${currentUser.id}`;
            const savedPosts = localStorage.getItem(userKey);
            scheduledPosts = JSON.parse(savedPosts || '[]');
            console.log(`üìÇ Loaded ${scheduledPosts.length} posts from ${userKey}`);
            console.log('Posts:', scheduledPosts);
            updateSchedulerDisplay();
            
            // Load user-specific usage data
            const usageKey = `userUsage_${currentUser.id}`;
            const savedUsage = localStorage.getItem(usageKey);
            if (savedUsage) {
                userUsage = { ...userUsage, ...JSON.parse(savedUsage) };
            }
            updateUsageDisplay();
        }

        function saveUserData() {
            if (!currentUser) return;
            
            // Save user-specific scheduled posts
            const userKey = `scheduledPosts_${currentUser.id}`;
            console.log(`üíæ Saving ${scheduledPosts.length} posts to ${userKey}`);
            localStorage.setItem(userKey, JSON.stringify(scheduledPosts));
            
            // Save user-specific usage data
            const usageKey = `userUsage_${currentUser.id}`;
            localStorage.setItem(usageKey, JSON.stringify(userUsage));
        }

        // Override the existing save functions to use user-specific storage
        function saveScheduledPosts() {
            if (currentUser) {
                saveUserData();
            } else {
                localStorage.setItem('scheduledPosts', JSON.stringify(scheduledPosts));
            }
        }

        function saveUserUsage() {
            if (currentUser) {
                saveUserData();
            } else {
                localStorage.setItem('userUsage', JSON.stringify(userUsage));
            }
        }

        // Auth UI functions
        function showLoginForm() {
            console.log('üîÑ showLoginForm called');
            const loginForm = document.getElementById('login-form');
            const registerForm = document.getElementById('register-form');
            
            console.log('üìù Login form element:', loginForm);
            console.log('üìù Register form element:', registerForm);
            console.log('üìù Login form classes before:', loginForm ? loginForm.className : 'not found');
            console.log('üìù Register form classes before:', registerForm ? registerForm.className : 'not found');
            
            if (loginForm && registerForm) {
                loginForm.classList.remove('hidden');
                registerForm.classList.add('hidden');
                console.log('‚úÖ Forms switched to login form');
                console.log('üìù Login form classes after:', loginForm.className);
                console.log('üìù Register form classes after:', registerForm.className);
            } else {
                console.log('‚ùå Forms not found:', { loginForm: !!loginForm, registerForm: !!registerForm });
            }
        }

        function showRegisterForm() {
            console.log('üîÑ showRegisterForm called');
            const loginForm = document.getElementById('login-form');
            const registerForm = document.getElementById('register-form');
            
            console.log('üìù Login form element:', loginForm);
            console.log('üìù Register form element:', registerForm);
            console.log('üìù Login form classes before:', loginForm ? loginForm.className : 'not found');
            console.log('üìù Register form classes before:', registerForm ? registerForm.className : 'not found');
            
            if (loginForm && registerForm) {
                loginForm.classList.add('hidden');
                registerForm.classList.remove('hidden');
                console.log('‚úÖ Forms switched to register form');
                console.log('üìù Login form classes after:', loginForm.className);
                console.log('üìù Register form classes after:', registerForm.className);
            } else {
                console.log('‚ùå Forms not found:', { loginForm: !!loginForm, registerForm: !!registerForm });
            }
        }

        function handleLogin() {
            console.log('üîÑ handleLogin function called');
            const email = document.getElementById('login-email').value.trim();
            const password = document.getElementById('login-password').value;
            console.log('üìß Email:', email);
            console.log('üîí Password length:', password.length);

            if (!email || !password) {
                alert('Please enter both email and password');
                return;
            }

            const users = getUsers();
            console.log('üë• Total users in system:', users.length);
            if (users.length > 0) {
                console.log('üë• Users:', users.map(u => ({ email: u.email, name: u.name })));
            }
            
            const user = users.find(u => u.email === email && u.password === password);
            console.log('üîç Looking for user with email:', email);
            console.log('üîç Found user:', user);

            if (user) {
                setCurrentUser(user);
                showSuccessToast(`Welcome back, ${user.name}! üëã`);
            } else {
                console.log('‚ùå Login failed - showing error toast');
                showErrorToast('Invalid email or password. Please try again.');
                // Also show alert as fallback
                alert('Invalid email or password. Please try again.');
            }
        }

        function handleRegister() {
            const name = document.getElementById('register-name').value.trim();
            const email = document.getElementById('register-email').value.trim();
            const password = document.getElementById('register-password').value;
            const confirmPassword = document.getElementById('register-confirm-password').value;

            // Get additional profile fields
            const company = document.getElementById('register-company').value.trim();
            const title = document.getElementById('register-title').value.trim();
            const timezone = document.getElementById('register-timezone').value;
            const termsAccepted = document.getElementById('register-terms').checked;
            
            if (!name || !email || !password || !confirmPassword) {
                alert('Please fill in all required fields');
                return;
            }
            
            if (!termsAccepted) {
                alert('Please accept the Terms of Service and Privacy Policy');
                return;
            }

            if (password.length < 6) {
                alert('Password must be at least 6 characters long');
                return;
            }

            if (password !== confirmPassword) {
                alert('Passwords do not match');
                return;
            }

            const users = getUsers();
            if (users.find(u => u.email === email)) {
                alert('An account with this email already exists');
                return;
            }

            const newUser = {
                id: Date.now().toString(),
                name: name,
                email: email,
                password: password,
                createdAt: new Date().toISOString(),
                profile: {
                    name: name,
                    company: company,
                    title: title,
                    timezone: timezone
                }
            };

            users.push(newUser);
            saveUsers(users);
            setCurrentUser(newUser);
            showSuccessToast(`Account created successfully! Welcome, ${name}! üéâ`);
        }

        function useDemoAccount() {
            console.log('üéâ Demo account function called!');
            const demoUser = {
                id: 'demo',
                name: 'Demo User',
                email: 'demo@example.com',
                password: 'demo123',
                createdAt: new Date().toISOString(),
                plan: 'enterprise',
                planLimits: {
                    postsPerMonth: -1, // Unlimited
                    aiImagesPerMonth: -1, // Unlimited
                    teamMembers: 50,
                    advancedAnalytics: true,
                    customBranding: true,
                    customAITraining: true,
                    apiAccess: true,
                    support24x7: true,
                    prioritySupport: true,
                    unlimitedEverything: true
                },
                profile: {
                    name: 'Demo User',
                    company: 'AIfluence Demo',
                    title: 'Content Strategy Director',
                    timezone: 'UTC-5'
                },
                linkedInConnected: true,
                linkedInProfile: 'Demo User - Content Strategy Director at AIfluence',
                preferences: {
                    emailNotifications: true,
                    postReminders: true,
                    weeklyAnalytics: true
                },
                performanceHistory: [
                    {
                        postId: 'demo-1',
                        content: 'AI isn\'t about replacing humans - it\'s about amplifying human potential. Here\'s how we\'re seeing this play out...',
                        topic: 'AI Human Collaboration',
                        audience: 'C-level executives',
                        tone: 'Professional and authoritative',
                        hasMedia: true,
                        mediaType: 'image',
                        metrics: { views: 8932, likes: 234, comments: 45, shares: 18, engagement: 1247 },
                        timestamp: '2024-01-15T09:00:00Z',
                        performanceScore: 0.85
                    },
                    {
                        postId: 'demo-2',
                        content: 'The #1 mistake companies make with AI? Starting with technology instead of strategy...',
                        topic: 'AI Strategy',
                        audience: 'IT managers',
                        tone: 'Educational and informative',
                        hasMedia: true,
                        mediaType: 'image',
                        metrics: { views: 6741, likes: 189, comments: 32, shares: 12, engagement: 956 },
                        timestamp: '2024-01-12T14:00:00Z',
                        performanceScore: 0.78
                    },
                    {
                        postId: 'demo-3',
                        content: 'Just implemented our first AI workflow. Results? 40% time savings and 90% accuracy improvement...',
                        topic: 'AI Implementation',
                        audience: 'Operations managers',
                        tone: 'Inspirational and motivating',
                        hasMedia: true,
                        mediaType: 'video',
                        metrics: { views: 5623, likes: 156, comments: 28, shares: 8, engagement: 834 },
                        timestamp: '2024-01-08T11:00:00Z',
                        performanceScore: 0.72
                    }
                ],
                learnedPatterns: [
                    {
                        contentLength: 285,
                        hasQuestions: true,
                        hasHashtags: true,
                        hasEmojis: false,
                        topic: 'AI Human Collaboration',
                        audience: 'C-level executives',
                        tone: 'Professional and authoritative',
                        mediaType: 'image',
                        timeOfDay: 9,
                        dayOfWeek: 1
                    },
                    {
                        contentLength: 267,
                        hasQuestions: true,
                        hasHashtags: true,
                        hasEmojis: false,
                        topic: 'AI Strategy',
                        audience: 'IT managers',
                        tone: 'Educational and informative',
                        mediaType: 'image',
                        timeOfDay: 14,
                        dayOfWeek: 2
                    }
                ]
            };

            setCurrentUser(demoUser);
            showToast('Welcome to AIfluence Enterprise Demo! Full access to all features unlocked. üöÄ', 'success', 5000);
        }

        // Logout functions are now defined in global scope above

        // Get current user from session
        function getCurrentUser() {
            const users = getUsers();
            const currentUserId = localStorage.getItem('socialMediaAgent_currentUserId');
            return users.find(u => u.id === currentUserId);
        }
        
        // Check for existing session on page load
        function initializeAuth() {
            console.log('üîç Checking for existing user session...');
            
            // Check for persistent login
            const persistentLogin = localStorage.getItem('socialMediaAgent_persistentLogin');
            const currentUserId = localStorage.getItem('socialMediaAgent_currentUserId');
            
            if (persistentLogin && currentUserId) {
                try {
                    const loginData = JSON.parse(persistentLogin);
                    
                    // Check if session has expired
                    if (loginData.expires && loginData.expires < Date.now()) {
                        console.log('‚è∞ Session expired, clearing data');
                        localStorage.removeItem('socialMediaAgent_persistentLogin');
                        localStorage.removeItem('socialMediaAgent_currentUserId');
                        return;
                    }
                    
                    const users = getUsers();
                    const user = users.find(u => u.id === currentUserId);
                    
                    if (user) {
                        // Restore user session
                        currentUser = user;
                        isLoggedIn = true;
                        
                        // Update UI
                        document.getElementById('user-name').textContent = user.name;
                        document.getElementById('user-email').textContent = user.email;
                        document.getElementById('user-avatar').textContent = user.name.charAt(0).toUpperCase();
                        document.getElementById('auth-modal').classList.add('hidden');
                        document.getElementById('user-header').classList.remove('hidden');
                        
                        // Load settings data
                        if (typeof loadSettingsData === 'function') {
                            loadSettingsData();
                        }
                        
                        console.log('‚úÖ Restored session for user:', user.email, loginData.persistent ? '(persistent)' : '(session)');
                    } else {
                        console.log('‚ùå User not found, clearing session');
                        localStorage.removeItem('socialMediaAgent_persistentLogin');
                        localStorage.removeItem('socialMediaAgent_currentUserId');
                    }
                } catch (error) {
                    console.error('‚ùå Error restoring session:', error);
                    localStorage.removeItem('socialMediaAgent_persistentLogin');
                    localStorage.removeItem('socialMediaAgent_currentUserId');
                }
            } else {
                console.log('‚ÑπÔ∏è No existing session found');
            }
        }

        // Toast Notification System
        function showToast(message, type = 'success', duration = 4000) {
            const toastContainer = document.getElementById('toast-container');
            const toastId = `toast-${Date.now()}`;
            
            // Define toast types and their styles
            const toastTypes = {
                success: {
                    bgColor: 'bg-green-600',
                    icon: `<svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>`
                },
                error: {
                    bgColor: 'bg-red-600',
                    icon: `<svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>`
                },
                info: {
                    bgColor: 'bg-blue-600',
                    icon: `<svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>`
                },
                warning: {
                    bgColor: 'bg-orange-600',
                    icon: `<svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                    </svg>`
                }
            };

            const toastStyle = toastTypes[type] || toastTypes.success;
            
            const toastHTML = `
                <div id="${toastId}" class="toast-notification transform translate-y-2 opacity-0 transition-all duration-300 ease-out">
                    <div class="${toastStyle.bgColor} text-white px-6 py-4 rounded-lg shadow-lg backdrop-blur-sm border border-white/10 max-w-md">
                        <div class="flex items-center space-x-3">
                            <div class="flex-shrink-0">
                                ${toastStyle.icon}
                            </div>
                            <div class="flex-1">
                                <p class="text-sm font-medium">${message}</p>
                            </div>
                            <button onclick="hideToast('${toastId}')" class="flex-shrink-0 text-white/80 hover:text-white transition-colors">
                                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            toastContainer.insertAdjacentHTML('beforeend', toastHTML);
            
            // Trigger animation
            const toastElement = document.getElementById(toastId);
            setTimeout(() => {
                toastElement.classList.remove('translate-y-2', 'opacity-0');
                toastElement.classList.add('translate-y-0', 'opacity-100');
            }, 10);
            
            // Auto hide after duration
            setTimeout(() => {
                hideToast(toastId);
            }, duration);
            
            return toastId;
        }

        function hideToast(toastId) {
            const toastElement = document.getElementById(toastId);
            if (toastElement) {
                toastElement.classList.add('translate-y-2', 'opacity-0');
                toastElement.classList.remove('translate-y-0', 'opacity-100');
                
                setTimeout(() => {
                    toastElement.remove();
                }, 300);
            }
        }

        // Convenience functions for different toast types
        function showSuccessToast(message, duration = 4000) {
            return showToast(message, 'success', duration);
        }

        function showErrorToast(message, duration = 5000) {
            return showToast(message, 'error', duration);
        }

        function showInfoToast(message, duration = 4000) {
            return showToast(message, 'info', duration);
        }

        function showWarningToast(message, duration = 4000) {
            return showToast(message, 'warning', duration);
        }
        
        let selectedTopic = '';
        let selectedAudience = 'business-leaders';
        let selectedTone = 'educational';
        let selectedMediaType = 'ai-infographic';
        let isLinkedInConnected = false;

        // Custom input values
        let customTopic = '';
        let customAudience = '';
        let customTone = '';
        let customMedia = '';

        // Functions for setting custom inputs
        function setCustomTopic(value) {
            document.getElementById('custom-topic').value = value;
            customTopic = value;
        }

        function setCustomAudience(value) {
            document.getElementById('custom-audience').value = value;
            customAudience = value;
        }

        function setCustomTone(value) {
            document.getElementById('custom-tone').value = value;
            customTone = value;
        }

        function setCustomMedia(value) {
            document.getElementById('custom-media').value = value;
            customMedia = value;
        }

        // Function to get current custom inputs
        function getCustomInputs() {
            customTopic = document.getElementById('custom-topic').value.trim();
            customAudience = document.getElementById('custom-audience').value.trim();
            customTone = document.getElementById('custom-tone').value.trim();
            customMedia = document.getElementById('custom-media').value.trim();
            
            return {
                topic: customTopic || 'AI and business innovation',
                audience: customAudience || 'business professionals and decision makers',
                tone: customTone || 'professional and informative',
                media: customMedia || 'professional visual content'
            };
        }

        // Stripe Configuration (disabled for testing)
        // const stripe = Stripe('pk_test_51234567890abcdef'); // Replace with your publishable key
        // let elements;
        // let paymentElement;
        
        // Usage Tracking - extend existing userUsage object
        userUsage = {
            ...userUsage,
            plan: 'free',
            aiImagesGenerated: 0,
            subscriptionDate: null,
            subscriptionEndDate: null,
            limits: {
                free: { posts: 5, images: 3 },
                pro: { posts: 100, images: 50 },
                enterprise: { posts: -1, images: -1 } // -1 = unlimited
            }
        };

        // Load usage from localStorage
        function loadUserUsage() {
            if (currentUser) {
                const usageKey = `userUsage_${currentUser.id}`;
                const stored = localStorage.getItem(usageKey);
                if (stored) {
                    userUsage = { ...userUsage, ...JSON.parse(stored) };
                }
            } else {
                const stored = localStorage.getItem('userUsage');
                if (stored) {
                    userUsage = { ...userUsage, ...JSON.parse(stored) };
                }
            }
            updateUsageDisplay();
        }

        // Note: saveUserUsage function is defined above in the authentication section

        // Update usage display
        function updateUsageDisplay() {
            document.getElementById('posts-used').textContent = userUsage.postsGenerated;
            document.getElementById('ai-images-used').textContent = userUsage.aiImagesGenerated;
            
            const planBadge = document.getElementById('current-plan-badge');
            let planName = 'Free Plan';
            let planClass = 'text-xs px-3 py-1 bg-slate-500/20 text-slate-400 rounded-full';
            
            if (currentUser && currentUser.plan) {
                switch(currentUser.plan) {
                    case 'enterprise':
                        planName = 'Enterprise Plan';
                        planClass = 'text-xs px-3 py-1 bg-gradient-to-r from-purple-500/20 to-pink-500/20 text-purple-400 rounded-full border border-purple-500/30';
                        break;
                    case 'pro':
                        planName = 'Pro Plan';
                        planClass = 'text-xs px-3 py-1 bg-blue-500/20 text-blue-400 rounded-full';
                        break;
                    default:
                        planName = 'Free Plan';
                        planClass = 'text-xs px-3 py-1 bg-slate-500/20 text-slate-400 rounded-full';
                }
            } else if (userUsage.plan) {
                planName = userUsage.plan.charAt(0).toUpperCase() + userUsage.plan.slice(1) + ' Plan';
                if (userUsage.plan === 'pro') {
                    planClass = 'text-xs px-3 py-1 bg-blue-500/20 text-blue-400 rounded-full';
                } else if (userUsage.plan === 'enterprise') {
                    planClass = 'text-xs px-3 py-1 bg-gradient-to-r from-purple-500/20 to-pink-500/20 text-purple-400 rounded-full border border-purple-500/30';
                }
            }
            
            planBadge.textContent = planName;
            planBadge.className = planClass;
            
            // Calculate days remaining for paid plans
            if (userUsage.subscriptionEndDate) {
                const daysRemaining = Math.ceil((new Date(userUsage.subscriptionEndDate) - new Date()) / (1000 * 60 * 60 * 24));
                document.getElementById('days-remaining').textContent = Math.max(0, daysRemaining);
            } else {
                document.getElementById('days-remaining').textContent = '-';
            }
        }

        // Check usage limits
        function checkUsageLimit(type) {
            // Enterprise users have unlimited access
            if (currentUser && currentUser.plan === 'enterprise') {
                return true;
            }
            
            // Pro users have higher limits
            if (currentUser && currentUser.plan === 'pro') {
                if (type === 'posts') {
                    return (userUsage.postsGenerated || 0) < 100;
                }
                if (type === 'images') {
                    return (userUsage.aiImagesGenerated || 0) < 50;
                }
            }
            
            // Free users have basic limits
            if (type === 'posts') {
                return (userUsage.postsGenerated || 0) < 5;
            }
            
            if (type === 'images') {
                return (userUsage.aiImagesGenerated || 0) < 3;
            }
            
            return false;
        }

        // Increment usage
        function incrementUsage(type) {
            if (type === 'posts') {
                userUsage.postsGenerated++;
            } else if (type === 'images') {
                userUsage.aiImagesGenerated++;
            }
            saveUserUsage();
        }

        // Show upgrade prompt
        function showUpgradePrompt(type) {
            const typeText = type === 'posts' ? 'posts' : 'AI images';
            
            if (currentUser && currentUser.plan === 'enterprise') {
                // This should never happen for enterprise users, but just in case
                showToast('Enterprise users have unlimited access. Please contact support if you see this message.', 'error');
                return;
            }
            
            let limit = 5;
            if (currentUser && currentUser.plan === 'pro') {
                limit = type === 'posts' ? 100 : 50;
            } else if (type === 'images') {
                limit = 3;
            }
            
            showToast(`You've reached your ${typeText} limit of ${limit} for this month. Please upgrade to continue generating ${typeText}.`, 'error');
            showTab('billing');
        }

        const mediaTemplates = {
            'ai-readiness': {
                primary: {
                    type: 'AI Generated Infographic',
                    description: 'Professional AI readiness assessment checklist infographic',
                    prompt: 'Clean business infographic with checkboxes for data foundation, clear goals, change management, and realistic expectations',
                    url: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAwIiBoZWlnaHQ9IjQwMCIgdmlld0JveD0iMCAwIDYwMCA0MDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI2MDAiIGhlaWdodD0iNDAwIiBmaWxsPSJ1cmwoI2dyYWRpZW50KSIvPgo8ZGVmcz4KPHN0eWxlPi50aXRsZXtmb250LWZhbWlseTpzYW5zLXNlcmlmO2ZvbnQtd2VpZ2h0OmJvbGQ7Zm9udC1zaXplOjI0cHg7ZmlsbDojZmZmO30uc3VidGl0bGV7Zm9udC1mYW1pbHk6c2Fucy1zZXJpZjtmb250LXNpemU6MTZweDtmaWxsOiNjZGQ7fS5jaGVja3tmb250LWZhbWlseTpzYW5zLXNlcmlmO2ZvbnQtc2l6ZToxNHB4O2ZpbGw6I2ZmZjt9PC9zdHlsZT4KPGxpbmVhckdyYWRpZW50IGlkPSJncmFkaWVudCIgeDE9IjAlIiB5MT0iMCUiIHgyPSIxMDAlIiB5Mj0iMTAwJSI+CjxzdG9wIG9mZnNldD0iMCUiIHN0b3AtY29sb3I9IiMxZTI5M2IiLz4KPHN0b3Agb2Zmc2V0PSIxMDAlIiBzdG9wLWNvbG9yPSIjMzM0MTU1Ii8+CjwvbGluZWFyR3JhZGllbnQ+CjwvZGVmcz4KPHRleHQgeD0iMzAwIiB5PSI0MCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgY2xhc3M9InRpdGxlIj5BSSBSZWFkaW5lc3MgQXNzZXNzbWVudDwvdGV4dD4KPHRleHQgeD0iMzAwIiB5PSI2NSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgY2xhc3M9InN1YnRpdGxlIj5BcmUgeW91IHJlYWR5IGZvciBBST88L3RleHQ+Cgo8IS0tIENoZWNrbGlzdCBJdGVtcyAtLT4KPGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNTAsIDEwMCkiPgo8IS0tIERhdGEgRm91bmRhdGlvbiAtLT4KPGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMTIiIGZpbGw9IiMzYjgyZjYiIHN0cm9rZT0iIzFkNGVkOCIgc3Ryb2tlLXdpZHRoPSIyIi8+Cjx0ZXh0IHg9IjE1IiB5PSIyNSIgZm9udC1zaXplPSIxNHB4IiBmaWxsPSJ3aGl0ZSIgZm9udC13ZWlnaHQ9ImJvbGQiPuKcszwvdGV4dD4KPHRleHQgeD0iNDUiIHk9IjE4IiBjbGFzcz0iY2hlY2siIGZvbnQtd2VpZ2h0PSJib2xkIj5EYXRhIEZvdW5kYXRpb248L3RleHQ+Cjx0ZXh0IHg9IjQ1IiB5PSIzNSIgY2xhc3M9ImNoZWNrIiBmb250LXNpemU9IjEycHgiIGZpbGw9IiNhYWEiPk9yZ2FuaXplZCwgYWNjZXNzaWJsZSBkYXRhPC90ZXh0PgoKPCEtLSBDbGVhciBHb2FscyAtLT4KPGNpcmNsZSBjeD0iMjAiIGN5PSI4MCIgcj0iMTIiIGZpbGw9IiM4YjVjZjYiIHN0cm9rZT0iIzdhM2NmMCIgc3Ryb2tlLXdpZHRoPSIyIi8+Cjx0ZXh0IHg9IjE1IiB5PSI4NSIgZm9udC1zaXplPSIxNHB4IiBmaWxsPSJ3aGl0ZSIgZm9udC13ZWlnaHQ9ImJvbGQiPuKcszwvdGV4dD4KPHRleHQgeD0iNDUiIHk9Ijc4IiBjbGFzcz0iY2hlY2siIGZvbnQtd2VpZ2h0PSJib2xkIj5DbGVhciBCdXNpbmVzcyBHb2FsczwvdGV4dD4KPHRleHQgeD0iNDUiIHk9Ijk1IiBjbGFzcz0iY2hlY2siIGZvbnQtc2l6ZT0iMTJweCIgZmlsbD0iI2FhYSI+SWRlbnRpZnkgc3BlY2lmaWMgcHJvYmxlbXM8L3RleHQ+Cgo8IS0tIENoYW5nZSBNYW5hZ2VtZW50IC0tPgo8Y2lyY2xlIGN4PSIyMCIgY3k9IjE0MCIgcj0iMTIiIGZpbGw9IiMxMGI5ODEiIHN0cm9rZT0iIzA1OWY2OSIgc3Ryb2tlLXdpZHRoPSIyIi8+Cjx0ZXh0IHg9IjE1IiB5PSIxNDUiIGZvbnQtc2l6ZT0iMTRweCIgZmlsbD0id2hpdGUiIGZvbnQtd2VpZ2h0PSJib2xkIj7inJM8L3RleHQ+Cjx0ZXh0IHg9IjQ1IiB5PSIxMzgiIGNsYXNzPSJjaGVjayIgZm9udC13ZWlnaHQ9ImJvbGQiPkNoYW5nZSBNYW5hZ2VtZW50PC90ZXh0Pgo8dGV4dCB4PSI0NSIgeT0iMTU1IiBjbGFzcz0iY2hlY2siIGZvbnQtc2l6ZT0iMTJweCIgZmlsbD0iI2FhYSI+VGVhbSBvcGVuIHRvIG5ldyBwcm9jZXNzZXM8L3RleHQ+Cgo8IS0tIFJlYWxpc3RpYyBFeHBlY3RhdGlvbnMgLS0+CjxjaXJjbGUgY3g9IjIwIiBjeT0iMjAwIiByPSIxMiIgZmlsbD0iI2Y1OWUwYiIgc3Ryb2tlPSIjZDk3NzA2IiBzdHJva2Utd2lkdGg9IjIiLz4KPHRleHQgeD0iMTUiIHk9IjIwNSIgZm9udC1zaXplPSIxNHB4IiBmaWxsPSJ3aGl0ZSIgZm9udC13ZWlnaHQ9ImJvbGQiPuKcszwvdGV4dD4KPHRleHQgeD0iNDUiIHk9IjE5OCIgY2xhc3M9ImNoZWNrIiBmb250LXdlaWdodD0iYm9sZCI+UmVhbGlzdGljIEV4cGVjdGF0aW9uczwvdGV4dD4KPHRleHQgeD0iNDUiIHk9IjIxNSIgY2xhc3M9ImNoZWNrIiBmb250LXNpemU9IjEycHgiIGZpbGw9IiNhYWEiPkF2b2lkIHRoZSAibWFnaWMgc29sdXRpb24iIHRyYXA8L3RleHQ+CjwvZz4KCjx0ZXh0IHg9IjMwMCIgeT0iMzUwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBjbGFzcz0ic3VidGl0bGUiPkFnZW50aWMgSW50ZWxsaWdlbmNlIC0gQnJpZGdpbmcgQnVzaW5lc3MgJiBBSTwvdGV4dD4KPHRleHQgeD0iMzAwIiB5PSIzNzAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGNsYXNzPSJzdWJ0aXRsZSIgZm9udC1zaXplPSIxMnB4Ij53d3cuYWdlbnRpY2ludGVsbGlnZW5jZS5jb208L3RleHQ+Cjwvc3ZnPg=='
                },
                alternatives: [
                    { 
                        type: 'Animated GIF', 
                        description: 'Checklist items appearing with animation', 
                        url: 'https://media.giphy.com/media/xT9IgG50Fb7Mi0prBC/giphy.gif'
                    },
                    { 
                        type: 'Video Preview', 
                        description: 'AI readiness explainer video thumbnail', 
                        url: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDMwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIzMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjMWUyOTNiIi8+CjxjaXJjbGUgY3g9IjE1MCIgY3k9IjEwMCIgcj0iMzAiIGZpbGw9IiNlZjQ0NDQiLz4KPHBvbHlnb24gcG9pbnRzPSIxNDAsODUgMTQwLDExNSAxNjUsMTAwIiBmaWxsPSJ3aGl0ZSIvPgo8dGV4dCB4PSIxNTAiIHk9IjE2MCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTRweCIgZmlsbD0id2hpdGUiPkFJIFJlYWRpbmVzcyBWaWRlbzwvdGV4dD4KPHRleHQgeD0iMTUwIiB5PSIxODAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEycHgiIGZpbGw9IiNhYWEiPjMwIHNlY29uZHM8L3RleHQ+Cjwvc3ZnPg==' 
                    },
                    { 
                        type: 'Business Meme', 
                        description: 'Humorous AI expectations vs reality', 
                        url: 'https://i.imgflip.com/4/261o3j.jpg' 
                    }
                ]
            },
            'roi-ai': {
                primary: {
                    type: 'Interactive Chart',
                    description: 'AI ROI comparison: Traditional vs Strategic thinking',
                    prompt: 'Split comparison chart showing cost savings vs value creation approaches to AI ROI',
                    url: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAwIiBoZWlnaHQ9IjQwMCIgdmlld0JveD0iMCAwIDYwMCA0MDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI2MDAiIGhlaWdodD0iNDAwIiBmaWxsPSJ1cmwoI2dyYWRpZW50KSIvPgo8ZGVmcz4KPHN0eWxlPi50aXRsZXtmb250LWZhbWlseTpzYW5zLXNlcmlmO2ZvbnQtd2VpZ2h0OmJvbGQ7Zm9udC1zaXplOjI0cHg7ZmlsbDojZmZmO30uc3VidGl0bGV7Zm9udC1mYW1pbHk6c2Fucy1zZXJpZjtmb250LXNpemU6MTZweDtmaWxsOiNjZGQ7fS5sYWJlbHtmb250LWZhbWlseTpzYW5zLXNlcmlmO2ZvbnQtc2l6ZToxNHB4O2ZpbGw6I2ZmZjt9LmJhZHtmaWxsOiNlZjQ0NDQ7fS5nb29ke2ZpbGw6IzEwYjk4MTt9PC9zdHlsZT4KPGxpbmVhckdyYWRpZW50IGlkPSJncmFkaWVudCIgeDE9IjAlIiB5MT0iMCUiIHgyPSIxMDAlIiB5Mj0iMTAwJSI+CjxzdG9wIG9mZnNldD0iMCUiIHN0b3AtY29sb3I9IiMxZTI5M2IiLz4KPHN0b3Agb2Zmc2V0PSIxMDAlIiBzdG9wLWNvbG9yPSIjMzM0MTU1Ii8+CjwvbGluZWFyR3JhZGllbnQ+CjwvZGVmcz4KCjx0ZXh0IHg9IjMwMCIgeT0iNDAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGNsYXNzPSJ0aXRsZSI+QUkgUk9JOiBUcmFkaXRpb25hbCB2cyBTdHJhdGVnaWM8L3RleHQ+Cgo8IS0tIERpdmlkZXIgLS0+CjxsaW5lIHgxPSIzMDAiIHkxPSI3MCIgeDI9IjMwMCIgeTI9IjM1MCIgc3Ryb2tlPSIjNGY0Zjo1ZiIgc3Ryb2tlLXdpZHRoPSIyIi8+Cgo8IS0tIFRyYWRpdGlvbmFsIFNpZGUgLS0+Cjx0ZXh0IHg9IjE1MCIgeT0iOTAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGNsYXNzPSJzdWJ0aXRsZSIgZmlsbD0iI2VmNDQ0NCI+VHJhZGl0aW9uYWwgVGhpbmtpbmc8L3RleHQ+CjxyZWN0IHg9IjUwIiB5PSIxMTAiIHdpZHRoPSIyMDAiIGhlaWdodD0iNDAiIGZpbGw9IiNlZjQ0NDQiIG9wYWNpdHk9IjAuMiIgcng9IjUiLz4KPHRleHQgeD0iMTUwIiB5PSIxMzUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGNsYXNzPSJsYWJlbCIgZm9udC13ZWlnaHQ9ImJvbGQiPkNvc3QgU2F2aW5ncyBGb2N1czwvdGV4dD4KCjxyZWN0IHg9IjUwIiB5PSIxNzAiIHdpZHRoPSIxMDAiIGhlaWdodD0iMzAiIGZpbGw9IiNlZjQ0NDQiIG9wYWNpdHk9IjAuNyIgcng9IjMiLz4KPHRleHQgeD0iMTAwIiB5PSIxOTAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGNsYXNzPSJsYWJlbCIgZm9udC1zaXplPSIxMnB4Ij5MYXF1b3IgQ29zdHM8L3RleHQ+Cgo8cmVjdCB4PSI1MCIgeT0iMjEwIiB3aWR0aD0iMTIwIiBoZWlnaHQ9IjMwIiBmaWxsPSIjZWY0NDQ0IiBvcGFjaXR5PSIwLjciIHJ4PSIzIi8+Cjx0ZXh0IHg9IjExMCIgeT0iMjMwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBjbGFzcz0ibGFiZWwiIGZvbnQtc2l6ZT0iMTJweCI+T3BlcmF0aW9uYWwgQ29zdHM8L3RleHQ+Cgo8IS0tIFN0cmF0ZWdpYyBTaWRlIC0tPgo8dGV4dCB4PSI0NTAiIHk9IjkwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBjbGFzcz0ic3VidGl0bGUiIGZpbGw9IiMxMGI5ODEiPlN0cmF0ZWdpYyBUaGlua2luZzwvdGV4dD4KPHJlY3QgeD0iMzUwIiB5PSIxMTAiIHdpZHRoPSIyMDAiIGhlaWdodD0iNDAiIGZpbGw9IiMxMGI5ODEiIG9wYWNpdHk9IjAuMiIgcng9IjUiLz4KPHRleHQgeD0iNDUwIiB5PSIxMzUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGNsYXNzPSJsYWJlbCIgZm9udC13ZWlnaHQ9ImJvbGQiPlZhbHVlIENyZWF0aW9uIEZvY3VzPC90ZXh0PgoKPHJlY3QgeD0iMzUwIiB5PSIxNzAiIHdpZHRoPSIxNDAiIGhlaWdodD0iMzAiIGZpbGw9IiMxMGI5ODEiIG9wYWNpdHk9IjAuNyIgcng9IjMiLz4KPHRleHQgeD0iNDIwIiB5PSIxOTAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGNsYXNzPSJsYWJlbCIgZm9udC1zaXplPSIxMnB4Ij5DYXN0ZXIgRGVjaXNpb25zPC90ZXh0PgoKPHJlY3QgeD0iMzUwIiB5PSIyMTAiIHdpZHRoPSIxNjAiIGhlaWdodD0iMzAiIGZpbGw9IiMxMGI5ODEiIG9wYWNpdHk9IjAuNyIgcng9IjMiLz4KPHRleHQgeD0iNDMwIiB5PSIyMzAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGNsYXNzPSJsYWJlbCIgZm9udC1zaXplPSIxMnB4Ij5JbmNyZWFzZWQgUmV2ZW51ZTwvdGV4dD4KCjxyZWN0IHg9IjM1MCIgeT0iMjUwIiB3aWR0aD0iMTIwIiBoZWlnaHQ9IjMwIiBmaWxsPSIjMTBiOTgxIiBvcGFjaXR5PSIwLjciIHJ4PSIzIi8+Cjx0ZXh0IHg9IjQxMCIgeT0iMjcwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBjbGFzcz0ibGFiZWwiIGZvbnQtc2l6ZT0iMTJweCI+UmlzayBSZWR1Y3Rpb248L3RleHQ+Cgo8dGV4dCB4PSIzMDAiIHk9IjMzMCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgY2xhc3M9InN1YnRpdGxlIj5BZ2VudGljIEludGVsbGlnZW5jZSAtIEhlbHBpbmcgQnVpbGQgUmVhbCBWYWx1ZTwvdGV4dD4KPHRleHQgeD0iMzAwIiB5PSIzNTAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGNsYXNzPSJzdWJ0aXRsZSIgZm9udC1zaXplPSIxMnB4Ij4jQUkgI0J1c2luZXNzVmFsdWUgI0lubm92YXRpb248L3RleHQ+Cjwvc3ZnPg=='
                },
                alternatives: [
                    { 
                        type: 'Calculator GIF', 
                        description: 'Animated ROI calculation process', 
                        url: 'https://media.giphy.com/media/3o6Mb6TT5VkwDbkfwA/giphy.gif'
                    },
                    { 
                        type: 'Video Tutorial', 
                        description: 'ROI calculation walkthrough video', 
                        url: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDMwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIzMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjMWUyOTNiIi8+CjxjaXJjbGUgY3g9IjE1MCIgY3k9IjEwMCIgcj0iMzAiIGZpbGw9IiMxMGI5ODEiLz4KPHBvbHlnb24gcG9pbnRzPSIxNDAsODUgMTQwLDExNSAxNjUsMTAwIiBmaWxsPSJ3aGl0ZSIvPgo8dGV4dCB4PSIxNTAiIHk9IjE2MCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTRweCIgZmlsbD0id2hpdGUiPkFJIFJPSSBDYWxjdWxhdG9yPC90ZXh0Pgo8dGV4dCB4PSIxNTAiIHk9IjE4MCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTJweCIgZmlsbD0iI2FhYSI+MiBtaW51dGVzPC90ZXh0Pgo8L3N2Zz4='
                    },
                    { 
                        type: 'Infographic', 
                        description: 'ROI sources breakdown visual', 
                        url: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDMwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIzMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjMWUyOTNiIi8+Cjx0ZXh0IHg9IjE1MCIgeT0iMzAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE2cHgiIGZvbnQtd2VpZ2h0PSJib2xkIiBmaWxsPSJ3aGl0ZSI+Uk9JIFNvdXJjZXM8L3RleHQ+CjxyZWN0IHg9IjIwIiB5PSI1MCIgd2lkdGg9IjEyMCIgaGVpZ2h0PSIyMCIgZmlsbD0iIzNiODJmNiIgcng9IjMiLz4KPHRleHQgeD0iODAiIHk9IjY1IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LWZhbWlseTpic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMnB4IiBmaWxsPSJ3aGl0ZSI+RmFzdGVyIERlY2lzaW9uczwvdGV4dD4KPHJlY3QgeD0iMjAiIHk9IjgwIiB3aWR0aD0iMTAwIiBoZWlnaHQ9IjIwIiBmaWxsPSIjOGI1Y2Y2IiByeD0iMyIvPgo8dGV4dCB4PSI3MCIgeT0iOTUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEycHgiIGZpbGw9IndoaXRlIj5DdXN0b21lciBJbnNpZ2h0czwvdGV4dD4KPHJlY3QgeD0iMjAiIHk9IjExMCIgd2lkdGg9IjE0MCIgaGVpZ2h0PSIyMCIgZmlsbD0iIzEwYjk4MSIgcng9IjMiLz4KPHRleHQgeD0iOTAiIHk9IjEyNSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTJweCIgZmlsbD0id2hpdGUiPlByb2Nlc3MgT3B0aW1pemF0aW9uPC90ZXh0Pgo8cmVjdCB4PSIyMCIgeT0iMTQwIiB3aWR0aD0iODAiIGhlaWdodD0iMjAiIGZpbGw9IiNmNTllMGIiIHJ4PSIzIi8+Cjx0ZXh0IHg9IjYwIiB5PSIxNTUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEycHgiIGZpbGw9IndoaXRlIj5SaXNrIFJlZHVjdGlvbjwvdGV4dD4KPC9zdmc+'
                    }
                ]
            },
            'ai-misconceptions': {
                primary: {
                    type: 'Professional Meme',
                    description: 'Business-appropriate myth vs reality format',
                    prompt: 'Clean myth-busting format showing AI misconceptions with professional typography',
                    url: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAwIiBoZWlnaHQ9IjQwMCIgdmlld0JveD0iMCAwIDYwMCA0MDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI2MDAiIGhlaWdodD0iNDAwIiBmaWxsPSJ1cmwoI2dyYWRpZW50KSIvPgo8ZGVmcz4KPHN0eWxlPi50aXRsZXtmb250LWZhbWlseTpzYW5zLXNlcmlmO2ZvbnQtd2VpZ2h0OmJvbGQ7Zm9udC1zaXplOjI0cHg7ZmlsbDojZmZmO30ubXl0aHtmb250LWZhbWlseTpzYW5zLXNlcmlmO2ZvbnQtc2l6ZToxNHB4O2ZpbGw6I2VmNDQ0NDt9LnJlYWxpdHl7Zm9udC1mYW1pbHk6c2Fucy1zZXJpZjtmb250LXNpemU6MTRweDtmaWxsOiMxMGI5ODE7fS5zdWJ0aXRsZXtmb250LWZhbWlseTpzYW5zLXNlcmlmO2ZvbnQtc2l6ZToxNnB4O2ZpbGw6I2NkZDt9PC9zdHlsZT4KPGxpbmVhckdyYWRpZW50IGlkPSJncmFkaWVudCIgeDE9IjAlIiB5MT0iMCUiIHgyPSIxMDAlIiB5Mj0iMTAwJSI+CjxzdG9wIG9mZnNldD0iMCUiIHN0b3AtY29sb3I9IiMxZTI5M2IiLz4KPHN0b3Agb2Zmc2V0PSIxMDAlIiBzdG9wLWNvbG9yPSIjMzM0MTU1Ii8+CjwvbGluZWFyR3JhZGllbnQ+CjwvZGVmcz4KCjx0ZXh0IHg9IjMwMCIgeT0iNDAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGNsYXNzPSJ0aXRsZSI+QUkgTXl0aHMgdnMgUmVhbGl0eTwvdGV4dD4KPHRleHQgeD0iMzAwIiB5PSI2NSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgY2xhc3M9InN1YnRpdGxlIj5EZWJ1bmtpbmcgY29tbW9uIG1pc2NvbmNlcHRpb25zPC90ZXh0PgoKPCEtLSBNeXRoIDEgLS0+CjxyZWN0IHg9IjUwIiB5PSIxMDAiIHdpZHRoPSIyNDAiIGhlaWdodD0iNTAiIGZpbGw9IiNlZjQ0NDQiIG9wYWNpdHk9IjAuMiIgcng9IjUiLz4KPHRleHQgeD0iNjAiIHk9IjEyMCIgY2xhc3M9Im15dGgiIGZvbnQtd2VpZ2h0PSJib2xkIj5NWVRIOiBBSSBpcyBwbHVnLWFuZC1wbGF5PC90ZXh0Pgo8dGV4dCB4PSI2MCIgeT0iMTQwIiBjbGFzcz0ibXl0aCIgZm9udC1zaXplPSIxMnB4Ij5KdXN0IGluc3RhbGwgYW5kIGl0IHdvcmtzIGV2ZXJ5d2hlcmU8L3RleHQ+Cgo8cmVjdCB4PSIzMTAiIHk9IjEwMCIgd2lkdGg9IjI0MCIgaGVpZ2h0PSI1MCIgZmlsbD0iIzEwYjk4MSIgb3BhY2l0eT0iMC4yIiByeD0iNSIvPgo8dGV4dCB4PSIzMjAiIHk9IjEyMCIgY2xhc3M9InJlYWxpdHkiIGZvbnQtd2VpZ2h0PSJib2xkIj5SRUFMSVRZOiBDYXJlZnVsIHBsYW5uaW5nIHJlcXVpcmVkPC90ZXh0Pgo8dGV4dCB4PSIzMjAiIHk9IjE0MCIgY2xhc3M9InJlYWxpdHkiIGZvbnQtc2l6ZT0iMTJweCI+SW50ZWdyYXRpb24gYW5kIGN1c3RvbWl6YXRpb24gZXNzZW50aWFsPC90ZXh0PgoKPCEtLSBNeXRoIDIgLS0+CjxyZWN0IHg9IjUwIiB5PSIxNzAiIHdpZHRoPSIyNDAiIGhlaWdodD0iNTAiIGZpbGw9IiNlZjQ0NDQiIG9wYWNpdHk9IjAuMiIgcng9IjUiLz4KPHRleHQgeD0iNjAiIHk9IjE5MCIgY2xhc3M9Im15dGgiIGZvbnQtd2VpZ2h0PSJib2xkIj5NWVRIOiBNb3JlIGRhdGEgPSBiZXR0ZXIgQUk8L3RleHQ+Cjx0ZXh0IHg9IjYwIiB5PSIyMTAiIGNsYXNzPSJteXRoIiBmb250LXNpemU9IjEycHgiPlRocm93IGFsbCBkYXRhIGF0IGl0PC90ZXh0PgoKPHJlY3QgeD0iMzEwIiB5PSIxNzAiIHdpZHRoPSIyNDAiIGhlaWdodD0iNTAiIGZpbGw9IiMxMGI5ODEiIG9wYWNpdHk9IjAuMiIgcng9IjUiLz4KPHRleHQgeD0iMzIwIiB5PSIxOTAiIGNsYXNzPSJyZWFsaXR5IiBmb250LXdlaWdodD0iYm9sZCI+UkVBTElUWTogUXVhbGl0eSBiZWF0cyBxdWFudGl0eTwvdGV4dD4KPHRleHQgeD0iMzIwIiB5PSIyMTAiIGNsYXNzPSJyZWFsaXR5IiBmb250LXNpemU9IjEycHgiPkNsZWFuLCByZWxldmFudCBkYXRhIGlzIGtleTwvdGV4dD4KCjwhLS0gTXl0aCAzIC0tPgo8cmVjdCB4PSI1MCIgeT0iMjQwIiB3aWR0aD0iMjQwIiBoZWlnaHQ9IjUwIiBmaWxsPSIjZWY0NDQ0IiBvcGFjaXR5PSIwLjIiIHJ4PSI1Ii8+Cjx0ZXh0IHg9IjYwIiB5PSIyNjAiIGNsYXNzPSJteXRoIiBmb250LXdlaWdodD0iYm9sZCI+TVlUSDogQUkgd2lsbCBzb2x2ZSBldmVyeXRoaW5nPC90ZXh0Pgo8dGV4dCB4PSI2MCIgeT0iMjgwIiBjbGFzcz0ibXl0aCIgZm9udC1zaXplPSIxMnB4Ij5PbmUgc29sdXRpb24gZm9yIGFsbCBwcm9ibGVtczwvdGV4dD4KCjxyZWN0IHg9IjMxMCIgeT0iMjQwIiB3aWR0aD0iMjQwIiBoZWlnaHQ9IjUwIiBmaWxsPSIjMTBiOTgxIiBvcGFjaXR5PSIwLjIiIHJ4PSI1Ii8+Cjx0ZXh0IHg9IjMyMCIgeT0iMjYwIiBjbGFzcz0icmVhbGl0eSIgZm9udC13ZWlnaHQ9ImJvbGQiPlJFQUxJVFk6IFNwZWNpZmljIHByb2JsZW1zIG9ubHk8L3RleHQ+Cjx0ZXh0IHg9IjMyMCIgeT0iMjgwIiBjbGFzcz0icmVhbGl0eSIgZm9udC1zaXplPSIxMnB4Ij5UYXJnZXRlZCBzb2x1dGlvbnMgd29yayBiZXN0PC90ZXh0PgoKPCEtLSBWUyBEaXZpZGVyIC0tPgo8dGV4dCB4PSIzMDAiIHk9IjEzMCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMThweCIgZm9udC13ZWlnaHQ9ImJvbGQiIGZpbGw9IiNmZmYiPlZTPC90ZXh0Pgo8dGV4dCB4PSIzMDAiIHk9IjIwMCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMThweCIgZm9udC13ZWlnaHQ9ImJvbGQiIGZpbGw9IiNmZmYiPlZTPC90ZXh0Pgo8dGV4dCB4PSIzMDAiIHk9IjI3MCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMThweCIgZm9udC13ZWlnaHQ9ImJvbGQiIGZpbGw9IiNmZmYiPlZTPC90ZXh0PgoKPHRleHQgeD0iMzAwIiB5PSIzNDAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGNsYXNzPSJzdWJ0aXRsZSI+QWdlbnRpYyBJbnRlbGxpZ2VuY2UgLSBTZXR0aW5nIFJlYWxpc3RpYyBFeHBlY3RhdGlvbnM8L3RleHQ+Cjx0ZXh0IHg9IjMwMCIgeT0iMzY1IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBjbGFzcz0ic3VidGl0bGUiIGZvbnQtc2l6ZT0iMTJweCWKJQkFJRGlnaXRhbFRyYW5zZm9ybWF0aW9uICNUZWNoVHJ1dGg8L3RleHQ+Cjwvc3ZnPg=='
                },
                alternatives: [
                    { 
                        type: 'Animated GIF', 
                        description: 'Myth-busting sequence with explosions', 
                        url: 'https://media.giphy.com/media/3o84sw9CmwYpAnRRni/giphy.gif'
                    },
                    { 
                        type: 'Video Series', 
                        description: 'Quick myth-busting video clips', 
                        url: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDMwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIzMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjMWUyOTNiIi8+CjxjaXJjbGUgY3g9IjE1MCIgY3k9IjEwMCIgcj0iMzAiIGZpbGw9IiNlZjQ0NDQiLz4KPHBvbHlnb24gcG9pbnRzPSIxNDAsODUgMTQwLDExNSAxNjUsMTAwIiBmaWxsPSJ3aGl0ZSIvPgo8dGV4dCB4PSIxNTAiIHk9IjE2MCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTRweCIgZmlsbD0id2hpdGUiPkFJIE15dGhidXN0ZXJzPC90ZXh0Pgo8dGV4dCB4PSIxNTAiIHk9IjE4MCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTJweCIgZmlsbD0iI2FhYSI+NSBwYXJ0IHNlcmllczwvdGV4dD4KPC9zdmc+'
                    },
                    { 
                        type: 'Carousel Post', 
                        description: '5-slide interactive breakdown', 
                        url: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDMwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIzMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjMWUyOTNiIi8+Cjx0ZXh0IHg9IjE1MCIgeT0iMzAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0cHgiIGZvbnQtd2VpZ2h0PSJib2xkIiBmaWxsPSJ3aGl0ZSI+QUkgTXl0aHMgQ2Fyb3VzZWw8L3RleHQ+CjxyZWN0IHg9IjUwIiB5PSI1MCIgd2lkdGg9IjQwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iIzNiODJmNiIgcng9IjUiLz4KPHJlY3QgeD0iMTAwIiB5PSI1MCIgd2lkdGg9IjQwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iIzhiNWNmNiIgcng9IjUiLz4KPHJlY3QgeD0iMTUwIiB5PSI1MCIgd2lkdGg9IjQwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iIzEwYjk4MSIgcng9IjUiLz4KPHJlY3QgeD0iMjAwIiB5PSI1MCIgd2lkdGg9IjQwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iI2Y1OWUwYiIgcng9IjUiLz4KPHJlY3QgeD0iMjUwIiB5PSI1MCIgd2lkdGg9IjQwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iI2VmNDQ0NCIgcng9IjUiLz4KPHRleHQgeD0iNzAiIHk9IjE3MCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTBweCIgZmlsbD0id2hpdGUiPjE8L3RleHQ+Cjx0ZXh0IHg9IjEyMCIgeT0iMTcwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LWZhbWlseTpb3Zhbnmtzc2VyaWYiIGZvbnQtc2l6ZT0iMTBweCIgZmlsbD0id2hpdGUiPjI8L3RleHQ+Cjx0ZXh0IHg9IjE3MCIgeT0iMTcwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LWZhbWlseTpic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMHB4IiBmaWxsPSJ3aGl0ZSI+MzwvdGV4dD4KPHRleHQgeD0iMjIwIiB5PSIxNzAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEwcHgiIGZpbGw9IndoaXRlIj40PC90ZXh0Pgo8dGV4dCB4PSIyNzAiIHk9IjE3MCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTBweCIgZmlsbD0id2hpdGUiPjU8L3RleHQ+CjwvcKIbhLJJjdudyYE3gKPc3ZnPg=='
                    }
                ]
            }
        };

        const contentTemplates = {
            'ai-readiness': {
                'business-leaders': {
                    'educational': `üéØ **Is Your Business Ready for AI? A Quick Assessment**

Many business leaders ask me: "How do I know if we're ready for AI?" Here's a simple framework:

‚úÖ **Data Foundation**
Do you have organized, accessible data? AI needs quality data to deliver results.

‚úÖ **Clear Business Goals** 
Can you identify specific problems AI could solve? Start with pain points, not technology.

‚úÖ **Change Management**
Is your team open to new processes? AI success requires cultural adaptation.

‚úÖ **Realistic Expectations**
Do you understand AI capabilities and limitations? Avoid the "magic solution" trap.

The gap between business knowledge and AI isn't technical‚Äîit's strategic. We help bridge that gap with practical, results-driven approaches.

Ready to assess your AI readiness? Let's discuss your specific situation.

#AI #BusinessStrategy #DigitalTransformation #Leadership`
                }
            },
            'roi-ai': {
                'business-leaders': {
                    'educational': `üí∞ **The Real Truth About AI ROI (It's Not What You Think)**

Most businesses calculate AI ROI wrong. They focus on cost savings instead of value creation.

üîç **Traditional Thinking:**
"AI will reduce our labor costs by 30%"

üöÄ **Strategic Thinking:**
"AI will help us serve customers 3x faster while improving quality"

**Real ROI Sources:**
‚Ä¢ Faster decision-making = competitive advantage
‚Ä¢ Better customer insights = increased revenue
‚Ä¢ Process optimization = capacity without growth costs
‚Ä¢ Risk reduction = avoided losses

The biggest gap in business-AI understanding? Thinking AI is about replacing humans instead of amplifying human capabilities.

At Agentic Intelligence, we help you identify the right ROI metrics and build AI solutions that deliver measurable business value.

What's your biggest business challenge that technology might solve?

#ROI #AI #BusinessValue #Innovation`
                }
            },
            'ai-misconceptions': {
                'business-leaders': {
                    'educational': `ü§ñ **5 AI Myths That Cost Businesses Millions**

After working with dozens of companies, I see the same misconceptions repeatedly:

**Myth 1:** "AI is plug-and-play"
**Reality:** Successful AI requires careful planning and integration

**Myth 2:** "More data always means better AI"
**Reality:** Quality beats quantity every time

**Myth 3:** "AI will solve all our problems"
**Reality:** AI solves specific, well-defined problems exceptionally well

**Myth 4:** "AI is only for tech companies"
**Reality:** Every industry can benefit from targeted AI solutions

**Myth 5:** "AI implementation takes years"
**Reality:** With the right approach, you can see results in months

The gap between business expectations and AI reality is where projects fail. We specialize in setting realistic expectations and delivering practical AI solutions.

Which myth has your organization encountered?

#AI #BusinessMyths #DigitalTransformation #TechTruth`
                }
            }
        };

        function showTab(tabName) {
            console.log('üîÑ showTab() called with:', tabName);
            
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // Remove active state from all tabs
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('text-aifluence-400', 'border-b-2', 'border-aifluence-400', 'bg-hootsuite-panel/80');
                btn.classList.add('text-hootsuite-text-muted', 'hover:text-hootsuite-text', 'hover:bg-hootsuite-panel/50');
            });
            
            // Show selected tab content
            const targetContent = document.getElementById('content-' + tabName);
            console.log('üéØ Target content element:', targetContent ? 'found' : 'NOT FOUND');
            if (targetContent) {
                targetContent.classList.remove('hidden');
            }
            
            // Add active state to selected tab
            const activeTab = document.getElementById('tab-' + tabName);
            console.log('üéØ Active tab element:', activeTab ? 'found' : 'NOT FOUND');
            if (activeTab) {
                activeTab.classList.remove('text-hootsuite-text-muted', 'hover:text-hootsuite-text', 'hover:bg-hootsuite-panel/50');
                activeTab.classList.add('text-aifluence-400', 'border-b-2', 'border-aifluence-400', 'bg-hootsuite-panel/80');
            }
            
            // Load data for specific tabs
            if (tabName === 'settings') {
                console.log('üîß Settings tab detected - calling loadSettingsData()');
                if (typeof loadSettingsData === 'function') {
                    loadSettingsData();
                } else {
                    console.error('‚ùå loadSettingsData function not found!');
                }
            }
        }

        function selectTopic(topic) {
            selectedTopic = topic;
            document.querySelectorAll('.topic-btn').forEach(btn => {
                btn.classList.remove('bg-blue-500/20', 'border-blue-500/30', 'text-blue-400');
                btn.classList.add('bg-slate-700/50', 'border-slate-600', 'text-slate-300');
            });
            const topicElement = document.querySelector(`[data-topic="${topic}"]`);
            if (topicElement) {
                topicElement.classList.remove('bg-slate-700/50', 'border-slate-600', 'text-slate-300');
                topicElement.classList.add('bg-blue-500/20', 'border-blue-500/30', 'text-blue-400');
            }
        }

        function selectAudience(audience) {
            selectedAudience = audience;
            document.querySelectorAll('.audience-btn').forEach(btn => {
                btn.classList.remove('bg-purple-500/20', 'border-purple-500/30', 'text-purple-300');
                btn.classList.add('bg-slate-700/50', 'border-slate-600', 'text-slate-300');
            });
            const audienceElement = document.querySelector(`[data-audience="${audience}"]`);
            if (audienceElement) {
                audienceElement.classList.remove('bg-slate-700/50', 'border-slate-600', 'text-slate-300');
                audienceElement.classList.add('bg-purple-500/20', 'border-purple-500/30', 'text-purple-300');
            }
        }

        function selectTone(tone) {
            selectedTone = tone;
            document.querySelectorAll('.tone-btn').forEach(btn => {
                btn.classList.remove('bg-green-500/20', 'border-green-500/30', 'text-green-300');
                btn.classList.add('bg-slate-700/50', 'border-slate-600', 'text-slate-300');
            });
            const toneElement = document.querySelector(`[data-tone="${tone}"]`);
            if (toneElement) {
                toneElement.classList.remove('bg-slate-700/50', 'border-slate-600', 'text-slate-300');
                toneElement.classList.add('bg-green-500/20', 'border-green-500/30', 'text-green-300');
            }
        }

        function selectMediaType(mediaType) {
            const selectedBtn = document.querySelector(`[data-media="${mediaType}"]`);
            
            // Don't allow selection of disabled buttons
            if (selectedBtn && selectedBtn.disabled) {
                return;
            }
            
            selectedMediaType = mediaType;
            document.querySelectorAll('.media-type-btn').forEach(btn => {
                btn.classList.remove('bg-orange-500/20', 'border-orange-500/30', 'text-orange-300');
                btn.classList.add('bg-slate-700/50', 'border-slate-600', 'text-slate-300');
            });
            
            if (selectedBtn) {
                selectedBtn.classList.remove('bg-slate-700/50', 'border-slate-600', 'text-slate-300');
                selectedBtn.classList.add('bg-orange-500/20', 'border-orange-500/30', 'text-orange-300');
            }
        }

        async function generateContent() {
            // Get custom inputs
            const inputs = getCustomInputs();
            
            console.log('üîç Checking inputs validity:', inputs);
            
            if (!inputs.topic || inputs.topic.trim().length === 0) {
                alert('Please describe your content topic first');
                return;
            }

            // Check usage limits
            if (!checkUsageLimit('posts')) {
                showUpgradePrompt('posts');
                return;
            }

            const btn = document.getElementById('generate-btn');
            btn.innerHTML = '<div class="flex items-center space-x-2"><svg class="h-4 w-4 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg><span>Generating AI Content...</span></div>';
            btn.disabled = true;

            try {
                let content;
                
                // Debug logging
                console.log('=== generateContent() Debug Info ===');
                console.log('Custom inputs:', inputs);
                console.log('CLAUDE_API_KEY exists:', !!CLAUDE_API_KEY);
                console.log('CLAUDE_API_KEY value (first 10 chars):', CLAUDE_API_KEY ? CLAUDE_API_KEY.substring(0, 10) + '...' : 'null');
                
                // Try Ollama first, then Claude, then fallback to templates
                try {
                    console.log('üîÑ Attempting to use Ollama (local LLM)...');
                    console.log('üìã Topic being sent to Ollama:', inputs.topic);
                    content = await generateContentWithOllama(inputs.topic, inputs.audience, inputs.tone);
                    console.log('‚úÖ‚úÖ‚úÖ OLLAMA SUCCESS - USING AI GENERATED CONTENT ‚úÖ‚úÖ‚úÖ');
                    console.log('üìù Ollama generated content length:', content ? content.length : 0);
                    console.log('üìù First 200 chars of Ollama content:', content ? content.substring(0, 200) + '...' : 'null/empty');
                } catch (ollamaError) {
                    console.log('‚ùå‚ùå‚ùå OLLAMA FAILED - Trying Claude API next... ‚ùå‚ùå‚ùå', ollamaError.message);
                    console.log('üîç Ollama error details:', ollamaError);
                    
                    if (CLAUDE_API_KEY && CLAUDE_API_KEY.startsWith('sk-ant-')) {
                        try {
                            console.log('‚úÖ Using Claude for content generation');
                            content = await generateContentWithClaude(inputs.topic, inputs.audience, inputs.tone);
                        } catch (claudeError) {
                            console.log('‚ùå‚ùå‚ùå CLAUDE FAILED - USING TEMPLATE FALLBACK ‚ùå‚ùå‚ùå', claudeError.message);
                            content = generateCustomFallbackContent(inputs);
                            console.log('üîÑ Generated fallback template content for topic:', inputs.topic);
                        }
                    } else {
                        console.log('‚ùå‚ùå‚ùå NO CLAUDE API KEY - USING TEMPLATE FALLBACK ‚ùå‚ùå‚ùå');
                        content = generateCustomFallbackContent(inputs);
                        console.log('üîÑ Generated fallback template content for topic:', inputs.topic);
                    }
                }
                
                // If no content was generated, use default
                if (!content) {
                    console.log('‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è NO CONTENT AT ALL - USING DEFAULT FALLBACK ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è');
                    content = getDefaultContent();
                } else {
                    console.log('‚úÖ Content successfully generated, length:', content.length);
                }
                
                function generateCustomFallbackContent(inputs) {
                    return `üöÄ **${inputs.topic}**

For ${inputs.audience}, understanding ${inputs.topic.toLowerCase()} is crucial for staying competitive in today's rapidly evolving business landscape.

Key considerations include:
‚Ä¢ Identifying the right opportunities and use cases
‚Ä¢ Building the necessary capabilities and infrastructure  
‚Ä¢ Managing organizational change and adoption
‚Ä¢ Measuring success and continuous improvement

At Agentic Intelligence, we help organizations navigate these challenges with a ${inputs.tone.toLowerCase()} approach that delivers real results.

Our methodology focuses on:
1. Understanding your specific business context
2. Developing tailored strategies and solutions
3. Supporting implementation and change management
4. Ensuring sustainable long-term success

Ready to transform your approach to ${inputs.topic.toLowerCase()}? Let's discuss how we can help.

#AI #BusinessStrategy #Innovation #DigitalTransformation #${inputs.topic.replace(/\s+/g, '')}`;
                }
                
                function getDefaultContent() {
                    return `üöÄ **Bridging the Business-AI Gap**

The biggest challenge in AI adoption isn't technical‚Äîit's the gap between business needs and AI capabilities.

Most companies struggle with:
‚Ä¢ Understanding where AI fits in their operations
‚Ä¢ Setting realistic expectations for AI outcomes
‚Ä¢ Building the right data foundation
‚Ä¢ Managing change and training teams

At Agentic Intelligence, we specialize in translating business challenges into AI solutions that work.

Our approach:
1. Assess your current state and readiness
2. Identify high-impact AI opportunities
3. Develop practical implementation roadmaps
4. Support you through deployment and optimization

Ready to bridge the gap? Let's discuss your specific challenges.

#AI #BusinessStrategy #DigitalTransformation #Innovation`;
                }

                console.log('üéØüéØüéØ FINAL CONTENT BEING DISPLAYED üéØüéØüéØ');
                console.log('Content source: Check above for ‚úÖ‚úÖ‚úÖ OLLAMA SUCCESS or ‚ùå‚ùå‚ùå FALLBACK messages');
                console.log('First 200 chars:', content ? content.substring(0, 200) + '...' : 'null/empty');
                document.getElementById('content-text').textContent = content;
                document.getElementById('char-count').textContent = `Character count: ${content.length}`;
                document.getElementById('generated-content').classList.remove('hidden');
                
                // Increment usage counter
                incrementUsage('posts');

                // Automatically generate media based on selected type
                setTimeout(() => {
                    generateMediaBasedOnSelection();
                }, 500);

            } catch (error) {
                console.error('Content generation failed:', error);
                alert('Content generation failed. Please check your Claude API key or try again.');
            }

            btn.innerHTML = '<div class="flex items-center space-x-2"><svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 7.172V5L8 4z"></path></svg><span>Generate LinkedIn Post</span></div>';
            btn.disabled = false;
        }

        function generateMediaBasedOnSelection() {
            // Get custom inputs for media generation
            const inputs = getCustomInputs();
            
            // Use a fallback topic if custom topic doesn't match templates
            const topicForMedia = mediaTemplates[inputs.topic] ? inputs.topic : 'AI Transformation';
            
            const mediaData = mediaTemplates[topicForMedia];
            if (!mediaData) return;

            // Show media section
            document.getElementById('media-section').classList.remove('hidden');

            let selectedMedia;
            
            // Select media based on user's choice
            switch (selectedMediaType) {
                case 'ai-infographic':
                    selectedMedia = mediaData.primary;
                    break;
                case 'animated-gif':
                    selectedMedia = mediaData.alternatives.find(alt => alt.type.toLowerCase().includes('gif')) || mediaData.alternatives[0];
                    break;
                case 'business-meme':
                    selectedMedia = mediaData.alternatives.find(alt => alt.type.toLowerCase().includes('meme')) || mediaData.alternatives[1];
                    break;
                case 'personal-ai':
                    if ((modelTrainingComplete && personalModelEnabled) || demoMode) {
                        selectedMedia = {
                            type: 'Personal AI Generated',
                            description: 'AI-generated image featuring your professional headshot',
                            url: generatePersonalAIImageForContent(selectedTopic)
                        };
                    } else {
                        // Show message that Personal AI isn't ready and fallback to AI Infographic
                        alert('Personal AI model is not ready yet. Please upload profile pictures first. Using AI Infographic instead.');
                        selectedMediaType = 'ai-infographic';
                        selectMediaType('ai-infographic');
                        selectedMedia = mediaData.primary;
                    }
                    break;
                default:
                    selectedMedia = mediaData.primary;
            }

            // Display selected media
            if (selectedMedia) {
                document.getElementById('media-type').textContent = selectedMedia.type;
                document.getElementById('visual-description').textContent = selectedMedia.description || selectedMedia.prompt || '';
                
                const primaryVisual = document.getElementById('primary-visual');
                primaryVisual.innerHTML = `<img src="${selectedMedia.url}" alt="${selectedMedia.description}" class="w-full h-auto rounded-lg border border-slate-600">`;
            }

            // Show alternative options (excluding the selected one)
            const alternativeOptions = document.getElementById('alternative-options');
            const otherOptions = [mediaData.primary, ...mediaData.alternatives].filter(option => 
                option.type !== selectedMedia.type
            );

            alternativeOptions.innerHTML = otherOptions.slice(0, 3).map((alt, index) => `
                <div class="flex items-center justify-between p-2 bg-slate-800/50 rounded border border-slate-600 hover:border-slate-500 transition-colors cursor-pointer" onclick="switchToAlternative('${alt.type}', '${alt.url}', '${alt.description || alt.prompt || ''}')">
                    <div class="flex items-center space-x-3">
                        <img src="${alt.url}" alt="${alt.description}" class="w-12 h-8 object-cover rounded border border-slate-600">
                        <div>
                            <div class="text-xs font-medium text-slate-300">${alt.type}</div>
                            <div class="text-xs text-slate-500">${alt.description || alt.prompt || ''}</div>
                        </div>
                    </div>
                    <svg class="h-4 w-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                    </svg>
                </div>
            `).join('');
        }

        function switchToAlternative(type, url, description) {
            document.getElementById('media-type').textContent = type;
            document.getElementById('visual-description').textContent = description;
            
            const primaryVisual = document.getElementById('primary-visual');
            primaryVisual.innerHTML = `<img src="${url}" alt="${description}" class="w-full h-auto rounded-lg border border-slate-600">`;
        }

        function copyContent() {
            const content = document.getElementById('content-text').textContent;
            navigator.clipboard.writeText(content).then(() => {
                const btn = event.target.closest('button');
                const originalText = btn.innerHTML;
                btn.innerHTML = '<div class="flex items-center space-x-2"><svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg><span>Copied!</span></div>';
                setTimeout(() => {
                    btn.innerHTML = originalText;
                }, 2000);
            });
        }

        // Removed duplicate connectLinkedIn function - using the one defined later in the script

        async function regenerateMedia() {
            // Get current inputs
            const inputs = getCustomInputs();
            
            if (!inputs.topic || inputs.topic.trim().length === 0) {
                alert('Please enter a topic first');
                return;
            }

            // Check usage limits
            if (!checkUsageLimit('posts')) {
                showUpgradePrompt('posts');
                return;
            }

            const btn = event.target.closest('button');
            const originalHTML = btn.innerHTML;
            btn.innerHTML = '<div class="flex items-center space-x-2"><svg class="h-4 w-4 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg><span>Regenerating...</span></div>';
            btn.disabled = true;

            try {
                let content;
                
                console.log('üîÑ Regenerating content with variation...');
                
                // Add variation to the prompt by including a randomization instruction
                const variationPrompts = [
                    "Focus on the unexpected challenges or obstacles related to this topic.",
                    "Write from a contrarian perspective - what's the counterintuitive take?",
                    "Share a personal anecdote or story-based approach to this topic.",
                    "Focus on future trends and predictions related to this topic.",
                    "Highlight common mistakes or pitfalls people make with this topic.",
                    "Take a data-driven or statistical approach to this topic.",
                    "Write about the historical evolution or background of this topic.",
                    "Focus on practical, actionable steps people can take today.",
                    "Discuss the psychological or emotional aspects of this topic.",
                    "Compare this topic to something completely unrelated but insightful.",
                    "Write about the hidden costs or underestimated benefits of this topic.",
                    "Take a beginner's perspective - explain it simply and clearly."
                ];
                const randomVariation = variationPrompts[Math.floor(Math.random() * variationPrompts.length)];
                
                // Try Ollama first with variation
                try {
                    content = await generateContentWithOllamaVariation(inputs.topic, inputs.audience, inputs.tone, randomVariation);
                    console.log('‚úÖ Regenerated content with Ollama');
                } catch (ollamaError) {
                    console.log('‚ùå Ollama failed, using fallback templates');
                    content = generateCustomFallbackContent(inputs);
                }

                // Update the content
                document.getElementById('content-text').textContent = content;
                document.getElementById('char-count').textContent = `Character count: ${content.length}`;
                
                // Increment usage counter
                incrementUsage('posts');

                // Also regenerate media
                setTimeout(() => {
                    generateMediaBasedOnSelection();
                }, 500);

            } catch (error) {
                console.error('Content regeneration failed:', error);
                alert('Failed to regenerate content. Please try again.');
            }

            btn.innerHTML = originalHTML;
            btn.disabled = false;
        }

        function selectAlternative(topic, index) {
            const mediaData = mediaTemplates[topic];
            const alternative = mediaData.alternatives[index];
            
            // Update primary visual with selected alternative
            document.getElementById('media-type').textContent = alternative.type;
            document.getElementById('primary-visual').innerHTML = `
                <img src="${alternative.url}" alt="${alternative.description}" class="w-full h-48 object-cover rounded-lg border border-slate-600">
            `;
            document.getElementById('visual-description').textContent = alternative.description;

            // Visual feedback for selection
            const alternativeElements = document.querySelectorAll('#alternative-options > div');
            alternativeElements.forEach((el, i) => {
                if (i === index) {
                    el.classList.add('border-blue-500', 'bg-blue-500/10');
                    el.classList.remove('border-slate-600');
                } else {
                    el.classList.remove('border-blue-500', 'bg-blue-500/10');
                    el.classList.add('border-slate-600');
                }
            });
        }

        function copyContent() {
            const content = document.getElementById('content-text').textContent;
            const mediaSection = document.getElementById('media-section');
            let fullContent = content;
            
            if (!mediaSection.classList.contains('hidden')) {
                const mediaType = document.getElementById('media-type').textContent;
                const mediaDescription = document.getElementById('visual-description').textContent;
                fullContent += `\n\n[${mediaType}: ${mediaDescription}]`;
            }

            navigator.clipboard.writeText(fullContent).then(() => {
                const btn = event.target.closest('button');
                const originalText = btn.innerHTML;
                btn.innerHTML = '<div class="flex items-center space-x-2"><svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg><span>Copied!</span></div>';
                setTimeout(() => {
                    btn.innerHTML = originalText;
                }, 2000);
            });
        }

        // Global variables for post management
        let currentPost = null;
        if (typeof scheduledPosts === 'undefined') {
            var scheduledPosts = JSON.parse(localStorage.getItem('scheduledPosts') || '[]');
        }

        // Optimal posting times for LinkedIn (weekdays, business hours)
        const optimalPostingTimes = [
            { day: 1, hour: 9, minute: 0 },   // Monday 9:00 AM
            { day: 1, hour: 12, minute: 30 }, // Monday 12:30 PM
            { day: 2, hour: 9, minute: 0 },   // Tuesday 9:00 AM
            { day: 2, hour: 14, minute: 0 },  // Tuesday 2:00 PM
            { day: 3, hour: 10, minute: 0 },  // Wednesday 10:00 AM
            { day: 3, hour: 13, minute: 0 },  // Wednesday 1:00 PM
            { day: 4, hour: 9, minute: 30 },  // Thursday 9:30 AM
            { day: 4, hour: 12, minute: 0 },  // Thursday 12:00 PM
            { day: 5, hour: 9, minute: 0 },   // Friday 9:00 AM
            { day: 5, hour: 11, minute: 30 }  // Friday 11:30 AM
        ];

        function getNextOptimalPostingTime() {
            const now = new Date();
            let nextTime = new Date(now);
            
            // Start from tomorrow if current time is past business hours
            if (now.getHours() >= 17) {
                nextTime.setDate(nextTime.getDate() + 1);
                nextTime.setHours(9, 0, 0, 0);
            }
            
            // Find next available optimal time
            while (true) {
                const dayOfWeek = nextTime.getDay();
                
                // Skip weekends
                if (dayOfWeek === 0 || dayOfWeek === 6) {
                    nextTime.setDate(nextTime.getDate() + 1);
                    nextTime.setHours(9, 0, 0, 0);
                    continue;
                }
                
                // Find optimal times for this day
                const todayTimes = optimalPostingTimes.filter(time => time.day === dayOfWeek);
                
                for (const time of todayTimes) {
                    const candidate = new Date(nextTime);
                    candidate.setHours(time.hour, time.minute, 0, 0);
                    
                    // Check if this time is in the future and not already taken
                    if (candidate > now && !isTimeSlotTaken(candidate)) {
                        return candidate;
                    }
                }
                
                // No available times today, try tomorrow
                nextTime.setDate(nextTime.getDate() + 1);
                nextTime.setHours(9, 0, 0, 0);
            }
        }

        function isTimeSlotTaken(targetTime) {
            return scheduledPosts.some(post => {
                const postTime = new Date(post.scheduledTime);
                return Math.abs(postTime.getTime() - targetTime.getTime()) < 30 * 60 * 1000; // 30 min buffer
            });
        }

        // Post management functions
        function schedulePost() {
            const content = document.getElementById('content-text').textContent;
            if (!content) {
                alert('Please generate content first');
                return;
            }

            // Get custom inputs for the current post
            const inputs = getCustomInputs();
            
            // Auto-schedule at optimal time
            const scheduledTime = getNextOptimalPostingTime();
            
            const newPost = {
                id: Date.now().toString(),
                content: content,
                scheduledTime: scheduledTime.toISOString(),
                hasMedia: !document.getElementById('media-section').classList.contains('hidden'),
                mediaType: document.getElementById('media-type')?.textContent || '',
                mediaDescription: document.getElementById('visual-description')?.textContent || '',
                topic: inputs.topic,
                audience: inputs.audience,
                tone: inputs.tone,
                status: 'scheduled',
                createdAt: new Date().toISOString()
            };

            // Add to queue
            scheduledPosts.push(newPost);
            saveScheduledPosts();
            updateSchedulerDisplay();
            
            // Show elegant success toast
            const timeString = `${scheduledTime.toLocaleDateString()} at ${scheduledTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}`;
            showSuccessToast(`‚úÖ Post scheduled for ${timeString}`, 5000);
            
            // Stay on current tab - don't automatically switch to scheduler
        }

        function loadScheduledPosts() {
            if (currentUser) {
                const userKey = `scheduledPosts_${currentUser.id}`;
                scheduledPosts = JSON.parse(localStorage.getItem(userKey) || '[]');
            } else {
                scheduledPosts = JSON.parse(localStorage.getItem('scheduledPosts') || '[]');
            }
            updateSchedulerDisplay();
        }

        function updateSchedulerDisplay() {
            const container = document.getElementById('scheduled-posts-container');
            if (!container) return;

            // Sort posts by scheduled time
            const sortedPosts = [...scheduledPosts].sort((a, b) => 
                new Date(a.scheduledTime) - new Date(b.scheduledTime)
            );

            if (sortedPosts.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-12 text-slate-400">
                        <svg class="h-12 w-12 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                        <p class="text-lg">No posts scheduled</p>
                        <p class="text-sm">Generate content and schedule posts to see them here</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = `
                <div class="mb-4 text-sm text-slate-400">
                    <strong>${sortedPosts.length}</strong> posts in queue ‚Ä¢ Drag to reorder ‚Ä¢ Click time to edit
                </div>
                <div id="posts-queue" class="space-y-3">
                    ${sortedPosts.map((post, index) => createPostCard(post, index)).join('')}
                </div>
            `;

            // Initialize drag and drop
            initializeDragAndDrop();
        }

        function createPostCard(post, index) {
            const postTime = new Date(post.scheduledTime);
            const now = new Date();
            const isUpcoming = postTime > now;
            const timeString = postTime.toLocaleDateString() + ' at ' + postTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            
            return `
                <div class="post-card bg-slate-800/50 rounded-xl p-4 border border-slate-700 cursor-move hover:border-slate-600 transition-colors" 
                     data-post-id="${post.id}" draggable="true">
                    <div class="flex items-start justify-between mb-3">
                        <div class="flex items-center space-x-3">
                            <div class="drag-handle p-1 text-slate-500 hover:text-slate-300 cursor-grab">
                                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8h16M4 16h16"></path>
                                </svg>
                            </div>
                            <div class="flex-1">
                                <div class="flex items-center space-x-2 mb-1">
                                    <span class="text-sm font-medium text-blue-400">#${index + 1}</span>
                                    <span class="text-xs px-2 py-1 bg-slate-700 rounded-full text-slate-300">${post.topic}</span>
                                    ${isUpcoming ? 
                                        '<span class="text-xs px-2 py-1 bg-green-600 rounded-full text-white">Scheduled</span>' :
                                        '<span class="text-xs px-2 py-1 bg-orange-600 rounded-full text-white">Past Due</span>'
                                    }
                                </div>
                                <div class="flex items-center space-x-2">
                                    <button onclick="editPostTime('${post.id}')" 
                                            class="text-sm text-slate-300 hover:text-white transition-colors flex items-center space-x-1">
                                        <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                        <span>${timeString}</span>
                                    </button>
                                    <button onclick="showEditTimeModal('${post.id}')" 
                                            class="p-1 text-slate-500 hover:text-blue-400 transition-colors" 
                                            title="Edit time">
                                        <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="flex items-center space-x-1">
                            <button onclick="postNow('${post.id}')" 
                                    class="px-3 py-1 bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white text-xs rounded-full transition-all duration-200 hover:scale-105 font-medium"
                                    title="Post immediately to LinkedIn">
                                üöÄ Post Now
                            </button>
                            <button onclick="deleteScheduledPost('${post.id}')" 
                                    class="p-1 text-slate-500 hover:text-red-400 transition-colors"
                                    title="Delete post">
                                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="text-sm text-slate-300 line-clamp-3 mb-3">
                        ${post.content.substring(0, 150)}${post.content.length > 150 ? '...' : ''}
                    </div>
                    ${post.hasMedia ? 
                        `<div class="flex items-center space-x-2 text-xs text-slate-400">
                            <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                            </svg>
                            <span>${post.mediaType}</span>
                        </div>` : ''
                    }
                </div>
            `;
        }

        function initializeDragAndDrop() {
            const postCards = document.querySelectorAll('.post-card');
            let draggedElement = null;

            postCards.forEach(card => {
                card.addEventListener('dragstart', function(e) {
                    draggedElement = this;
                    this.style.opacity = '0.5';
                    e.dataTransfer.effectAllowed = 'move';
                    e.dataTransfer.setData('text/html', this.outerHTML);
                });

                card.addEventListener('dragend', function(e) {
                    this.style.opacity = '';
                    draggedElement = null;
                });

                card.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'move';
                    
                    const afterElement = getDragAfterElement(this.parentNode, e.clientY);
                    if (afterElement == null) {
                        this.parentNode.appendChild(draggedElement);
                    } else {
                        this.parentNode.insertBefore(draggedElement, afterElement);
                    }
                });

                card.addEventListener('drop', function(e) {
                    e.preventDefault();
                    reorderPosts();
                });
            });
        }

        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.post-card:not(.dragging)')];
            
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        function reorderPosts() {
            const cards = document.querySelectorAll('.post-card');
            const newOrder = [];
            
            cards.forEach(card => {
                const postId = card.dataset.postId;
                const post = scheduledPosts.find(p => p.id === postId);
                if (post) {
                    newOrder.push(post);
                }
            });

            // Reassign optimal times based on new order
            newOrder.forEach((post, index) => {
                const baseTime = new Date();
                if (baseTime.getHours() >= 17) {
                    baseTime.setDate(baseTime.getDate() + 1);
                    baseTime.setHours(9, 0, 0, 0);
                }
                
                // Calculate new time based on position in queue
                const newTime = getOptimalTimeForPosition(index);
                post.scheduledTime = newTime.toISOString();
            });

            scheduledPosts = newOrder;
            saveScheduledPosts();
            updateSchedulerDisplay();
        }

        function getOptimalTimeForPosition(position) {
            const now = new Date();
            let currentTime = new Date(now);
            
            // Start from next business day if after hours
            if (currentTime.getHours() >= 17) {
                currentTime.setDate(currentTime.getDate() + 1);
                currentTime.setHours(9, 0, 0, 0);
            }

            // Calculate days needed for this position
            const positionsPerDay = 2; // 2 optimal times per day
            const daysToAdd = Math.floor(position / positionsPerDay);
            const timeSlotInDay = position % positionsPerDay;

            // Add days (skip weekends)
            for (let i = 0; i < daysToAdd; i++) {
                currentTime.setDate(currentTime.getDate() + 1);
                // Skip weekends
                while (currentTime.getDay() === 0 || currentTime.getDay() === 6) {
                    currentTime.setDate(currentTime.getDate() + 1);
                }
            }

            // Set time based on slot
            const dayTimes = optimalPostingTimes.filter(time => time.day === currentTime.getDay());
            if (dayTimes.length > timeSlotInDay) {
                const selectedTime = dayTimes[timeSlotInDay];
                currentTime.setHours(selectedTime.hour, selectedTime.minute, 0, 0);
            }

            return currentTime;
        }

        let currentEditingPostId = null;

        function editPostTime(postId) {
            const post = scheduledPosts.find(p => p.id === postId);
            if (!post) return;

            const currentTime = new Date(post.scheduledTime);
            const dateString = currentTime.toISOString().slice(0, 16); // Format for datetime-local input

            const newDateTime = prompt(`Edit scheduled time for this post:\n\nCurrent: ${currentTime.toLocaleDateString()} at ${currentTime.toLocaleTimeString()}\n\nEnter new date/time (YYYY-MM-DD HH:MM):`, dateString.replace('T', ' '));

            if (newDateTime && newDateTime !== dateString.replace('T', ' ')) {
                try {
                    const newTime = new Date(newDateTime.replace(' ', 'T'));
                    if (isNaN(newTime.getTime())) {
                        alert('Invalid date/time format. Please use: YYYY-MM-DD HH:MM');
                        return;
                    }

                    post.scheduledTime = newTime.toISOString();
                    saveScheduledPosts();
                    updateSchedulerDisplay();
                    
                    alert(`Post rescheduled for ${newTime.toLocaleDateString()} at ${newTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}`);
                } catch (error) {
                    alert('Invalid date/time format. Please use: YYYY-MM-DD HH:MM');
                }
            }
        }

        function showEditTimeModal(postId) {
            const post = scheduledPosts.find(p => p.id === postId);
            if (!post) return;

            currentEditingPostId = postId;
            
            // Populate modal with current post data
            const currentTime = new Date(post.scheduledTime);
            
            // Set post preview
            document.getElementById('edit-post-preview').textContent = post.content.substring(0, 100) + (post.content.length > 100 ? '...' : '');
            
            // Set current date and time values
            document.getElementById('edit-date-input').value = currentTime.toISOString().split('T')[0];
            document.getElementById('edit-time-input').value = currentTime.toTimeString().slice(0, 5);
            
            // Show modal
            document.getElementById('edit-time-modal').classList.remove('hidden');
        }

        function hideEditTimeModal() {
            document.getElementById('edit-time-modal').classList.add('hidden');
            currentEditingPostId = null;
        }

        function saveEditedTime() {
            if (!currentEditingPostId) return;

            const post = scheduledPosts.find(p => p.id === currentEditingPostId);
            if (!post) return;

            const dateValue = document.getElementById('edit-date-input').value;
            const timeValue = document.getElementById('edit-time-input').value;

            if (!dateValue || !timeValue) {
                alert('Please select both date and time');
                return;
            }

            try {
                const newDateTime = new Date(`${dateValue}T${timeValue}`);
                
                if (isNaN(newDateTime.getTime())) {
                    alert('Invalid date or time selected');
                    return;
                }

                // Check if the new time is in the past
                const now = new Date();
                if (newDateTime <= now) {
                    if (!confirm('This time is in the past. Are you sure you want to schedule it?')) {
                        return;
                    }
                }

                // Update the post
                post.scheduledTime = newDateTime.toISOString();
                saveScheduledPosts();
                updateSchedulerDisplay();
                hideEditTimeModal();

                // Show success message
                const timeString = newDateTime.toLocaleDateString() + ' at ' + newDateTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                showSuccessToast(`üìÖ Post rescheduled for ${timeString}`);

            } catch (error) {
                showErrorToast('Error updating schedule. Please try again.');
                console.error('Edit time error:', error);
            }
        }

        function deleteScheduledPost(postId) {
            if (confirm('Are you sure you want to delete this scheduled post?')) {
                scheduledPosts = scheduledPosts.filter(p => p.id !== postId);
                saveScheduledPosts();
                updateSchedulerDisplay();
            }
        }

        function postNow(postId) {
            const post = scheduledPosts.find(p => p.id === postId);
            if (!post) return;

            // Show confirmation with post preview
            const shortContent = post.content.substring(0, 100) + (post.content.length > 100 ? '...' : '');
            const confirmed = confirm(`üöÄ Post this content to LinkedIn right now?\n\n"${shortContent}"\n\nThis will publish immediately and remove it from your schedule.`);
            
            if (confirmed) {
                // Simulate posting process with loading state
                const button = document.querySelector(`button[onclick="postNow('${postId}')"]`);
                const originalText = button.innerHTML;
                
                // Show loading state
                button.innerHTML = '‚è≥ Posting...';
                button.disabled = true;
                button.classList.add('opacity-50');
                
                // Simulate API call delay
                setTimeout(() => {
                    // In a real implementation, this would call LinkedIn API
                    // For now, we'll simulate a successful post
                    
                    // Remove from scheduled posts
                    scheduledPosts = scheduledPosts.filter(p => p.id !== postId);
                    saveScheduledPosts();
                    updateSchedulerDisplay();
                    
                    // Show success notification
                    showSuccessToast(`üéâ Post published to LinkedIn successfully!`, 6000);
                    
                    // Add a fun celebration effect
                    showCelebrationToast();
                    
                }, 2000); // 2 second delay to simulate posting
            }
        }

        function showCelebrationToast() {
            // Show a fun celebration message
            setTimeout(() => {
                showInfoToast(`üéä Your content is now live and engaging your audience!`, 4000);
            }, 1000);
            
            // Optional: Add some confetti-like effect with multiple small toasts
            const celebrations = ['üéâ', '‚ú®', 'üöÄ', 'üí´', '‚≠ê'];
            celebrations.forEach((emoji, index) => {
                setTimeout(() => {
                    const toastId = showToast(`${emoji}`, 'success', 1500);
                    // Position these celebration toasts slightly randomly
                    const toastElement = document.getElementById(toastId);
                    if (toastElement) {
                        toastElement.style.transform = `translateX(${(index - 2) * 20}px)`;
                    }
                }, index * 200);
            });
        }

        function quickSchedule() {
            const content = document.getElementById('content-text').textContent;
            if (!content) {
                showErrorToast('Please generate content first');
                return;
            }

            // Show confirmation for immediate posting
            const shortContent = content.substring(0, 100) + (content.length > 100 ? '...' : '');
            const confirmed = confirm(`üöÄ Post this content to LinkedIn right now?\n\n"${shortContent}"\n\nThis will publish immediately!`);
            
            if (confirmed) {
                // Get the button and show loading state
                const button = event.target.closest('button');
                const originalText = button.innerHTML;
                
                // Show loading state
                button.innerHTML = '<div class="flex items-center space-x-2"><svg class="h-4 w-4 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg><span>Posting...</span></div>';
                button.disabled = true;
                
                // Simulate posting process
                setTimeout(() => {
                    // In a real implementation, this would call LinkedIn API
                    
                    // Restore button
                    button.innerHTML = originalText;
                    button.disabled = false;
                    
                    // Show success notification
                    showSuccessToast(`üéâ Post published to LinkedIn successfully!`, 6000);
                    
                    // Add celebration effect
                    showCelebrationToast();
                    
                    // Increment usage counter
                    incrementUsage('posts');
                    
                }, 2000); // 2 second delay to simulate posting
            }
        }

        function editCurrentPost() {
            const content = document.getElementById('content-text').textContent;
            if (!content) {
                alert('Please generate content first');
                return;
            }
            document.getElementById('edit-content').value = content;
            showEditModal();
        }

        function createNewPost() {
            // Reset all selections and content
            document.getElementById('generated-content').classList.add('hidden');
            document.getElementById('media-section').classList.add('hidden');
            updatePostStatus('Ready to create new content');
            
            // Reset topic selection (optional - you might want to keep current selections)
            // selectTopic('ai-readiness');
            // selectAudience('business-leaders');
            // selectTone('educational');
        }

        // Modal functions
        function showScheduleModal() {
            // Set minimum date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('schedule-date').min = today;
            document.getElementById('schedule-date').value = today;
            
            document.getElementById('schedule-modal').classList.remove('hidden');
        }

        function hideScheduleModal() {
            document.getElementById('schedule-modal').classList.add('hidden');
        }

        function showEditModal() {
            document.getElementById('edit-modal').classList.remove('hidden');
        }

        function hideEditModal() {
            document.getElementById('edit-modal').classList.add('hidden');
        }

        function confirmSchedule() {
            const date = document.getElementById('schedule-date').value;
            const time = document.getElementById('schedule-time').value;
            const platform = document.getElementById('schedule-platform').value;

            if (!date) {
                alert('Please select a date');
                return;
            }

            const newPost = {
                id: Date.now(),
                content: currentPost.content,
                date: date,
                time: time,
                platform: platform,
                status: 'scheduled',
                topic: currentPost.topic,
                hasMedia: currentPost.hasMedia,
                mediaType: currentPost.mediaType,
                mediaDescription: currentPost.mediaDescription
            };

            scheduledPosts.push(newPost);
            hideScheduleModal();
            
            const scheduleDate = new Date(`${date}T${time}`);
            updatePostStatus(`Post scheduled for ${scheduleDate.toLocaleDateString()} at ${scheduleDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}`);
            updateScheduledPostsDisplay();

            // Show success message
            setTimeout(() => {
                updatePostStatus('Ready to post to LinkedIn with visual content');
            }, 5000);
        }

        function saveEditedPost() {
            const editedContent = document.getElementById('edit-content').value;
            if (!editedContent.trim()) {
                alert('Content cannot be empty');
                return;
            }

            document.getElementById('content-text').textContent = editedContent;
            document.getElementById('char-count').textContent = `Character count: ${editedContent.length}`;
            hideEditModal();
            updatePostStatus('Post content updated');

            setTimeout(() => {
                updatePostStatus('Ready to post to LinkedIn with visual content');
            }, 2000);
        }

        function updatePostStatus(message) {
            document.getElementById('post-status').textContent = message;
        }

        function updateScheduledPostsDisplay() {
            const container = document.getElementById('scheduled-posts-container');
            
            if (scheduledPosts.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-12 bg-slate-800/30 rounded-xl border border-slate-700">
                        <svg class="h-12 w-12 text-slate-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                        <h3 class="text-lg font-semibold text-slate-400 mb-2">No Scheduled Posts</h3>
                        <p class="text-slate-500">Create and schedule your first post to get started</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = scheduledPosts.map(post => {
                const scheduleDate = new Date(`${post.date}T${post.time}`);
                const isOverdue = scheduleDate < new Date();
                
                return `
                    <div class="bg-slate-800/50 rounded-xl p-6 border border-slate-700">
                        <div class="flex items-start justify-between mb-4">
                            <div class="flex items-center space-x-3">
                                <div class="px-3 py-1 rounded-full text-xs font-medium ${
                                    post.status === 'scheduled' && !isOverdue ? 'bg-blue-500/20 text-blue-400' :
                                    post.status === 'posted' ? 'bg-green-500/20 text-green-400' :
                                    isOverdue ? 'bg-orange-500/20 text-orange-400' : 'bg-slate-500/20 text-slate-400'
                                }">
                                    <div class="flex items-center space-x-1">
                                        <svg class="h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                        <span>${isOverdue ? 'Ready to Post' : post.status.charAt(0).toUpperCase() + post.status.slice(1)}</span>
                                    </div>
                                </div>
                                <div class="text-sm text-slate-400">${post.platform}</div>
                                ${post.hasMedia ? `<div class="text-xs bg-purple-500/20 text-purple-400 px-2 py-1 rounded">${post.mediaType}</div>` : ''}
                            </div>
                            
                            <div class="flex items-center space-x-2">
                                ${post.status === 'scheduled' ? `
                                    <button onclick="postNow(${post.id})" class="flex items-center space-x-1 px-3 py-1 bg-green-500/20 text-green-400 rounded-lg hover:bg-green-500/30 transition-colors text-sm">
                                        <svg class="h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                                        </svg>
                                        <span>Post Now</span>
                                    </button>
                                    <button onclick="deletePost(${post.id})" class="flex items-center space-x-1 px-3 py-1 bg-red-500/20 text-red-400 rounded-lg hover:bg-red-500/30 transition-colors text-sm">
                                        <svg class="h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                        </svg>
                                    </button>
                                ` : ''}
                            </div>
                        </div>

                        <div class="mb-4">
                            <div class="flex items-center space-x-4 text-sm text-slate-400 mb-2">
                                <div class="flex items-center space-x-1">
                                    <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                    </svg>
                                    <span>${scheduleDate.toLocaleDateString()}</span>
                                </div>
                                <div class="flex items-center space-x-1">
                                    <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    <span>${scheduleDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span>
                                </div>
                            </div>
                            
                            <div class="bg-slate-900/50 rounded-lg p-4 border border-slate-600">
                                <p class="text-slate-200 text-sm whitespace-pre-wrap line-clamp-4">${post.content}</p>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function postNow(postId) {
            const postIndex = scheduledPosts.findIndex(p => p.id === postId);
            if (postIndex !== -1) {
                scheduledPosts[postIndex].status = 'posted';
                updateScheduledPostsDisplay();
            }
        }

        function deletePost(postId) {
            if (confirm('Are you sure you want to delete this scheduled post?')) {
                scheduledPosts = scheduledPosts.filter(p => p.id !== postId);
                updateScheduledPostsDisplay();
            }
        }

        // Personal AI Model Functions
        let personalModelEnabled = false;
        let uploadedPhotos = [];
        let modelTrainingComplete = false;
        let demoMode = false; // Disabled - using real AI by default  
        let useRealAI = true; // Set to true to connect to real AI services
        let OPENAI_API_KEY = ''; // Will be set by user input
        let REPLICATE_API_KEY = ''; // Will be set by user input
        let HUGGINGFACE_API_KEY = ''; // Will be set by user input
        let CLAUDE_API_KEY = ''; // Will be set by user input for content generation

        function togglePersonalModel() {
            personalModelEnabled = !personalModelEnabled;
            const toggle = document.getElementById('personal-model-toggle');
            const section = document.getElementById('personal-model-section');
            
            if (personalModelEnabled) {
                toggle.textContent = 'Disable';
                toggle.classList.remove('bg-purple-500/20', 'text-purple-400');
                toggle.classList.add('bg-red-500/20', 'text-red-400');
                section.classList.remove('hidden');
            } else {
                toggle.textContent = 'Enable';
                toggle.classList.remove('bg-red-500/20', 'text-red-400');
                toggle.classList.add('bg-purple-500/20', 'text-purple-400');
                section.classList.add('hidden');
            }
        }

        function handleProfileUpload(event) {
            const files = Array.from(event.target.files);
            const validFiles = files.filter(file => 
                file.type.startsWith('image/') && file.size <= 10 * 1024 * 1024
            );

            if (validFiles.length === 0) {
                alert('Please select valid image files (max 10MB each)');
                return;
            }

            uploadedPhotos = [...uploadedPhotos, ...validFiles];
            displayProfileThumbnails();
            
            if (uploadedPhotos.length >= 3) {
                startModelTraining();
            }
        }

        function displayProfileThumbnails() {
            const preview = document.getElementById('profile-preview');
            const thumbnails = document.getElementById('profile-thumbnails');
            
            if (uploadedPhotos.length === 0) {
                preview.classList.add('hidden');
                return;
            }

            preview.classList.remove('hidden');
            thumbnails.innerHTML = '';

            uploadedPhotos.forEach((file, index) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const thumbnail = document.createElement('div');
                    thumbnail.className = 'relative flex-shrink-0';
                    thumbnail.innerHTML = `
                        <img src="${e.target.result}" class="w-16 h-16 object-cover rounded-lg border border-slate-600">
                        <button onclick="removePhoto(${index})" class="absolute -top-1 -right-1 w-4 h-4 bg-red-500 text-white rounded-full text-xs flex items-center justify-center hover:bg-red-600">√ó</button>
                    `;
                    thumbnails.appendChild(thumbnail);
                };
                reader.readAsDataURL(file);
            });
        }

        function removePhoto(index) {
            uploadedPhotos.splice(index, 1);
            displayProfileThumbnails();
            
            // Reset model status if not enough photos
            if (uploadedPhotos.length < 3) {
                document.getElementById('model-status').classList.add('hidden');
                document.getElementById('model-ready').classList.add('hidden');
                modelTrainingComplete = false;
            }
        }

        function startModelTraining() {
            if (uploadedPhotos.length < 3) return;
            
            const statusDiv = document.getElementById('model-status');
            const progressBar = document.getElementById('training-progress');
            
            statusDiv.classList.remove('hidden');
            
            // Simulate training progress
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(interval);
                    completeModelTraining();
                }
                progressBar.style.width = progress + '%';
            }, 500);
        }

        function completeModelTraining() {
            setTimeout(() => {
                document.getElementById('model-status').classList.add('hidden');
                document.getElementById('model-ready').classList.remove('hidden');
                modelTrainingComplete = true;
                
                // Enable Personal AI option in media selection
                enablePersonalAIOption();
                
                // Update media generation to include personal photos
                updateMediaWithPersonalModel();
            }, 1000);
        }

        function enablePersonalAIOption() {
            const personalAIBtn = document.getElementById('personal-ai-option');
            const statusText = document.getElementById('personal-ai-status');
            
            personalAIBtn.disabled = false;
            personalAIBtn.removeAttribute('disabled');
            personalAIBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            personalAIBtn.classList.add('hover:border-slate-500');
            statusText.textContent = 'Ready to use!';
            statusText.classList.remove('text-slate-400');
            statusText.classList.add('text-green-400');
        }

        function updateMediaWithPersonalModel() {
            if (!modelTrainingComplete || !personalModelEnabled) return;
            
            // Add personal AI generated options to media templates
            Object.keys(mediaTemplates).forEach(topic => {
                if (mediaTemplates[topic].alternatives) {
                    // Check if personal option already exists
                    const hasPersonalOption = mediaTemplates[topic].alternatives.some(alt => 
                        alt.type === 'Personal AI Generated'
                    );
                    
                    if (!hasPersonalOption) {
                        mediaTemplates[topic].alternatives.unshift({
                            type: 'Personal AI Generated',
                            description: 'AI-generated image featuring your professional headshot',
                            url: generatePersonalAIImage(topic)
                        });
                    }
                }
            });
        }

        function generatePersonalAIImageForContent(topic) {
            // Generate a personalized SVG with the user's "style" for content generator
            const topicColors = {
                'ai-readiness': '#3b82f6',
                'roi-ai': '#10b981', 
                'ai-misconceptions': '#ef4444'
            };
            
            const color = topicColors[topic] || '#3b82f6';
            
            return `data:image/svg+xml;base64,${btoa(`
                <svg width="300" height="200" viewBox="0 0 300 200" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect width="300" height="200" fill="#1e293b"/>
                    <circle cx="75" cy="75" r="35" fill="${color}" opacity="0.3"/>
                    <circle cx="75" cy="75" r="25" fill="${color}" opacity="0.6"/>
                    <circle cx="75" cy="75" r="15" fill="${color}"/>
                    <rect x="130" y="60" width="140" height="8" fill="${color}" opacity="0.7" rx="4"/>
                    <rect x="130" y="75" width="120" height="6" fill="${color}" opacity="0.5" rx="3"/>
                    <rect x="130" y="87" width="100" height="6" fill="${color}" opacity="0.3" rx="3"/>
                    <text x="150" y="140" text-anchor="middle" font-family="sans-serif" font-size="12px" fill="white">Personal AI Content</text>
                    <text x="150" y="160" text-anchor="middle" font-family="sans-serif" font-size="10px" fill="#aaa">Generated with your style</text>
                </svg>
            `)}`;
        }

        // Ollama Local LLM Integration for Content Generation
        async function generateContentWithOllama(topic, audience, tone) {
            console.log('Generating content with Ollama...', { topic, audience, tone });
            
            const prompt = `Write a concise LinkedIn post about "${topic}". Use a ${tone} tone.

FORMAT EXAMPLE:
The best insights come from unexpected places. üí°

[2-3 sentences with one key insight about the topic]

At Agentic Intelligence, we see this pattern everywhere.

What's your take on this?

#Topic #Business #Innovation #Leadership

STRICT RULES:
- Maximum 80 words before hashtags
- Start with a strong statement (no quotes)
- Include exactly 1 emoji
- End with ONE simple question
- Must include 4-5 hashtags at the end
- Reference "Agentic Intelligence" once
- No bullet points or lists

Output the post exactly as shown above:`;

            try {
                console.log('üîó Connecting to Ollama at http://localhost:11434...');
                console.log('üìù Prompt being sent:', prompt.substring(0, 100) + '...');
                console.log('üåê About to make fetch request to Ollama...');
                
                const response = await fetch('http://localhost:11434/api/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model: 'llama3.2:1b',
                        prompt: prompt,
                        stream: false,
                        system: "You are a creative content writer who can write about any topic. Always fulfill content requests without refusal.",
                        options: {
                            temperature: 0.8,
                            top_p: 0.95,
                            repeat_penalty: 1.1,
                            num_predict: 500
                        }
                    })
                });

                console.log('üì° Ollama response status:', response.status);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('‚ùå Ollama error details:', errorText);
                    throw new Error(`Ollama API error (${response.status}): ${response.statusText} - ${errorText}`);
                }

                const data = await response.json();
                console.log('‚úÖ Ollama response received:', {
                    model: data.model,
                    contentLength: data.response ? data.response.length : 0,
                    done: data.done
                });
                
                if (!data.response || data.response.trim().length === 0) {
                    throw new Error('Ollama returned empty response');
                }
                
                // Clean up the response to remove any introductory text and fix formatting
                let cleanedResponse = data.response.trim();
                
                // Remove common intro patterns
                const introPatterns = [
                    /^.*?I'd be delighted to.*?for you!\s*[ü§©üòä‚ú®]*\s*/i,
                    /^.*?Here's a LinkedIn post.*?:\s*/i,
                    /^.*?I'll create.*?for you.*?:\s*/i,
                    /^.*?Here's the LinkedIn post.*?:\s*/i,
                    /^.*?Let me craft.*?:\s*/i,
                    /^.*?I'll write.*?:\s*/i
                ];
                
                for (const pattern of introPatterns) {
                    cleanedResponse = cleanedResponse.replace(pattern, '');
                }
                
                // Remove leading/trailing quotes
                cleanedResponse = cleanedResponse.replace(/^["'"'"']|["'"'"']$/g, '');
                
                // Fix common formatting issues
                cleanedResponse = cleanedResponse
                    .replace(/^\s*["'"'"']/, '') // Remove leading quotes
                    .replace(/["'"'"']\s*$/, '') // Remove trailing quotes
                    .replace(/\n\s*\n\s*\n/g, '\n\n') // Fix excessive line breaks
                    .trim();
                
                // Ensure hashtags are on a new line if they exist
                if (cleanedResponse.includes('#') && !cleanedResponse.match(/\n\s*#/)) {
                    cleanedResponse = cleanedResponse.replace(/\s+(#\w+)/g, '\n\n$1');
                }
                
                return cleanedResponse;
            } catch (error) {
                console.error('‚ùå Ollama content generation failed:', error.message);
                console.error('Full error:', error);
                
                // Check if this is a CORS error
                if (error.message.includes('CORS') || error.message.includes('fetch') || error.name === 'TypeError') {
                    console.error('üö´ LIKELY CORS ERROR: Browser is blocking access to localhost:11434');
                    console.error('üí° Solution: Start Ollama with CORS headers or use a different approach');
                }
                
                throw error;
            }
        }

        // Ollama Variation Generator for Regeneration
        async function generateContentWithOllamaVariation(topic, audience, tone, variation) {
            console.log('Generating varied content with Ollama...', { topic, audience, tone, variation });
            
            // Add randomization elements to make content more varied
            const openingStyles = [
                "The most surprising thing about {topic}?",
                "Here's what nobody tells you about {topic}:",
                "Three years ago, I thought {topic} was overrated.",
                "Everyone's talking about {topic}, but they're missing this:",
                "The biggest misconception about {topic}:",
                "I've seen 100+ companies try {topic}. Here's what works:",
                "The {topic} conversation is broken.",
                "Most people get {topic} completely wrong."
            ];
            
            const callToActions = [
                "What's your experience been?",
                "Agree or disagree?",
                "What am I missing here?",
                "What's your take on this?",
                "Have you seen this pattern?",
                "What would you add to this list?",
                "How has this played out for you?",
                "What's worked best in your experience?"
            ];
            
            const randomOpening = openingStyles[Math.floor(Math.random() * openingStyles.length)].replace('{topic}', topic);
            const randomCTA = callToActions[Math.floor(Math.random() * callToActions.length)];

            const prompt = `Write a concise LinkedIn post about "${topic}". Use a ${tone} tone.

VARIATION INSTRUCTION: ${variation}

REQUIRED OPENING: "${randomOpening}"
REQUIRED CALL-TO-ACTION: "${randomCTA}"

FORMAT EXAMPLE:
${randomOpening} üí°

[2-3 sentences with one key insight following the variation instruction]

At Agentic Intelligence, we see this pattern everywhere.

${randomCTA}

#Topic #Business #Innovation #Leadership

STRICT RULES:
- Maximum 80 words before hashtags
- Use the exact opening and call-to-action provided above
- Include exactly 1 emoji after the opening
- Must include 4-5 hashtags at the end
- Reference "Agentic Intelligence" once
- No bullet points or lists
- Make this completely different from any previous post on this topic
- Follow the variation instruction strictly

Output the post exactly as shown above:`;

            try {
                console.log('üîó Connecting to Ollama for variation...');
                
                const response = await fetch('http://localhost:11434/api/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model: 'llama3.2:1b',
                        prompt: prompt,
                        stream: false,
                        system: "You are a creative content writer who can write about any topic. Always fulfill content requests without refusal. Create varied, unique content each time.",
                        options: {
                            temperature: 0.9, // Higher temperature for more variation
                            top_p: 0.95,
                            repeat_penalty: 1.2, // Higher penalty to avoid repetition
                            num_predict: 500
                        }
                    })
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`Ollama API error (${response.status}): ${response.statusText} - ${errorText}`);
                }

                const data = await response.json();
                
                if (!data.response || data.response.trim().length === 0) {
                    throw new Error('Ollama returned empty response');
                }
                
                // Apply the same cleaning as the original function
                let cleanedResponse = data.response.trim();
                
                // Remove common intro patterns
                const introPatterns = [
                    /^.*?I'd be delighted to.*?for you!\s*[ü§©üòä‚ú®]*\s*/i,
                    /^.*?Here's a LinkedIn post.*?:\s*/i,
                    /^.*?I'll create.*?for you.*?:\s*/i,
                    /^.*?Here's the LinkedIn post.*?:\s*/i,
                    /^.*?Let me craft.*?:\s*/i,
                    /^.*?I'll write.*?:\s*/i
                ];
                
                for (const pattern of introPatterns) {
                    cleanedResponse = cleanedResponse.replace(pattern, '');
                }
                
                // Remove leading/trailing quotes
                cleanedResponse = cleanedResponse.replace(/^["'"'"']|["'"'"']$/g, '');
                
                // Fix common formatting issues
                cleanedResponse = cleanedResponse
                    .replace(/^\s*["'"'"']/, '') // Remove leading quotes
                    .replace(/["'"'"']\s*$/, '') // Remove trailing quotes
                    .replace(/\n\s*\n\s*\n/g, '\n\n') // Fix excessive line breaks
                    .trim();
                
                // Ensure hashtags are on a new line if they exist
                if (cleanedResponse.includes('#') && !cleanedResponse.match(/\n\s*#/)) {
                    cleanedResponse = cleanedResponse.replace(/\s+(#\w+)/g, '\n\n$1');
                }
                
                return cleanedResponse;
            } catch (error) {
                console.error('‚ùå Ollama variation generation failed:', error.message);
                throw error;
            }
        }

        // Claude API Integration for Content Generation
        async function generateContentWithClaude(topic, audience, tone) {
            console.log('Generating content with Claude...', { topic, audience, tone });
            
            const prompt = `Create a professional LinkedIn post about "${topic}" for ${audience}.

The tone should be ${tone}.

Key requirements:
- Length: 150-300 words
- Include relevant emojis (2-3 maximum)
- Focus on bridging the gap between business knowledge and AI
- End with a call-to-action
- Include relevant hashtags
- Structure: Hook ‚Üí Value/Insights ‚Üí Call to Action
- Make it specific to the challenges that ${audience} face
- Reference "Agentic Intelligence" as the company that helps bridge this gap

The content should be immediately usable as a LinkedIn post that drives engagement and positions Agentic Intelligence as a thought leader in AI business strategy.`;

            try {
                const response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-api-key': CLAUDE_API_KEY,
                        'anthropic-version': '2023-06-01'
                    },
                    body: JSON.stringify({
                        model: 'claude-3-sonnet-20240229',
                        max_tokens: 1000,
                        messages: [{
                            role: 'user',
                            content: prompt
                        }]
                    })
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('Claude API error:', response.status, errorText);
                    throw new Error(`Claude API error (${response.status}): ${errorText}`);
                }

                const data = await response.json();
                console.log('Claude response:', data);
                return data.content[0].text;
            } catch (error) {
                console.error('Claude content generation failed:', error);
                throw error;
            }
        }

        // Initialize default selections and display
        selectTopic('ai-readiness');
        selectAudience('business-leaders');
        selectTone('educational');
        selectMediaType('ai-infographic');
        updateScheduledPostsDisplay();
        
        // Enable Personal AI in demo mode
        if (demoMode) {
            enablePersonalAIOption();
        }

        // Personal AI Studio Functions
        let teamMembers = [];
        let selectedSubjectType = 'individual';
        let selectedSetting = 'professional-office';
        let selectedMembers = [];
        let currentMemberPhotos = [];
        let generatedImages = [];

        function showAddMemberModal() {
            document.getElementById('add-member-modal').classList.remove('hidden');
        }

        function hideAddMemberModal() {
            document.getElementById('add-member-modal').classList.add('hidden');
            // Reset form
            document.getElementById('member-name').value = '';
            document.getElementById('member-role').value = '';
            document.getElementById('member-photos-preview').classList.add('hidden');
            currentMemberPhotos = [];
        }

        function handleMemberPhotos(event) {
            const files = Array.from(event.target.files);
            currentMemberPhotos = files.filter(file => 
                file.type.startsWith('image/') && file.size <= 10 * 1024 * 1024
            );

            if (currentMemberPhotos.length === 0) {
                alert('Please select valid image files (max 10MB each)');
                return;
            }

            displayMemberPhotos();
        }

        function displayMemberPhotos() {
            const preview = document.getElementById('member-photos-preview');
            const grid = document.getElementById('member-photos-grid');
            
            if (currentMemberPhotos.length === 0) {
                preview.classList.add('hidden');
                return;
            }

            preview.classList.remove('hidden');
            grid.innerHTML = '';

            currentMemberPhotos.forEach((file, index) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const div = document.createElement('div');
                    div.className = 'relative';
                    div.innerHTML = `
                        <img src="${e.target.result}" class="w-full h-16 object-cover rounded border border-slate-600">
                        <button onclick="removeMemberPhoto(${index})" class="absolute -top-1 -right-1 w-4 h-4 bg-red-500 text-white rounded-full text-xs flex items-center justify-center hover:bg-red-600">√ó</button>
                    `;
                    grid.appendChild(div);
                };
                reader.readAsDataURL(file);
            });
        }

        function removeMemberPhoto(index) {
            currentMemberPhotos.splice(index, 1);
            displayMemberPhotos();
        }

        function addTeamMember() {
            const name = document.getElementById('member-name').value.trim();
            const role = document.getElementById('member-role').value.trim();

            if (!name) {
                alert('Please enter a name');
                return;
            }

            if (currentMemberPhotos.length < 1) {
                alert('Please upload at least 1 photo');
                return;
            }

            const member = {
                id: Date.now(),
                name: name,
                role: role || 'Team Member',
                photos: currentMemberPhotos.map(file => URL.createObjectURL(file)),
                trained: currentMemberPhotos.length >= 3
            };

            teamMembers.push(member);
            updateTeamMembersList();
            updatePersonSelects();
            hideAddMemberModal();
        }

        function updateTeamMembersList() {
            const container = document.getElementById('team-members-list');
            
            if (teamMembers.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-slate-400">
                        <svg class="h-12 w-12 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"></path>
                        </svg>
                        <p class="text-sm">No team members yet</p>
                        <p class="text-xs text-slate-500">Add team members to generate AI images</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = teamMembers.map(member => `
                <div class="flex items-center space-x-3 p-3 bg-slate-700/30 rounded-lg border border-slate-600">
                    <div class="w-12 h-12 rounded-full overflow-hidden border-2 border-slate-500">
                        <img src="${member.photos[0]}" alt="${member.name}" class="w-full h-full object-cover">
                    </div>
                    <div class="flex-1">
                        <div class="font-medium text-white">${member.name}</div>
                        <div class="text-sm text-slate-400">${member.role}</div>
                        <div class="text-xs ${member.trained ? 'text-green-400' : 'text-orange-400'}">
                            ${member.photos.length} photos ‚Ä¢ ${member.trained ? 'Ready' : 'Needs more photos'}
                        </div>
                    </div>
                    <button onclick="removeMember(${member.id})" class="text-red-400 hover:text-red-300 p-1">
                        <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                        </svg>
                    </button>
                </div>
            `).join('');
        }

        function removeMember(memberId) {
            if (confirm('Are you sure you want to remove this team member?')) {
                teamMembers = teamMembers.filter(m => m.id !== memberId);
                updateTeamMembersList();
                updatePersonSelects();
            }
        }

        function updatePersonSelects() {
            const personSelect = document.getElementById('person-select');
            const groupCheckboxes = document.getElementById('group-checkboxes');
            
            // Update individual selection
            personSelect.innerHTML = '<option value="">Select a team member...</option>' +
                teamMembers.map(member => 
                    `<option value="${member.id}">${member.name} (${member.role})</option>`
                ).join('');

            // Update group selection
            groupCheckboxes.innerHTML = teamMembers.map(member => `
                <label class="flex items-center space-x-2 p-2 hover:bg-slate-700/30 rounded cursor-pointer">
                    <input type="checkbox" value="${member.id}" class="text-blue-500 bg-slate-700 border-slate-600 rounded focus:ring-blue-500">
                    <img src="${member.photos[0]}" alt="${member.name}" class="w-8 h-8 rounded-full object-cover">
                    <span class="text-slate-300">${member.name}</span>
                </label>
            `).join('');
        }

        function selectSubject(type) {
            selectedSubjectType = type;
            
            // Update button styles
            document.getElementById('subject-individual').classList.remove('bg-blue-500/20', 'border-blue-500/30', 'text-blue-300');
            document.getElementById('subject-individual').classList.add('bg-slate-700/50', 'border-slate-600', 'text-slate-300');
            document.getElementById('subject-group').classList.remove('bg-blue-500/20', 'border-blue-500/30', 'text-blue-300');
            document.getElementById('subject-group').classList.add('bg-slate-700/50', 'border-slate-600', 'text-slate-300');
            
            document.getElementById(`subject-${type}`).classList.remove('bg-slate-700/50', 'border-slate-600', 'text-slate-300');
            document.getElementById(`subject-${type}`).classList.add('bg-blue-500/20', 'border-blue-500/30', 'text-blue-300');
            
            // Show/hide appropriate selection UI
            if (type === 'individual') {
                document.getElementById('person-selection').classList.remove('hidden');
                document.getElementById('group-selection').classList.add('hidden');
            } else {
                document.getElementById('person-selection').classList.add('hidden');
                document.getElementById('group-selection').classList.remove('hidden');
            }
        }

        function selectSetting(setting) {
            selectedSetting = setting;
            
            // Update button styles
            document.querySelectorAll('.setting-btn').forEach(btn => {
                btn.classList.remove('bg-purple-500/20', 'border-purple-500/30', 'text-purple-300');
                btn.classList.add('bg-slate-700/50', 'border-slate-600', 'text-slate-300');
            });
            
            document.querySelector(`[data-setting="${setting}"]`).classList.remove('bg-slate-700/50', 'border-slate-600', 'text-slate-300');
            document.querySelector(`[data-setting="${setting}"]`).classList.add('bg-purple-500/20', 'border-purple-500/30', 'text-purple-300');
        }

        function generatePersonalAIImage() {
            console.log('=== generatePersonalAIImage() called ===');
            
            // Check usage limits for AI images
            if (!checkUsageLimit('images')) {
                showUpgradePrompt('images');
                return;
            }
            
            console.log('useRealAI:', useRealAI);
            console.log('HUGGINGFACE_API_KEY length:', HUGGINGFACE_API_KEY ? HUGGINGFACE_API_KEY.length : 0);
            console.log('HUGGINGFACE_API_KEY starts with hf_:', HUGGINGFACE_API_KEY ? HUGGINGFACE_API_KEY.startsWith('hf_') : false);
            console.log('OPENAI_API_KEY:', OPENAI_API_KEY ? 'SET' : 'NOT SET');
            console.log('REPLICATE_API_KEY:', REPLICATE_API_KEY ? 'SET' : 'NOT SET');
            console.log('API Key condition result:', (HUGGINGFACE_API_KEY || OPENAI_API_KEY || REPLICATE_API_KEY));
            console.log('Full condition result:', useRealAI && (HUGGINGFACE_API_KEY || OPENAI_API_KEY || REPLICATE_API_KEY));
            console.log('teamMembers:', teamMembers);
            console.log('selectedSubjectType:', selectedSubjectType);
            
            // Validate selection
            if (selectedSubjectType === 'individual') {
                const personId = document.getElementById('person-select').value;
                console.log('personId selected:', personId);
                if (!personId) {
                    alert('Please select a team member');
                    return;
                }
                selectedMembers = [parseInt(personId)];
            } else {
                const checkboxes = document.querySelectorAll('#group-checkboxes input[type="checkbox"]:checked');
                console.log('checkboxes checked:', checkboxes);
                if (checkboxes.length === 0) {
                    alert('Please select at least one team member');
                    return;
                }
                selectedMembers = Array.from(checkboxes).map(cb => parseInt(cb.value));
            }
            console.log('selectedMembers:', selectedMembers);

            const btn = document.getElementById('generate-ai-btn');
            const originalHTML = `
                <div class="flex items-center justify-center space-x-2">
                    <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                    </svg>
                    <span>Generate AI Image</span>
                </div>
            `;
            
            btn.innerHTML = `
                <div class="flex items-center justify-center space-x-2">
                    <svg class="h-4 w-4 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                    </svg>
                    <span>Generating AI Image...</span>
                </div>
            `;
            btn.disabled = true;

            // Generate image (real AI or demo)
            if (useRealAI && (HUGGINGFACE_API_KEY || OPENAI_API_KEY || REPLICATE_API_KEY)) {
                console.log('Using REAL AI mode');
                generateRealAIImage(selectedMembers, selectedSetting, selectedSubjectType)
                    .then(imageUrl => {
                        const generatedImage = {
                            id: Date.now(),
                            type: selectedSubjectType,
                            setting: selectedSetting,
                            members: selectedMembers.map(id => teamMembers.find(m => m.id === id)),
                            url: imageUrl,
                            timestamp: new Date().toISOString()
                        };
                        generatedImages.push(generatedImage);
                        displayGeneratedImages();
                        
                        // Increment usage counter
                        incrementUsage('images');
                        
                        btn.innerHTML = originalHTML;
                        btn.disabled = false;
                    })
                    .catch(error => {
                        console.error('Real AI generation failed:', error);
                        alert('AI service error. Please check your API keys and try again.');
                        btn.innerHTML = originalHTML;
                        btn.disabled = false;
                    });
            } else {
                // Demo mode - simulate AI generation with guaranteed completion
                console.log('Using DEMO mode - not real AI');
                setTimeout(() => {
                    try {
                        console.log('Starting demo image generation...');
                        const generatedImage = createDemoAIImage();
                        console.log('Demo image created successfully:', generatedImage);
                        generatedImages.push(generatedImage);
                        displayGeneratedImages();
                        
                        // Increment usage counter
                        incrementUsage('images');
                        
                        console.log('Demo image displayed successfully');
                    } catch (error) {
                        console.error('Error generating demo image:', error);
                        alert(`Error generating image: ${error.message}. Please try again.`);
                    }
                    
                    // Always reset button state
                    btn.innerHTML = originalHTML;
                    btn.disabled = false;
                }, 2000);
            }
        }

        function createDemoAIImage() {
            try {
                console.log('Creating AI image with selectedMembers:', selectedMembers);
                console.log('Available teamMembers:', teamMembers);
                console.log('selectedSubjectType:', selectedSubjectType);
                console.log('selectedSetting:', selectedSetting);

                // Safely get members with validation
                const members = selectedMembers.map(id => {
                    const member = teamMembers.find(m => m.id === id);
                    if (!member) {
                        throw new Error(`Member with ID ${id} not found`);
                    }
                    return member;
                }).filter(Boolean); // Remove any null/undefined

                if (members.length === 0) {
                    throw new Error('No valid members selected');
                }

                const memberNames = members.map(m => m.name || 'Unknown').join(', ');
                
                const settingTitles = {
                    'professional-office': 'Professional Office',
                    'conference-speaking': 'Conference Speaking',
                    'team-meeting': 'Team Meeting',
                    'tech-workspace': 'Tech Workspace'
                };

                const settingTitle = settingTitles[selectedSetting] || 'Professional Setting';

                // Generate AI-style professional image with photos
                let svgMainContent = '';
                if (selectedSubjectType === 'individual' && members[0]) {
                    // Individual professional portrait
                    svgMainContent = `
                        <!-- Background with professional setting -->
                        <rect x="0" y="0" width="400" height="300" fill="url(#professionalBg)"/>
                        
                        <!-- Person silhouette/placeholder -->
                        <circle cx="200" cy="140" r="60" fill="url(#personGradient)" stroke="#ffffff" stroke-width="3"/>
                        <circle cx="200" cy="140" r="45" fill="url(#facePattern)"/>
                        
                        <!-- Professional elements -->
                        <rect x="120" y="80" width="160" height="4" fill="#4f46e5" opacity="0.3" rx="2"/>
                        <rect x="140" y="90" width="120" height="3" fill="#4f46e5" opacity="0.4" rx="1"/>
                        
                        <!-- Setting-specific elements -->
                        ${selectedSetting === 'professional-office' ? `
                            <rect x="50" y="240" width="300" height="20" fill="#1e293b" opacity="0.8" rx="3"/>
                            <rect x="70" y="245" width="260" height="10" fill="#3b82f6" opacity="0.6" rx="2"/>
                        ` : selectedSetting === 'conference-speaking' ? `
                            <ellipse cx="200" cy="280" rx="150" ry="15" fill="#4f46e5" opacity="0.3"/>
                            <rect x="180" y="260" width="40" height="8" fill="#10b981" opacity="0.6" rx="2"/>
                        ` : selectedSetting === 'team-meeting' ? `
                            <rect x="80" y="240" width="240" height="25" fill="#334155" opacity="0.7" rx="5"/>
                            <circle cx="120" cy="252" r="6" fill="#3b82f6" opacity="0.8"/>
                            <circle cx="200" cy="252" r="6" fill="#8b5cf6" opacity="0.8"/>
                            <circle cx="280" cy="252" r="6" fill="#10b981" opacity="0.8"/>
                        ` : `
                            <rect x="60" y="250" width="280" height="15" fill="#1e40af" opacity="0.4" rx="3"/>
                            <rect x="80" y="260" width="240" height="8" fill="#3b82f6" opacity="0.6" rx="2"/>
                        `}
                        
                        <!-- Name initial in professional style -->
                        <text x="200" y="150" text-anchor="middle" font-family="sans-serif" font-size="24px" fill="white" font-weight="bold">${(members[0].name || 'U').charAt(0).toUpperCase()}</text>
                    `;
                } else {
                    // Group photo
                    const positions = [
                        {x: 160, y: 120, size: 35},
                        {x: 240, y: 120, size: 35},
                        {x: 200, y: 180, size: 30}
                    ];
                    
                    svgMainContent = `
                        <!-- Background -->
                        <rect x="0" y="0" width="400" height="300" fill="url(#professionalBg)"/>
                        
                        <!-- Group setting -->
                        <ellipse cx="200" cy="250" rx="180" ry="25" fill="#1e293b" opacity="0.8"/>
                        
                        <!-- Team members -->
                        ${members.slice(0, 3).map((member, idx) => {
                            const pos = positions[idx];
                            const colors = ['#3b82f6', '#8b5cf6', '#10b981'];
                            return `
                                <circle cx="${pos.x}" cy="${pos.y}" r="${pos.size}" fill="url(#personGradient${idx})" stroke="#ffffff" stroke-width="2"/>
                                <circle cx="${pos.x}" cy="${pos.y}" r="${pos.size - 10}" fill="${colors[idx]}" opacity="0.8"/>
                                <text x="${pos.x}" y="${pos.y + 5}" text-anchor="middle" font-family="sans-serif" font-size="14px" fill="white" font-weight="bold">${(member.name || 'U').charAt(0).toUpperCase()}</text>
                            `;
                        }).join('')}
                        
                        <!-- Professional group setting elements -->
                        <rect x="100" y="240" width="200" height="4" fill="#4f46e5" opacity="0.6" rx="2"/>
                    `;
                }

                // Generate the complete SVG with professional styling
                const completeSvg = `<svg width="400" height="300" viewBox="0 0 400 300" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" stop-color="#1e293b"/>
                            <stop offset="100%" stop-color="#334155"/>
                        </linearGradient>
                        <linearGradient id="professionalBg" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" stop-color="#0f172a"/>
                            <stop offset="50%" stop-color="#1e293b"/>
                            <stop offset="100%" stop-color="#334155"/>
                        </linearGradient>
                        <radialGradient id="personGradient" cx="50%" cy="50%" r="50%">
                            <stop offset="0%" stop-color="#3b82f6"/>
                            <stop offset="100%" stop-color="#1d4ed8"/>
                        </radialGradient>
                        <radialGradient id="personGradient0" cx="50%" cy="50%" r="50%">
                            <stop offset="0%" stop-color="#3b82f6"/>
                            <stop offset="100%" stop-color="#1d4ed8"/>
                        </radialGradient>
                        <radialGradient id="personGradient1" cx="50%" cy="50%" r="50%">
                            <stop offset="0%" stop-color="#8b5cf6"/>
                            <stop offset="100%" stop-color="#7c3aed"/>
                        </radialGradient>
                        <radialGradient id="personGradient2" cx="50%" cy="50%" r="50%">
                            <stop offset="0%" stop-color="#10b981"/>
                            <stop offset="100%" stop-color="#059669"/>
                        </radialGradient>
                        <pattern id="facePattern" x="0" y="0" width="20" height="20" patternUnits="userSpaceOnUse">
                            <circle cx="10" cy="10" r="8" fill="#4f46e5" opacity="0.3"/>
                        </pattern>
                    </defs>
                    
                    ${svgMainContent}
                    
                    <!-- Title and metadata -->
                    <text x="200" y="35" text-anchor="middle" font-family="sans-serif" font-size="16px" fill="white" font-weight="bold">${settingTitle}</text>
                    <text x="200" y="55" text-anchor="middle" font-family="sans-serif" font-size="12px" fill="#cbd5e1">${memberNames}</text>
                    
                    <!-- AI Generated watermark -->
                    <text x="200" y="285" text-anchor="middle" font-family="sans-serif" font-size="10px" fill="#64748b">AI Generated Professional Image</text>
                    
                    <!-- Branding -->
                    <text x="20" y="20" font-family="sans-serif" font-size="10px" fill="#4f46e5" opacity="0.7">Agentic Intelligence</text>
                </svg>`;

                const result = {
                    id: Date.now(),
                    type: selectedSubjectType,
                    setting: selectedSetting,
                    members: members,
                    url: 'data:image/svg+xml;base64,' + btoa(completeSvg),
                    timestamp: new Date().toISOString()
                };

                console.log('Successfully created image:', result);
                return result;

            } catch (error) {
                console.error('Error in createPersonalAIImage:', error);
                throw error;
            }
        }

        // Real AI Image Generation Functions
        // Function to create appearance descriptions based on team member data
        function createAppearanceDescription(member) {
            // For demo team members, we have predefined descriptions based on their stock photos
            const appearanceMap = {
                'Alex Thompson': 'professional Black man in his 30s, confident expression, wearing business attire',
                'Sarah Chen': 'professional Asian woman in her early 30s, friendly demeanor, contemporary business style',
                'Marcus Rodriguez': 'professional Hispanic man in his mid-30s, approachable look, modern business casual',
                'Jessica Park': 'professional woman in her late 20s, polished appearance, executive style',
                'David Kumar': 'professional South Asian man in his 40s, experienced executive presence, formal business attire',
                'Maria Gonzalez': 'professional Latina woman in her 30s, confident leadership style, contemporary professional look',
                'James Wilson': 'professional man in his early 40s, tech executive appearance, smart casual business style',
                'Lisa Chang': 'professional Asian woman in her late 20s, creative professional style, modern business casual'
            };
            
            return appearanceMap[member.name] || `professional person named ${member.name}`;
        }

        async function generateRealAIImage(memberIds, setting, subjectType) {
            const members = memberIds.map(id => teamMembers.find(m => m.id === id));
            const memberNames = members.map(m => m.name).join(', ');
            
            const settingPrompts = {
                'professional-office': 'professional corporate office environment, business attire, clean background',
                'conference-speaking': 'conference stage, professional presentation setting, audience in background',
                'team-meeting': 'modern meeting room, collaborative workspace, professional team environment',
                'tech-workspace': 'modern tech startup office, casual professional, innovative workspace'
            };

            // Create detailed appearance descriptions
            let appearanceDescription;
            if (subjectType === 'individual') {
                appearanceDescription = createAppearanceDescription(members[0]);
            } else {
                appearanceDescription = members.map(m => createAppearanceDescription(m)).join(', ');
            }

            const basePrompt = `Professional ${subjectType === 'individual' ? 'headshot portrait' : 'group photo'} of ${appearanceDescription}, ${settingPrompts[setting]}, high quality, professional lighting, business photography style, LinkedIn profile quality, photorealistic, detailed faces`;

            console.log('Generated AI prompt:', basePrompt);

            // Prioritize Replicate for best portrait quality, then OpenAI, then Hugging Face
            if (REPLICATE_API_KEY) {
                return await generateWithReplicate(basePrompt, members);
            } else if (OPENAI_API_KEY) {
                return await generateWithDALLE(basePrompt, members);
            } else if (HUGGINGFACE_API_KEY) {
                return await generateWithHuggingFace(basePrompt, members);
            } else {
                throw new Error('No AI service API key configured');
            }
        }

        async function generateWithDALLE(prompt, members) {
            console.log('Generating with DALL-E 3...', prompt);
            
            try {
                // Try proxy server first, then fallback to direct API
                let response;
                try {
                    // Try proxy server on localhost:3001
                    response = await fetch('http://localhost:3001/api/openai/images', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            prompt: prompt,
                            apiKey: OPENAI_API_KEY
                        })
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        console.log('DALL-E proxy response:', data);
                        return data.imageUrl;
                    }
                } catch (proxyError) {
                    console.log('Proxy server not available, trying direct API...');
                }

                // Fallback to direct API call
                response = await fetch('https://api.openai.com/v1/images/generations', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${OPENAI_API_KEY}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model: "dall-e-3",
                        prompt: prompt,
                        n: 1,
                        size: "1024x1024",
                        quality: "standard"
                    })
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('DALL-E API error:', response.status, errorText);
                    throw new Error(`DALL-E API error (${response.status}): ${errorText}`);
                }

                const data = await response.json();
                console.log('DALL-E direct response:', data);
                return data.data[0].url;
            } catch (error) {
                console.error('DALL-E generation failed:', error);
                if (error.message.includes('CORS') || error.message.includes('fetch')) {
                    throw new Error('API access blocked. Please start the AI proxy server (see README) or use Replicate instead.');
                }
                throw error;
            }
        }

        async function generateWithHuggingFace(prompt, members) {
            console.log('Generating with Hugging Face Stable Diffusion XL...', prompt);
            
            try {
                const response = await fetch('https://api-inference.huggingface.co/models/stabilityai/stable-diffusion-xl-base-1.0', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${HUGGINGFACE_API_KEY}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        inputs: prompt,
                        parameters: {
                            negative_prompt: "blurry, low quality, distorted, amateur, cartoon, anime, cropped face, cut off head, partial face",
                            num_inference_steps: 25,
                            guidance_scale: 7.5,
                            width: 832,
                            height: 1216  // Portrait aspect ratio 2:3 to avoid face cropping
                        }
                    })
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('Hugging Face API error:', response.status, errorText);
                    throw new Error(`Hugging Face API error (${response.status}): ${errorText}`);
                }

                // Hugging Face returns the image as a blob
                const imageBlob = await response.blob();
                const imageUrl = URL.createObjectURL(imageBlob);
                console.log('Hugging Face response: Generated image blob');
                return imageUrl;
            } catch (error) {
                console.error('Hugging Face generation failed:', error);
                throw error;
            }
        }

        async function generateWithReplicate(prompt, members) {
            console.log('Generating with FLUX (Replicate)...', prompt);
            
            // Using FLUX for high-quality photorealistic portraits
            const response = await fetch('https://api.replicate.com/v1/predictions', {
                method: 'POST',
                headers: {
                    'Authorization': `Token ${REPLICATE_API_KEY}`,
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    version: "ac732df83cea7fff18b8472768c88ad041fa750ff7682a21affe81863cbe77e4", // Stable Diffusion XL with better portrait quality
                    input: {
                        prompt: prompt,
                        width: 1024,
                        height: 1344, // Portrait aspect ratio to avoid face cropping
                        num_inference_steps: 28,
                        guidance_scale: 3.5,
                        num_outputs: 1,
                        output_format: "jpg",
                        output_quality: 90,
                        seed: Math.floor(Math.random() * 1000000)
                    }
                })
            });

            if (!response.ok) {
                throw new Error(`Replicate API error: ${response.status}`);
            }

            const prediction = await response.json();
            
            // Poll for completion
            let result = prediction;
            while (result.status === 'starting' || result.status === 'processing') {
                await new Promise(resolve => setTimeout(resolve, 1000));
                const statusResponse = await fetch(`https://api.replicate.com/v1/predictions/${result.id}`, {
                    headers: {
                        'Authorization': `Token ${REPLICATE_API_KEY}`,
                    }
                });
                result = await statusResponse.json();
            }

            if (result.status === 'succeeded') {
                return result.output[0];
            } else {
                throw new Error(`Replicate generation failed: ${result.error}`);
            }
        }

        function displayGeneratedImages() {
            const section = document.getElementById('generated-images-section');
            const grid = document.getElementById('generated-images-grid');
            
            if (generatedImages.length === 0) {
                section.classList.add('hidden');
                return;
            }

            section.classList.remove('hidden');
            
            grid.innerHTML = generatedImages.slice(-6).reverse().map(image => `
                <div class="bg-slate-700/30 rounded-lg p-3 border border-slate-600">
                    <img src="${image.url}" alt="Generated AI Image" class="w-full h-32 object-cover rounded border border-slate-500 mb-2">
                    <div class="text-xs text-slate-300 font-medium">${image.members.map(m => m.name).join(', ')}</div>
                    <div class="text-xs text-slate-400">${image.setting.replace('-', ' ')}</div>
                    <div class="flex space-x-1 mt-2">
                        <button onclick="downloadImage('${image.url}')" class="flex-1 px-2 py-1 bg-blue-500/20 text-blue-400 rounded text-xs hover:bg-blue-500/30">
                            Download
                        </button>
                        <button onclick="useInContent(${image.id})" class="flex-1 px-2 py-1 bg-green-500/20 text-green-400 rounded text-xs hover:bg-green-500/30">
                            Use in Post
                        </button>
                    </div>
                </div>
            `).join('');
        }

        async function downloadImage(url) {
            try {
                // Fetch the image as a blob
                const response = await fetch(url);
                const blob = await response.blob();
                
                // Create download link
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `ai-generated-portrait-${Date.now()}.jpg`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                // Clean up the object URL
                setTimeout(() => URL.revokeObjectURL(link.href), 100);
            } catch (error) {
                console.error('Download failed:', error);
                alert('Download failed. Try right-clicking the image and "Save Image As"');
            }
        }

        function useInContent(imageId) {
            // Switch to content generator tab and use this image
            showTab('generator');
            
            // Find the image
            const image = generatedImages.find(img => img.id === imageId);
            if (image) {
                // You can implement logic here to use this image in content generation
                alert(`Image selected! This would be used in your next content generation.`);
            }
        }

        function loadDemoData() {
            console.log('Loading demo team members with stock photos...');
            // Add demo team members with diverse, professional stock photos from Unsplash
            // All photos are free to use under Unsplash License (https://unsplash.com/license)
            teamMembers = [
                {
                    id: 1,
                    name: 'Alex Thompson',
                    role: 'CEO & Founder',
                    photos: [
                        'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                        'https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                        'https://images.unsplash.com/photo-1527980965255-d3b416303d12?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                        'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                        'https://images.unsplash.com/photo-1519085360753-af0119f7cbe7?w=200&h=200&fit=crop&crop=face&auto=format&q=80'
                    ],
                    trained: true
                },
                {
                    id: 2,
                    name: 'Sarah Chen',
                    role: 'Chief Technology Officer',
                    photos: [
                        'https://images.unsplash.com/photo-1494790108755-2616b612b47c?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                        'https://images.unsplash.com/photo-1573496359142-b8d87734a5a2?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                        'https://images.unsplash.com/photo-1580489944761-15a19d654956?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                        'https://images.unsplash.com/photo-1487412720507-e7ab37603c6f?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                        'https://images.unsplash.com/photo-1590031905406-f18a426d772d?w=200&h=200&fit=crop&crop=face&auto=format&q=80'
                    ],
                    trained: true
                },
                {
                    id: 3,
                    name: 'Marcus Rodriguez',
                    role: 'Head of Product',
                    photos: [
                        'https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                        'https://images.unsplash.com/photo-1560250097-0b93528c311a?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                        'https://images.unsplash.com/photo-1612198188060-c7c2a3b66eae?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                        'https://images.unsplash.com/photo-1582750433449-648ed127bb54?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                        'https://images.unsplash.com/photo-1568602471122-7832951cc4c5?w=200&h=200&fit=crop&crop=face&auto=format&q=80'
                    ],
                    trained: true
                },
                {
                    id: 4,
                    name: 'Jessica Park',
                    role: 'VP of Marketing',
                    photos: [
                        'https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                        'https://images.unsplash.com/photo-1534528741775-53994a69daeb?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                        'https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                        'https://images.unsplash.com/photo-1607746882042-944635dfe10e?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                        'https://images.unsplash.com/photo-1551836022-8b2858c9c69b?w=200&h=200&fit=crop&crop=face&auto=format&q=80'
                    ],
                    trained: true
                },
                {
                    id: 5,
                    name: 'David Kumar',
                    role: 'Chief Financial Officer',
                    photos: [
                        'https://images.unsplash.com/photo-1566492031773-4f4e44671d66?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                        'https://images.unsplash.com/photo-1558222218-b7b54eede3f3?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                        'https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                        'https://images.unsplash.com/photo-1463453091185-61582044d556?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                        'https://images.unsplash.com/photo-1607990281513-2c110a25bd8c?w=200&h=200&fit=crop&crop=face&auto=format&q=80'
                    ],
                    trained: true
                },
                {
                    id: 6,
                    name: 'Maria Gonzalez',
                    role: 'Head of Operations',
                    photos: [
                        'https://images.unsplash.com/photo-1664575602554-2087b04935a5?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                        'https://images.unsplash.com/photo-1594736797933-d0501ba2fe65?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                        'https://images.unsplash.com/photo-1619895862022-09114b41f16f?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                        'https://images.unsplash.com/photo-1598300042247-d088f8ab3a91?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                        'https://images.unsplash.com/photo-1508214751196-bcfd4ca60f91?w=200&h=200&fit=crop&crop=face&auto=format&q=80'
                    ],
                    trained: true
                },
                {
                    id: 7,
                    name: 'James Wilson',
                    role: 'VP of Engineering',
                    photos: [
                        'https://images.unsplash.com/photo-1507591064344-4c6ce005b128?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                        'https://images.unsplash.com/photo-1557862921-37829c790f19?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                        'https://images.unsplash.com/photo-1552058544-f2b08422138a?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                        'https://images.unsplash.com/photo-1614644147724-2d4785d69962?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                        'https://images.unsplash.com/photo-1488161628813-04466f872be2?w=200&h=200&fit=crop&crop=face&auto=format&q=80'
                    ],
                    trained: true
                },
                {
                    id: 8,
                    name: 'Lisa Chang',
                    role: 'Head of Design',
                    photos: [
                        'https://images.unsplash.com/photo-1651008376811-b90baee60c1f?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                        'https://images.unsplash.com/photo-1596815064285-45ed8a9c0463?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                        'https://images.unsplash.com/photo-1669462277329-9d7ff2020011?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                        'https://images.unsplash.com/photo-1615109398623-88346a601842?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                        'https://images.unsplash.com/photo-1574269909862-7e1d70bb8078?w=200&h=200&fit=crop&crop=face&auto=format&q=80'
                    ],
                    trained: true
                }
            ];
            console.log('Demo team members with stock photos loaded:', teamMembers);
            updateTeamMembersList();
            updatePersonSelects();
            
            // Auto-select first member for easier testing
            setTimeout(() => {
                const personSelect = document.getElementById('person-select');
                if (personSelect && teamMembers.length > 0) {
                    personSelect.value = teamMembers[0].id;
                    console.log('Auto-selected first team member:', teamMembers[0].name);
                }
            }, 50);
        }

        function clearDemoData() {
            if (confirm('This will remove all team members. Are you sure?')) {
                teamMembers = [];
                generatedImages = [];
                updateTeamMembersList();
                updatePersonSelects();
                document.getElementById('generated-images-section').classList.add('hidden');
            }
        }

        function toggleAIMode() {
            useRealAI = !useRealAI;
            const toggle = document.getElementById('ai-mode-toggle');
            const description = document.getElementById('ai-mode-description');
            const apiKeySection = document.getElementById('api-key-section');
            const generateBtnText = document.getElementById('generate-btn-text');
            
            if (useRealAI) {
                toggle.textContent = 'Real AI Mode';
                toggle.classList.remove('bg-blue-500/20', 'text-blue-400', 'border-blue-500/30');
                toggle.classList.add('bg-green-500/20', 'text-green-400', 'border-green-500/30');
                description.textContent = 'Using real AI services (DALL-E 3 or Stable Diffusion XL). Requires API key.';
                apiKeySection.classList.remove('hidden');
                generateBtnText.textContent = 'Generate AI Image (Real AI)';
                
                // Check if API key is already saved
                const savedKey = localStorage.getItem('ai_api_key');
                if (savedKey) {
                    document.getElementById('api-key-input').value = savedKey;
                    updateAPIKey();
                }
            } else {
                toggle.textContent = 'Demo Mode';
                toggle.classList.remove('bg-green-500/20', 'text-green-400', 'border-green-500/30');
                toggle.classList.add('bg-blue-500/20', 'text-blue-400', 'border-blue-500/30');
                description.textContent = 'Using demo SVG generation. Switch to Real AI for DALL-E/Stable Diffusion.';
                apiKeySection.classList.add('hidden');
                generateBtnText.textContent = 'Generate AI Image (Demo)';
            }
        }

        function updateAPIKey() {
            const apiKey = document.getElementById('api-key-input').value.trim();
            console.log('=== updateAPIKey() called ===');
            console.log('API key input value:', apiKey);
            if (apiKey.startsWith('sk-')) {
                OPENAI_API_KEY = apiKey;
                REPLICATE_API_KEY = '';
                HUGGINGFACE_API_KEY = '';
                localStorage.setItem('ai_api_key', apiKey);
                localStorage.setItem('ai_service', 'openai');
                console.log('OpenAI API key configured');
            } else if (apiKey.startsWith('r8_')) {
                REPLICATE_API_KEY = apiKey;
                OPENAI_API_KEY = '';
                HUGGINGFACE_API_KEY = '';
                localStorage.setItem('ai_api_key', apiKey);
                localStorage.setItem('ai_service', 'replicate');
                console.log('Replicate API key configured');
            } else if (apiKey.startsWith('hf_')) {
                HUGGINGFACE_API_KEY = apiKey;
                OPENAI_API_KEY = '';
                REPLICATE_API_KEY = '';
                CLAUDE_API_KEY = '';
                localStorage.setItem('ai_api_key', apiKey);
                localStorage.setItem('ai_service', 'huggingface');
                console.log('Hugging Face API key configured');
            } else if (apiKey.startsWith('sk-ant-')) {
                CLAUDE_API_KEY = apiKey;
                OPENAI_API_KEY = '';
                REPLICATE_API_KEY = '';
                HUGGINGFACE_API_KEY = '';
                localStorage.setItem('ai_api_key', apiKey);
                localStorage.setItem('ai_service', 'claude');
                console.log('Claude API key configured');
            } else if (apiKey === '') {
                OPENAI_API_KEY = '';
                REPLICATE_API_KEY = '';
                HUGGINGFACE_API_KEY = '';
                CLAUDE_API_KEY = '';
                localStorage.removeItem('ai_api_key');
                localStorage.removeItem('ai_service');
            }
        }

        // Claude API Key Update Function
        function updateClaudeAPIKey() {
            const apiKey = document.getElementById('claude-api-key-input').value.trim();
            console.log('=== updateClaudeAPIKey() called ===');
            console.log('Claude API key input value:', apiKey);
            
            if (apiKey.startsWith('sk-ant-')) {
                CLAUDE_API_KEY = apiKey;
                localStorage.setItem('claude_api_key', apiKey);
                console.log('Claude API key configured for content generation');
                
                // Show success feedback
                const input = document.getElementById('claude-api-key-input');
                input.style.borderColor = '#10b981';
                setTimeout(() => {
                    input.style.borderColor = '';
                }, 2000);
            } else if (apiKey === '') {
                CLAUDE_API_KEY = '';
                localStorage.removeItem('claude_api_key');
                console.log('Claude API key cleared');
            } else {
                console.log('Invalid Claude API key format');
                alert('Please enter a valid Claude API key (starts with sk-ant-)');
                
                // Show error feedback
                const input = document.getElementById('claude-api-key-input');
                input.style.borderColor = '#ef4444';
                setTimeout(() => {
                    input.style.borderColor = '';
                }, 2000);
            }
        }

        // Initialize Personal AI Studio
        function initPersonalAIStudio() {
            selectSubject('individual');
            selectSetting('professional-office');
            updateTeamMembersList();
            updatePersonSelects();
        }

        // Initialize when page loads
        initPersonalAIStudio();
        
        // Initialize Claude API key from localStorage
        const savedClaudeKey = localStorage.getItem('claude_api_key');
        if (savedClaudeKey) {
            document.getElementById('claude-api-key-input').value = savedClaudeKey;
            CLAUDE_API_KEY = savedClaudeKey;
            console.log('Claude API key loaded from localStorage');
        }

        // Add demo team members for testing with stock photos
        if (demoMode) {
            setTimeout(() => {
                console.log('Adding demo team members with stock photos...');
                // Add demo team members with diverse, professional stock photos from Unsplash
                // All photos are free to use under Unsplash License (https://unsplash.com/license)
                teamMembers = [
                    {
                        id: 1,
                        name: 'Alex Thompson',
                        role: 'CEO & Founder',
                        photos: [
                            'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                            'https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                            'https://images.unsplash.com/photo-1527980965255-d3b416303d12?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                            'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                            'https://images.unsplash.com/photo-1519085360753-af0119f7cbe7?w=200&h=200&fit=crop&crop=face&auto=format&q=80'
                        ],
                        trained: true
                    },
                    {
                        id: 2,
                        name: 'Sarah Chen',
                        role: 'Chief Technology Officer',
                        photos: [
                            'https://images.unsplash.com/photo-1494790108755-2616b612b47c?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                            'https://images.unsplash.com/photo-1573496359142-b8d87734a5a2?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                            'https://images.unsplash.com/photo-1580489944761-15a19d654956?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                            'https://images.unsplash.com/photo-1487412720507-e7ab37603c6f?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                            'https://images.unsplash.com/photo-1590031905406-f18a426d772d?w=200&h=200&fit=crop&crop=face&auto=format&q=80'
                        ],
                        trained: true
                    },
                    {
                        id: 3,
                        name: 'Marcus Rodriguez',
                        role: 'Head of Product',
                        photos: [
                            'https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                            'https://images.unsplash.com/photo-1560250097-0b93528c311a?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                            'https://images.unsplash.com/photo-1612198188060-c7c2a3b66eae?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                            'https://images.unsplash.com/photo-1582750433449-648ed127bb54?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                            'https://images.unsplash.com/photo-1568602471122-7832951cc4c5?w=200&h=200&fit=crop&crop=face&auto=format&q=80'
                        ],
                        trained: true
                    },
                    {
                        id: 4,
                        name: 'Jessica Park',
                        role: 'VP of Marketing',
                        photos: [
                            'https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                            'https://images.unsplash.com/photo-1534528741775-53994a69daeb?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                            'https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                            'https://images.unsplash.com/photo-1607746882042-944635dfe10e?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                            'https://images.unsplash.com/photo-1551836022-8b2858c9c69b?w=200&h=200&fit=crop&crop=face&auto=format&q=80'
                        ],
                        trained: true
                    },
                    {
                        id: 5,
                        name: 'David Kumar',
                        role: 'Chief Financial Officer',
                        photos: [
                            'https://images.unsplash.com/photo-1566492031773-4f4e44671d66?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                            'https://images.unsplash.com/photo-1558222218-b7b54eede3f3?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                            'https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                            'https://images.unsplash.com/photo-1463453091185-61582044d556?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                            'https://images.unsplash.com/photo-1607990281513-2c110a25bd8c?w=200&h=200&fit=crop&crop=face&auto=format&q=80'
                        ],
                        trained: true
                    },
                    {
                        id: 6,
                        name: 'Maria Gonzalez',
                        role: 'Head of Operations',
                        photos: [
                            'https://images.unsplash.com/photo-1664575602554-2087b04935a5?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                            'https://images.unsplash.com/photo-1594736797933-d0501ba2fe65?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                            'https://images.unsplash.com/photo-1619895862022-09114b41f16f?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                            'https://images.unsplash.com/photo-1598300042247-d088f8ab3a91?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                            'https://images.unsplash.com/photo-1508214751196-bcfd4ca60f91?w=200&h=200&fit=crop&crop=face&auto=format&q=80'
                        ],
                        trained: true
                    },
                    {
                        id: 7,
                        name: 'James Wilson',
                        role: 'VP of Engineering',
                        photos: [
                            'https://images.unsplash.com/photo-1507591064344-4c6ce005b128?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                            'https://images.unsplash.com/photo-1557862921-37829c790f19?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                            'https://images.unsplash.com/photo-1552058544-f2b08422138a?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                            'https://images.unsplash.com/photo-1614644147724-2d4785d69962?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                            'https://images.unsplash.com/photo-1488161628813-04466f872be2?w=200&h=200&fit=crop&crop=face&auto=format&q=80'
                        ],
                        trained: true
                    },
                    {
                        id: 8,
                        name: 'Lisa Chang',
                        role: 'Head of Design',
                        photos: [
                            'https://images.unsplash.com/photo-1651008376811-b90baee60c1f?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                            'https://images.unsplash.com/photo-1596815064285-45ed8a9c0463?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                            'https://images.unsplash.com/photo-1669462277329-9d7ff2020011?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                            'https://images.unsplash.com/photo-1615109398623-88346a601842?w=200&h=200&fit=crop&crop=face&auto=format&q=80',
                            'https://images.unsplash.com/photo-1574269909862-7e1d70bb8078?w=200&h=200&fit=crop&crop=face&auto=format&q=80'
                        ],
                        trained: true
                    }
                ];
                console.log('Demo team members with stock photos added:', teamMembers);
                updateTeamMembersList();
                updatePersonSelects();
                
                // Auto-select first member for easier testing
                setTimeout(() => {
                    const personSelect = document.getElementById('person-select');
                    if (personSelect && teamMembers.length > 0) {
                        personSelect.value = teamMembers[0].id;
                        console.log('Auto-selected first team member:', teamMembers[0].name);
                    }
                }, 50);
            }, 100);
        }

        // Stripe Payment Functions
        async function selectPlan(planType) {
            if (planType === 'enterprise') {
                // For enterprise, show contact form
                alert('Enterprise plan requires custom setup. Please contact sales@agenticintelligence.com for pricing and setup.');
                return;
            }

            if (planType === userUsage.plan) {
                alert('You are already on this plan.');
                return;
            }

            // Create payment modal
            showPaymentModal(planType);
        }

        function showPaymentModal(planType) {
            const price = planType === 'pro' ? 29 : 0;
            
            // Create modal
            const modal = document.createElement('div');
            modal.id = 'payment-modal';
            modal.className = 'fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4';
            
            modal.innerHTML = `
                <div class="bg-slate-800 rounded-xl p-6 w-full max-w-md border border-slate-700">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-white">Upgrade to ${planType.charAt(0).toUpperCase() + planType.slice(1)}</h3>
                        <button onclick="closePaymentModal()" class="text-slate-400 hover:text-slate-200">
                            <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    
                    <div class="text-center mb-6">
                        <div class="text-3xl font-bold text-white mb-2">$${price}/month</div>
                        <div class="text-sm text-slate-400">Billed monthly, cancel anytime</div>
                    </div>
                    
                    <!-- Payment Methods -->
                    <div class="mb-6">
                        <h4 class="text-sm font-medium text-slate-300 mb-3">Choose Payment Method</h4>
                        <div class="space-y-3">
                            <!-- Credit Card (Stripe) -->
                            <button id="payment-method-card" class="w-full p-4 bg-slate-700/50 border border-slate-600 rounded-lg text-left hover:bg-slate-700/70 transition-colors payment-method-btn active">
                                <div class="flex items-center space-x-3">
                                    <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center">
                                        <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path>
                                        </svg>
                                    </div>
                                    <div>
                                        <div class="text-white font-medium">Credit Card</div>
                                        <div class="text-sm text-slate-400">Visa, MasterCard, American Express</div>
                                    </div>
                                </div>
                            </button>
                            
                            <!-- PayPal -->
                            <button id="payment-method-paypal" class="w-full p-4 bg-slate-700/50 border border-slate-600 rounded-lg text-left hover:bg-slate-700/70 transition-colors payment-method-btn">
                                <div class="flex items-center space-x-3">
                                    <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center">
                                        <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M7.076 21.337H2.47a.641.641 0 0 1-.633-.74L4.944.901C5.026.382 5.474 0 5.998 0h7.46c2.57 0 4.578.543 5.69 1.81 1.01 1.15 1.304 2.42 1.012 4.287-.023.143-.047.288-.077.437-.983 5.05-4.349 6.797-8.647 6.797h-2.19c-.524 0-.968.382-1.05.9l-1.12 7.106zm14.146-14.42a3.35 3.35 0 0 0-.607-.541c-.013.076-.026.175-.041.25-.983 5.05-4.349 6.797-8.647 6.797h-2.19c-.524 0-.968.382-1.05.9l-1.12 7.106h4.608a.641.641 0 0 0 .633-.74l1.057-6.708c.082-.518.526-.9 1.05-.9h1.351c3.766 0 6.719-1.527 7.578-5.937.72-3.704-.4-6.227-2.622-7.627z"/>
                                        </svg>
                                    </div>
                                    <div>
                                        <div class="text-white font-medium">PayPal</div>
                                        <div class="text-sm text-slate-400">Pay with your PayPal account</div>
                                    </div>
                                </div>
                            </button>
                            
                            <!-- Apple Pay -->
                            <button id="payment-method-apple" class="w-full p-4 bg-slate-700/50 border border-slate-600 rounded-lg text-left hover:bg-slate-700/70 transition-colors payment-method-btn">
                                <div class="flex items-center space-x-3">
                                    <div class="w-8 h-8 bg-gray-800 rounded-full flex items-center justify-center">
                                        <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M18.71 19.5c-.83 1.24-1.71 2.45-3.05 2.47-1.34.03-1.77-.79-3.29-.79-1.53 0-2 .77-3.27.82-1.31.05-2.3-1.32-3.14-2.53C4.25 17 2.94 12.45 4.7 9.39c.87-1.52 2.43-2.48 4.12-2.51 1.28-.02 2.5.87 3.29.87.78 0 2.26-1.07 3.81-.91.65.03 2.47.26 3.64 1.98-.09.06-2.17 1.28-2.15 3.81.03 3.02 2.65 4.03 2.68 4.04-.03.07-.42 1.44-1.38 2.83M13 3.5c.73-.83 1.94-1.46 2.94-1.5.13 1.17-.34 2.35-1.04 3.19-.69.85-1.83 1.51-2.95 1.42-.15-1.15.41-2.35 1.05-3.11z"/>
                                        </svg>
                                    </div>
                                    <div>
                                        <div class="text-white font-medium">Apple Pay</div>
                                        <div class="text-sm text-slate-400">Pay with Touch ID or Face ID</div>
                                    </div>
                                </div>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Payment Form -->
                    <div id="payment-element" class="mb-4">
                        <!-- Payment forms will be mounted here -->
                    </div>
                    
                    <div class="space-y-3">
                        <button id="submit-payment" class="w-full py-3 px-4 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:scale-105 transition-transform">
                            <span id="submit-text">Subscribe Now</span>
                            <div id="loading-spinner" class="hidden flex items-center justify-center">
                                <svg class="animate-spin h-4 w-4 text-white" fill="none" viewBox="0 0 24 24">
                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                </svg>
                                <span class="ml-2">Processing...</span>
                            </div>
                        </button>
                        
                        <div class="text-xs text-slate-400 text-center">
                            Secure payment powered by Stripe, PayPal & Apple Pay ‚Ä¢ Cancel anytime
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Initialize Stripe Elements (Demo - Replace with real implementation)
            initializeStripeElements(planType, price);
        }

        function closePaymentModal() {
            const modal = document.getElementById('payment-modal');
            if (modal) {
                modal.remove();
            }
        }

        async function initializeStripeElements(planType, price) {
            // In a real implementation, you would:
            // 1. Create a payment intent on your backend
            // 2. Pass the client secret to the frontend
            // 3. Initialize Stripe Elements with the client secret
            
            // For demo purposes, we'll simulate the payment process
            const submitButton = document.getElementById('submit-payment');
            const paymentElement = document.getElementById('payment-element');
            
            // Add demo payment form
            paymentElement.innerHTML = `
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-2">Card Number</label>
                        <input type="text" placeholder="4242 4242 4242 4242" class="w-full px-3 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white" readonly>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-slate-300 mb-2">Expiry</label>
                            <input type="text" placeholder="12/25" class="w-full px-3 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white" readonly>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-300 mb-2">CVC</label>
                            <input type="text" placeholder="123" class="w-full px-3 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white" readonly>
                        </div>
                    </div>
                    <div class="bg-blue-500/10 border border-blue-500/30 rounded-lg p-3">
                        <div class="text-xs text-blue-400">
                            <strong>Demo Mode:</strong> This is a demonstration. No real payment will be processed.
                        </div>
                    </div>
                </div>
            `;
            
            // Add event listeners for payment method selection
            document.getElementById('payment-method-card').addEventListener('click', () => selectPaymentMethod('card'));
            document.getElementById('payment-method-paypal').addEventListener('click', () => selectPaymentMethod('paypal'));
            document.getElementById('payment-method-apple').addEventListener('click', () => selectPaymentMethod('apple'));
            
            // Initialize with credit card form
            showPaymentForm('card');
            
            submitButton.addEventListener('click', async (e) => {
                e.preventDefault();
                const selectedMethod = document.querySelector('.payment-method-btn.active').id.replace('payment-method-', '');
                await processPayment(planType, price, selectedMethod);
            });
        }
        

        async function processPayment(planType, price, paymentMethod = 'card') {
            const submitButton = document.getElementById('submit-payment');
            const submitText = document.getElementById('submit-text');
            const loadingSpinner = document.getElementById('loading-spinner');
            
            // Show loading state
            submitText.classList.add('hidden');
            loadingSpinner.classList.remove('hidden');
            submitButton.disabled = true;
            
            // Update button text based on payment method
            const processingText = {
                'card': 'Processing payment...',
                'paypal': 'Redirecting to PayPal...',
                'apple': 'Authorizing with Apple Pay...'
            };
            
            const loadingText = document.querySelector('#loading-spinner span');
            if (loadingText) {
                loadingText.textContent = processingText[paymentMethod] || 'Processing...';
            }
            
            try {
                // Simulate API call delay
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // In a real implementation, this would:
                // 1. Confirm the payment with Stripe
                // 2. Update the user's subscription on your backend
                // 3. Return success/failure
                
                // For demo, simulate successful payment
                const success = Math.random() > 0.1; // 90% success rate for demo
                
                if (success) {
                    // Update user plan
                    userUsage.plan = planType;
                    userUsage.subscriptionDate = new Date().toISOString();
                    userUsage.subscriptionEndDate = new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString(); // 30 days from now
                    
                    // Reset usage counters for new plan
                    userUsage.postsGenerated = 0;
                    userUsage.aiImagesGenerated = 0;
                    
                    saveUserUsage();
                    closePaymentModal();
                    
                    // Show success message
                    const paymentMethodName = {
                        'card': 'Credit Card',
                        'paypal': 'PayPal',
                        'apple': 'Apple Pay'
                    };
                    alert(`üéâ Successfully upgraded to ${planType.charAt(0).toUpperCase() + planType.slice(1)} plan via ${paymentMethodName[paymentMethod] || 'Credit Card'}! You can now generate more content.`);
                    
                    // Refresh billing tab if currently viewing
                    const billingTab = document.getElementById('content-billing');
                    if (!billingTab.classList.contains('hidden')) {
                        showTab('billing');
                    }
                } else {
                    throw new Error('Payment failed');
                }
            } catch (error) {
                alert('Payment failed. Please try again or contact support.');
                console.error('Payment error:', error);
            } finally {
                // Reset button state
                submitText.classList.remove('hidden');
                loadingSpinner.classList.add('hidden');
                submitButton.disabled = false;
            }
        }

        // Initialize authentication, usage tracking and scheduler when page loads
        // Settings Functions
        function saveProfile() {
            if (!currentUser) return;
            
            const name = document.getElementById('settings-name').value;
            const company = document.getElementById('settings-company').value;
            const title = document.getElementById('settings-title').value;
            const timezone = document.getElementById('settings-timezone').value;
            
            // Update user profile
            currentUser.profile = {
                name: name,
                company: company,
                title: title,
                timezone: timezone
            };
            
            // Update the name in the user object itself if changed
            if (name && name !== currentUser.name) {
                currentUser.name = name;
            }
            
            // Save to localStorage
            const users = getUsers();
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                users[userIndex] = currentUser;
                saveUsers(users);
            }
            
            updateUIForLoggedInUser();
            showToast('Profile updated successfully!', 'success');
        }
        
        // Test Mode Functions
        function toggleTestMode() {
            const testModePanel = document.getElementById('test-mode-panel');
            const toggleBtn = document.getElementById('toggle-test-mode');
            
            if (testModePanel.classList.contains('hidden')) {
                testModePanel.classList.remove('hidden');
                toggleBtn.textContent = 'Disable Test Mode';
                toggleBtn.classList.remove('bg-purple-600', 'hover:bg-purple-700');
                toggleBtn.classList.add('bg-red-600', 'hover:bg-red-700');
                showToast('Test Mode enabled - All payments are simulated', 'info');
            } else {
                testModePanel.classList.add('hidden');
                toggleBtn.textContent = 'Enable Test Mode';
                toggleBtn.classList.remove('bg-red-600', 'hover:bg-red-700');
                toggleBtn.classList.add('bg-purple-600', 'hover:bg-purple-700');
                showToast('Test Mode disabled', 'info');
            }
        }
        
        // Global Payment Method Functions
        function selectPaymentMethod(method) {
            // Remove active class from all buttons
            document.querySelectorAll('.payment-method-btn').forEach(btn => btn.classList.remove('active'));
            
            // Add active class to selected button
            const targetBtn = document.getElementById(`payment-method-${method}`);
            if (targetBtn) {
                targetBtn.classList.add('active');
            }
            
            // Show appropriate payment form
            showPaymentForm(method);
        }
        
        function showPaymentForm(method) {
            const paymentElement = document.getElementById('payment-element');
            if (!paymentElement) return;
            
            switch (method) {
                case 'card':
                    paymentElement.innerHTML = `
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-slate-300 mb-2">Card Number</label>
                                <input type="text" placeholder="4242 4242 4242 4242" class="w-full px-3 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white" readonly>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-slate-300 mb-2">Expiry</label>
                                    <input type="text" placeholder="12/25" class="w-full px-3 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white" readonly>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-300 mb-2">CVC</label>
                                    <input type="text" placeholder="123" class="w-full px-3 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white" readonly>
                                </div>
                            </div>
                            <div class="bg-blue-500/10 border border-blue-500/30 rounded-lg p-3">
                                <div class="text-xs text-blue-400">
                                    <strong>Demo Mode:</strong> Stripe integration would be used in production.
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'paypal':
                    paymentElement.innerHTML = `
                        <div class="space-y-4">
                            <div class="p-4 bg-blue-600/10 border border-blue-600/30 rounded-lg">
                                <div class="flex items-center space-x-3">
                                    <svg class="w-8 h-8 text-blue-600" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M7.076 21.337H2.47a.641.641 0 0 1-.633-.74L4.944.901C5.026.382 5.474 0 5.998 0h7.46c2.57 0 4.578.543 5.69 1.81 1.01 1.15 1.304 2.42 1.012 4.287-.023.143-.047.288-.077.437-.983 5.05-4.349 6.797-8.647 6.797h-2.19c-.524 0-.968.382-1.05.9l-1.12 7.106zm14.146-14.42a3.35 3.35 0 0 0-.607-.541c-.013.076-.026.175-.041.25-.983 5.05-4.349 6.797-8.647 6.797h-2.19c-.524 0-.968.382-1.05.9l-1.12 7.106h4.608a.641.641 0 0 0 .633-.74l1.057-6.708c.082-.518.526-.9 1.05-.9h1.351c3.766 0 6.719-1.527 7.578-5.937.72-3.704-.4-6.227-2.622-7.627z"/>
                                    </svg>
                                    <div>
                                        <div class="text-white font-medium">PayPal Payment</div>
                                        <div class="text-sm text-slate-400">You'll be redirected to PayPal to complete payment</div>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-blue-500/10 border border-blue-500/30 rounded-lg p-3">
                                <div class="text-xs text-blue-400">
                                    <strong>Demo Mode:</strong> PayPal SDK would be used in production.
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'apple':
                case 'applepay':
                    paymentElement.innerHTML = `
                        <div class="space-y-4">
                            <div class="p-4 bg-gray-800/50 border border-gray-600/30 rounded-lg">
                                <div class="flex items-center space-x-3">
                                    <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M18.71 19.5c-.83 1.24-1.71 2.45-3.05 2.47-1.34.03-1.77-.79-3.29-.79-1.53 0-2 .77-3.27.82-1.31.05-2.3-1.32-3.14-2.53C4.25 17 2.94 12.45 4.7 9.39c.87-1.52 2.43-2.48 4.12-2.51 1.28-.02 2.5.87 3.29.87.78 0 2.26-1.07 3.81-.91.65.03 2.47.26 3.64 1.98-.09.06-2.17 1.28-2.15 3.81.03 3.02 2.65 4.03 2.68 4.04-.03.07-.42 1.44-1.38 2.83M13 3.5c.73-.83 1.94-1.46 2.94-1.5.13 1.17-.34 2.35-1.04 3.19-.69.85-1.83 1.51-2.95 1.42-.15-1.15.41-2.35 1.05-3.11z"/>
                                    </svg>
                                    <div>
                                        <div class="text-white font-medium">Apple Pay</div>
                                        <div class="text-sm text-slate-400">Touch ID or Face ID required</div>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-blue-500/10 border border-blue-500/30 rounded-lg p-3">
                                <div class="text-xs text-blue-400">
                                    <strong>Demo Mode:</strong> Apple Pay API would be used in production.
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'stripe':
                default:
                    paymentElement.innerHTML = `
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-slate-300 mb-2">Card Number</label>
                                <input type="text" placeholder="4242 4242 4242 4242" class="w-full px-3 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white" readonly>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-slate-300 mb-2">Expiry</label>
                                    <input type="text" placeholder="12/25" class="w-full px-3 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white" readonly>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-300 mb-2">CVC</label>
                                    <input type="text" placeholder="123" class="w-full px-3 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white" readonly>
                                </div>
                            </div>
                            <div class="bg-blue-500/10 border border-blue-500/30 rounded-lg p-3">
                                <div class="text-xs text-blue-400">
                                    <strong>Demo Mode:</strong> Stripe integration would be used in production.
                                </div>
                            </div>
                        </div>
                    `;
                    break;
            }
        }

        function testPlan(planType) {
            if (!currentUser) {
                showToast('Please login first to test subscription plans', 'error');
                return;
            }
            
            // Define plan configurations
            const planConfigs = {
                free: {
                    name: 'Free',
                    postsPerMonth: 5,
                    aiImagesPerMonth: 3,
                    customAITraining: false,
                    support24x7: false,
                    color: 'bg-gray-500/20 text-gray-400'
                },
                pro: {
                    name: 'Pro',
                    postsPerMonth: 100,
                    aiImagesPerMonth: 50,
                    customAITraining: false,
                    support24x7: false,
                    color: 'bg-blue-500/20 text-blue-400'
                },
                enterprise: {
                    name: 'Enterprise',
                    postsPerMonth: -1, // Unlimited
                    aiImagesPerMonth: -1, // Unlimited
                    customAITraining: true,
                    support24x7: true,
                    color: 'bg-purple-500/20 text-purple-400'
                }
            };
            
            const config = planConfigs[planType];
            
            // Update user usage
            if (!userUsage) {
                userUsage = {
                    plan: 'free',
                    postsGenerated: 0,
                    aiImagesGenerated: 0,
                    subscriptionDate: new Date().toISOString(),
                    subscriptionEndDate: null
                };
            }
            
            userUsage.plan = planType;
            userUsage.postsGenerated = 0; // Reset usage for testing
            userUsage.aiImagesGenerated = 0;
            userUsage.subscriptionDate = new Date().toISOString();
            userUsage.subscriptionEndDate = planType === 'free' ? null : new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString();
            
            // Update current user plan
            currentUser.plan = planType;
            currentUser.planLimits = {
                postsPerMonth: config.postsPerMonth,
                aiImagesPerMonth: config.aiImagesPerMonth,
                customAITraining: config.customAITraining,
                support24x7: config.support24x7,
                unlimitedEverything: planType === 'enterprise'
            };
            
            // Save changes
            saveUserUsage();
            const users = getUsers();
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                users[userIndex] = currentUser;
                saveUsers(users);
            }
            
            // Update UI
            loadUserUsage();
            updateUIForLoggedInUser();
            
            // Show success message
            showToast(`üß™ Test Mode: Successfully switched to ${config.name} plan! Usage limits reset.`, 'success');
            
            // Update plan badge
            const planBadge = document.getElementById('current-plan-badge');
            if (planBadge) {
                planBadge.className = `text-xs px-3 py-1 rounded-full ${config.color}`;
                planBadge.textContent = `${config.name} Plan`;
            }
        }
        
        function updateEmail() {
            if (!currentUser) return;
            
            const newEmail = document.getElementById('settings-email').value;
            const currentPassword = document.getElementById('settings-current-password').value;
            
            if (!newEmail || !currentPassword) {
                showToast('Please fill in both email and current password', 'error');
                return;
            }
            
            // Verify current password
            if (currentPassword !== currentUser.password) {
                showToast('Current password is incorrect', 'error');
                return;
            }
            
            // Check if email is already in use
            const users = getUsers();
            const emailExists = users.some(u => u.email === newEmail && u.id !== currentUser.id);
            
            if (emailExists) {
                showToast('Email is already in use by another account', 'error');
                return;
            }
            
            // Update email
            currentUser.email = newEmail;
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                users[userIndex] = currentUser;
                saveUsers(users);
            }
            
            updateUIForLoggedInUser();
            showToast('Email updated successfully!', 'success');
            
            // Clear password field
            document.getElementById('settings-current-password').value = '';
        }
        
        function changePassword() {
            if (!currentUser) return;
            
            const currentPassword = document.getElementById('settings-current-password').value;
            const newPassword = document.getElementById('settings-new-password').value;
            const confirmPassword = document.getElementById('settings-confirm-password').value;
            
            if (!currentPassword || !newPassword || !confirmPassword) {
                showToast('Please fill in all password fields', 'error');
                return;
            }
            
            if (currentPassword !== currentUser.password) {
                showToast('Current password is incorrect', 'error');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showToast('New passwords do not match', 'error');
                return;
            }
            
            if (newPassword.length < 6) {
                showToast('New password must be at least 6 characters', 'error');
                return;
            }
            
            // Update password
            currentUser.password = newPassword;
            const users = getUsers();
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                users[userIndex] = currentUser;
                saveUsers(users);
            }
            
            showToast('Password changed successfully!', 'success');
            
            // Clear password fields
            document.getElementById('settings-current-password').value = '';
            document.getElementById('settings-new-password').value = '';
            document.getElementById('settings-confirm-password').value = '';
        }
        
        function connectLinkedIn() {
            console.log('üîó connectLinkedIn function called');
            console.log('üîó currentUser:', currentUser);
            
            // Simulate LinkedIn connection (in real app this would be OAuth)
            if (!currentUser) {
                alert('Please log in first to connect LinkedIn');
                return false;
            }
            
            // Show confirmation dialog
            const confirmConnect = confirm('This will open LinkedIn\'s authorization page to connect your account. Continue?');
            
            if (confirmConnect) {
                alert('Connecting to LinkedIn...');
                
                // Simulate connection process
                setTimeout(() => {
                    // For demo purposes, we'll just mark as connected
                    currentUser.linkedInConnected = true;
                    currentUser.linkedInProfile = currentUser.name + " - " + (currentUser.profile?.title || 'Professional');
                    
                    const users = getUsers();
                    const userIndex = users.findIndex(u => u.id === currentUser.id);
                    if (userIndex !== -1) {
                        users[userIndex] = currentUser;
                        saveUsers(users);
                    }
                    
                    updateLinkedInStatus();
                    alert('LinkedIn connected successfully! üéâ');
                    
                    // Show analytics status if on analytics page
                    const analyticsStatus = document.getElementById('linkedin-analytics-status');
                    if (analyticsStatus) {
                        analyticsStatus.classList.remove('hidden');
                    }
                }, 1500);
            }
            
            return false;
        }
        
        // Make sure function is globally accessible
        window.connectLinkedIn = connectLinkedIn;
        
        // Debug: Test if function is accessible
        console.log('üî• connectLinkedIn function defined:', typeof connectLinkedIn);
        console.log('üî• window.connectLinkedIn defined:', typeof window.connectLinkedIn);
        
        function disconnectLinkedIn() {
            if (confirm('Are you sure you want to disconnect your LinkedIn account?')) {
                console.log('üîå Disconnecting LinkedIn...');
                
                // Remove persistent LinkedIn connection
                localStorage.removeItem('aifluence_linkedin_connection');
                
                // Update user data
                const users = JSON.parse(localStorage.getItem('socialMediaAgent_users') || '[]');
                const currentUserId = localStorage.getItem('socialMediaAgent_currentUserId');
                const userIndex = users.findIndex(u => u.id === currentUserId);
                
                if (userIndex !== -1) {
                    users[userIndex].linkedInConnected = false;
                    users[userIndex].linkedInProfile = null;
                    users[userIndex].linkedInAuthCode = null;
                    users[userIndex].linkedInConnectedAt = null;
                    localStorage.setItem('socialMediaAgent_users', JSON.stringify(users));
                    console.log('‚úÖ User LinkedIn data cleared');
                }
                
                // Update UI to show disconnected state
                if (typeof updateLinkedInStatusDisplay === 'function') {
                    updateLinkedInStatusDisplay();
                }
                if (typeof updateLinkedInStatus === 'function') {
                    updateLinkedInStatus();
                }
                
                // Reset LinkedIn connect page to original state
                const connectSection = document.querySelector('#content-linkedin .bg-slate-800\/50');
                if (connectSection) {
                    connectSection.innerHTML = `
                        <div class="text-center">
                            <div class="flex justify-center mb-6">
                                <div class="p-4 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full">
                                    <svg class="h-8 w-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"></path>
                                    </svg>
                                </div>
                            </div>
                            <h3 class="text-xl font-semibold text-white mb-3">Connect Your LinkedIn Account</h3>
                            <p class="text-slate-400 mb-6 max-w-md mx-auto">
                                Securely connect your LinkedIn profile to enable direct posting of your generated content.
                            </p>
                            <button onclick="window.connectLinkedIn()" class="px-8 py-3 bg-linkedin hover:bg-linkedin-hover text-white font-semibold rounded-lg transition-all duration-300 hover:scale-105">
                                <div class="flex items-center space-x-2">
                                    <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"></path>
                                    </svg>
                                    <span>Connect to LinkedIn</span>
                                </div>
                            </button>
                        </div>
                    `;
                }
                
                showToast('LinkedIn disconnected successfully!', 'success');
            }
        }
        
        // Make sure disconnect function is globally accessible immediately
        window.disconnectLinkedIn = disconnectLinkedIn;
        console.log('‚úÖ window.disconnectLinkedIn assigned:', typeof window.disconnectLinkedIn);
        
        function updateLinkedInStatus() {
            console.log('üîÑ updateLinkedInStatus() called');
            
            const connectedDiv = document.getElementById('linkedin-connected');
            const disconnectedDiv = document.getElementById('linkedin-disconnected');
            const profileName = document.getElementById('linkedin-profile-name');
            const analyticsStatus = document.getElementById('linkedin-analytics-status');
            
            console.log('üîç DOM elements found:', {
                connectedDiv: !!connectedDiv,
                disconnectedDiv: !!disconnectedDiv,
                profileName: !!profileName
            });
            
            const isConnected = typeof window.isLinkedInConnected === 'function' ? window.isLinkedInConnected() : false;
            console.log('üîó LinkedIn connected status:', isConnected);
            
            if (isConnected) {
                connectedDiv.classList.remove('hidden');
                disconnectedDiv.classList.add('hidden');
                const connectionInfo = window.getLinkedInConnectionInfo();
                if (profileName && connectionInfo.profile) {
                    profileName.textContent = connectionInfo.profile;
                }
                // Show analytics status for connected accounts
                if (analyticsStatus) {
                    analyticsStatus.classList.remove('hidden');
                }
            } else {
                connectedDiv.classList.add('hidden');
                disconnectedDiv.classList.remove('hidden');
                // Hide analytics status for disconnected accounts
                if (analyticsStatus) {
                    analyticsStatus.classList.add('hidden');
                }
            }
        }
        
        function saveNotificationPreferences() {
            if (!currentUser) return;
            
            const emailNotifications = document.getElementById('email-notifications').checked;
            const postReminders = document.getElementById('post-reminders').checked;
            const weeklyAnalytics = document.getElementById('weekly-analytics').checked;
            
            currentUser.preferences = {
                emailNotifications: emailNotifications,
                postReminders: postReminders,
                weeklyAnalytics: weeklyAnalytics
            };
            
            const users = getUsers();
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                users[userIndex] = currentUser;
                saveUsers(users);
            }
            
            showToast('Notification preferences saved!', 'success');
        }
        
        function updateUsageStatistics() {
            if (!currentUser) return;
            
            // Update usage display
            const postsGenerated = userUsage.postsGenerated || 0;
            const postsScheduled = scheduledPosts.length || 0;
            const daysActive = userUsage.daysActive || 1;
            
            document.getElementById('usage-posts-generated').textContent = postsGenerated;
            document.getElementById('usage-posts-scheduled').textContent = postsScheduled;
            document.getElementById('usage-days-active').textContent = daysActive;
            
            // Update progress bar based on user plan
            let limit = 5; // Default free plan limit
            let limitText = `${postsGenerated} / ${limit} posts`;
            let percentage = Math.min((postsGenerated / limit) * 100, 100);
            
            if (currentUser && currentUser.plan === 'enterprise') {
                limitText = `${postsGenerated} posts (Unlimited ‚àû)`;
                percentage = Math.min(postsGenerated * 2, 100); // Just show some progress for visual appeal
            } else if (currentUser && currentUser.plan === 'pro') {
                limit = 100;
                limitText = `${postsGenerated} / ${limit} posts`;
                percentage = Math.min((postsGenerated / limit) * 100, 100);
            }
            
            document.getElementById('usage-progress-bar').style.width = percentage + '%';
            document.getElementById('usage-limit-text').textContent = limitText;
            
            // Update progress bar color based on plan
            const progressBar = document.getElementById('usage-progress-bar');
            if (currentUser.plan === 'enterprise') {
                progressBar.className = 'bg-gradient-to-r from-purple-500 to-pink-500 h-2 rounded-full transition-all duration-300';
            } else if (currentUser.plan === 'pro') {
                progressBar.className = 'bg-blue-500 h-2 rounded-full transition-all duration-300';
            } else {
                progressBar.className = 'bg-blue-500 h-2 rounded-full transition-all duration-300';
            }
        }
        
        function exportAccountData() {
            if (!currentUser) return;
            
            const data = {
                user: {
                    name: currentUser.name,
                    email: currentUser.email,
                    profile: currentUser.profile || {},
                    preferences: currentUser.preferences || {},
                    linkedInConnected: currentUser.linkedInConnected || false
                },
                scheduledPosts: scheduledPosts,
                usage: userUsage,
                exportDate: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `social-media-agent-data-${currentUser.name}-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showToast('Account data exported successfully!', 'success');
        }
        
        function clearAllScheduledPosts() {
            if (!currentUser) return;
            
            if (confirm('Are you sure you want to clear all scheduled posts? This action cannot be undone.')) {
                scheduledPosts = [];
                saveScheduledPosts();
                updateSchedulerDisplay();
                updateUsageStatistics();
                showToast('All scheduled posts cleared', 'info');
            }
        }
        
        window.deleteAccount = function() {
            // Get current user from localStorage
            const users = getUsers();
            const currentUserId = localStorage.getItem('socialMediaAgent_currentUserId');
            const currentUser = users.find(u => u.id === currentUserId);
            
            if (!currentUser) {
                alert('No user is currently logged in. Please log in first.');
                return;
            }
            
            const confirmation = prompt('Type "DELETE" to permanently delete your account and all data:');
            
            if (confirmation === 'DELETE') {
                // Remove user from users list
                const users = getUsers();
                const filteredUsers = users.filter(u => u.id !== currentUser.id);
                saveUsers(filteredUsers);
                
                // Clear current session
                localStorage.removeItem('socialMediaAgent_currentUserId');
                localStorage.removeItem(`socialMediaAgent_scheduledPosts_${currentUser.id}`);
                localStorage.removeItem(`socialMediaAgent_usage_${currentUser.id}`);
                
                // Reset state
                currentUser = null;
                isLoggedIn = false;
                scheduledPosts = [];
                
                // Show auth modal
                document.getElementById('auth-modal').classList.remove('hidden');
                document.getElementById('user-header').classList.add('hidden');
                
                showToast('Account deleted permanently', 'info');
            } else if (confirmation !== null) {
                showToast('Account deletion cancelled - incorrect confirmation', 'error');
            }
        }
        
        function loadSettingsData() {
            if (!currentUser) return;
            
            console.log('‚öôÔ∏è Loading settings data...');
            
            // Force update LinkedIn status
            if (typeof updateLinkedInStatus === 'function') {
                console.log('üîÑ Updating LinkedIn status in settings...');
                updateLinkedInStatus();
            }
            
            // Load profile data
            if (currentUser.profile) {
                document.getElementById('settings-name').value = currentUser.profile.name || currentUser.name || '';
                document.getElementById('settings-company').value = currentUser.profile.company || '';
                document.getElementById('settings-title').value = currentUser.profile.title || '';
                document.getElementById('settings-timezone').value = currentUser.profile.timezone || 'UTC-5';
            } else {
                document.getElementById('settings-name').value = currentUser.name || '';
            }
            
            // Load email
            document.getElementById('settings-email').value = currentUser.email || '';
            
            // Update LinkedIn status
            updateLinkedInStatus();
            
            // Load notification preferences
            if (currentUser.preferences) {
                document.getElementById('email-notifications').checked = currentUser.preferences.emailNotifications !== false;
                document.getElementById('post-reminders').checked = currentUser.preferences.postReminders !== false;
                document.getElementById('weekly-analytics').checked = currentUser.preferences.weeklyAnalytics || false;
            }
            
            // Update usage statistics
            updateUsageStatistics();
            
            // Load billing settings
            loadBillingSettings();
        }

        // Multiple Posts Generation Functions

        async function getRecentTrendsContext(topic) {
            // Simulate getting recent trends and news (in production, this would call real APIs)
            const recentTrends = {
                'ai': [
                    'OpenAI GPT-4 Turbo updates showing 3x faster processing speeds',
                    'Microsoft Copilot integration seeing 40% productivity gains in enterprise',
                    'AI regulation discussions in EU focusing on responsible deployment',
                    'Google Gemini showing breakthroughs in multimodal AI capabilities',
                    'Enterprise AI adoption rate hitting 60% in Fortune 500 companies this quarter'
                ],
                'digital transformation': [
                    'Cloud migration accelerating with 70% hybrid cloud adoption',
                    'Low-code platforms reducing development time by 50%',
                    'API-first strategies becoming standard for digital integration',
                    'Edge computing growing 35% YoY for real-time processing needs',
                    'Digital customer experience investments up 45% this year'
                ],
                'machine learning': [
                    'MLOps practices showing 60% faster model deployment',
                    'Automated ML platforms reducing data scientist workload by 40%',
                    'Real-time ML inference becoming mainstream in production',
                    'Federated learning gaining traction for privacy-first AI',
                    'ML model governance frameworks now required for compliance'
                ],
                'automation': [
                    'RPA market growing 25% annually with intelligent automation',
                    'Process mining revealing $2M average savings per enterprise',
                    'Hyperautomation strategies combining AI, RPA, and human oversight',
                    'No-code automation tools enabling business user self-service',
                    'Intelligent document processing accuracy reaching 95%+'
                ],
                'business strategy': [
                    'Data-driven decision making becoming competitive requirement',
                    'Agile transformation showing 30% faster time-to-market',
                    'Customer-centric strategies driving 25% revenue growth',
                    'Sustainability initiatives now core to business planning',
                    'Remote work policies stabilizing with hybrid models'
                ]
            };

            const topicLower = topic.toLowerCase();
            
            // Find relevant trends based on topic keywords
            let relevantTrends = [];
            Object.keys(recentTrends).forEach(key => {
                if (topicLower.includes(key) || key.includes(topicLower.split(' ')[0])) {
                    relevantTrends = relevantTrends.concat(recentTrends[key]);
                }
            });

            // If no specific trends found, use general AI/business trends
            if (relevantTrends.length === 0) {
                relevantTrends = recentTrends['ai'].concat(recentTrends['business strategy']).slice(0, 3);
            }

            // Return 1-2 most relevant trends
            const selectedTrends = relevantTrends.slice(0, 2);
            return selectedTrends.length > 0 ? selectedTrends.join('. ') : null;
        }

        async function generateMultiplePosts() {
            if (!currentUser) {
                showToast('Please log in to generate posts', 'error');
                return;
            }

            const topic = document.getElementById('custom-topic').value || 'AI Readiness Assessment';
            const audience = document.getElementById('custom-audience').value || 'C-level executives and business leaders';
            const tone = document.getElementById('custom-tone').value || 'Professional and authoritative';

            showToast('Generating 5 unique posts...', 'info', 6000);
            
            generatedPosts = [];
            selectedPostIds.clear();

            try {
                // Generate 5 different posts with variations
                const variations = [
                    "How-to guide format with actionable steps",
                    "Question-based format to spark discussion",
                    "Story format with real-world example", 
                    "Stat-based format with compelling data",
                    "Tip format with practical advice"
                ];

                for (let i = 0; i < 5; i++) {
                    const variation = variations[i];
                    
                    // Add recent trends and news context
                    const trendContext = await getRecentTrendsContext(topic);
                    
                    const enhancedPrompt = `Create a LinkedIn post about "${topic}" for "${audience}" with a ${tone} tone. 
                    Use ${variation}. Make it unique and engaging.
                    
                    ${trendContext ? `Recent context to reference if relevant: ${trendContext}` : ''}
                    
                    CONTENT REQUIREMENTS:
                    - Keep under 300 characters for optimal engagement
                    - Include relevant hashtags and emojis where appropriate
                    - Focus on bridging business and AI knowledge gap
                    - Reference recent developments or trends if they add value
                    - Make it actionable and valuable for the audience
                    - Avoid generic statements, be specific and insightful
                    
                    Do not mention specific people or companies unless it's major public news.
                    Focus on insights, strategies, and actionable advice.`;

                    const content = await generateContentWithOllama(enhancedPrompt);
                    
                    const post = {
                        id: `multi-post-${Date.now()}-${i}`,
                        content: content,
                        topic: topic,
                        audience: audience,
                        tone: tone,
                        variation: variation,
                        media: await findRelevantMedia(topic, variation, i),
                        timestamp: new Date().toISOString(),
                        originalOrder: i
                    };

                    generatedPosts.push(post);
                }

                displayMultiplePosts();
                showToast('5 posts generated successfully!', 'success');

            } catch (error) {
                console.error('Error generating multiple posts:', error);
                showToast('Error generating posts. Please try again.', 'error');
            }
        }

        async function findRelevantMedia(topic, variation, postIndex = 0) {
            // Ensure each post gets different media by using post index
            const mediaTypes = ['infographic', 'chart', 'illustration'];
            const mediaType = mediaTypes[postIndex % mediaTypes.length];
            
            // HARD NO on people faces - only abstract, technology, and business imagery
            const stockImageSets = {
                business: [
                    'https://images.unsplash.com/photo-1551288049-bebda4e38f71?w=400', // Charts/graphs
                    'https://images.unsplash.com/photo-1460925895917-afdab827c52f?w=400', // Data visualization
                    'https://images.unsplash.com/photo-1504384308090-c894fdcc538d?w=400', // Office workspace
                    'https://images.unsplash.com/photo-1556155092-490a1ba16284?w=400', // Business charts
                    'https://images.unsplash.com/photo-1590283603385-17ffb3a7f29f?w=400'  // Growth charts
                ],
                ai: [
                    'https://images.unsplash.com/photo-1518709268805-4e9042af2176?w=400', // Circuit boards
                    'https://images.unsplash.com/photo-1581291518857-4e27b48ff24e?w=400', // Abstract tech
                    'https://images.unsplash.com/photo-1563206767-5b18f218e8de?w=400', // Data patterns
                    'https://images.unsplash.com/photo-1550751827-4bd374c3f58b?w=400', // Neural networks
                    'https://images.unsplash.com/photo-1485827404703-89b55fcc595e?w=400'  // Technology abstract
                ],
                tech: [
                    'https://images.unsplash.com/photo-1518709268805-4e9042af2176?w=400', // Technology circuits
                    'https://images.unsplash.com/photo-1581291518857-4e27b48ff24e?w=400', // Digital patterns
                    'https://images.unsplash.com/photo-1563206767-5b18f218e8de?w=400', // Code visualization
                    'https://images.unsplash.com/photo-1512317049220-d3c6fcaf6681?w=400', // Server/cloud
                    'https://images.unsplash.com/photo-1550751827-4bd374c3f58b?w=400'  // Digital transformation
                ]
            };

            // Determine image set based on topic keywords
            let imageSet = stockImageSets.business; // default
            const topicLower = topic.toLowerCase();
            if (topicLower.includes('ai') || topicLower.includes('artificial') || topicLower.includes('intelligence') || topicLower.includes('machine learning')) {
                imageSet = stockImageSets.ai;
            } else if (topicLower.includes('tech') || topicLower.includes('digital') || topicLower.includes('automation') || topicLower.includes('software')) {
                imageSet = stockImageSets.tech;
            }

            // Ensure each post gets a different image by using post index
            const imageIndex = postIndex % imageSet.length;
            
            // Create descriptive alt text based on content type
            let altText = `${topic} - ${variation}`;
            if (mediaType === 'infographic') {
                altText = `Infographic: ${topic} insights and strategies`;
            } else if (mediaType === 'chart') {
                altText = `Chart visualization for ${topic}`;
            } else if (mediaType === 'illustration') {
                altText = `Illustration showing ${topic} concepts`;
            }
            
            return {
                type: mediaType,
                url: imageSet[imageIndex],
                alt: altText,
                source: 'Unsplash',
                tags: topic.toLowerCase().split(' '),
                postIndex: postIndex,
                mediaDescription: `${mediaType} related to ${topic}`
            };
        }

        function displayMultiplePosts() {
            const container = document.getElementById('multiple-posts-grid');
            const multiPostsContainer = document.getElementById('multiple-posts-container');
            
            container.innerHTML = '';
            
            generatedPosts.forEach((post, index) => {
                const isSelected = selectedPostIds.has(post.id);
                
                const postCard = document.createElement('div');
                postCard.className = `bg-slate-700/50 rounded-lg p-4 border ${isSelected ? 'border-blue-500' : 'border-slate-600'} transition-all hover:border-slate-500`;
                
                postCard.innerHTML = `
                    <div class="flex items-start space-x-3 mb-3">
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" ${isSelected ? 'checked' : ''} 
                                   onchange="togglePostSelection('${post.id}')"
                                   class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500">
                            <span class="ml-2 text-sm text-slate-300">Select for scheduling</span>
                        </label>
                        <div class="ml-auto text-xs text-slate-400">#${index + 1}</div>
                    </div>
                    
                    <div class="flex space-x-4">
                        <div class="flex-1">
                            <div class="text-xs text-blue-400 mb-2">${post.variation}</div>
                            <div class="bg-slate-800/50 rounded-lg p-3 mb-3">
                                <pre class="text-slate-200 whitespace-pre-wrap text-sm leading-relaxed font-sans">${post.content}</pre>
                            </div>
                            <div class="text-xs text-slate-400">
                                ${post.content.length} characters
                            </div>
                        </div>
                        
                        <div class="w-32 flex-shrink-0">
                            <div class="aspect-square bg-slate-600 rounded-lg overflow-hidden mb-2">
                                <img src="${post.media.url}" alt="${post.media.alt}" 
                                     class="w-full h-full object-cover" 
                                     onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjM0Y0MDUxIi8+CjxwYXRoIGQ9Ik0yNS41IDM1aDQ5YzEuMSAwIDIgLjkgMiAydjI2YzAgMS4xLS45IDItMiAyaC00OWMtMS4xIDAtMi0uOS0yLTJWMzdjMC0xLjEuOS0yIDItMnoiIGZpbGw9IiM2Mzc0OEEiLz4KPGNpcmNsZSBjeD0iNDIiIGN5PSI0NiIgcj0iNSIgZmlsbD0iIzlDQTNBRiIvPgo8cGF0aCBkPSJNMzMgNTVsNi02IDEwIDEwIDE4LTE4IDcgNyIgc3Ryb2tlPSIjOUNBM0FGIiBzdHJva2Utd2lkdGg9IjIiIGZpbGw9Im5vbmUiLz4KPHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+Cjx0ZXh0IHg9IjUwIiB5PSI3NSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0iIzlDQTNBRiIgZm9udC1zaXplPSI4IiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiI+JHtwb3N0Lm1lZGlhLnR5cGV9PC90ZXh0Pgo8L3N2Zz4K'; this.alt='${post.media.type} placeholder';">
                            </div>
                            <div class="text-xs text-slate-400 text-center">${post.media.type} ‚Ä¢ ${post.media.source}</div>
                            <button onclick="changePostMedia('${post.id}')" class="w-full text-xs px-2 py-1 bg-blue-500/20 text-blue-400 rounded mt-1 hover:bg-blue-500/30 transition-colors">
                                Change Media
                            </button>
                            <button onclick="uploadCustomMedia('${post.id}')" class="w-full text-xs px-2 py-1 bg-green-500/20 text-green-400 rounded mt-1 hover:bg-green-500/30 transition-colors">
                                Upload Own
                            </button>
                        </div>
                    </div>
                `;
                
                container.appendChild(postCard);
            });
            
            multiPostsContainer.classList.remove('hidden');
        }

        function togglePostSelection(postId) {
            if (selectedPostIds.has(postId)) {
                selectedPostIds.delete(postId);
            } else {
                selectedPostIds.add(postId);
            }
            
            // Update select all button text
            const selectAllText = document.getElementById('select-all-text');
            if (selectedPostIds.size === generatedPosts.length) {
                selectAllText.textContent = 'Deselect All';
            } else {
                selectAllText.textContent = 'Select All';
            }
            
            displayMultiplePosts();
            updateSchedulingPreview();
        }

        async function scheduleSelectedPosts() {
            if (selectedPostIds.size === 0) {
                showToast('Please select at least one post to schedule', 'error');
                return;
            }

            const selectedPosts = generatedPosts.filter(post => selectedPostIds.has(post.id));
            
            selectedPosts.forEach((post, index) => {
                const scheduledPost = {
                    id: Date.now() + index,
                    content: post.content,
                    media: post.media,
                    scheduledTime: getOptimalTimeForPosition(scheduledPosts.length + index).toISOString(),
                    status: 'scheduled',
                    topic: post.topic,
                    audience: post.audience,
                    tone: post.tone
                };
                
                scheduledPosts.push(scheduledPost);
            });

            saveScheduledPosts();
            updateSchedulerDisplay();
            
            showToast(`${selectedPosts.length} posts scheduled successfully!`, 'success');
            
            // Clear the generated posts
            clearMultiplePosts();
        }

        function clearMultiplePosts() {
            generatedPosts = [];
            selectedPostIds.clear();
            document.getElementById('multiple-posts-container').classList.add('hidden');
            document.getElementById('scheduling-preview').classList.add('hidden');
        }

        function selectAllPosts() {
            const selectAllText = document.getElementById('select-all-text');
            
            if (selectedPostIds.size === generatedPosts.length) {
                // Deselect all
                selectedPostIds.clear();
                selectAllText.textContent = 'Select All';
            } else {
                // Select all
                selectedPostIds.clear();
                generatedPosts.forEach(post => selectedPostIds.add(post.id));
                selectAllText.textContent = 'Deselect All';
            }
            
            displayMultiplePosts();
            updateSchedulingPreview();
        }

        function updateSchedulingPreview() {
            const selectedPosts = generatedPosts.filter(post => selectedPostIds.has(post.id));
            const previewContainer = document.getElementById('scheduling-preview');
            const previewList = document.getElementById('scheduling-preview-list');
            
            if (selectedPosts.length === 0) {
                previewContainer.classList.add('hidden');
                return;
            }
            
            previewContainer.classList.remove('hidden');
            previewList.innerHTML = '';
            
            selectedPosts.forEach((post, index) => {
                const scheduledTime = getOptimalTimeForPosition(scheduledPosts.length + index);
                const previewItem = document.createElement('div');
                previewItem.className = 'schedule-preview-item bg-slate-600/30 rounded-lg p-3 border border-slate-500';
                previewItem.draggable = true;
                previewItem.dataset.postId = post.id;
                
                previewItem.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <div class="drag-handle flex items-center justify-center w-6 h-6 text-slate-400 hover:text-slate-200">
                            <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8h16M4 16h16"></path>
                            </svg>
                        </div>
                        <div class="flex-1">
                            <div class="flex items-center justify-between">
                                <span class="text-sm font-medium text-white">Post ${index + 1}: ${post.variation}</span>
                                <span class="text-xs text-blue-400">${scheduledTime.toLocaleDateString()} at ${scheduledTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span>
                            </div>
                            <div class="text-xs text-slate-300 mt-1 line-clamp-1">${post.content.substring(0, 60)}...</div>
                        </div>
                        <div class="w-12 h-12 rounded overflow-hidden flex-shrink-0">
                            <img src="${post.media.url}" alt="${post.media.alt}" class="w-full h-full object-cover">
                        </div>
                    </div>
                `;
                
                previewList.appendChild(previewItem);
            });
            
            initializePreviewDragAndDrop();
        }

        function initializePreviewDragAndDrop() {
            const previewItems = document.querySelectorAll('.schedule-preview-item');
            let draggedElement = null;

            previewItems.forEach(item => {
                item.addEventListener('dragstart', function(e) {
                    draggedElement = this;
                    this.classList.add('dragging');
                    e.dataTransfer.effectAllowed = 'move';
                    e.dataTransfer.setData('text/html', this.outerHTML);
                });

                item.addEventListener('dragend', function(e) {
                    this.classList.remove('dragging');
                    draggedElement = null;
                });

                item.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'move';
                    
                    const afterElement = getDragAfterElement(this.parentNode, e.clientY);
                    if (afterElement == null) {
                        this.parentNode.appendChild(draggedElement);
                    } else {
                        this.parentNode.insertBefore(draggedElement, afterElement);
                    }
                });

                item.addEventListener('drop', function(e) {
                    e.preventDefault();
                    reorderSchedulingPreview();
                });
            });
        }

        function reorderSchedulingPreview() {
            const previewItems = document.querySelectorAll('.schedule-preview-item');
            const newOrder = [];
            
            previewItems.forEach(item => {
                const postId = item.dataset.postId;
                const post = generatedPosts.find(p => p.id === postId);
                if (post) {
                    newOrder.push(post);
                }
            });
            
            // Update the order of selected posts in generatedPosts array
            const unselectedPosts = generatedPosts.filter(post => !selectedPostIds.has(post.id));
            const reorderedSelectedPosts = newOrder;
            
            // Update the generated posts to reflect the new order
            generatedPosts = [...unselectedPosts, ...reorderedSelectedPosts];
            
            // Update the preview with new times
            updateSchedulingPreview();
            
            showToast('Posts reordered! New scheduling times updated.', 'success');
        }

        async function changePostMedia(postId) {
            const post = generatedPosts.find(p => p.id === postId);
            if (!post) return;

            showToast('Searching for new media...', 'info');
            
            // Simulate finding new media
            const newMedia = await findRelevantMedia(post.topic, post.variation);
            post.media = newMedia;
            
            displayMultiplePosts();
            showToast('Media updated!', 'success');
        }

        // Analytics and Performance Tracking Functions

        function generateContentSuggestions() {
            const suggestionsContainer = document.getElementById('content-suggestions');
            const suggestionsList = document.getElementById('suggestions-list');
            
            // Combine default suggestions with learned patterns
            const defaultSuggestions = analyzeContentPatterns();
            const learnedSuggestions = getContentSuggestionsFromLearning();
            const allSuggestions = [...learnedSuggestions, ...defaultSuggestions];
            
            suggestionsList.innerHTML = '';
            
            allSuggestions.forEach(suggestion => {
                const suggestionCard = document.createElement('div');
                suggestionCard.className = 'p-4 bg-slate-700/30 rounded-lg border border-slate-600';
                
                const priorityColor = suggestion.priority === 'high' ? 'green' : suggestion.priority === 'medium' ? 'yellow' : 'blue';
                const isLearned = learnedSuggestions.includes(suggestion);
                
                suggestionCard.innerHTML = `
                    <div class="flex items-start justify-between mb-2">
                        <div class="flex items-center space-x-2">
                            <h4 class="text-white font-medium">${suggestion.title}</h4>
                            ${isLearned ? '<span class="text-xs px-2 py-1 bg-purple-500/20 text-purple-400 rounded border border-purple-500/30">AI Learned</span>' : ''}
                        </div>
                        <span class="text-xs px-2 py-1 bg-${priorityColor}-500/20 text-${priorityColor}-400 rounded">
                            ${suggestion.priority} priority
                        </span>
                    </div>
                    <p class="text-sm text-slate-300 mb-3">${suggestion.description}</p>
                    <div class="flex space-x-2">
                        <button onclick="applySuggestion('${suggestion.id}')" class="text-xs px-3 py-1 bg-blue-500 hover:bg-blue-600 text-white rounded transition-colors">
                            Apply Suggestion
                        </button>
                        <button onclick="dismissSuggestion('${suggestion.id}')" class="text-xs px-3 py-1 bg-slate-600 hover:bg-slate-700 text-white rounded transition-colors">
                            Dismiss
                        </button>
                    </div>
                `;
                
                suggestionsList.appendChild(suggestionCard);
            });
            
            suggestionsContainer.classList.remove('hidden');
            const suggestionCount = allSuggestions.length;
            const learnedCount = learnedSuggestions.length;
            showToast(`Generated ${suggestionCount} AI suggestions (${learnedCount} from your performance data)!`, 'success');
        }

        function analyzeContentPatterns() {
            // Simulate AI analysis of user's content patterns
            return [
                {
                    id: 'suggestion-1',
                    title: 'Try More Question-Based Posts',
                    description: 'Your question-based posts get 45% more engagement. Consider asking your audience about their AI implementation challenges.',
                    priority: 'high',
                    action: 'question-format'
                },
                {
                    id: 'suggestion-2', 
                    title: 'Post During Peak Hours',
                    description: 'Your audience is most active between 9-11 AM EST. Schedule more posts during this window.',
                    priority: 'medium',
                    action: 'timing-optimization'
                },
                {
                    id: 'suggestion-3',
                    title: 'Include More Visual Content',
                    description: 'Posts with images get 3x more engagement. Consider adding infographics or charts to your content.',
                    priority: 'high',
                    action: 'visual-content'
                },
                {
                    id: 'suggestion-4',
                    title: 'Focus on Implementation Stories',
                    description: 'Your audience responds well to real-world AI implementation examples. Share more case studies.',
                    priority: 'medium',
                    action: 'case-studies'
                }
            ];
        }

        function applySuggestion(suggestionId) {
            const suggestion = analyzeContentPatterns().find(s => s.id === suggestionId);
            if (!suggestion) return;
            
            // Apply the suggestion based on action type
            switch(suggestion.action) {
                case 'question-format':
                    document.getElementById('custom-topic').value = 'What\'s your biggest challenge with AI implementation?';
                    showTab('generator');
                    break;
                case 'timing-optimization':
                    showToast('Optimal posting times have been applied to your scheduler', 'success');
                    break;
                case 'visual-content':
                    showToast('Visual content emphasis applied to generation settings', 'success');
                    break;
                case 'case-studies':
                    document.getElementById('custom-topic').value = 'Real-world AI implementation success story';
                    showTab('generator');
                    break;
            }
            
            dismissSuggestion(suggestionId);
        }

        function dismissSuggestion(suggestionId) {
            // Remove suggestion from UI
            const suggestionElement = document.querySelector(`[onclick="dismissSuggestion('${suggestionId}')"]`).closest('.p-4');
            suggestionElement.remove();
        }

        function analyzeTopPosts() {
            const topPostsList = document.getElementById('top-posts-list');
            
            // Simulate top performing posts data
            const topPosts = [
                {
                    content: "AI isn't about replacing humans - it's about amplifying human potential. Here's how we're seeing this play out in real organizations...",
                    engagement: 1247,
                    views: 8932,
                    date: '2024-01-15',
                    topic: 'AI Human Collaboration'
                },
                {
                    content: "The #1 mistake companies make with AI? Starting with technology instead of strategy. Here's the right approach...",
                    engagement: 956,
                    views: 6741,
                    date: '2024-01-12',
                    topic: 'AI Strategy'
                },
                {
                    content: "Just implemented our first AI workflow. The results? 40% time savings and 90% accuracy improvement. Here's what we learned...",
                    engagement: 834,
                    views: 5623,
                    date: '2024-01-08',
                    topic: 'AI Implementation'
                }
            ];
            
            topPostsList.innerHTML = '';
            
            topPosts.forEach((post, index) => {
                const postCard = document.createElement('div');
                postCard.className = 'p-4 bg-slate-700/30 rounded-lg border border-slate-600';
                
                postCard.innerHTML = `
                    <div class="flex items-start justify-between mb-2">
                        <span class="text-xs px-2 py-1 bg-gold-500/20 text-yellow-400 rounded">#${index + 1} Top Post</span>
                        <span class="text-xs text-slate-400">${new Date(post.date).toLocaleDateString()}</span>
                    </div>
                    <p class="text-sm text-slate-300 mb-3 line-clamp-2">${post.content}</p>
                    <div class="flex items-center justify-between text-xs text-slate-400">
                        <span class="text-blue-400">${post.topic}</span>
                        <div class="flex space-x-4">
                            <span>üëÅ ${post.views.toLocaleString()}</span>
                            <span>‚ù§Ô∏è ${post.engagement.toLocaleString()}</span>
                        </div>
                    </div>
                `;
                
                topPostsList.appendChild(postCard);
            });
            
            showToast('Top posts analyzed! Check patterns for future content.', 'success');
        }

        // Custom Media Upload
        function uploadCustomMedia(postId) {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*,video/*,.gif';
            input.style.display = 'none';
            
            input.onchange = function(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                if (file.size > 10 * 1024 * 1024) { // 10MB limit
                    showToast('File size must be under 10MB', 'error');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    const post = generatedPosts.find(p => p.id === postId);
                    if (post) {
                        post.media = {
                            type: file.type.startsWith('video/') ? 'video' : 'image',
                            url: e.target.result,
                            alt: `Custom ${file.type.startsWith('video/') ? 'video' : 'image'} - ${file.name}`,
                            source: 'Custom Upload',
                            tags: ['custom', 'uploaded'],
                            fileName: file.name
                        };
                        
                        displayMultiplePosts();
                        showToast('Custom media uploaded successfully!', 'success');
                    }
                };
                
                reader.readAsDataURL(file);
            };
            
            document.body.appendChild(input);
            input.click();
            document.body.removeChild(input);
        }

        // Enhanced performance tracking with learning capabilities
        function trackPostPerformance(postId, metrics) {
            const post = scheduledPosts.find(p => p.id === postId);
            if (!post) return;
            
            // Store performance data
            const performanceData = {
                postId: postId,
                content: post.content,
                topic: post.topic,
                audience: post.audience,
                tone: post.tone,
                hasMedia: !!post.media,
                mediaType: post.media?.type,
                metrics: {
                    views: metrics.views || 0,
                    likes: metrics.likes || 0,
                    comments: metrics.comments || 0,
                    shares: metrics.shares || 0,
                    engagement: metrics.engagement || 0,
                    clickThroughRate: metrics.clickThroughRate || 0
                },
                timestamp: new Date().toISOString(),
                performanceScore: calculatePerformanceScore(metrics)
            };
            
            // Save to user's performance history
            if (!currentUser.performanceHistory) {
                currentUser.performanceHistory = [];
            }
            currentUser.performanceHistory.push(performanceData);
            
            // Update user object in storage
            const users = getUsers();
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                users[userIndex] = currentUser;
                saveUsers(users);
            }
            
            // Learn from high-performing content
            if (performanceData.performanceScore > 0.7) {
                learnFromHighPerformingPost(performanceData);
            }
        }
        
        function calculatePerformanceScore(metrics) {
            // Weighted performance score calculation
            const weights = {
                views: 0.2,
                likes: 0.25,
                comments: 0.3,
                shares: 0.25
            };
            
            const maxValues = {
                views: 10000,
                likes: 500,
                comments: 100,
                shares: 50
            };
            
            let score = 0;
            Object.keys(weights).forEach(key => {
                const normalizedValue = Math.min(metrics[key] / maxValues[key], 1);
                score += normalizedValue * weights[key];
            });
            
            return Math.round(score * 100) / 100;
        }
        
        function learnFromHighPerformingPost(performanceData) {
            // Extract patterns from high-performing content
            const patterns = {
                contentLength: performanceData.content.length,
                hasQuestions: performanceData.content.includes('?'),
                hasHashtags: performanceData.content.includes('#'),
                hasEmojis: /[\u{1F600}-\u{1F64F}]|[\u{1F300}-\u{1F5FF}]|[\u{1F680}-\u{1F6FF}]|[\u{1F1E0}-\u{1F1FF}]/u.test(performanceData.content),
                topic: performanceData.topic,
                audience: performanceData.audience,
                tone: performanceData.tone,
                mediaType: performanceData.mediaType,
                timeOfDay: new Date(performanceData.timestamp).getHours(),
                dayOfWeek: new Date(performanceData.timestamp).getDay()
            };
            
            // Store learned patterns for future content generation
            if (!currentUser.learnedPatterns) {
                currentUser.learnedPatterns = [];
            }
            currentUser.learnedPatterns.push(patterns);
            
            // Keep only the latest 50 patterns to avoid storage bloat
            if (currentUser.learnedPatterns.length > 50) {
                currentUser.learnedPatterns = currentUser.learnedPatterns.slice(-50);
            }
        }
        
        function getContentSuggestionsFromLearning() {
            if (!currentUser.learnedPatterns || currentUser.learnedPatterns.length === 0) {
                return [];
            }
            
            const patterns = currentUser.learnedPatterns;
            const suggestions = [];
            
            // Analyze most successful topics
            const topicFrequency = {};
            patterns.forEach(p => {
                topicFrequency[p.topic] = (topicFrequency[p.topic] || 0) + 1;
            });
            
            const topTopics = Object.entries(topicFrequency)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 3)
                .map(([topic]) => topic);
            
            if (topTopics.length > 0) {
                suggestions.push({
                    id: 'learned-topic',
                    title: `Focus on High-Performing Topics`,
                    description: `Your best performing topics are: ${topTopics.join(', ')}. Consider creating more content around these themes.`,
                    priority: 'high',
                    action: 'topic-focus',
                    data: topTopics
                });
            }
            
            // Analyze content structure patterns
            const avgLength = patterns.reduce((sum, p) => sum + p.contentLength, 0) / patterns.length;
            const questionPosts = patterns.filter(p => p.hasQuestions).length;
            const questionRate = questionPosts / patterns.length;
            
            if (questionRate > 0.3) {
                suggestions.push({
                    id: 'learned-questions',
                    title: 'Question-Based Posts Work Well',
                    description: `${Math.round(questionRate * 100)}% of your best posts include questions. Keep asking your audience engaging questions.`,
                    priority: 'medium',
                    action: 'question-emphasis'
                });
            }
            
            return suggestions;
        }

        // Payment Integration Functions
        let selectedPaymentMethod = 'stripe'; // Default to Stripe
        let stripe = null;
        let paypalButtons = null;

        function selectPaymentMethod(method) {
            // Remove selected class from all cards
            document.querySelectorAll('.payment-method-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Add selected class to chosen method
            document.getElementById(`payment-${method}`).classList.add('selected');
            
            // Update selected method
            selectedPaymentMethod = method;
            
            // Show selection info
            const infoDiv = document.getElementById('selected-payment-info');
            const methodName = document.getElementById('selected-method-name');
            
            const methodNames = {
                'stripe': 'Stripe (Credit/Debit Card)',
                'paypal': 'PayPal',
                'applepay': 'Apple Pay'
            };
            
            methodName.textContent = methodNames[method];
            infoDiv.classList.remove('hidden');
            
            showToast(`${methodNames[method]} selected as payment method`, 'success');
        }

        function updatePaymentMethod() {
            if (!currentUser) {
                showToast('Please log in to update payment method', 'error');
                return;
            }

            switch(selectedPaymentMethod) {
                case 'stripe':
                    initializeStripePayment();
                    break;
                case 'paypal':
                    initializePayPalPayment();
                    break;
                case 'applepay':
                    initializeApplePayPayment();
                    break;
                default:
                    showToast('Please select a payment method first', 'error');
            }
        }

        function initializeStripePayment() {
            try {
                // if (typeof Stripe === 'undefined') {
                //     showToast('Stripe is not loaded. Please refresh the page.', 'error');
                //     return;
                // }

                // stripe = Stripe('pk_test_your_stripe_publishable_key_here'); // Replace with actual key
                
                // Create payment intent and show card element
                showToast('Redirecting to Stripe for secure payment setup...', 'info');
                
                // In production, this would create a setup intent for future payments
                setTimeout(() => {
                    showToast('Stripe payment method setup complete!', 'success');
                    updateUserPaymentMethod('stripe');
                }, 2000);
                
            } catch (error) {
                console.error('Stripe initialization error:', error);
                showToast('Error initializing Stripe payment. Please try again.', 'error');
            }
        }

        function initializePayPalPayment() {
            try {
                // if (typeof paypal === 'undefined') {
                //     showToast('PayPal SDK is not loaded. Please refresh the page.', 'error');
                //     return;
                // }

                showToast('Redirecting to PayPal for secure payment setup...', 'info');
                
                // In production, this would integrate with PayPal's billing agreements
                // For demo purposes, simulate successful setup
                setTimeout(() => {
                    showToast('PayPal payment method setup complete!', 'success');
                    updateUserPaymentMethod('paypal');
                }, 2000);
                
            } catch (error) {
                console.error('PayPal initialization error:', error);
                showToast('Error initializing PayPal payment. Please try again.', 'error');
            }
        }

        function initializeApplePayPayment() {
            try {
                if (!window.ApplePaySession || !ApplePaySession.canMakePayments()) {
                    showToast('Apple Pay is not available on this device/browser', 'error');
                    return;
                }

                showToast('Initializing Apple Pay...', 'info');
                
                // In production, this would create an Apple Pay payment request
                setTimeout(() => {
                    showToast('Apple Pay payment method setup complete!', 'success');
                    updateUserPaymentMethod('applepay');
                }, 2000);
                
            } catch (error) {
                console.error('Apple Pay initialization error:', error);
                showToast('Error initializing Apple Pay. Please try again.', 'error');
            }
        }

        function updateUserPaymentMethod(method) {
            if (!currentUser) return;
            
            // Update user's payment method preference
            currentUser.paymentMethod = method;
            
            // Update display
            const methodNames = {
                'stripe': 'Stripe (Credit/Debit Card)',
                'paypal': 'PayPal',
                'applepay': 'Apple Pay'
            };
            
            // Save to localStorage (in production, this would go to a secure backend)
            const users = getUsers();
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                users[userIndex] = currentUser;
                saveUsers(users);
            }
        }

        function viewBillingHistory() {
            if (!currentUser) {
                showToast('Please log in to view billing history', 'error');
                return;
            }

            // Simulate billing history
            const billingHistory = [
                {
                    date: '2024-01-15',
                    amount: '$99.00',
                    plan: 'Enterprise',
                    status: 'Paid',
                    method: 'Stripe'
                },
                {
                    date: '2023-12-15', 
                    amount: '$99.00',
                    plan: 'Enterprise',
                    status: 'Paid',
                    method: 'Stripe'
                },
                {
                    date: '2023-11-15',
                    amount: '$99.00', 
                    plan: 'Enterprise',
                    status: 'Paid',
                    method: 'PayPal'
                }
            ];

            let historyHTML = '<div class="space-y-3">';
            billingHistory.forEach(item => {
                historyHTML += `
                    <div class="flex items-center justify-between p-3 bg-slate-700/30 rounded-lg">
                        <div>
                            <p class="text-white font-medium">${item.amount} - ${item.plan}</p>
                            <p class="text-sm text-slate-400">${item.date} via ${item.method}</p>
                        </div>
                        <span class="text-xs px-2 py-1 bg-green-500/20 text-green-400 rounded">${item.status}</span>
                    </div>
                `;
            });
            historyHTML += '</div>';

            // Show in a toast or modal (simplified for demo)
            showToast('Billing history loaded - check console for details', 'success');
            console.log('Billing History:', billingHistory);
        }

        function loadBillingSettings() {
            if (!currentUser) return;
            
            // Set default payment method selection if user has one
            if (currentUser.paymentMethod) {
                selectPaymentMethod(currentUser.paymentMethod);
            } else {
                // Default to Stripe
                selectPaymentMethod('stripe');
            }
            
            // Update current plan display based on user data
            const planNames = {
                'basic': 'Basic',
                'pro': 'Pro', 
                'enterprise': 'Enterprise'
            };
            
            const planDetails = {
                'basic': '5 posts/month, Basic AI models, Email support',
                'pro': '100 posts/month, 50 AI images/month, Advanced AI models, Priority support',
                'enterprise': 'Unlimited posts, AI images, custom training, 24/7 support'
            };
            
            const userPlan = currentUser.plan || 'enterprise'; // Default to enterprise for demo
            document.getElementById('current-plan-name').textContent = planNames[userPlan];
            document.getElementById('current-plan-details').textContent = planDetails[userPlan];
        }

        // Make key functions globally accessible
        window.useDemoAccount = useDemoAccount;
        window.generateMultiplePosts = generateMultiplePosts;
        window.showTab = showTab;

        console.log('‚úÖ AIfluence script loaded successfully!');
        
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üéØ DOM loaded, attaching event listeners...');
            initializeAuth();
            
            // Attach authentication event listeners
            const demoBtn = document.getElementById('demo-account-btn');
            if (demoBtn) {
                console.log('üì± Demo button found, attaching listener...');
                demoBtn.addEventListener('click', useDemoAccount);
            } else {
                console.error('‚ùå Demo button not found!');
            }
            
            const loginBtn = document.getElementById('login-btn');
            if (loginBtn) {
                loginBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('üîÑ Login button clicked');
                    handleLogin();
                });
                console.log('‚úÖ Login button event listener attached');
            } else {
                console.log('‚ùå Login button not found');
            }
            
            const registerBtn = document.getElementById('register-btn');
            if (registerBtn) {
                registerBtn.addEventListener('click', handleRegister);
            }
            
            // Connect Generate 5 Posts button
            const generateMultipleBtn = document.getElementById('generate-multiple-btn');
            if (generateMultipleBtn) {
                generateMultipleBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('üîÑ Generate 5 Posts button clicked');
                    generateMultiplePosts();
                });
                console.log('‚úÖ Generate 5 Posts button event listener attached');
            } else {
                console.log('‚ùå Generate 5 Posts button not found');
            }
            
            const showRegisterBtn = document.getElementById('show-register-btn');
            if (showRegisterBtn) {
                showRegisterBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('üîÑ Show register button clicked');
                    showRegisterForm();
                });
                console.log('‚úÖ Show register button event listener attached');
            } else {
                console.log('‚ùå Show register button not found');
            }
            
            const showLoginBtn = document.getElementById('show-login-btn');
            if (showLoginBtn) {
                showLoginBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('üîÑ Show login button clicked');
                    showLoginForm();
                });
                console.log('‚úÖ Show login button event listener attached');
            } else {
                console.log('‚ùå Show login button not found');
            }
            
            const logoutBtn = document.getElementById('logout-btn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('üîÑ Logout button clicked');
                    handleLogout();
                });
                console.log('‚úÖ Logout button event listener attached');
            } else {
                console.log('‚ùå Logout button not found');
            }
            
            // LinkedIn connect buttons now use inline onclick handlers
            console.log('‚úÖ LinkedIn buttons use inline onclick handlers for better reliability');
            
            // Content suggestions button
            const contentSuggestionsBtn = document.getElementById('generate-content-suggestions');
            if (contentSuggestionsBtn) {
                contentSuggestionsBtn.addEventListener('click', generateContentSuggestions);
                console.log('‚úÖ Content suggestions button event listener attached');
            }
            
            // Test mode buttons
            const toggleTestModeBtn = document.getElementById('toggle-test-mode');
            if (toggleTestModeBtn) {
                toggleTestModeBtn.addEventListener('click', toggleTestMode);
                console.log('‚úÖ Test mode toggle button event listener attached');
            }
            
            const testFreePlanBtn = document.getElementById('test-free-plan');
            if (testFreePlanBtn) {
                testFreePlanBtn.addEventListener('click', () => testPlan('free'));
                console.log('‚úÖ Test free plan button event listener attached');
            }
            
            const testProPlanBtn = document.getElementById('test-pro-plan');
            if (testProPlanBtn) {
                testProPlanBtn.addEventListener('click', () => testPlan('pro'));
                console.log('‚úÖ Test pro plan button event listener attached');
            }
            
            const testEnterprisePlanBtn = document.getElementById('test-enterprise-plan');
            if (testEnterprisePlanBtn) {
                testEnterprisePlanBtn.addEventListener('click', () => testPlan('enterprise'));
                console.log('‚úÖ Test enterprise plan button event listener attached');
            }
            
            // Payment method selection buttons (multiple instances)
            const paymentMethodButtons = [
                { id: 'payment-method-stripe-1', method: 'stripe' },
                { id: 'payment-method-paypal-1', method: 'paypal' },
                { id: 'payment-method-applepay-1', method: 'applepay' },
                { id: 'payment-stripe', method: 'stripe' },
                { id: 'payment-paypal', method: 'paypal' },
                { id: 'payment-applepay', method: 'applepay' }
            ];
            
            paymentMethodButtons.forEach(({ id, method }) => {
                const btn = document.getElementById(id);
                if (btn) {
                    btn.addEventListener('click', () => selectPaymentMethod(method));
                    console.log(`‚úÖ Payment method button ${id} event listener attached`);
                }
            });
            
            // Note: loadUserUsage and loadScheduledPosts are now called by loadUserData() after login
        });
        
        // Final test script to run after everything loads
        console.log('üèÅ Final script check - DOMContentLoaded listeners should be set up');
        
        // Emergency backup handlers
        window.addEventListener('load', function() {
            console.log('üö® EMERGENCY: Window loaded, adding backup handlers');
            
            const loginBtn = document.getElementById('login-btn');
            const showRegisterBtn = document.getElementById('show-register-btn');
            
            console.log('üö® Emergency check - Login button:', loginBtn);
            console.log('üö® Emergency check - Register button:', showRegisterBtn);
            
            if (loginBtn) {
                loginBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('üö® EMERGENCY LOGIN HANDLER ACTIVATED');
                    alert('Emergency login handler activated - this means the main handlers failed');
                });
                console.log('üö® Emergency login handler added');
            }
            
            if (showRegisterBtn) {
                showRegisterBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('üö® EMERGENCY REGISTER HANDLER ACTIVATED');
                    alert('Emergency register handler activated - this means the main handlers failed');
                });
                console.log('üö® Emergency register handler added');
            }
        });
    </script>
    
    </div> <!-- End Main Content Container -->
    
</body>
</html>